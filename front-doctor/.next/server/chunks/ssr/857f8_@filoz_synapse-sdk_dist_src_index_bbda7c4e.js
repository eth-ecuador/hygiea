module.exports=[106679,a=>{"use strict";let b,c,d;var e,f=a.i(112662),f=f;a.s([],312151);var g=a.i(572139);let h=[...g.erc20Abi,{type:"function",stateMutability:"view",name:"nonces",inputs:[{name:"owner",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",stateMutability:"view",name:"version",inputs:[],outputs:[{name:"",type:"string"}]}];a.s(["erc20WithPermit",0,h],176337);let i=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"COMMISSION_MAX_BPS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NETWORK_FEE_DENOMINATOR",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NETWORK_FEE_NUMERATOR",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"owner",internalType:"address",type:"address"}],name:"accounts",outputs:[{name:"funds",internalType:"uint256",type:"uint256"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"}],name:"auctionInfo",outputs:[{name:"startPrice",internalType:"uint88",type:"uint88"},{name:"startTime",internalType:"uint168",type:"uint168"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"recipient",internalType:"address",type:"address"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"burnForFees",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}],name:"createRail",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"}],name:"depositWithAuthorization",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"depositWithAuthorizationAndApproveOperator",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"depositWithAuthorizationAndIncreaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"}],name:"depositWithPermit",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndApproveOperator",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndIncreaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"owner",internalType:"address",type:"address"}],name:"getAccountInfoIfSettled",outputs:[{name:"fundedUntilEpoch",internalType:"uint256",type:"uint256"},{name:"currentFunds",internalType:"uint256",type:"uint256"},{name:"availableFunds",internalType:"uint256",type:"uint256"},{name:"currentLockupRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRail",outputs:[{name:"",internalType:"struct FilecoinPayV1.RailView",type:"tuple",components:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupPeriod",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"},{name:"settledUpTo",internalType:"uint256",type:"uint256"},{name:"endEpoch",internalType:"uint256",type:"uint256"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getRailsForPayeeAndToken",outputs:[{name:"results",internalType:"struct FilecoinPayV1.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]},{name:"nextOffset",internalType:"uint256",type:"uint256"},{name:"total",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getRailsForPayerAndToken",outputs:[{name:"results",internalType:"struct FilecoinPayV1.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]},{name:"nextOffset",internalType:"uint256",type:"uint256"},{name:"total",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRateChangeQueueSize",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"increaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"period",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"}],name:"modifyRailLockup",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"newRate",internalType:"uint256",type:"uint256"},{name:"oneTimePayment",internalType:"uint256",type:"uint256"}],name:"modifyRailPayment",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"client",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"operatorApprovals",outputs:[{name:"isApproved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"approved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"setOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"untilEpoch",internalType:"uint256",type:"uint256"}],name:"settleRail",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"totalNetworkFee",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"settleTerminatedRailWithoutValidation",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"totalNetworkFee",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"terminateRail",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdrawTo",outputs:[],stateMutability:"nonpayable"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"owner",internalType:"address",type:"address",indexed:!0},{name:"lockupCurrent",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256",indexed:!1}],name:"AccountLockupSettled"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1}],name:"DepositRecorded"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"client",internalType:"address",type:"address",indexed:!0},{name:"operator",internalType:"address",type:"address",indexed:!0},{name:"approved",internalType:"bool",type:"bool",indexed:!1},{name:"rateAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1}],name:"OperatorApprovalUpdated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"payer",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0},{name:"token",internalType:"contract IERC20",type:"address",indexed:!1},{name:"operator",internalType:"address",type:"address",indexed:!1},{name:"validator",internalType:"address",type:"address",indexed:!1},{name:"serviceFeeRecipient",internalType:"address",type:"address",indexed:!1},{name:"commissionRateBps",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailCreated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0}],name:"RailFinalized"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"oldLockupFixed",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupFixed",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailLockupModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"netPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1},{name:"networkFee",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailOneTimePaymentProcessed"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"totalSettledAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1},{name:"networkFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"settledUpTo",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailSettled"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"by",internalType:"address",type:"address",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailTerminated"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1}],name:"WithdrawRecorded"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxSettlementEpoch",internalType:"uint256",type:"uint256"},{name:"blockNumber",internalType:"uint256",type:"uint256"}],name:"CannotModifyTerminatedRailBeyondEndEpoch"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowedEpoch",internalType:"uint256",type:"uint256"},{name:"attemptedEpoch",internalType:"uint256",type:"uint256"}],name:"CannotSettleFutureEpochs"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"requiredBlock",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"CannotSettleTerminatedRailBeforeMaxEpoch"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionRateTooHigh"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"oldLockup",internalType:"uint256",type:"uint256"},{name:"currentLockup",internalType:"uint256",type:"uint256"}],name:"CurrentLockupLessThanOldLockup"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"currentLockup",internalType:"uint256",type:"uint256"},{name:"lockupReduction",internalType:"uint256",type:"uint256"}],name:"InsufficientCurrentLockup"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"required",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForOneTimePayment"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForSettlement"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupForSettlement"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"InsufficientNativeTokenForBurn"},{type:"error",inputs:[{name:"available",internalType:"uint256",type:"uint256"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"InsufficientUnlockedFunds"},{type:"error",inputs:[{name:"nextRateChangeUntilEpoch",internalType:"uint256",type:"uint256"},{name:"processedEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidRateChangeQueueState"},{type:"error",inputs:[{name:"actualPeriod",internalType:"uint256",type:"uint256"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"InvalidTerminatedRailModification"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"account",internalType:"address",type:"address"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"fundsCurrent",internalType:"uint256",type:"uint256"}],name:"LockupExceedsFundsInvariant"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"LockupFixedIncreaseNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"expectedLockup",internalType:"uint256",type:"uint256"},{name:"actualLockup",internalType:"uint256",type:"uint256"}],name:"LockupInconsistencyDuringRailFinalization"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"isSettled",internalType:"bool",type:"bool"},{name:"currentRate",internalType:"uint256",type:"uint256"},{name:"attemptedRate",internalType:"uint256",type:"uint256"}],name:"LockupNotSettledRateChangeNotAllowed"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodChangeNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxAllowedPeriod",internalType:"uint256",type:"uint256"},{name:"requestedPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodExceedsOperatorMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"}],name:"LockupRateInconsistent"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"oldRate",internalType:"uint256",type:"uint256"}],name:"LockupRateLessThanOldRate"},{type:"error",inputs:[],name:"MissingServiceFeeRecipient"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"MustSendExactNativeAmount"},{type:"error",inputs:[{name:"sent",internalType:"uint256",type:"uint256"}],name:"NativeTokenNotAccepted"},{type:"error",inputs:[],name:"NativeTokenNotSupported"},{type:"error",inputs:[{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"NativeTransferFailed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"expectedSettledUpTo",internalType:"uint256",type:"uint256"},{name:"actualSettledUpTo",internalType:"uint256",type:"uint256"}],name:"NoProgressInSettlement"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedClient",internalType:"address",type:"address"},{name:"allowedOperator",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"NotAuthorizedToTerminateRail"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"OneTimePaymentExceedsLockup"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailClientAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailOperatorAllowed"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorLockupAllowanceExceeded"},{type:"error",inputs:[{name:"from",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorRateAllowanceExceeded"},{type:"error",inputs:[{name:"x",internalType:"uint256",type:"uint256"},{name:"y",internalType:"uint256",type:"uint256"},{name:"denominator",internalType:"uint256",type:"uint256"}],name:"PRBMath_MulDiv_Overflow"},{type:"error",inputs:[{name:"x",internalType:"UD60x18",type:"uint256"}],name:"PRBMath_UD60x18_Exp2_InputTooBig"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailAlreadyTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailInactiveOrSettled"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RateChangeNotAllowedOnTerminatedRail"},{type:"error",inputs:[{name:"nextUntilEpoch",internalType:"uint256",type:"uint256"}],name:"RateChangeQueueNotEmpty"},{type:"error",inputs:[],name:"ReentrancyGuardReentrantCall"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"}],name:"SafeERC20FailedOperation"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"SignerMustBeMsgSender"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"attempted",internalType:"uint256",type:"uint256"}],name:"ValidatorModifiedAmountExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedStart",internalType:"uint256",type:"uint256"},{name:"attemptedStart",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeforeSegmentStart"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedEnd",internalType:"uint256",type:"uint256"},{name:"attemptedEnd",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeyondSegmentEnd"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"WithdrawAmountExceedsAccumulatedFees"},{type:"error",inputs:[{name:"varName",internalType:"string",type:"string"}],name:"ZeroAddressNotAllowed"}],j=[{type:"constructor",inputs:[{name:"_service",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"challengeWindow",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"}],name:"clientDataSets",outputs:[{name:"dataSetIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"nonce",internalType:"uint256",type:"uint256"}],name:"clientNonces",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"filBeamControllerAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getAllDataSetMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getAllPieceMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getApprovedProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getApprovedProvidersLength",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengesPerProof",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"pure"},{type:"function",inputs:[{name:"client",internalType:"address",type:"address"}],name:"getClientDataSets",outputs:[{name:"infos",internalType:"struct FilecoinWarmStorageService.DataSetInfoView[]",type:"tuple[]",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"dataSetId",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"getCurrentPricingRates",outputs:[{name:"storagePrice",internalType:"uint256",type:"uint256"},{name:"minimumRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getDataSet",outputs:[{name:"info",internalType:"struct FilecoinWarmStorageService.DataSetInfoView",type:"tuple",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"dataSetId",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getDataSetMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"leafCount",internalType:"uint256",type:"uint256"}],name:"getDataSetSizeInBytes",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"pure"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getDataSetStatus",outputs:[{name:"status",internalType:"enum FilecoinWarmStorageService.DataSetStatus",type:"uint8"}],stateMutability:"view"},{type:"function",inputs:[],name:"getMaxProvingPeriod",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[],name:"getPDPConfig",outputs:[{name:"maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"challengesPerProof",internalType:"uint256",type:"uint256"},{name:"initChallengeWindowStart",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getPieceMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderApproved",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"nextPDPChallengeWindowStart",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"nextUpgrade",outputs:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodId",internalType:"uint256",type:"uint256"}],name:"provenPeriods",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provenThisPeriod",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provingActivationEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"provingDeadline",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"railToDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"service",outputs:[{name:"",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"serviceCommissionBps",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodNotInitialized"}],k=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"MAX_ENQUEUED_REMOVALS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_PIECE_SIZE_LOG2",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_CHALLENGE_SCHEDULED",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_PROVEN_EPOCH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"listenerAddr",internalType:"address",type:"address"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"addPieces",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"calculateProofFee",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"proofSize",internalType:"uint256",type:"uint256"}],name:"calculateProofFeeForSize",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"claimDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"listenerAddr",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"createDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"dataSetLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"deleteDataSet",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"feeEffectiveTime",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[],name:"feePerTiB",outputs:[{name:"",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"leafIndexs",internalType:"uint256[]",type:"uint256[]"}],name:"findPieceIds",outputs:[{name:"",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getActivePieceCount",outputs:[{name:"activeCount",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getActivePieces",outputs:[{name:"pieces",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengeFinality",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getChallengeRange",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLastProvenEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetListener",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetStorageProvider",outputs:[{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextChallengeEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextDataSetId",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextPieceId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceCid",outputs:[{name:"",internalType:"struct Cids.Cid",type:"tuple",components:[{name:"data",internalType:"bytes",type:"bytes"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getRandomness",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getScheduledRemovals",outputs:[{name:"",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"_challengeFinality",internalType:"uint256",type:"uint256"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceChallengable",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"newStorageProvider",internalType:"address",type:"address"}],name:"proposeDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"proposedFeePerTiB",outputs:[{name:"",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"proofs",internalType:"struct IPDPTypes.Proof[]",type:"tuple[]",components:[{name:"leaf",internalType:"bytes32",type:"bytes32"},{name:"proof",internalType:"bytes32[]",type:"bytes32[]"}]}],name:"provePossession",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"schedulePieceDeletions",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newFeePerTiB",internalType:"uint256",type:"uint256"}],name:"updateProofFee",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"storageProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"deletedLeafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"DataSetDeleted"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0}],name:"DataSetEmpty"},{type:"event",anonymous:!1,inputs:[{name:"currentFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"newFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"effectiveTime",internalType:"uint256",type:"uint256",indexed:!1}],name:"FeeUpdateProposed"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challengeEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"leafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"NextProvingPeriod"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1},{name:"pieceCids",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}],indexed:!1}],name:"PiecesAdded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1}],name:"PiecesRemoved"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challenges",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}],indexed:!1}],name:"PossessionProven"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"fee",internalType:"uint256",type:"uint256",indexed:!1}],name:"ProofFeePaid"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldStorageProvider",internalType:"address",type:"address",indexed:!0},{name:"newStorageProvider",internalType:"address",type:"address",indexed:!0}],name:"StorageProviderChanged"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"idx",internalType:"uint256",type:"uint256"},{name:"msg",internalType:"string",type:"string"}],name:"IndexedError"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],l=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"MAX_CAPABILITIES",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_KEY_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_VALUE_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"REGISTRATION_FEE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"activeProductTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"activeProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"addProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"addressToProviderId",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getAllActiveProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"getAllProductCapabilities",outputs:[{name:"isActive",internalType:"bool",type:"bool"},{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"bytes[]",type:"bytes[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextProviderId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"keys",internalType:"string[]",type:"string[]"}],name:"getProductCapabilities",outputs:[{name:"values",internalType:"bytes[]",type:"bytes[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getProvider",outputs:[{name:"info",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderByAddress",outputs:[{name:"info",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]}],stateMutability:"view"},{type:"function",inputs:[],name:"getProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderIdByAddress",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getProviderPayee",outputs:[{name:"payee",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"getProviderWithProduct",outputs:[{name:"",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"productCapabilityValues",internalType:"bytes[]",type:"bytes[]"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"}],name:"getProvidersByIds",outputs:[{name:"providerInfos",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]},{name:"validIds",internalType:"bool[]",type:"bool[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"onlyActive",internalType:"bool",type:"bool"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getProvidersByProductType",outputs:[{name:"result",internalType:"struct ServiceProviderRegistryStorage.PaginatedProviders",type:"tuple",components:[{name:"providers",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"productCapabilityValues",internalType:"bytes[]",type:"bytes[]"}]},{name:"hasMore",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderActive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"isRegisteredProvider",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"newVersion",internalType:"string",type:"string"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"key",internalType:"string",type:"string"}],name:"productCapabilities",outputs:[{name:"value",internalType:"bytes",type:"bytes"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"productTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerHasProduct",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerProducts",outputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"providers",outputs:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"registerProvider",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"removeProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"removeProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"updateProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"}],name:"updateProviderInfo",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]",indexed:!1}],name:"ProductAdded"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0}],name:"ProductRemoved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]",indexed:!1}],name:"ProductUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderInfoUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0}],name:"ProviderRegistered"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderRemoved"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"InsufficientCapabilitiesForProduct"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],m=[{type:"constructor",inputs:[{name:"_pdpVerifierAddress",internalType:"address",type:"address"},{name:"_paymentsContractAddress",internalType:"address",type:"address"},{name:"_usdfc",internalType:"contract IERC20Metadata",type:"address"},{name:"_filBeamBeneficiaryAddress",internalType:"address",type:"address"},{name:"_serviceProviderRegistry",internalType:"contract ServiceProviderRegistry",type:"address"},{name:"_sessionKeyRegistry",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"addApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"plannedUpgrade",internalType:"struct FilecoinWarmStorageService.PlannedUpgrade",type:"tuple",components:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}]}],name:"announcePlannedUpgrade",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"totalBytes",internalType:"uint256",type:"uint256"}],name:"calculateRatePerEpoch",outputs:[{name:"storageRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"configureProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"dataSetCreated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"bytes",type:"bytes"}],name:"dataSetDeleted",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"extsload",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"},{name:"size",internalType:"uint256",type:"uint256"}],name:"extsloadStruct",outputs:[{name:"",internalType:"bytes32[]",type:"bytes32[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"filBeamBeneficiaryAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"getEffectiveRates",outputs:[{name:"serviceFee",internalType:"uint256",type:"uint256"},{name:"spPayment",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getProvingPeriodForEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getServicePrice",outputs:[{name:"pricing",internalType:"struct FilecoinWarmStorageService.ServicePricing",type:"tuple",components:[{name:"pricePerTiBPerMonthNoCDN",internalType:"uint256",type:"uint256"},{name:"pricePerTiBCdnEgress",internalType:"uint256",type:"uint256"},{name:"pricePerTiBCacheMissEgress",internalType:"uint256",type:"uint256"},{name:"tokenAddress",internalType:"contract IERC20",type:"address"},{name:"epochsPerMonth",internalType:"uint256",type:"uint256"},{name:"minimumPricePerMonth",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"_filBeamControllerAddress",internalType:"address",type:"address"},{name:"_name",internalType:"string",type:"string"},{name:"_description",internalType:"string",type:"string"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"leafCount",internalType:"uint256",type:"uint256"},{name:"",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"paymentsContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"pdpVerifierAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"firstAdded",internalType:"uint256",type:"uint256"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesAdded",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesScheduledRemove",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"challengeCount",internalType:"uint256",type:"uint256"}],name:"possessionProven",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"terminator",internalType:"address",type:"address"},{name:"endEpoch",internalType:"uint256",type:"uint256"}],name:"railTerminated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"index",internalType:"uint256",type:"uint256"}],name:"removeApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"serviceProviderRegistry",outputs:[{name:"",internalType:"contract ServiceProviderRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"sessionKeyRegistry",outputs:[{name:"",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"setViewContract",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"cdnAmount",internalType:"uint256",type:"uint256"},{name:"cacheMissAmount",internalType:"uint256",type:"uint256"}],name:"settleFilBeamPaymentRails",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"},{name:"",internalType:"bytes",type:"bytes"}],name:"storageProviderChanged",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateCDNService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"cdnAmountToAdd",internalType:"uint256",type:"uint256"},{name:"cacheMissAmountToAdd",internalType:"uint256",type:"uint256"}],name:"topUpCDNPaymentRails",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newController",internalType:"address",type:"address"}],name:"transferFilBeamController",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newStoragePrice",internalType:"uint256",type:"uint256"},{name:"newMinimumRate",internalType:"uint256",type:"uint256"}],name:"updatePricing",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newCommissionBps",internalType:"uint256",type:"uint256"}],name:"updateServiceCommission",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"usdfcTokenAddress",outputs:[{name:"",internalType:"contract IERC20Metadata",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"proposedAmount",internalType:"uint256",type:"uint256"},{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"}],name:"validatePayment",outputs:[{name:"result",internalType:"struct IValidator.ValidationResult",type:"tuple",components:[{name:"modifiedAmount",internalType:"uint256",type:"uint256"},{name:"settleUpto",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"viewContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"cdnAmountAdded",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalCdnLockup",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissAmountAdded",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalCacheMissLockup",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNPaymentRailsToppedUp"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"payer",internalType:"address",type:"address",indexed:!1},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"payee",internalType:"address",type:"address",indexed:!1},{name:"metadataKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"metadataValues",internalType:"string[]",type:"string[]",indexed:!1}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldServiceProvider",internalType:"address",type:"address",indexed:!0},{name:"newServiceProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetServiceProviderChanged"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"periodsFaulted",internalType:"uint256",type:"uint256",indexed:!1},{name:"deadline",internalType:"uint256",type:"uint256",indexed:!1}],name:"FaultRecord"},{type:"event",anonymous:!1,inputs:[{name:"oldController",internalType:"address",type:"address",indexed:!1},{name:"newController",internalType:"address",type:"address",indexed:!1}],name:"FilBeamControllerChanged"},{type:"event",anonymous:!1,inputs:[{name:"name",internalType:"string",type:"string",indexed:!1},{name:"description",internalType:"string",type:"string",indexed:!1}],name:"FilecoinServiceDeployed"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"PDPPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceCid",internalType:"struct Cids.Cid",type:"tuple",components:[{name:"data",internalType:"bytes",type:"bytes"}],indexed:!1},{name:"keys",internalType:"string[]",type:"string[]",indexed:!1},{name:"values",internalType:"string[]",type:"string[]",indexed:!1}],name:"PieceAdded"},{type:"event",anonymous:!1,inputs:[{name:"storagePrice",internalType:"uint256",type:"uint256",indexed:!1},{name:"minimumRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"PricingUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderApproved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderUnapproved"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"railId",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateUpdated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"ServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"plannedUpgrade",internalType:"struct FilecoinWarmStorageService.PlannedUpgrade",type:"tuple",components:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}],indexed:!1}],name:"UpgradeAnnounced"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"event",anonymous:!1,inputs:[{name:"viewContract",internalType:"address",type:"address",indexed:!0}],name:"ViewContractSet"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[],name:"AtLeastOnePriceMustBeNonZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CDNPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CacheMissPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayer"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"expectedPayee",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayerOrPayee"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"CallerNotPayments"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"windowStart",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ChallengeWindowTooEarly"},{type:"error",inputs:[{name:"clientDataSetId",internalType:"uint256",type:"uint256"}],name:"ClientDataSetAlreadyRegistered"},{type:"error",inputs:[{name:"commissionType",internalType:"enum Errors.CommissionType",type:"uint8"},{name:"max",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"DataSetNotFoundForRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentBeyondEndEpoch"},{type:"error",inputs:[],name:"DivisionByZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"DuplicateMetadataKey"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"ExtraDataRequired"},{type:"error",inputs:[{name:"actualSize",internalType:"uint256",type:"uint256"},{name:"maxAllowedSize",internalType:"uint256",type:"uint256"}],name:"ExtraDataTooLarge"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilBeamServiceNotConfigured"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"minimumRequired",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForMinimumRate"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"minimumLockupRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupAllowance"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"},{name:"requiredLockupPeriod",internalType:"uint256",type:"uint256"}],name:"InsufficientMaxLockupPeriod"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"minimumRateRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientRateAllowance"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minExpected",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeCount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minAllowed",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeEpoch"},{type:"error",inputs:[{name:"maxProvingPeriod",internalType:"uint256",type:"uint256"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeWindowSize"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidDataSetId"},{type:"error",inputs:[{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidEpochRange"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceDescriptionLength"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceNameLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidTopUpAmount"},{type:"error",inputs:[],name:"MaxProvingPeriodZero"},{type:"error",inputs:[{name:"metadataArrayCount",internalType:"uint256",type:"uint256"},{name:"pieceCount",internalType:"uint256",type:"uint256"}],name:"MetadataArrayCountMismatch"},{type:"error",inputs:[{name:"keysLength",internalType:"uint256",type:"uint256"},{name:"valuesLength",internalType:"uint256",type:"uint256"}],name:"MetadataKeyAndValueLengthMismatch"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataKeyExceedsMaxLength"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataValueExceedsMaxLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodDeadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"NextProvingPeriodAlreadyCalled"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"NoPDPPaymentRail"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyFilBeamControllerAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyPDPVerifierAllowed"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"}],name:"PaymentRailsNotFinalized"},{type:"error",inputs:[{name:"priceType",internalType:"enum Errors.PriceType",type:"uint8"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"PriceExceedsMaximum"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProofAlreadySubmitted"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderAlreadyApproved"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotInApprovedList"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"ProviderNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingNotStarted"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodPassed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotAssociated"},{type:"error",inputs:[],name:"ServiceContractMustTerminateRail"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"keysLength",internalType:"uint256",type:"uint256"}],name:"TooManyMetadataKeys"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"ZeroAddress"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"AddressAlreadySet"},{type:"error",inputs:[],name:"AtLeastOnePriceMustBeNonZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CDNPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CacheMissPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayer"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"expectedPayee",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayerOrPayee"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"CallerNotPayments"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"windowStart",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ChallengeWindowTooEarly"},{type:"error",inputs:[{name:"clientDataSetId",internalType:"uint256",type:"uint256"}],name:"ClientDataSetAlreadyRegistered"},{type:"error",inputs:[{name:"commissionType",internalType:"enum Errors.CommissionType",type:"uint8"},{name:"max",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"DataSetNotFoundForRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentBeyondEndEpoch"},{type:"error",inputs:[],name:"DivisionByZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"DuplicateMetadataKey"},{type:"error",inputs:[],name:"ExtraDataRequired"},{type:"error",inputs:[{name:"actualSize",internalType:"uint256",type:"uint256"},{name:"maxAllowedSize",internalType:"uint256",type:"uint256"}],name:"ExtraDataTooLarge"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilBeamServiceNotConfigured"},{type:"error",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"InsufficientCapabilitiesForProduct"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"minimumRequired",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForMinimumRate"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"minimumLockupRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupAllowance"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"},{name:"requiredLockupPeriod",internalType:"uint256",type:"uint256"}],name:"InsufficientMaxLockupPeriod"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"minimumRateRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientRateAllowance"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minExpected",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeCount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minAllowed",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeEpoch"},{type:"error",inputs:[{name:"maxProvingPeriod",internalType:"uint256",type:"uint256"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeWindowSize"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidDataSetId"},{type:"error",inputs:[{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidEpochRange"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceDescriptionLength"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceNameLength"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"InvalidSignature"},{type:"error",inputs:[{name:"expectedLength",internalType:"uint256",type:"uint256"},{name:"actualLength",internalType:"uint256",type:"uint256"}],name:"InvalidSignatureLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidTopUpAmount"},{type:"error",inputs:[],name:"MaxProvingPeriodZero"},{type:"error",inputs:[{name:"metadataArrayCount",internalType:"uint256",type:"uint256"},{name:"pieceCount",internalType:"uint256",type:"uint256"}],name:"MetadataArrayCountMismatch"},{type:"error",inputs:[{name:"keysLength",internalType:"uint256",type:"uint256"},{name:"valuesLength",internalType:"uint256",type:"uint256"}],name:"MetadataKeyAndValueLengthMismatch"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataKeyExceedsMaxLength"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataValueExceedsMaxLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodDeadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"NextProvingPeriodAlreadyCalled"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"NoPDPPaymentRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OldServiceProviderMismatch"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyFilBeamControllerAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyPDPVerifierAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlySelf"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"}],name:"PaymentRailsNotFinalized"},{type:"error",inputs:[{name:"priceType",internalType:"enum Errors.PriceType",type:"uint8"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"PriceExceedsMaximum"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProofAlreadySubmitted"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderAlreadyApproved"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotInApprovedList"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"ProviderNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingNotStarted"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodNotInitialized"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodPassed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotAssociated"},{type:"error",inputs:[],name:"ServiceContractMustTerminateRail"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"keysLength",internalType:"uint256",type:"uint256"}],name:"TooManyMetadataKeys"},{type:"error",inputs:[{name:"v",internalType:"uint8",type:"uint8"}],name:"UnsupportedSignatureV"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"ZeroAddress"}];a.i(176337);let n=BigInt(4),o=BigInt(127),p=BigInt(128),q=254/256,r=32,s=BigInt(32),t=2*r+1,u=(a=>{if(a instanceof Uint8Array){if(a.length>r)return a.subarray(0,r);else if(a.length==r)return a}let b=new Uint8Array(r);return b.set([...a]),b})(new Uint8Array(r).fill(0));Object.freeze(u.buffer);let v=new Uint8Array(0);function w(a){return a.reduce((a,b)=>a+b.toString(16).padStart(2,"0"),"")}function x(a){let b=a.match(/../g);return null!=b?new Uint8Array(b.map(a=>parseInt(a,16))):v}function y(a,b){if(a===b)return!0;if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.byteLength;c++)if(a[c]!==b[c])return!1;return!0}function z(a){if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")}function A(a){return a instanceof ArrayBuffer||ArrayBuffer.isView(a)}function B(a){return new TextEncoder().encode(a)}function C(a){return new TextDecoder().decode(a)}a.s(["coerce",()=>z,"empty",0,v,"equals",()=>y,"fromHex",()=>x,"fromString",()=>B,"isBinary",()=>A,"toHex",()=>w,"toString",()=>C],530984);var D=a.i(666680);let E="sha2-256",F=new Uint8Array([18,32]);class G{constructor(a){this.code=18,this.name=E,this.bytes=a,this.size=32,this.digest=a.subarray(2)}}let H=a=>{let b=new Uint8Array(F.length+32);return b.set(F,0),b.set(D.default.createHash("sha256").update(a).digest(),F.length),new G(b)};a.s(["digest",0,H],470255),a.s(["code",0,18],381307);let I=["string","number","bigint","symbol"],J=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class K{constructor(a,b,c){this.major=a,this.majorEncoded=a<<5,this.name=b,this.terminal=c}toString(){return`Type[${this.major}].${this.name}`}compare(a){return this.major<a.major?-1:+(this.major>a.major)}}K.uint=new K(0,"uint",!0),K.negint=new K(1,"negint",!0),K.bytes=new K(2,"bytes",!0),K.string=new K(3,"string",!0),K.array=new K(4,"array",!1),K.map=new K(5,"map",!1),K.tag=new K(6,"tag",!1),K.float=new K(7,"float",!0),K.false=new K(7,"false",!0),K.true=new K(7,"true",!0),K.null=new K(7,"null",!0),K.undefined=new K(7,"undefined",!0),K.break=new K(7,"break",!0);class L{constructor(a,b,c){this.type=a,this.value=b,this.encodedLength=c,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let M=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,N=new TextDecoder,O=new TextEncoder;function P(a){return M&&globalThis.Buffer.isBuffer(a)}function Q(a){return a instanceof Uint8Array?P(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a:Uint8Array.from(a)}let R=M?(a,b,c)=>c-b>64?globalThis.Buffer.from(a.subarray(b,c)).toString("utf8"):Y(a,b,c):(a,b,c)=>c-b>64?N.decode(a.subarray(b,c)):Y(a,b,c),S=M?a=>a.length>64?globalThis.Buffer.from(a):X(a):a=>a.length>64?O.encode(a):X(a),T=M?(a,b,c)=>P(a)?new Uint8Array(a.subarray(b,c)):a.slice(b,c):(a,b,c)=>a.slice(b,c),U=M?(a,b)=>(a=a.map(a=>a instanceof Uint8Array?a:globalThis.Buffer.from(a)),Q(globalThis.Buffer.concat(a,b))):(a,b)=>{let c=new Uint8Array(b),d=0;for(let b of a)d+b.length>c.length&&(b=b.subarray(0,c.length-d)),c.set(b,d),d+=b.length;return c},V=M?a=>globalThis.Buffer.allocUnsafe(a):a=>new Uint8Array(a);function W(a,b){if(P(a)&&P(b))return a.compare(b);for(let c=0;c<a.length;c++)if(a[c]!==b[c])return a[c]<b[c]?-1:1;return 0}function X(a){let b=[],c=0;for(let d=0;d<a.length;d++){let e=a.charCodeAt(d);e<128?b[c++]=e:(e<2048?b[c++]=e>>6|192:((64512&e)==55296&&d+1<a.length&&(64512&a.charCodeAt(d+1))==56320?(e=65536+((1023&e)<<10)+(1023&a.charCodeAt(++d)),b[c++]=e>>18|240,b[c++]=e>>12&63|128):b[c++]=e>>12|224,b[c++]=e>>6&63|128),b[c++]=63&e|128)}return b}function Y(a,b,c){let d=[];for(;b<c;){let e=a[b],f=null,g=e>239?4:e>223?3:e>191?2:1;if(b+g<=c){let c,d,h,i;switch(g){case 1:e<128&&(f=e);break;case 2:(192&(c=a[b+1]))==128&&(i=(31&e)<<6|63&c)>127&&(f=i);break;case 3:c=a[b+1],d=a[b+2],(192&c)==128&&(192&d)==128&&(i=(15&e)<<12|(63&c)<<6|63&d)>2047&&(i<55296||i>57343)&&(f=i);break;case 4:c=a[b+1],d=a[b+2],h=a[b+3],(192&c)==128&&(192&d)==128&&(192&h)==128&&(i=(15&e)<<18|(63&c)<<12|(63&d)<<6|63&h)>65535&&i<1114112&&(f=i)}}null===f?(f=65533,g=1):f>65535&&(f-=65536,d.push(f>>>10&1023|55296),f=56320|1023&f),d.push(f),b+=g}var e=d;let f=e.length;if(f<=4096)return String.fromCharCode.apply(String,e);let g="",h=0;for(;h<f;)g+=String.fromCharCode.apply(String,e.slice(h,h+=4096));return g}class Z{constructor(a=256){this.chunkSize=a,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(a){let b=this.chunks[this.chunks.length-1];if(this.cursor+a.length<=this.maxCursor+1){let c=b.length-(this.maxCursor-this.cursor)-1;b.set(a,c)}else{if(b){let a=b.length-(this.maxCursor-this.cursor)-1;a<b.length&&(this.chunks[this.chunks.length-1]=b.subarray(0,a),this.maxCursor=this.cursor-1)}a.length<64&&a.length<this.chunkSize?(b=V(this.chunkSize),this.chunks.push(b),this.maxCursor+=b.length,null===this._initReuseChunk&&(this._initReuseChunk=b),b.set(a,0)):(this.chunks.push(a),this.maxCursor+=a.length)}this.cursor+=a.length}toBytes(a=!1){let b;if(1===this.chunks.length){let c=this.chunks[0];a&&this.cursor>c.length/2?(b=this.cursor===c.length?c:c.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):b=T(c,0,this.cursor)}else b=U(this.chunks,this.cursor);return a&&this.reset(),b}}let $="CBOR decode error:",_="CBOR encode error:",aa=[];function ab(a,b,c){if(a.length-b<c)throw Error(`${$} not enough data for type`)}aa[23]=1,aa[24]=2,aa[25]=3,aa[26]=5,aa[27]=9;let ac=[24,256,65536,0x100000000,BigInt("18446744073709551616")];function ad(a,b,c){ab(a,b,1);let d=a[b];if(!0===c.strict&&d<ac[0])throw Error(`${$} integer encoded in more bytes than necessary (strict decode)`);return d}function ae(a,b,c){ab(a,b,2);let d=a[b]<<8|a[b+1];if(!0===c.strict&&d<ac[1])throw Error(`${$} integer encoded in more bytes than necessary (strict decode)`);return d}function af(a,b,c){ab(a,b,4);let d=0x1000000*a[b]+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3];if(!0===c.strict&&d<ac[2])throw Error(`${$} integer encoded in more bytes than necessary (strict decode)`);return d}function ag(a,b,c){ab(a,b,8);let d=0x1000000*a[b]+(a[b+1]<<16)+(a[b+2]<<8)+a[b+3],e=0x1000000*a[b+4]+(a[b+5]<<16)+(a[b+6]<<8)+a[b+7],f=(BigInt(d)<<BigInt(32))+BigInt(e);if(!0===c.strict&&f<ac[3])throw Error(`${$} integer encoded in more bytes than necessary (strict decode)`);if(f<=Number.MAX_SAFE_INTEGER)return Number(f);if(!0===c.allowBigInt)return f;throw Error(`${$} integers outside of the safe integer range are not supported`)}function ah(a,b){return ai(a,0,b.value)}function ai(a,b,c){if(c<ac[0]){let d=Number(c);a.push([b|d])}else if(c<ac[1]){let d=Number(c);a.push([24|b,d])}else if(c<ac[2]){let d=Number(c);a.push([25|b,d>>>8,255&d])}else if(c<ac[3]){let d=Number(c);a.push([26|b,d>>>24&255,d>>>16&255,d>>>8&255,255&d])}else{let d=BigInt(c);if(d<ac[4]){let c=[27|b,0,0,0,0,0,0,0],e=Number(d&BigInt(0xffffffff)),f=Number(d>>BigInt(32)&BigInt(0xffffffff));c[8]=255&e,e>>=8,c[7]=255&e,e>>=8,c[6]=255&e,e>>=8,c[5]=255&e,c[4]=255&f,f>>=8,c[3]=255&f,f>>=8,c[2]=255&f,f>>=8,c[1]=255&f,a.push(c)}else throw Error(`${$} encountered BigInt larger than allowable range`)}}ah.encodedSize=function(a){return ai.encodedSize(a.value)},ai.encodedSize=function(a){return a<ac[0]?1:a<ac[1]?2:a<ac[2]?3:a<ac[3]?5:9},ah.compareTokens=function(a,b){return a.value<b.value?-1:+(a.value>b.value)};let aj=BigInt(-1),ak=BigInt(1);function al(a,b){let c=b.value;ai(a,b.type.majorEncoded,"bigint"==typeof c?c*aj-ak:-1*c-1)}function am(a,b,c,d){ab(a,b,c+d);let e=T(a,b+c,b+c+d);return new L(K.bytes,e,c+d)}function an(a,b,c,d){return am(a,b,1,c)}function ao(a){return void 0===a.encodedBytes&&(a.encodedBytes=a.type===K.string?S(a.value):a.value),a.encodedBytes}function ap(a,b){let c=ao(b);ai(a,b.type.majorEncoded,c.length),a.push(c)}function aq(a,b,c,d,e){let f=c+d;ab(a,b,f);let g=new L(K.string,R(a,b+c,b+f),f);return!0===e.retainStringBytes&&(g.byteValue=T(a,b+c,b+f)),g}function ar(a,b,c,d){return aq(a,b,1,c,d)}function as(a,b,c,d){return new L(K.array,d,c)}function at(a,b,c,d){return as(a,b,1,c)}function au(a,b){ai(a,K.array.majorEncoded,b.value)}function av(a,b,c,d){return new L(K.map,d,c)}function aw(a,b,c,d){return av(a,b,1,c)}function ax(a,b){ai(a,K.map.majorEncoded,b.value)}function ay(a,b,c,d){return new L(K.tag,c,1)}function az(a,b){ai(a,K.tag.majorEncoded,b.value)}function aA(a,b,c){if(c){if(!1===c.allowNaN&&Number.isNaN(a))throw Error(`${$} NaN values are not supported`);if(!1===c.allowInfinity&&(a===1/0||a===-1/0))throw Error(`${$} Infinity values are not supported`)}return new L(K.float,a,b)}function aB(a,b,c){let d=b.value;if(!1===d)a.push([20|K.float.majorEncoded]);else if(!0===d)a.push([21|K.float.majorEncoded]);else if(null===d)a.push([22|K.float.majorEncoded]);else if(void 0===d)a.push([23|K.float.majorEncoded]);else{var e;let b=!1;c&&!0===c.float64||(aF(d),d===aG(aE,1)||Number.isNaN(d)?(aE[0]=249,a.push(aE.slice(0,3)),b=!0):(aH(d),d===aI(aE,1)&&(aE[0]=250,a.push(aE.slice(0,5)),b=!0))),b||(e=d,aD.setFloat64(0,e,!1),aJ(aE,1),aE[0]=251,a.push(aE.slice(0,9)))}}al.encodedSize=function(a){let b=a.value,c="bigint"==typeof b?b*aj-ak:-1*b-1;return c<ac[0]?1:c<ac[1]?2:c<ac[2]?3:c<ac[3]?5:9},al.compareTokens=function(a,b){return a.value<b.value?1:a.value>b.value?-1:0},ap.encodedSize=function(a){let b=ao(a);return ai.encodedSize(b.length)+b.length},ap.compareTokens=function(a,b){var c,d;return c=ao(a),d=ao(b),c.length<d.length?-1:c.length>d.length?1:W(c,d)},au.compareTokens=ah.compareTokens,au.encodedSize=function(a){return ai.encodedSize(a.value)},ax.compareTokens=ah.compareTokens,ax.encodedSize=function(a){return ai.encodedSize(a.value)},az.compareTokens=ah.compareTokens,az.encodedSize=function(a){return ai.encodedSize(a.value)},aB.encodedSize=function(a,b){let c=a.value;if(!1===c||!0===c||null==c)return 1;if(!b||!0!==b.float64){aF(c);let a=aG(aE,1);if(c===a||Number.isNaN(c))return 3;if(aH(c),c===(a=aI(aE,1)))return 5}return 9};let aC=new ArrayBuffer(9),aD=new DataView(aC,1),aE=new Uint8Array(aC,0);function aF(a){if(a===1/0)aD.setUint16(0,31744,!1);else if(a===-1/0)aD.setUint16(0,64512,!1);else if(Number.isNaN(a))aD.setUint16(0,32256,!1);else{aD.setFloat32(0,a);let b=aD.getUint32(0),c=(0x7f800000&b)>>23,d=8388607&b;if(255===c)aD.setUint16(0,31744,!1);else if(0===c)aD.setUint16(0,(0x80000000&a)>>16|d>>13,!1);else{let a=c-127;a<-24?aD.setUint16(0,0):a<-14?aD.setUint16(0,(0x80000000&b)>>16|1<<24+a,!1):aD.setUint16(0,(0x80000000&b)>>16|a+15<<10|d>>13,!1)}}}function aG(a,b){let c;if(a.length-b<2)throw Error(`${$} not enough data for float16`);let d=(a[b]<<8)+a[b+1];if(31744===d)return 1/0;if(64512===d)return-1/0;if(32256===d)return NaN;let e=d>>10&31,f=1023&d;return c=0===e?5960464477539063e-23*f:31!==e?(f+1024)*2**(e-25):0===f?1/0:NaN,32768&d?-c:c}function aH(a){aD.setFloat32(0,a,!1)}function aI(a,b){if(a.length-b<4)throw Error(`${$} not enough data for float32`);let c=(a.byteOffset||0)+b;return new DataView(a.buffer,c,4).getFloat32(0,!1)}function aJ(a,b){if(a.length-b<8)throw Error(`${$} not enough data for float64`);let c=(a.byteOffset||0)+b;return new DataView(a.buffer,c,8).getFloat64(0,!1)}function aK(a,b,c){throw Error(`${$} encountered invalid minor (${c}) for major ${a[b]>>>5}`)}function aL(a){return()=>{throw Error(`${$} ${a}`)}}aB.compareTokens=ah.compareTokens;let aM=[];for(let a=0;a<=23;a++)aM[a]=aK;aM[24]=function(a,b,c,d){return new L(K.uint,ad(a,b+1,d),2)},aM[25]=function(a,b,c,d){return new L(K.uint,ae(a,b+1,d),3)},aM[26]=function(a,b,c,d){return new L(K.uint,af(a,b+1,d),5)},aM[27]=function(a,b,c,d){return new L(K.uint,ag(a,b+1,d),9)},aM[28]=aK,aM[29]=aK,aM[30]=aK,aM[31]=aK;for(let a=32;a<=55;a++)aM[a]=aK;aM[56]=function(a,b,c,d){return new L(K.negint,-1-ad(a,b+1,d),2)},aM[57]=function(a,b,c,d){return new L(K.negint,-1-ae(a,b+1,d),3)},aM[58]=function(a,b,c,d){return new L(K.negint,-1-af(a,b+1,d),5)},aM[59]=function(a,b,c,d){let e=ag(a,b+1,d);if("bigint"!=typeof e){let a=-1-e;if(a>=Number.MIN_SAFE_INTEGER)return new L(K.negint,a,9)}if(!0!==d.allowBigInt)throw Error(`${$} integers outside of the safe integer range are not supported`);return new L(K.negint,aj-BigInt(e),9)},aM[60]=aK,aM[61]=aK,aM[62]=aK,aM[63]=aK;for(let a=64;a<=87;a++)aM[a]=an;aM[88]=function(a,b,c,d){return am(a,b,2,ad(a,b+1,d))},aM[89]=function(a,b,c,d){return am(a,b,3,ae(a,b+1,d))},aM[90]=function(a,b,c,d){return am(a,b,5,af(a,b+1,d))},aM[91]=function(a,b,c,d){let e=ag(a,b+1,d);if("bigint"==typeof e)throw Error(`${$} 64-bit integer bytes lengths not supported`);return am(a,b,9,e)},aM[92]=aK,aM[93]=aK,aM[94]=aK,aM[95]=aL("indefinite length bytes/strings are not supported");for(let a=96;a<=119;a++)aM[a]=ar;aM[120]=function(a,b,c,d){return aq(a,b,2,ad(a,b+1,d),d)},aM[121]=function(a,b,c,d){return aq(a,b,3,ae(a,b+1,d),d)},aM[122]=function(a,b,c,d){return aq(a,b,5,af(a,b+1,d),d)},aM[123]=function(a,b,c,d){let e=ag(a,b+1,d);if("bigint"==typeof e)throw Error(`${$} 64-bit integer string lengths not supported`);return aq(a,b,9,e,d)},aM[124]=aK,aM[125]=aK,aM[126]=aK,aM[127]=aL("indefinite length bytes/strings are not supported");for(let a=128;a<=151;a++)aM[a]=at;aM[152]=function(a,b,c,d){return as(a,b,2,ad(a,b+1,d))},aM[153]=function(a,b,c,d){return as(a,b,3,ae(a,b+1,d))},aM[154]=function(a,b,c,d){return as(a,b,5,af(a,b+1,d))},aM[155]=function(a,b,c,d){let e=ag(a,b+1,d);if("bigint"==typeof e)throw Error(`${$} 64-bit integer array lengths not supported`);return as(a,b,9,e)},aM[156]=aK,aM[157]=aK,aM[158]=aK,aM[159]=function(a,b,c,d){if(!1===d.allowIndefinite)throw Error(`${$} indefinite length items not allowed`);return as(a,b,1,1/0)};for(let a=160;a<=183;a++)aM[a]=aw;aM[184]=function(a,b,c,d){return av(a,b,2,ad(a,b+1,d))},aM[185]=function(a,b,c,d){return av(a,b,3,ae(a,b+1,d))},aM[186]=function(a,b,c,d){return av(a,b,5,af(a,b+1,d))},aM[187]=function(a,b,c,d){let e=ag(a,b+1,d);if("bigint"==typeof e)throw Error(`${$} 64-bit integer map lengths not supported`);return av(a,b,9,e)},aM[188]=aK,aM[189]=aK,aM[190]=aK,aM[191]=function(a,b,c,d){if(!1===d.allowIndefinite)throw Error(`${$} indefinite length items not allowed`);return av(a,b,1,1/0)};for(let a=192;a<=215;a++)aM[a]=ay;aM[216]=function(a,b,c,d){return new L(K.tag,ad(a,b+1,d),2)},aM[217]=function(a,b,c,d){return new L(K.tag,ae(a,b+1,d),3)},aM[218]=function(a,b,c,d){return new L(K.tag,af(a,b+1,d),5)},aM[219]=function(a,b,c,d){return new L(K.tag,ag(a,b+1,d),9)},aM[220]=aK,aM[221]=aK,aM[222]=aK,aM[223]=aK;for(let a=224;a<=243;a++)aM[a]=aL("simple values are not supported");aM[244]=aK,aM[245]=aK,aM[246]=aK,aM[247]=function(a,b,c,d){if(!1===d.allowUndefined)throw Error(`${$} undefined values are not supported`);return!0===d.coerceUndefinedToNull?new L(K.null,null,1):new L(K.undefined,void 0,1)},aM[248]=aL("simple values are not supported"),aM[249]=function(a,b,c,d){return aA(aG(a,b+1),3,d)},aM[250]=function(a,b,c,d){return aA(aI(a,b+1),5,d)},aM[251]=function(a,b,c,d){return aA(aJ(a,b+1),9,d)},aM[252]=aK,aM[253]=aK,aM[254]=aK,aM[255]=function(a,b,c,d){if(!1===d.allowIndefinite)throw Error(`${$} indefinite length items not allowed`);return new L(K.break,void 0,1)};let aN=[];for(let a=0;a<24;a++)aN[a]=new L(K.uint,a,1);for(let a=-1;a>=-24;a--)aN[31-a]=new L(K.negint,a,1);aN[64]=new L(K.bytes,new Uint8Array(0),1),aN[96]=new L(K.string,"",1),aN[128]=new L(K.array,0,1),aN[160]=new L(K.map,0,1),aN[244]=new L(K.false,!1,1),aN[245]=new L(K.true,!0,1),aN[246]=new L(K.null,null,1);let aO=Object.freeze({float64:!0,mapSorter:function(a,b){if(a[0]instanceof L&&b[0]instanceof L){let c=a[0],d=b[0];return c._keyBytes||(c._keyBytes=function(a){return aV(a,aP,aO)}(c.value)),d._keyBytes||(d._keyBytes=function(a){return aV(a,aP,aO)}(d.value)),W(c._keyBytes,d._keyBytes)}throw Error("rfc8949MapSorter: complex key types are not supported yet")},quickEncodeToken:function(a){switch(a.type){case K.false:let b;return b=[244],Uint8Array.from(b);case K.true:let c;return c=[245],Uint8Array.from(c);case K.null:let d;return d=[246],Uint8Array.from(d);case K.bytes:if(!a.value.length){let a;return a=[64],Uint8Array.from(a)}return;case K.string:if(""===a.value){let a;return a=[96],Uint8Array.from(a)}return;case K.array:if(0===a.value){let a;return a=[128],Uint8Array.from(a)}return;case K.map:if(0===a.value){let a;return a=[160],Uint8Array.from(a)}return;case K.uint:if(a.value<24){let b;return b=[Number(a.value)],Uint8Array.from(b)}return;case K.negint:if(a.value>=-24){let b;return b=[31-Number(a.value)],Uint8Array.from(b)}}}}),aP=((b=[])[K.uint.major]=ah,b[K.negint.major]=al,b[K.bytes.major]=ap,b[K.string.major]=ap,b[K.array.major]=au,b[K.map.major]=ax,b[K.tag.major]=az,b[K.float.major]=aB,b),aQ=new Z;class aR{constructor(a,b){this.obj=a,this.parent=b}includes(a){let b=this;do if(b.obj===a)return!0;while(b=b.parent)return!1}static createCheck(a,b){if(a&&a.includes(b))throw Error(`${_} object contains circular references`);return new aR(b,a)}}let aS={null:new L(K.null,null),undefined:new L(K.undefined,void 0),true:new L(K.true,!0),false:new L(K.false,!1),emptyArray:new L(K.array,0),emptyMap:new L(K.map,0)},aT={number:(a,b,c,d)=>Number.isInteger(a)&&Number.isSafeInteger(a)?a>=0?new L(K.uint,a):new L(K.negint,a):new L(K.float,a),bigint:(a,b,c,d)=>a>=BigInt(0)?new L(K.uint,a):new L(K.negint,a),Uint8Array:(a,b,c,d)=>new L(K.bytes,a),string:(a,b,c,d)=>new L(K.string,a),boolean:(a,b,c,d)=>a?aS.true:aS.false,null:(a,b,c,d)=>aS.null,undefined:(a,b,c,d)=>aS.undefined,ArrayBuffer:(a,b,c,d)=>new L(K.bytes,new Uint8Array(a)),DataView:(a,b,c,d)=>new L(K.bytes,new Uint8Array(a.buffer,a.byteOffset,a.byteLength)),Array(a,b,c,d){if(!a.length)return!0===c.addBreakTokens?[aS.emptyArray,new L(K.break)]:aS.emptyArray;d=aR.createCheck(d,a);let e=[],f=0;for(let b of a)e[f++]=aU(b,c,d);return c.addBreakTokens?[new L(K.array,a.length),e,new L(K.break)]:[new L(K.array,a.length),e]},Object(a,b,c,d){var e,f;let g="Object"!==b,h=g?a.keys():Object.keys(a),i=g?a.size:h.length;if(!i)return!0===c.addBreakTokens?[aS.emptyMap,new L(K.break)]:aS.emptyMap;d=aR.createCheck(d,a);let j=[],k=0;for(let b of h)j[k++]=[aU(b,c,d),aU(g?a.get(b):a[b],c,d)];return(e=j,(f=c).mapSorter&&e.sort(f.mapSorter),c.addBreakTokens)?[new L(K.map,i),j,new L(K.break)]:[new L(K.map,i),j]}};for(let a of(aT.Map=aT.Object,aT.Buffer=aT.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))aT[`${a}Array`]=aT.DataView;function aU(a,b={},c){let d=function(a){var b;if(null===a)return"null";if(void 0===a)return"undefined";if(!0===a||!1===a)return"boolean";let c=typeof a;if(I.includes(c))return c;if("function"===c)return"Function";if(Array.isArray(a))return"Array";if((b=a)&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer.call(null,b))return"Buffer";let d=function(a){let b=Object.prototype.toString.call(a).slice(8,-1);if(J.includes(b))return b}(a);return d||"Object"}(a),e=b&&b.typeEncoders&&b.typeEncoders[d]||aT[d];if("function"==typeof e){let f=e(a,d,b,c);if(null!=f)return f}let f=aT[d];if(!f)throw Error(`${_} unsupported type: ${d}`);return f(a,d,b,c)}function aV(a,b,c){let d=aU(a,c);if(!Array.isArray(d)&&c.quickEncodeToken){let a=c.quickEncodeToken(d);if(a)return a;let e=b[d.type.major];if(e.encodedSize){let a=new Z(e.encodedSize(d,c));if(e(a,d,c),1!==a.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${d} was wrong`);return Q(a.chunks[0])}}return aQ.reset(),!function a(b,c,d,e){if(Array.isArray(c))for(let f of c)a(b,f,d,e);else d[c.type.major](b,c,e)}(aQ,d,b,c),aQ.toBytes(!0)}Symbol.for("DONE"),Symbol.for("BREAK");let aW=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};class aX{name;prefix;baseEncode;constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class aY{name;prefix;baseDecode;prefixCodePoint;constructor(a,b,c){this.name=a,this.prefix=b;const d=b.codePointAt(0);if(void 0===d)throw Error("Invalid prefix character");this.prefixCodePoint=d,this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return a$(this,a)}}class aZ{decoders;constructor(a){this.decoders=a}or(a){return a$(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(null!=c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function a$(a,b){return new aZ({...a.decoders??{[a.prefix]:a},...b.decoders??{[b.prefix]:b}})}class a_{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new aX(a,b,c),this.decoder=new aY(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}function a0({name:a,prefix:b,encode:c,decode:d}){return new a_(a,b,c,d)}function a1({name:a,prefix:b,alphabet:c}){let{encode:d,decode:e}=aW(c,a);return a0({prefix:b,name:a,encode:d,decode:a=>z(e(a))})}function a2({name:a,prefix:b,bitsPerChar:c,alphabet:d}){let e=function(a){let b={};for(let c=0;c<a.length;++c)b[a[c]]=c;return b}(d);return a0({prefix:b,name:a,encode:a=>(function(a,b,c){let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(0!==g&&(f+=b[e&h<<c-g]),d)for(;(f.length*c&7)!=0;)f+="=";return f})(a,d,c),decode:b=>(function(a,b,c,d){let e=a.length;for(;"="===a[e-1];)--e;let f=new Uint8Array(e*c/8|0),g=0,h=0,i=0;for(let j=0;j<e;++j){let e=b[a[j]];if(void 0===e)throw SyntaxError(`Non-${d} character`);h=h<<c|e,(g+=c)>=8&&(g-=8,f[i++]=255&h>>g)}if(g>=c||(255&h<<8-g)!=0)throw SyntaxError("Unexpected end of data");return f})(b,e,c,a)})}let a3=a2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});a2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),a2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),a2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),a2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),a2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),a2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),a2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let a4=a1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});a1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});let a5=a1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});a1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});function a6(a,b,c){b=b||[];for(var d=c=c||0;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,a6.bytes=c-d+1,b}function a7(a,b){var c,d=0,b=b||0,e=0,f=b,g=a.length;do{if(f>=g)throw a7.bytes=0,RangeError("Could not decode varint");c=a[f++],d+=e<28?(127&c)<<e:(127&c)*Math.pow(2,e),e+=7}while(c>=128)return a7.bytes=f-b,d}let a8=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};function a9(a,b=0){return[a7(a,b),a7.bytes]}function ba(a,b,c=0){return a6(a,b,c),b}function bb(a){return a8(a)}function bc(a,b){let c=b.byteLength,d=a8(a),e=d+a8(c),f=new Uint8Array(e+c);return ba(a,f,0),ba(c,f,d),f.set(b,e),new bf(a,c,b,f)}function bd(a){let b=z(a),[c,d]=a9(b),[e,f]=a9(b.subarray(d)),g=b.subarray(d+f);if(g.byteLength!==e)throw Error("Incorrect length");return new bf(c,e,g,b)}function be(a,b){return a===b||a.code===b.code&&a.size===b.size&&b.bytes instanceof Uint8Array&&y(a.bytes,b.bytes)}a.s(["decode",()=>a9,"encodeTo",()=>ba,"encodingLength",()=>bb],536137);class bf{code;size;digest;bytes;constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}function bg(a,b){return a.code===b}function bh(a,b){let{bytes:c,version:d}=a;return 0===d?function(a,b,c){let{prefix:d}=c;if(d!==a5.prefix)throw Error(`Cannot string encode V0 in ${c.name} encoding`);let e=b.get(d);if(null!=e)return e;{let e=c.encode(a).slice(1);return b.set(d,e),e}}(c,bj(a),b??a5.encoder):function(a,b,c){let{prefix:d}=c,e=b.get(d);if(null!=e)return e;{let e=c.encode(a);return b.set(d,e),e}}(c,bj(a),b??a3.encoder)}a.s(["Digest",()=>bf,"create",()=>bc,"decode",()=>bd,"equals",()=>be,"hasCode",()=>bg],28908);let bi=new WeakMap;function bj(a){let b=bi.get(a);if(null==b){let b=new Map;return bi.set(a,b),b}return b}class bk{code;version;multihash;bytes;"/";constructor(a,b,c,d){this.code=b,this.version=a,this.multihash=c,this.bytes=d,this["/"]=d}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:a,multihash:b}=this;if(a!==bl)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(b.code!==bm)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return bk.createV0(b)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:a,digest:b}=this.multihash,c=bc(a,b);return bk.createV1(this.code,c)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(a){return bk.equals(this,a)}static equals(a,b){return null!=b&&a.code===b.code&&a.version===b.version&&be(a.multihash,b.multihash)}toString(a){return bh(this,a)}toJSON(){return{"/":bh(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(a){if(null==a)return null;if(a instanceof bk)return a;if(null!=a["/"]&&a["/"]===a.bytes||a.asCID===a){let{version:b,code:c,multihash:d,bytes:e}=a;return new bk(b,c,d,e??bn(b,c,d.bytes))}if(!0!==a[bo])return null;{let{version:b,multihash:c,code:d}=a,e=bd(c);return bk.create(b,d,e)}}static create(a,b,c){if("number"!=typeof b)throw Error("String codecs are no longer supported");if(!(c.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(a){case 0:if(b===bl)return new bk(a,b,c,c.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${bl}) block encoding`);case 1:{let d=bn(a,b,c.bytes);return new bk(a,b,c,d)}default:throw Error("Invalid version")}}static createV0(a){return bk.create(0,bl,a)}static createV1(a,b){return bk.create(1,a,b)}static decode(a){let[b,c]=bk.decodeFirst(a);if(0!==c.length)throw Error("Incorrect length");return b}static decodeFirst(a){let b=bk.inspectBytes(a),c=b.size-b.multihashSize,d=z(a.subarray(c,c+b.multihashSize));if(d.byteLength!==b.multihashSize)throw Error("Incorrect length");let e=d.subarray(b.multihashSize-b.digestSize),f=new bf(b.multihashCode,b.digestSize,e,d);return[0===b.version?bk.createV0(f):bk.createV1(b.codec,f),a.subarray(b.size)]}static inspectBytes(a){let b=0,c=()=>{let[c,d]=a9(a.subarray(b));return b+=d,c},d=c(),e=bl;if(18===d?(d=0,b=0):e=c(),0!==d&&1!==d)throw RangeError(`Invalid CID version ${d}`);let f=b,g=c(),h=c(),i=b+h;return{version:d,codec:e,multihashCode:g,digestSize:h,multihashSize:i-f,size:i}}static parse(a,b){let[c,d]=function(a,b){switch(a[0]){case"Q":{let c=b??a5;return[a5.prefix,c.decode(`${a5.prefix}${a}`)]}case a5.prefix:{let c=b??a5;return[a5.prefix,c.decode(a)]}case a3.prefix:{let c=b??a3;return[a3.prefix,c.decode(a)]}case a4.prefix:{let c=b??a4;return[a4.prefix,c.decode(a)]}default:if(null==b)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[a[0],b.decode(a)]}}(a,b),e=bk.decode(d);if(0===e.version&&"Q"!==a[0])throw Error("Version 0 CID string must not include multibase prefix");return bj(e).set(c,a),e}}let bl=112,bm=18;function bn(a,b,c){let d=a8(a),e=d+a8(b),f=new Uint8Array(e+c.byteLength);return ba(a,f,0),ba(b,f,d),f.set(c,e),f}let bo=Symbol.for("@ipld/js-cid/CID"),bp={float64:!0,typeEncoders:{Map:function(a){for(let b of a.keys())if("string"!=typeof b||0===b.length)throw Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null},Object:function(a){if(a.asCID!==a&&a["/"]!==a.bytes)return null;let b=bk.asCID(a);if(!b)return null;let c=new Uint8Array(b.bytes.byteLength+1);return c.set(b.bytes,1),[new L(K.tag,42),new L(K.bytes,c)]},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(a){if(Number.isNaN(a))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(a===1/0||a===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};({...bp,typeEncoders:{...bp.typeEncoders}});let bq={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};function br(a,b){return bk.create(1,a,b)}bq.tags[42]=function(a){if(0!==a[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");return bk.decode(a.subarray(1))},bq.tags.slice(),a.i(381307),a.i(470255),a.s(["code",0,18,"digest",0,H,"name",0,E,"size",0,32],404150),a.i(404150),a.s(["code",0,18,"digest",0,H,"name",0,E,"size",0,32],952841);var bs=a.i(952841),bs=bs;let bt=(a,b,c)=>{let d=new Uint8Array(a.length+b.length);return d.set(a,0),d.set(b,a.length),function(a,b={}){var c;let{digest:d}=(b.hasher||bs).digest(a);return c=d,c[r-1]&=63,c}(d,c)},bu=new class{constructor(){this.bytes=new Uint8Array(64*r),this.bytes.set(u,0),this.node=u,this.length=r}slice(a,b){for(;this.length<b;)this.node=bt(this.node,this.node),this.bytes.set(this.node,this.length),this.length+=r;return this.bytes.subarray(a,b)}},bv=a=>{if(a<0||a>=64)throw Error("Only levels between 0 and 63 inclusive are available");return bu.slice(r*a,r*(a+1))},bw=a=>{let b=a.length/r,c=Array(b);for(let d=0;d<b;d++){let b=d*r,e=a.subarray(b,b+r);c[d]=e}return c};function bx(a){let b=Math.max(a,t),c=Math.floor(Math.log2(b)),d=Math.ceil(q*2**(c+1));return b<=d?d:Math.ceil(q*2**(c+2))}let by=a=>bx(a)/q,bz=(a,b=new Uint8Array(by(a.length)))=>{let c=bx(a.byteLength)/127;for(let d=0;d<c;d++){let c=127*d,e=128*d;b.set(a.subarray(c,c+32),e),b[e+31]&=63;for(let d=32;d<64;d++)b[e+d]=a[c+d]<<2|a[c+d-1]>>6;b[e+63]&=63;for(let d=64;d<96;d++)b[e+d]=a[c+d]<<4|a[c+d-1]>>4;b[e+95]&=63;for(let d=96;d<127;d++)b[e+d]=a[c+d]<<6|a[c+d-1]>>2;b[e+127]=a[c+126]>>2}return b},bA=a=>a<=1n?0:(a=>{let b=0n;for(;a>>=1n;)b++;return Number(b)})(BigInt(a)-1n)+1,bB=a=>bD(a)*o,bC=a=>bD(a)*n,bD=a=>2n**BigInt(bA((a+o-1n)/o));a.s(["fromPiece",0,({height:a,padding:b})=>2n**BigInt(a-2)*o-b,"toExpanded",0,a=>bD(a)*p,"toHeight",0,a=>bA(bC(a)),"toPadded",0,bB,"toPadding",0,a=>bB(a)-a,"toWidth",0,bC],788447);let bE=a=>bF(2n**BigInt(a)),bF=a=>a*s;var bG=a.i(788447),bG=bG;function bH({name:a,code:b,encode:c,minDigestLength:d,maxDigestLength:e}){return new bI(a,b,c,d,e)}a.i(530984),a.i(28908);class bI{name;code;encode;minDigestLength;maxDigestLength;constructor(a,b,c,d,e){this.name=a,this.code=b,this.encode=c,this.minDigestLength=d??20,this.maxDigestLength=e}digest(a,b){if(b?.truncate!=null){if(b.truncate<this.minDigestLength)throw Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(null!=this.maxDigestLength&&b.truncate>this.maxDigestLength)throw Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(a instanceof Uint8Array){let c=this.encode(a);return c instanceof Uint8Array?bJ(c,this.code,b?.truncate):c.then(a=>bJ(a,this.code,b?.truncate))}throw Error("Unknown type, must be binary type")}}function bJ(a,b,c){if(null!=c&&c!==a.byteLength){if(c>a.byteLength)throw Error(`Invalid truncate option, must be less than or equal to ${a.byteLength}`);a=a.subarray(0,c)}return bc(b,a)}a.s(["Hasher",()=>bI,"from",()=>bH],333272),a.i(333272);var bK=a.i(536137),bL=bK,bs=bs;let bM="fr32-sha2-256-trunc254-padded-binary-tree",bN=bs.size,bO=10+bs.size,bP=bL.encodingLength(4113),bQ=bP+bL.encodingLength(bO)+bO,bR=bE(255)*BigInt(254)/BigInt(256),bS=a=>new bW(a),bT=({digest:a})=>{let[,b]=bL.decode(a);return a[b]},bU=({digest:a})=>{let[b]=bL.decode(a);return BigInt(b)},bV=({digest:a})=>{let[,b]=bL.decode(a);return a.subarray(b+1,b+1+bs.size)};class bW{constructor(a){this.bytes=a;const[b]=bL.decode(a);if(4113!==b)throw RangeError("Expected multihash with code 4113");let c=bP;const[d,e]=bL.decode(a,c);c+=e;const f=a.subarray(c);if(f.length!==d)throw RangeError(`Invalid multihash size expected ${c+d} bytes, got ${a.length} bytes`);this.digest=f}get name(){return bM}get code(){return 4113}get size(){return this.digest.length}get padding(){return bU(this)}get height(){return bT(this)}get root(){return bV(this)}}a.s(["HEIGHT_SIZE",0,1,"MAX_DIGEST_SIZE",0,bO,"MAX_HEIGHT",0,255,"MAX_PAYLOAD_SIZE",0,bR,"MAX_SIZE",0,bQ,"ROOT_SIZE",0,bN,"TAG_SIZE",0,bP,"code",0,4113,"fromBytes",0,bS,"fromPiece",0,({padding:a,height:b,root:c})=>{let d=bL.encodingLength(Number(a)),e=d+1+bN,f=bL.encodingLength(e),g=0,h=new Uint8Array(bP+f+e);return bL.encodeTo(4113,h,g),g+=bP,bL.encodeTo(e,h,g),g+=f,bL.encodeTo(Number(a),h,g),h[g+=d]=b,g+=1,h.set(c,g),new bW(h)},"height",0,bT,"name",0,bM,"padding",0,bU,"root",0,bV,"toBytes",0,({digest:a})=>{let b=bL.encodingLength(a.length)+bP;if(a.byteOffset>=b){let c=new Uint8Array(a.buffer,a.byteOffset-b,a.byteOffset+a.length),[d,e]=bL.decode(c);if(4113===d&&bL.decode(c,e)[0]===a.length)return c}let c=new Uint8Array(a.length+b);return bL.encodeTo(4113,c),bL.encodeTo(a.length,c,bP),c.set(a,b),c}],628571),a.i(628571);var bL=bK;let bX=bE(255)*BigInt(254)/BigInt(256),bY=()=>new bZ;class bZ{constructor(){this.bytesWritten=0n,this.buffer=new Uint8Array(127),this.offset=0,this.layers=[[]]}count(){return this.bytesWritten}digest(){let a=new Uint8Array(bQ),b=this.digestInto(a,0,!0);return bS(a.subarray(0,b))}digestInto(a,b=0,c=!0){let{buffer:d,layers:e,offset:f,bytesWritten:g}=this,[h,...i]=e;(f>0||0n===g)&&(h=[...h,...bw(bz(d.fill(0,f)))]);let j=b_([h,...i]),k=j.length-1,[l]=j[k],m=Number(bG.toPadding(this.bytesWritten)),n=bL.encodingLength(m),o=b;if(c){bL.encodeTo(4113,a,o),o+=bP;let b=n+1+bN,c=bL.encodingLength(b);bL.encodeTo(b,a,o),o+=c}return bL.encodeTo(m,a,o),a[o+=n]=k,o+=1,a.set(l,o),(o+=l.length)-b}write(a){let{buffer:b,offset:c,layers:d}=this,e=d[0],{length:f}=a;if(0===f)return this;if(this.bytesWritten+BigInt(f)>bX)throw RangeError(`Writing ${f} bytes exceeds max payload size of ${bX}`);if(c+f<b.length)return b.set(a,c),this.offset+=f,this.bytesWritten+=BigInt(f),this;{let d=b.length-c;b.set(a.subarray(0,d),c),e.push(...bw(bz(b)));let g=d;for(;g+127<f;){let b=a.subarray(g,g+127);e.push(...bw(bz(b))),g+=127}return this.buffer.set(a.subarray(g),0),this.offset=f-g,this.bytesWritten+=BigInt(f),b$(this.layers),this}}reset(){return this.offset=0,this.bytesWritten=0n,this.layers.length=1,this.layers[0].length=0,this}dispose(){this.reset()}get code(){return 4113}get name(){return"fr32-sha2-256-trunc254-padded-binary-tree"}}let b$=a=>b0(a,!1),b_=a=>b0([...a],!0),b0=(a,b)=>{let c=0;for(;c<a.length;){let d=a[c+1],e=a[c];b&&e.length%2>0&&d&&e.push(bv(c)),c+=1,d=d?b?[...d]:d:[];let f=0;for(;f+1<e.length;){let a=bt(e[f],e[f+1]);delete e[f],delete e[f+1],d.push(a),f+=2}d.length&&(a[c]=d),e.splice(0,f)}return a};var bG=bG,b1=a.i(1428);function b2(a){return 85===a.code&&4113===a.multihash.code}function b3(a){if(null==a)return null;if("string"==typeof a){try{let b=bk.parse(a);if(b2(b))return b}catch{}return null}return"object"==typeof a&&null!==a&&null!==bk.asCID(a)&&b2(a)?a:null}function b4(a){try{var b;let c=bk.parse(a).toV1();if(b=c,"object"!=typeof b||null==bk.asCID(b)||85!==b.code||4113!==b.multihash.code)throw Error("Invalid PieceCID: input must be a valid PieceCIDv2");return c}catch{throw Error(`Invalid CID string: ${a}`)}}function b5(){let a=bY(),b=!1,c=null;return{stream:new TransformStream({transform(b,c){a.write(b),c.enqueue(b)},flush(){c=br(85,a.digest()),b=!0}}),getPieceCID:()=>b?c:null}}async function*b6(a,b=2048){for(let c=0;c<a.length;c+=b)yield a.subarray(c,c+b)}async function b7(a,b){let c=b3(b);if(null==c)throw Error(`Invalid PieceCID: ${String(b)}`);if(!a.ok)throw Error(`Download failed: ${a.status} ${a.statusText}`);if(null==a.body)throw Error("Response body is null");let{stream:d,getPieceCID:e}=b5(),f=[],g=new TransformStream({transform(a,b){f.push(a),b.enqueue(a)}}),h=a.body.pipeThrough(d).pipeThrough(g).getReader();try{for(;;){let{done:a}=await h.read();if(a)break}}finally{h.releaseLock()}if(0===f.length)throw Error("Response body is empty");let i=e();if(null==i)throw Error("Failed to calculate PieceCID from stream");if(i.toString()!==c.toString())throw Error(`PieceCID verification failed. Expected: ${String(c)}, Got: ${String(i)}`);let j=new Uint8Array(f.reduce((a,b)=>a+b.length,0)),k=0;for(let a of f)j.set(a,k),k+=a.length;return j}let b8={USDFC:"USDFC",FIL:"FIL"},b9={mainnet:314,calibration:314159},ca={ERC20:g.erc20Abi,ERC20_PERMIT:h,PAYMENTS:i,PDP_VERIFIER:k,WARM_STORAGE:m,WARM_STORAGE_VIEW:j,MULTICALL3:g.multicall3Abi,SERVICE_PROVIDER_REGISTRY:l,SESSION_KEY_REGISTRY:[{type:"function",inputs:[{name:"user",internalType:"address",type:"address"},{name:"signer",internalType:"address",type:"address"},{name:"permission",internalType:"bytes32",type:"bytes32"}],name:"authorizationExpiry",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"login",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"signer",internalType:"address payable",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"loginAndFund",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"revoke",outputs:[],stateMutability:"nonpayable"},{type:"event",anonymous:!1,inputs:[{name:"identity",internalType:"address",type:"address",indexed:!0},{name:"signer",internalType:"address",type:"address",indexed:!1},{name:"expiry",internalType:"uint256",type:"uint256",indexed:!1},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]",indexed:!1},{name:"origin",internalType:"string",type:"string",indexed:!1}],name:"AuthorizationsUpdated"}]},cb={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},cc={EPOCH_DURATION:30,EPOCHS_PER_DAY:2880n,EPOCHS_PER_MONTH:86400n,DAYS_PER_MONTH:30n,DEFAULT_LOCKUP_DAYS:30n},cd={mainnet:0x5f443860,calibration:0x636161ac},ce={KiB:1024n,MiB:1n<<20n,GiB:1n<<30n,TiB:1n<<40n,PiB:1n<<50n,MAX_UPLOAD_SIZE:0x3f800000,MIN_UPLOAD_SIZE:127,DEFAULT_UPLOAD_BATCH_SIZE:32},cf={WITH_CDN:"withCDN",WITH_IPFS_INDEXING:"withIPFSIndexing",IPFS_ROOT_CID:"ipfsRootCID"},cg={TRANSACTION_PROPAGATION_TIMEOUT_MS:18e4,TRANSACTION_PROPAGATION_POLL_INTERVAL_MS:2e3,DATA_SET_CREATION_TIMEOUT_MS:42e4,DATA_SET_CREATION_POLL_INTERVAL_MS:2e3,PIECE_PARKING_TIMEOUT_MS:42e4,PIECE_PARKING_POLL_INTERVAL_MS:5e3,TRANSACTION_CONFIRMATIONS:1,PERMIT_DEADLINE_DURATION:3600,PIECE_ADDITION_TIMEOUT_MS:42e4,PIECE_ADDITION_POLL_INTERVAL_MS:1e3},ch={mainnet:{http:"https://api.node.glif.io/rpc/v1",websocket:"wss://wss.node.glif.io/apigw/lotus/rpc/v1"},calibration:{http:"https://api.calibration.node.glif.io/rpc/v1",websocket:"wss://wss.calibration.node.glif.io/apigw/lotus/rpc/v1"}},ci={WARM_STORAGE:{mainnet:"0x8408502033C418E1bbC97cE9ac48E5528F371A9f",calibration:"0x02925630df557F957f70E112bA06e50965417CA0"},MULTICALL3:{mainnet:"0xcA11bde05977b3631167028862bE2a173976CA11",calibration:"0xcA11bde05977b3631167028862bE2a173976CA11"},USDFC:{mainnet:"0x80B98d3aa09ffff255c3ba4A241111Ff1262F045",calibration:"0xb3042734b608a1B16e9e86B374A3f3e389B4cDf0"}};a.s(["CHAIN_IDS",0,b9,"CONTRACT_ABIS",0,ca,"CONTRACT_ADDRESSES",0,ci,"EIP2612_PERMIT_TYPES",0,cb,"GENESIS_TIMESTAMPS",0,cd,"METADATA_KEYS",0,cf,"RPC_URLS",0,ch,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ce,"TIME_CONSTANTS",0,cc,"TIMING_CONSTANTS",0,cg,"TOKENS",0,b8],584295),a.i(486963),a.i(531959),"function"==typeof Uint8Array.from([]).toHex&&Uint8Array.fromHex;class cj extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof cj){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof cj&&b.cause.docsPath||b.docsPath,e=b.docsOrigin??"https://oxlib.sh",f=`${e}${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d||b.version?["",c?`Details: ${c}`:void 0,d?`See: ${f}`:void 0,b.version?`Version: ${b.version}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.cause=b.cause,this.details=c,this.docs=f,this.docsPath=d,this.shortMessage=a,this.version=b.version??"ox@0.1.1"}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function ck(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function cl(a,b){if(cx(a)>b)throw new cz({givenSize:cx(a),maxSize:b})}function cm(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new cB({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function cn(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let co=new TextEncoder,cp=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function cq(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function cr(a,b={}){let c=`0x${Number(a)}`;return"number"==typeof b.size?(cl(c,b.size),cv(c,b.size)):c}function cs(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=cp[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(cl(d,b.size),cw(d,b.size)):d}function ct(a,b={}){let c,{signed:d,size:e}=b,f=BigInt(a);e?c=d?(1n<<8n*BigInt(e)-1n)-1n:2n**(8n*BigInt(e))-1n:"number"==typeof a&&(c=BigInt(Number.MAX_SAFE_INTEGER));let g="bigint"==typeof c&&d?-c-1n:0;if(c&&f>c||f<g){let b="bigint"==typeof a?"n":"";throw new cy({max:c?`${c}${b}`:void 0,min:`${g}${b}`,signed:d,size:e,value:`${a}${b}`})}let h=(d&&f<0?BigInt.asUintN(8*e,BigInt(f)):f).toString(16),i=`0x${h}`;return e?cv(i,e):i}function cu(a,b={}){return cs(co.encode(a),b)}function cv(a,b){return cm(a,{dir:"left",size:b})}function cw(a,b){return cm(a,{dir:"right",size:b})}function cx(a){return Math.ceil((a.length-2)/2)}class cy extends cj{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class cz extends cj{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class cA extends cj{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class cB extends cj{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let cC=new TextEncoder;function cD(a,b={}){let{size:c}=b,d=cC.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new cE({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new cF({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}class cE extends cj{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class cF extends cj{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}class cG extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let cH={checksum:new cG(8192)}.checksum;function cI(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function cJ(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function cK(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function cL(a,b){cJ(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function cM(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}D&&"object"==typeof D&&"webcrypto"in D&&D.webcrypto;let cN=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a};function cO(a){return"string"==typeof a&&(a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a)),cJ(a),a}class cP{}let cQ=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),cR=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),cS=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),cT=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),cU=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),cV=new Uint32Array(80);(a,b)=>Math.floor(0x100000000*Math.abs(Math.sin(b+1)));let cW=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),cX=Uint8Array.from(Array(16).fill(0).map((a,b)=>b)),cY=cX.map(a=>(9*a+5)%16),cZ=(()=>{let a=[[cX],[cY]];for(let b=0;b<4;b++)for(let c of a)c.push(c[b].map(a=>cW[a]));return a})(),c$=cZ[0],c_=cZ[1],c0=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(a=>Uint8Array.from(a)),c1=c$.map((a,b)=>a.map(a=>c0[b][a])),c2=c_.map((a,b)=>a.map(a=>c0[b][a])),c3=Uint32Array.from([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),c4=Uint32Array.from([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]),c5=BigInt(0x100000000-1),c6=BigInt(32);function c7(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&c5),l:Number(a>>c6&c5)}:{h:0|Number(a>>c6&c5),l:0|Number(a&c5)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let c8=BigInt(0),c9=BigInt(1),da=BigInt(2),db=BigInt(7),dc=BigInt(256),dd=BigInt(113),de=[],df=[],dg=[];for(let a=0,b=c9,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],de.push(2*(5*d+c)),df.push((a+1)*(a+2)/2%64);let e=c8;for(let a=0;a<7;a++)(b=(b<<c9^(b>>db)*dd)%dc)&da&&(e^=c9<<(c9<<BigInt(a))-c9);dg.push(e)}let dh=c7(dg,!0),di=dh[0],dj=dh[1],dk=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,dl=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class dm extends cP{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,cI(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}(this.state)}clone(){return this._cloneInto()}keccak(){cN(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=dk(f,g,1)^c[d],i=dl(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=df[c],f=dk(b,e,d),g=dl(b,e,d),h=de[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=di[d],a[1]^=dj[d]}cM(c)}(this.state32,this.rounds),cN(this.state32),this.posOut=0,this.pos=0}update(a){cK(this),cJ(a=cO(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){cK(this,!1),cJ(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return cI(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(cL(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,cM(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new dm(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let dn=(e=()=>new dm(136,1,32),(c=a=>e().update(cO(a)).digest()).outputLen=(d=e()).outputLen,c.blockLen=d.blockLen,c.create=()=>e(),c),dp=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),dq=new Uint32Array(64),dr=c7(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),ds=dr[0],dt=dr[1],du=new Uint32Array(80),dv=new Uint32Array(80);function dw(a,b={}){var c;let{as:d="string"==typeof a?"Hex":"Bytes"}=b,e=dn(a instanceof Uint8Array?a:"string"==typeof a?function(a,b={}){let{size:c}=b,d=a;c&&(cl(a,c),d=cw(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=ck(e.charCodeAt(b++)),d=ck(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new cj(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=c<<4|d}return g}(a):(c=a)instanceof Uint8Array?c:new Uint8Array(c));return"Bytes"===d?e:cs(e)}let dx=/^0x[a-fA-F0-9]{40}$/;function dy(a,b={}){let{strict:c=!0}=b;if(!dx.test(a))throw new dz({address:a,cause:new dA});if(c){if(a.toLowerCase()===a)return;if(function(a){if(cH.has(a))return cH.get(a);dy(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=dw(cD(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return cH.set(a,e),e}(a)!==a)throw new dz({address:a,cause:new dB})}}class dz extends cj{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class dA extends cj{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class dB extends cj{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}let dC=/^(.*)\[([0-9]*)\]$/,dD=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,dE=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function dF(a){let b=0;for(let c=0;c<a.length;c++){let{dynamic:d,encoded:e}=a[c];d?b+=32:b+=cx(e)}let c=[],d=[],e=0;for(let f=0;f<a.length;f++){let{dynamic:g,encoded:h}=a[f];g?(c.push(ct(b+e,{size:32})),d.push(h),e+=cx(h)):c.push(h)}return cq(...c,...d)}function dG(a,b,c){let{checksumAddress:d=!1}=c??{};if(a.length!==b.length)throw new dK({expectedLength:a.length,givenLength:b.length});let e=dF(function({checksumAddress:a,parameters:b,values:c}){let d=[];for(let e=0;e<b.length;e++)d.push(function a({checksumAddress:b=!1,parameter:c,value:d}){let e,f=(e=c.type.match(/^(.*)\[(\d+)?\]$/))?[e[2]?Number(e[2]):null,e[1]]:void 0;if(f){let[e,g]=f;return function(b,c){let{checksumAddress:d,length:e,parameter:f}=c,g=null===e;if(!Array.isArray(b))throw new dL(b);if(!g&&b.length!==e)throw new dI({expectedLength:e,givenLength:b.length,type:`${f.type}[${e}]`});let h=!1,i=[];for(let c=0;c<b.length;c++){let e=a({checksumAddress:d,parameter:f,value:b[c]});e.dynamic&&(h=!0),i.push(e)}if(g||h){let a=dF(i);if(g){let b=ct(i.length,{size:32});return{dynamic:!0,encoded:i.length>0?cq(b,a):b}}if(h)return{dynamic:!0,encoded:a}}return{dynamic:!1,encoded:cq(...i.map(({encoded:a})=>a))}}(d,{checksumAddress:b,length:e,parameter:{...c,type:g}})}if("tuple"===c.type)return function(b,c){let{checksumAddress:d,parameter:e}=c,f=!1,g=[];for(let c=0;c<e.components.length;c++){let h=e.components[c],i=Array.isArray(b)?c:h.name,j=a({checksumAddress:d,parameter:h,value:b[i]});g.push(j),j.dynamic&&(f=!0)}return{dynamic:f,encoded:f?dF(g):cq(...g.map(({encoded:a})=>a))}}(d,{checksumAddress:b,parameter:c});if("address"===c.type)return function(a,b){let{checksum:c=!1}=b;return dy(a,{strict:c}),{dynamic:!1,encoded:cv(a.toLowerCase())}}(d,{checksum:b});if("bool"===c.type){var g=d;if("boolean"!=typeof g)throw new cj(`Invalid boolean value: "${g}" (type: ${typeof g}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:cv(cr(g))}}if(c.type.startsWith("uint")||c.type.startsWith("int")){let a=c.type.startsWith("int"),[,,b="256"]=dE.exec(c.type)??[];return function(a,{signed:b,size:c}){if("number"==typeof c){let d=2n**(BigInt(c)-(b?1n:0n))-1n,e=b?-d-1n:0n;if(a>d||a<e)throw new cy({max:d.toString(),min:e.toString(),signed:b,size:c/8,value:a.toString()})}return{dynamic:!1,encoded:ct(a,{size:32,signed:b})}}(d,{signed:a,size:Number(b)})}if(c.type.startsWith("bytes"))return function(a,{type:b}){let[,c]=b.split("bytes"),d=cx(a);if(!c){let b=a;return d%32!=0&&(b=cw(b,32*Math.ceil((a.length-2)/2/32))),{dynamic:!0,encoded:cq(cv(ct(d,{size:32})),b)}}if(d!==Number.parseInt(c,10))throw new dJ({expectedSize:Number.parseInt(c,10),value:a});return{dynamic:!1,encoded:cw(a)}}(d,{type:c.type});if("string"===c.type){var h=d;let a=cu(h),b=Math.ceil(cx(a)/32),c=[];for(let d=0;d<b;d++)c.push(cw(function(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>cx(a)-1)throw new cA({offset:b,position:"start",size:cx(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&cx(a)!==c-b)throw new cA({offset:c,position:"end",size:cx(a)})}(f,b,c),f}(a,32*d,(d+1)*32)));return{dynamic:!0,encoded:cq(cw(ct(cx(a),{size:32})),...c)}}throw new dM(c.type)}({checksumAddress:a,parameter:b[e],value:c[e]}));return d}({checksumAddress:d,parameters:a,values:b}));return 0===e.length?"0x":e}function dH(a,b){if(a.length!==b.length)throw new dK({expectedLength:a.length,givenLength:b.length});let c=[];for(let d=0;d<a.length;d++){let e=a[d],f=b[d];c.push(dH.encode(e,f))}return cq(...c)}new Uint8Array,new DataView(new ArrayBuffer(0)),(dH||(dH={})).encode=function a(b,c,d=!1){if("address"===b)return dy(c),cv(c.toLowerCase(),32*!!d);if("string"===b)return cu(c);if("bytes"===b)return c;if("bool"===b)return cv(cr(c),d?32:1);let e=b.match(dE);if(e){let[a,b,f="256"]=e,g=Number.parseInt(f,10)/8;return ct(c,{size:d?32:g,signed:"int"===b})}let f=b.match(dD);if(f){let[a,b]=f;if(Number.parseInt(b,10)!==(c.length-2)/2)throw new dJ({expectedSize:Number.parseInt(b,10),value:c});return cw(c,32*!!d)}let g=b.match(dC);if(g&&Array.isArray(c)){let[b,d]=g,e=[];for(let b=0;b<c.length;b++)e.push(a(d,c[b],!0));return 0===e.length?"0x":cq(...e)}throw new dM(b)};class dI extends cj{constructor({expectedLength:a,givenLength:b,type:c}){super(`Array length mismatch for type \`${c}\`. Expected: \`${a}\`. Given: \`${b}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}class dJ extends cj{constructor({expectedSize:a,value:b}){super(`Size of bytes "${b}" (bytes${cx(b)}) does not match expected size (bytes${a}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class dK extends cj{constructor({expectedLength:a,givenLength:b}){super(`ABI encoding parameters/values length mismatch.
Expected length (parameters): ${a}
Given length (values): ${b}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class dL extends cj{constructor(a){super(`Value \`${a}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class dM extends cj{constructor(a){super(`Type \`${a}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}function dN(a){let{domain:b,message:c,primaryType:d,types:e}=a,f=(a,b)=>{for(let c of a){let{name:a,type:d}=c,g=b[a],h=d.match(dE);if(h&&("number"==typeof g||"bigint"==typeof g)){let[,a,b]=h;ct(g,{signed:"int"===a,size:Number.parseInt(b??"",10)/8})}if("address"===d&&"string"==typeof g&&!function(a,b={}){let{strict:c=!0}=b??{};try{return dy(a,{strict:c}),!0}catch{return!1}}(g))throw new dz({address:g,cause:new dA});let i=d.match(dD);if(i){let[,a]=i;if(a&&cx(g)!==Number.parseInt(a,10))throw new dX({expectedSize:Number.parseInt(a,10),givenSize:cx(g)})}let j=e[d];j&&(function(a){if("address"===a||"bool"===a||"string"===a||a.startsWith("bytes")||a.startsWith("uint")||a.startsWith("int"))throw new d$({type:a})}(d),f(j,g))}};if(e.EIP712Domain&&b){if("object"!=typeof b)throw new dY({domain:b});f(e.EIP712Domain,b)}if("EIP712Domain"!==d)if(e[d])f(e[d],c);else throw new dZ({primaryType:d,types:e})}function dO(a){return dT({domain:a})}function dP(a){let{domain:b={},message:c,primaryType:d}=a,e={EIP712Domain:dR(b),...a.types};dN({domain:b,message:c,primaryType:d,types:e});let f=["0x19","0x01"];return b&&f.push(dT({domain:b,types:e})),"EIP712Domain"!==d&&f.push(dU({data:c,primaryType:d,types:e})),cq(...f)}function dQ(a){let{primaryType:b,types:c}=a,d="",e=d2({primaryType:b,types:c});for(let a of(e.delete(b),[b,...Array.from(e).sort()]))d+=`${a}(${(c[a]??[]).map(({name:a,type:b})=>`${b} ${a}`).join(",")})`;return d}function dR(a){return["string"==typeof a?.name&&{name:"name",type:"string"},a?.version&&{name:"version",type:"string"},("number"==typeof a?.chainId||"bigint"==typeof a?.chainId)&&{name:"chainId",type:"uint256"},a?.verifyingContract&&{name:"verifyingContract",type:"address"},a?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function dS(a){return dw(dP(a))}function dT(a){let{domain:b,types:c}=a;return dU({data:b,primaryType:"EIP712Domain",types:{...c,EIP712Domain:c?.EIP712Domain||dR(b)}})}function dU(a){let{data:b,primaryType:c,types:d}=a;return dw(d_({data:b,primaryType:c,types:d}))}function dV(a){let{domain:b,message:c,primaryType:d,types:e}=a,f=(a,b)=>{let c={...b};for(let b of a){let{name:a,type:d}=b;"address"===d&&(c[a]=c[a].toLowerCase())}return c};return cn({domain:b?f(e.EIP712Domain??dR(b),b):{},message:(()=>{if("EIP712Domain"!==d)return e[d]?f(e[d],c):{}})(),primaryType:d,types:e},(a,b)=>"bigint"==typeof b?b.toString():b)}function dW(a){try{return dN(a),!0}catch{return!1}}class dX extends cj{constructor({expectedSize:a,givenSize:b}){super(`Expected bytes${a}, got bytes${b}.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.BytesSizeMismatchError"})}}class dY extends cj{constructor({domain:a}){super(`Invalid domain "${cn(a)}".`,{metaMessages:["Must be a valid EIP-712 domain."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidDomainError"})}}class dZ extends cj{constructor({primaryType:a,types:b}){super(`Invalid primary type \`${a}\` must be one of \`${JSON.stringify(Object.keys(b))}\`.`,{metaMessages:["Check that the primary type is a key in `types`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidPrimaryTypeError"})}}class d$ extends cj{constructor({type:a}){super(`Struct type "${a}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidStructTypeError"})}}function d_(a){let{data:b,primaryType:c,types:d}=a,e=[{type:"bytes32"}],f=[d0({primaryType:c,types:d})];for(let a of d[c]??[]){let[c,g]=d1({types:d,name:a.name,type:a.type,value:b[a.name]});e.push(c),f.push(g)}return dG(e,f)}function d0(a){let{primaryType:b,types:c}=a;return dw(cu(dQ({primaryType:b,types:c})))}function d1(a){let{types:b,name:c,type:d,value:e}=a;if(void 0!==b[d])return[{type:"bytes32"},dw(d_({data:e,primaryType:d,types:b}))];if("bytes"===d){let a=e.length%2?"0":"";return[{type:"bytes32"},dw(e=`0x${a+e.slice(2)}`,{as:"Hex"})]}if("string"===d)return[{type:"bytes32"},dw(cD(e),{as:"Hex"})];if(d.lastIndexOf("]")===d.length-1){let a=d.slice(0,d.lastIndexOf("[")),f=e.map(d=>d1({name:c,type:a,types:b,value:d}));return[{type:"bytes32"},dw(dG(f.map(([a])=>a),f.map(([,a])=>a)))]}return[{type:d},e]}function d2(a,b=new Set){let{primaryType:c,types:d}=a,e=c.match(/^\w*/u),f=e?.[0];if(b.has(f)||void 0===d[f])return b;for(let a of(b.add(f),d[f]))d2({primaryType:a.type,types:d},b);return b}a.s(["BytesSizeMismatchError",()=>dX,"InvalidDomainError",()=>dY,"InvalidPrimaryTypeError",()=>dZ,"InvalidStructTypeError",()=>d$,"assert",()=>dN,"domainSeparator",()=>dO,"encode",()=>dP,"encodeData",()=>d_,"encodeField",()=>d1,"encodeType",()=>dQ,"extractEip712DomainTypes",()=>dR,"findTypeDependencies",()=>d2,"getSignPayload",()=>dS,"hashDomain",()=>dT,"hashStruct",()=>dU,"hashType",()=>d0,"serialize",()=>dV,"validate",()=>dW],959292);var d3=a.i(959292),d3=d3,d4=a.i(375908),d5=a.i(875032);let d6={MetadataEntry:[{name:"key",type:"string"},{name:"value",type:"string"}],CreateDataSet:[{name:"clientDataSetId",type:"uint256"},{name:"payee",type:"address"},{name:"metadata",type:"MetadataEntry[]"}],Cid:[{name:"data",type:"bytes"}],PieceMetadata:[{name:"pieceIndex",type:"uint256"},{name:"metadata",type:"MetadataEntry[]"}],AddPieces:[{name:"clientDataSetId",type:"uint256"},{name:"nonce",type:"uint256"},{name:"pieceData",type:"Cid[]"},{name:"pieceMetadata",type:"PieceMetadata[]"}],SchedulePieceRemovals:[{name:"clientDataSetId",type:"uint256"},{name:"pieceIds",type:"uint256[]"}],DeleteDataSet:[{name:"clientDataSetId",type:"uint256"}]},d7={},d8={};for(let a in d6){let b=d3.encodeType({types:d6,primaryType:a});d7[a]=b,d8[a]=(0,d4.keccak256)((0,d5.stringToHex)(b))}a.s(["calculateLastProofDate",()=>ep,"dateToEpoch",()=>em,"epochToDate",()=>el,"getCurrentEpoch",()=>eq,"getGenesisTimestamp",()=>en,"timeUntilEpoch",()=>eo],615135);let d9=a.i(278721).default.version,ea=void 0!==globalThis.window&&void 0!==globalThis.document;async function eb(){try{if(ea)return await a.A(948146);return await a.A(384820)}catch{return null}}let ec=[[/\?.+/,""],[/\/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/gi,"/<UUID>"],[/\/baf[a-z0-9]{50,}/g,"/<CID>"],[/\/0x[a-f0-9]{16,}/gi,"/<txHash>"],[/\/[0-9]+\b/g,"/<ID>"]];function ed(a){let b=a;for(let[a,c]of ec)b=b.replace(a,c);return b}class ee{eventBuffer=[];maxBufferSize=15;sentry=null;async initSentry(a,b){let c,d=await eb();if(!d)return;this.sentry=d;let e=[d.dedupeIntegration()];ea?(c="browser",e.push(d.globalHandlersIntegration({onerror:!0,onunhandledrejection:!0}))):(c="node",e.push(d.onUncaughtExceptionIntegration(),d.onUnhandledRejectionIntegration()));let f={...a.sentrySetTags,filecoinNetwork:b.filecoinNetwork,synapseSdkVersion:`@filoz/synapse-sdk@v${d9}`};this.sentry.init({dsn:"https://7a07cc9e3b5bf5a8fada2f25dc76cd49@o4510235322023936.ingest.us.sentry.io/4510308233445376",sendDefaultPii:!1,tracesSampleRate:1,integrations:e,defaultIntegrations:!1,...a.sentryInitOptions,beforeSend:this.createBeforeSend(a),beforeSendSpan:this.createBeforeSendSpan(a,f),release:`@filoz/synapse-sdk@v${d9}`}),this.sentry.setContext("runtime",{type:c,userAgent:ea&&"navigator"in globalThis?globalThis.navigator.userAgent:void 0}),this.sentry.setTags(f)}createBeforeSend(a){return async(b,c)=>(this.addToEventBuffer(b),a.sentryInitOptions?.beforeSend!=null)?await a.sentryInitOptions.beforeSend(b,c):b}createBeforeSendSpan(a,b){let c=/^(GET|POST|PUT|PATCH|DELETE|HEAD|OPTIONS|TRACE|CONNECT)\s/i;return d=>{let e=d;if(a.sentryInitOptions?.beforeSendSpan!=null){let b=a.sentryInitOptions.beforeSendSpan(d);null!=b&&(e=b)}return e.description&&c.test(e.description)&&(e.description=ed(e.description),("http.client"===e.op||"http.client"===e.data["sentry.op"])&&(e.data={...b,...e.data,"url.sanitizedPath":ed(e.data?.["url.path"]?.toString()??"")})),e}}debugDump(a=50){return{events:this.eventBuffer.slice(-a)}}addToEventBuffer(a){this.eventBuffer.push(a),this.eventBuffer.length>this.maxBufferSize&&this.eventBuffer.shift()}}let ef=null;function eg(){return ef}async function eh(a,b){var c,d;c=a,d=b,c?.sentryInitOptions?.enabled===!1||function(){if("undefined"!=typeof globalThis){if(!0===globalThis.SYNAPSE_TELEMETRY_DISABLED)return!0;if("process"in globalThis){let a=globalThis.process;if(a?.env){let b=a.env.SYNAPSE_TELEMETRY_DISABLED;if("string"==typeof b&&"true"===b.trim().toLowerCase())return!0}}}return!1}()||c?.sentryInitOptions?.enabled===void 0&&(globalThis.process?.env?.NODE_ENV==="test"||null!=globalThis.PW_TEST)||c?.sentryInitOptions?.enabled!==!0&&"calibration"!==d.filecoinNetwork||(ef=new ee,await ef.initSentry(a,b),ej||(ej=!0,globalThis.fetch=async function(a,b){let c=ef?.sentry;if(!c)return ei(a,b);let d=a instanceof Request?new URL(a.url):new URL(a.toString()),e=a instanceof Request?a.method:b?.method||"GET";return await c.startSpan({op:"http.client",name:`${e} ${d}`},async c=>{c.setAttributes({"url.path":d.pathname,"url.full":d.toString(),"server.address":d.hostname,"http.request.method":e,"server.port":d.port||void 0,"location.origin":ea?globalThis.location?.origin:void 0});let f=await ei(a,b);return c.setAttributes({"http.response.status_code":f.status,"http.response_content_length":f.headers.get("content-length")?Number(f.headers.get("content-length")):void 0}),f})}),function(a={}){let b=globalThis,c=a.timeoutMs??2e3,d=!1;if(ea){let a=()=>{ef?.sentry?.flush(c).catch(()=>{})};b.window.addEventListener("pagehide",a,{capture:!0}),b.document.addEventListener("visibilitychange",()=>{"hidden"===b.document.visibilityState&&a()},{capture:!0}),b.window.addEventListener("beforeunload",a,{capture:!0}),b.window.addEventListener("unload",a,{capture:!0})}else{let a=()=>{d||(d=!0,ef?.sentry?.close(c).finally(()=>{d=!1,function(a=!0){null!=ef&&(a&&ef?.sentry?.flush().catch(()=>{}),ej&&(globalThis.fetch=ei,ej=!1),ef=null)}(!1)}).catch(()=>{}))};process.on("exit",a),process.on("beforeExit",a),process.on("SIGINT",a),process.on("SIGTERM",a),process.on("SIGQUIT",a)}}())}let ei=globalThis.fetch,ej=!1;function ek(a,b,c,d){let e,f=`${a} ${b} failed: ${c}`;return null!=d&&d instanceof Error&&(f=`${f} - ${d.message}`),e=null!=d?Error(f,{cause:d}):Error(f),ef?.sentry?.captureException(e,{tags:{operation:`${a}.${b}`},extra:{synapseErrorPrefix:a,synapseErrorOperation:b,synapseErrorDetails:c,originalError:d}}),e}function el(a,b){return new Date(1e3*(cd[b]+a*cc.EPOCH_DURATION))}function em(a,b){let c=cd[b],d=cc.EPOCH_DURATION;return Math.floor((Math.floor(a.getTime()/1e3)-c)/d)}function en(a){return cd[a]}function eo(a,b){let c=a-b,d=c*cc.EPOCH_DURATION;return{epochs:c,seconds:d,minutes:d/60,hours:d/3600,days:d/86400}}function ep(a,b,c){if(0===a)return null;let d=a-b;return d<=0?null:el(d,c)}async function eq(a){let b=await a.getBlockNumber();if(null==b)throw ek("epoch","getCurrentEpoch","Failed to get latest block number");return BigInt(b)}function er(a){return Object.entries(a).sort(([a],[b])=>a.localeCompare(b)).map(([a,b])=>({key:a,value:b}))}function es(a){let b=Array.isArray(a)?a:er(a);if(b.length>10)throw Error(`Too many metadata keys for data set: ${b.length} (max: 10)`);for(let{key:a,value:c}of b){if(a.length>32)throw Error(`Metadata key "${a}" exceeds max length: ${a.length} bytes (max: 32)`);if(c.length>128)throw Error(`Metadata value for key "${a}" exceeds max length: ${c.length} bytes (max: 128)`)}}function et(a){let b=Array.isArray(a)?a:er(a);if(b.length>5)throw Error(`Too many metadata keys for piece: ${b.length} (max: 5)`);for(let{key:a,value:c}of b){if(a.length>32)throw Error(`Metadata key "${a}" exceeds max length: ${a.length} bytes (max: 32)`);if(c.length>128)throw Error(`Metadata value for key "${a}" exceeds max length: ${c.length} bytes (max: 128)`)}}function eu(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;if(0===d.length)return!0;for(let c of d)if(a[c]!==b[c])return!1;return!0}function ev(a={},b){return null==b||cf.WITH_CDN in a?a:b?{...a,[cf.WITH_CDN]:""}:a}async function ew(a){try{let b=await a.getNetwork(),c=Number(b.chainId);if(c===b9.mainnet)return"mainnet";if(c===b9.calibration)return"calibration";throw ek("NetworkUtils","getFilecoinNetworkType",`Unsupported network: chain ID ${c}. Only Filecoin mainnet (${b9.mainnet}) and calibration (${b9.calibration}) are supported.`)}catch(a){if(a instanceof Error&&a.message.includes("Unsupported network"))throw a;throw ek("NetworkUtils","getFilecoinNetworkType",`Failed to detect network: ${a instanceof Error?a.message:String(a)}`)}}function ex(a,b){let c=a.replace(/\/$/,"");return`${c}/piece/${b.toString()}`}function ey(a,b){let c=a.replace(/\/$/,""),d=new URLSearchParams({pieceCid:b.toString()});return`${c}/pdp/piece?${d.toString()}`}class ez{_provider;_signer;_paymentsAddress;_usdfcAddress;_disableNonceManager;_usdfcContract=null;_paymentsContract=null;constructor(a,b,c,d,e){this._provider=a,this._signer=b,this._paymentsAddress=c,this._usdfcAddress=d,this._disableNonceManager=e}_getUsdfcContract(){return null==this._usdfcContract&&(this._usdfcContract=new f.Contract(this._usdfcAddress,ca.ERC20,this._signer)),this._usdfcContract}_getPaymentsContract(){return null==this._paymentsContract&&(this._paymentsContract=new f.Contract(this._paymentsAddress,ca.PAYMENTS,this._signer)),this._paymentsContract}async _getPermitSignature(a,b,c){let d,e,g,h,i,j=await this._signer.getAddress(),k=await ew(this._provider),l=b9[k],m=ci.MULTICALL3[k],n=new f.Contract(m,ca.MULTICALL3,this._provider),o=new f.Interface(ca.ERC20),p=new f.Interface(ca.ERC20_PERMIT),q=[{target:this._usdfcAddress,allowFailure:!1,callData:o.encodeFunctionData("balanceOf",[j])},{target:this._usdfcAddress,allowFailure:!1,callData:o.encodeFunctionData("name")},{target:this._usdfcAddress,allowFailure:!0,callData:p.encodeFunctionData("version")},{target:this._usdfcAddress,allowFailure:!1,callData:p.encodeFunctionData("nonces",[j])}];try{d=await n.aggregate3.staticCall(q)}catch(a){throw ek("PaymentsService",c,"Failed to fetch token information for permit. Ensure token contract is reachable.",a)}try{e=o.decodeFunctionResult("balanceOf",d[0].returnData)[0]}catch(a){throw ek("PaymentsService",c,"Failed to decode token balance.",a)}if(e<a)throw ek("PaymentsService",c,`Insufficient USDFC: have ${e.toString()}, need ${a.toString()}`);try{g=o.decodeFunctionResult("name",d[1].returnData)[0]}catch(a){throw ek("PaymentsService",c,"Failed to read token name for permit domain. Ensure token contract is reachable.",a)}let r="1";if(d[2].success)try{let a=p.decodeFunctionResult("version",d[2].returnData)[0];"string"==typeof a&&a.length>0&&(r=a)}catch{}try{h=p.decodeFunctionResult("nonces",d[3].returnData)[0]}catch(a){throw ek("PaymentsService",c,"Token does not appear to support EIP-2612 permit (nonces() unavailable).",a)}let s={name:g,version:r,chainId:l,verifyingContract:this._usdfcAddress},t={owner:j,spender:this._paymentsAddress,value:a,nonce:h,deadline:b};try{i=await this._signer.signTypedData(s,cb,t)}catch(a){throw ek("PaymentsService",c,"Failed to sign EIP-2612 permit. Ensure your wallet supports typed data signing.",a)}return f.Signature.from(i)}async balance(a=b8.USDFC){if(a!==b8.USDFC)throw ek("PaymentsService","payments contract balance check",`Token "${a}" is not supported. Currently only USDFC token is supported for payments contract balance queries.`);return(await this.accountInfo(a)).availableFunds}async accountInfo(a=b8.USDFC){let b;if(a!==b8.USDFC)throw ek("PaymentsService","account info",`Token "${a}" is not supported. Currently only USDFC token is supported.`);let c=await this._signer.getAddress(),d=this._getPaymentsContract();try{b=await d.accounts(this._usdfcAddress,c)}catch(a){throw ek("PaymentsService","account info","Failed to read account information from payments contract. This could indicate the contract is not properly deployed, the ABI is incorrect, or there are network connectivity issues.",a)}let[e,f,g,h]=b,i=await eq(this._provider)-BigInt(h),j=BigInt(f)+BigInt(g)*i,k=BigInt(e)-j;return{funds:BigInt(e),lockupCurrent:BigInt(f),lockupRate:BigInt(g),lockupLastSettledAt:BigInt(h),availableFunds:k>0n?k:0n}}async walletBalance(a){if(null==a||a===b8.FIL)try{let a=await this._signer.getAddress();return await this._provider.getBalance(a)}catch(a){throw ek("PaymentsService","wallet FIL balance check","Unable to retrieve FIL balance from wallet. This could be due to network connectivity issues, RPC endpoint problems, or wallet connection issues.",a)}if(a===b8.USDFC)try{let a=await this._signer.getAddress(),b=this._getUsdfcContract();return await b.balanceOf(a)}catch(a){throw ek("PaymentsService","wallet USDFC balance check","Unexpected error while checking USDFC token balance in wallet.",a)}throw ek("PaymentsService","wallet balance",`Token "${a}" is not supported. Currently only FIL and USDFC tokens are supported.`)}decimals(a=b8.USDFC){return 18}async allowance(a,b=b8.USDFC){if(b!==b8.USDFC)throw ek("PaymentsService","allowance",`Token "${b}" is not supported. Currently only USDFC token is supported.`);let c=await this._signer.getAddress(),d=this._getUsdfcContract();try{return await d.allowance(c,a)}catch(a){throw ek("PaymentsService","allowance check","Failed to check token allowance. This could indicate network connectivity issues or an invalid spender address.",a)}}async approve(a,b,c=b8.USDFC){if(c!==b8.USDFC)throw ek("PaymentsService","approve",`Token "${c}" is not supported. Currently only USDFC token is supported.`);let d="bigint"==typeof b?b:BigInt(b);if(d<0n)throw ek("PaymentsService","approve","Approval amount cannot be negative");let e=await this._signer.getAddress(),f=this._getUsdfcContract(),g={};this._disableNonceManager&&(g.nonce=await this._provider.getTransactionCount(e,"pending"));try{return await f.approve(a,d,g)}catch(b){throw ek("PaymentsService","approve",`Failed to approve ${a} to spend ${d.toString()} ${c}`,b)}}async approveService(a,b,c,d,e=b8.USDFC){if(e!==b8.USDFC)throw ek("PaymentsService","approveService",`Token "${e}" is not supported. Currently only USDFC token is supported.`);let f="bigint"==typeof b?b:BigInt(b),g="bigint"==typeof c?c:BigInt(c),h="bigint"==typeof d?d:BigInt(d);if(f<0n||g<0n||h<0n)throw ek("PaymentsService","approveService","Allowance values cannot be negative");let i=await this._signer.getAddress(),j=this._getPaymentsContract(),k={};this._disableNonceManager&&(k.nonce=await this._provider.getTransactionCount(i,"pending"));try{return await j.setOperatorApproval(this._usdfcAddress,a,!0,f,g,h,k)}catch(b){throw ek("PaymentsService","approveService",`Failed to approve service ${a} as operator for ${e}`,b)}}async revokeService(a,b=b8.USDFC){if(b!==b8.USDFC)throw ek("PaymentsService","revokeService",`Token "${b}" is not supported. Currently only USDFC token is supported.`);let c=await this._signer.getAddress(),d=this._getPaymentsContract(),e={};this._disableNonceManager&&(e.nonce=await this._provider.getTransactionCount(c,"pending"));try{return await d.setOperatorApproval(this._usdfcAddress,a,!1,0n,0n,0n,e)}catch(c){throw ek("PaymentsService","revokeService",`Failed to revoke service ${a} as operator for ${b}`,c)}}async serviceApproval(a,b=b8.USDFC){if(b!==b8.USDFC)throw ek("PaymentsService","serviceApproval",`Token "${b}" is not supported. Currently only USDFC token is supported.`);let c=await this._signer.getAddress(),d=this._getPaymentsContract();try{let b=await d.operatorApprovals(this._usdfcAddress,c,a);return{isApproved:b[0],rateAllowance:b[1],lockupAllowance:b[2],rateUsed:b[3],lockupUsed:b[4],maxLockupPeriod:b[5]}}catch(b){throw ek("PaymentsService","serviceApproval",`Failed to check service approval status for ${a}`,b)}}async deposit(a,b=b8.USDFC,c){if(b!==b8.USDFC)throw ek("PaymentsService","deposit",`Unsupported token: ${b}`);let d="bigint"==typeof a?a:BigInt(a);if(d<=0n)throw ek("PaymentsService","deposit","Invalid amount");let e=await this._signer.getAddress(),f=c?.to??e,g=this._getUsdfcContract(),h=this._getPaymentsContract(),i=await g.balanceOf(e);if(i<d)throw ek("PaymentsService","deposit",`Insufficient USDFC: have ${BigInt(i).toString()}, need ${d.toString()}`);let j=await this.allowance(this._paymentsAddress,b);if(c?.onAllowanceCheck?.(j,d),j<d){let a=await this.approve(this._paymentsAddress,d,b);c?.onApprovalTransaction?.(a);let e=await a.wait(cg.TRANSACTION_CONFIRMATIONS);null!=e&&c?.onApprovalConfirmed?.(e)}c?.onDepositStarting?.();let k={};return this._disableNonceManager&&(k.nonce=await this._provider.getTransactionCount(e,"pending")),await h.deposit(this._usdfcAddress,f,d,k)}async depositWithPermit(a,b=b8.USDFC,c){if(b!==b8.USDFC)throw ek("PaymentsService","depositWithPermit",`Unsupported token: ${b}`);let d="bigint"==typeof a?a:BigInt(a);if(d<=0n)throw ek("PaymentsService","depositWithPermit","Invalid amount");let e=await this._signer.getAddress(),f=this._getPaymentsContract(),g=null==c?BigInt(Math.floor(Date.now()/1e3)+cg.PERMIT_DEADLINE_DURATION):BigInt(c),h=await this._getPermitSignature(d,g,"depositWithPermit"),i={};this._disableNonceManager&&(i.nonce=await this._provider.getTransactionCount(e,"pending"));try{return await f.depositWithPermit(this._usdfcAddress,e,d,g,h.v,h.r,h.s,i)}catch(a){throw ek("PaymentsService","depositWithPermit","Failed to execute depositWithPermit on Payments contract.",a)}}async depositWithPermitAndApproveOperator(a,b,c,d,e,f=b8.USDFC,g){if(f!==b8.USDFC)throw ek("PaymentsService","depositWithPermitAndApproveOperator",`Unsupported token: ${f}`);let h="bigint"==typeof a?a:BigInt(a);if(h<=0n)throw ek("PaymentsService","depositWithPermitAndApproveOperator","Invalid amount");let i="bigint"==typeof c?c:BigInt(c),j="bigint"==typeof d?d:BigInt(d),k="bigint"==typeof e?e:BigInt(e);if(i<0n||j<0n||k<0n)throw ek("PaymentsService","depositWithPermitAndApproveOperator","Allowance values cannot be negative");let l=await this._signer.getAddress(),m=this._getPaymentsContract(),n=null==g?BigInt(Math.floor(Date.now()/1e3)+cg.PERMIT_DEADLINE_DURATION):BigInt(g),o=await this._getPermitSignature(h,n,"depositWithPermitAndApproveOperator"),p={};this._disableNonceManager&&(p.nonce=await this._provider.getTransactionCount(l,"pending"));try{return await m.depositWithPermitAndApproveOperator(this._usdfcAddress,l,h,n,o.v,o.r,o.s,b,i,j,k,p)}catch(a){throw ek("PaymentsService","depositWithPermitAndApproveOperator","Failed to execute depositWithPermitAndApproveOperator on Payments contract.",a)}}async withdraw(a,b=b8.USDFC){if(b!==b8.USDFC)throw ek("PaymentsService","withdraw",`Unsupported token: ${b}`);let c="bigint"==typeof a?a:BigInt(a);if(c<=0n)throw ek("PaymentsService","withdraw","Invalid amount");let d=await this._signer.getAddress(),e=this._getPaymentsContract(),f=await this.accountInfo(b);if(f.availableFunds<c)throw ek("PaymentsService","withdraw",`Insufficient available balance: have ${f.availableFunds.toString()}, need ${c.toString()}`);let g={};return this._disableNonceManager&&(g.nonce=await this._provider.getTransactionCount(d,"pending")),await e.withdraw(this._usdfcAddress,c,g)}async settle(a,b){let c="bigint"==typeof a?a:BigInt(a),[d,e]=await Promise.all([this._signer.getAddress(),null==b?eq(this._provider):Promise.resolve(null)]),f=null==b?e:BigInt(b),g=this._getPaymentsContract(),h={value:1300000000000000n};this._disableNonceManager&&(h.nonce=await this._provider.getTransactionCount(d,"pending"));try{return await g.settleRail(c,f,h)}catch(a){throw ek("PaymentsService","settle",`Failed to settle rail ${c.toString()} up to epoch ${f.toString()}`,a)}}async getSettlementAmounts(a,b){let c="bigint"==typeof a?a:BigInt(a),d=null==b?await eq(this._provider):null,e=null==b?d:BigInt(b),f=this._getPaymentsContract();try{let a=await f.settleRail.staticCall(c,e);return{totalSettledAmount:a[0],totalNetPayeeAmount:a[1],totalOperatorCommission:a[2],totalNetworkFee:a[3],finalSettledEpoch:a[4],note:a[5]}}catch(a){throw ek("PaymentsService","getSettlementAmounts",`Failed to get settlement amounts for rail ${c.toString()} up to epoch ${e.toString()}`,a)}}async settleTerminatedRail(a){let b="bigint"==typeof a?a:BigInt(a),c=await this._signer.getAddress(),d=this._getPaymentsContract(),e={};this._disableNonceManager&&(e.nonce=await this._provider.getTransactionCount(c,"pending"));try{return await d.settleTerminatedRailWithoutValidation(b,e)}catch(a){throw ek("PaymentsService","settleTerminatedRail",`Failed to settle terminated rail ${b.toString()}`,a)}}async getRail(a){let b="bigint"==typeof a?a:BigInt(a),c=this._getPaymentsContract();try{let a=await c.getRail(b);return{token:a.token,from:a.from,to:a.to,operator:a.operator,validator:a.validator,paymentRate:a.paymentRate,lockupPeriod:a.lockupPeriod,lockupFixed:a.lockupFixed,settledUpTo:a.settledUpTo,endEpoch:a.endEpoch,commissionRateBps:a.commissionRateBps,serviceFeeRecipient:a.serviceFeeRecipient}}catch(a){if(a.message?.includes("RailInactiveOrSettled"))throw ek("PaymentsService","getRail",`Rail ${b.toString()} does not exist or is inactive`);throw ek("PaymentsService","getRail",`Failed to get rail ${b.toString()}`,a)}}async settleAuto(a,b){let c="bigint"==typeof a?a:BigInt(a);return(await this.getRail(c)).endEpoch>0n?await this.settleTerminatedRail(c):await this.settle(c,b)}async getRailsAsPayer(a=b8.USDFC){if(a!==b8.USDFC)throw ek("PaymentsService","getRailsAsPayer",`Token "${a}" is not supported. Currently only USDFC token is supported.`);let b=await this._signer.getAddress(),c=this._getPaymentsContract();try{let[a]=await c.getRailsForPayerAndToken(b,this._usdfcAddress,0n,0n);return a.map(a=>({railId:Number(a.railId),isTerminated:a.isTerminated,endEpoch:Number(a.endEpoch)}))}catch(a){throw ek("PaymentsService","getRailsAsPayer","Failed to get rails where wallet is payer",a)}}async getRailsAsPayee(a=b8.USDFC){if(a!==b8.USDFC)throw ek("PaymentsService","getRailsAsPayee",`Token "${a}" is not supported. Currently only USDFC token is supported.`);let b=await this._signer.getAddress(),c=this._getPaymentsContract();try{let[a]=await c.getRailsForPayeeAndToken(b,this._usdfcAddress,0n,0n);return a.map(a=>({railId:Number(a.railId),isTerminated:a.isTerminated,endEpoch:Number(a.endEpoch)}))}catch(a){throw ek("PaymentsService","getRailsAsPayee","Failed to get rails where wallet is payee",a)}}}a.s([],771384);var f=f;class eA{signer;domain;WITH_CDN_METADATA={key:cf.WITH_CDN,value:""};constructor(a,b,c){this.signer=b,this.domain={name:"FilecoinWarmStorageService",version:"1",chainId:Number(c),verifyingContract:a}}getUnderlyingSigner(){return"signer"in this.signer&&"NonceManager"===this.signer.constructor.name?this.signer.signer:this.signer}async isMetaMaskSigner(){try{let a=this.getUnderlyingSigner();if("Wallet"===a.constructor.name)return!1;let b=a.provider;if(null==b)return!1;if("_eip1193Provider"in b)return!0;if(b instanceof f.JsonRpcProvider||b instanceof f.WebSocketProvider)return!1;if("request"in b&&"function"==typeof b.request)return!0}catch{}return!1}async signWithMetaMask(a,b){let c,d=this.signer.provider;if(null==d)throw Error("No provider available");let e=await this.signer.getAddress(),f="";for(let b of Object.keys(a))if("Cid"!==b&&"PieceData"!==b){f=b;break}let g={types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],...a},primaryType:f,domain:this.domain,message:b};return"_eip1193Provider"in d?c=d._eip1193Provider:("request"in d,c=d),null!=c&&"request"in c?await c.request({method:"eth_signTypedData_v4",params:[e,JSON.stringify(g)]}):await d.send("eth_signTypedData_v4",[e,JSON.stringify(g)])}async signCreateDataSet(a,b,c=[]){let d,e={CreateDataSet:d6.CreateDataSet,MetadataEntry:d6.MetadataEntry};if(await this.isMetaMaskSigner()){let f={clientDataSetId:a.toString(),metadata:c,payee:b};d=await this.signWithMetaMask(e,f)}else{let f=this.getUnderlyingSigner();d=await f.signTypedData(this.domain,e,{clientDataSetId:a,metadata:c,payee:b})}let g=f.Signature.from(d),h=f.TypedDataEncoder.hash(this.domain,e,{clientDataSetId:a,metadata:c,payee:b});return{signature:d,v:g.v,r:g.r,s:g.s,signedData:h}}async signAddPieces(a,b,c,d=[]){let e;if(0===d.length)d=Array(c.length).fill([]);else if(d.length!==c.length)throw Error("metadata length must match pieceDataArray length");let g=[],h=[];for(let a=0;a<c.length;a++){let b=c[a],e="string"==typeof b?b3(b):b;if(null==e)throw Error(`Invalid PieceCID: ${String(e)}`);h.push({data:e.bytes}),g.push({pieceIndex:a,metadata:d[a]})}let i={AddPieces:d6.AddPieces,Cid:d6.Cid,PieceMetadata:d6.PieceMetadata,MetadataEntry:d6.MetadataEntry};if(await this.isMetaMaskSigner()){let c={clientDataSetId:a.toString(),nonce:b.toString(),pieceData:h.map(a=>({data:f.hexlify(a.data)})),pieceMetadata:g};e=await this.signWithMetaMask(i,c)}else{let c=this.getUnderlyingSigner();e=await c.signTypedData(this.domain,i,{clientDataSetId:a,nonce:b,pieceData:h,pieceMetadata:g})}let j=f.Signature.from(e),k=f.TypedDataEncoder.hash(this.domain,i,{clientDataSetId:a,nonce:b,pieceData:h,pieceMetadata:g});return{signature:e,v:j.v,r:j.r,s:j.s,signedData:k}}async signSchedulePieceRemovals(a,b){let c;if(await this.isMetaMaskSigner()){let d={clientDataSetId:a.toString(),pieceIds:b.map(a=>a.toString())};c=await this.signWithMetaMask({SchedulePieceRemovals:d6.SchedulePieceRemovals},d)}else{let d=this.getUnderlyingSigner();c=await d.signTypedData(this.domain,{SchedulePieceRemovals:d6.SchedulePieceRemovals},{clientDataSetId:a,pieceIds:b})}let d=f.Signature.from(c),e=f.TypedDataEncoder.hash(this.domain,{SchedulePieceRemovals:d6.SchedulePieceRemovals},{clientDataSetId:a,pieceIds:b});return{signature:c,v:d.v,r:d.r,s:d.s,signedData:e}}async signDeleteDataSet(a){let b;if(await this.isMetaMaskSigner()){let c={clientDataSetId:a.toString()};b=await this.signWithMetaMask({DeleteDataSet:d6.DeleteDataSet},c)}else{let c=this.getUnderlyingSigner();b=await c.signTypedData(this.domain,{DeleteDataSet:d6.DeleteDataSet},{clientDataSetId:a})}let c=f.Signature.from(b),d=f.TypedDataEncoder.hash(this.domain,{DeleteDataSet:d6.DeleteDataSet},{clientDataSetId:a});return{signature:b,v:c.v,r:c.r,s:c.s,signedData:d}}async getSignerAddress(){return await this.signer.getAddress()}}let eB=Symbol.for("sindresorhus/unlimited-timeout#brand"),eC=new WeakMap,eD=function({clearTimeout:a,setTimeout:b}={}){return(c,{value:d,signal:e}={})=>{let f,g,h;if(e?.aborted)return Promise.reject(e.reason);let i=a??clearTimeout,j=()=>{i(f),h(e.reason)},k=new Promise((a,i)=>{g=()=>{e&&e.removeEventListener("abort",j),a(d)},h=i,f=(b??setTimeout)(g,c)});return e&&e.addEventListener("abort",j,{once:!0}),eC.set(k,()=>{i(f),f=null,g()}),k}}({setTimeout:function(a,b,...c){if("function"!=typeof a)throw TypeError("Expected callback to be a function");b??=0;let d=!1,e={[eB]:!0,id:void 0,cleared:!1,ref:()=>(d=!1,e.id?.ref?.(),e),unref:()=>(d=!0,e.id?.unref?.(),e)};if((b=Number(b))===1/0||b>Number.MAX_SAFE_INTEGER)return e;(!Number.isFinite(b)||b<0)&&(b=0);let f=performance.now()+b,g=b=>{!e.cleared&&(b<=0x7fffffff?e.id=globalThis.setTimeout(()=>{e.cleared||a(...c)},b):e.id=globalThis.setTimeout(()=>{g(Math.max(0,f-performance.now()))},0x7fffffff),d&&e.id?.unref?.())};return g(b),e},clearTimeout:function(a){a&&"object"==typeof a&&a[eB]&&(a.cleared=!0,void 0!==a.id&&(globalThis.clearTimeout(a.id),a.id=void 0))}}),eE=Object.prototype.toString,eF=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function eG(a,b,{min:c=0,allowInfinity:d=!1}={}){if(void 0!==b){if("number"!=typeof b||Number.isNaN(b))throw TypeError(`Expected \`${a}\` to be a number${d?" or Infinity":""}.`);if(!d&&!Number.isFinite(b))throw TypeError(`Expected \`${a}\` to be a finite number.`);if(b<c)throw TypeError(`Expected \`${a}\` to be \u2265 ${c}.`)}}class eH extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}}function eI(a,b){return Number.isFinite(b)?b-(performance.now()-a):b}async function eJ({error:a,attemptNumber:b,retriesConsumed:c,startTime:d,options:e}){let f,g=a instanceof Error?a:TypeError(`Non-error was thrown: "${a}". You should only throw errors.`);if(g instanceof eH)throw g.originalError;let h=Number.isFinite(e.retries)?Math.max(0,e.retries-c):e.retries,i=e.maxRetryTime??1/0,j=Object.freeze({error:g,attemptNumber:b,retriesLeft:h,retriesConsumed:c});if(await e.onFailedAttempt(j),0>=eI(d,i))throw g;let k=await e.shouldConsumeRetry(j),l=eI(d,i);if(l<=0||h<=0)throw g;if(g instanceof TypeError&&!function(a){if(!(a&&"[object Error]"===eE.call(a)&&"TypeError"===a.name&&"string"==typeof a.message))return!1;let{message:b,stack:c}=a;return"Load failed"===b?void 0===c||"__sentry_captured__"in a:!!b.startsWith("error sending request for url")||eF.has(b)}(g)){if(k)throw g;return e.signal?.throwIfAborted(),!1}if(!await e.shouldRetry(j))throw g;if(!k)return e.signal?.throwIfAborted(),!1;let m=Math.min((f=Math.max(1,c+1),Math.min(Math.round((e.randomize?Math.random()+1:1)*e.minTimeout*e.factor**(f-1)),e.maxTimeout)),l);return m>0&&await new Promise((a,b)=>{let c=()=>{clearTimeout(d),e.signal?.removeEventListener("abort",c),b(e.signal.reason)},d=setTimeout(()=>{e.signal?.removeEventListener("abort",c),a()},m);e.unref&&d.unref?.(),e.signal?.addEventListener("abort",c,{once:!0})}),e.signal?.throwIfAborted(),!0}async function eK(a,b={}){var c=(b={...b}).retries;if("number"==typeof c){if(c<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(c))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==c)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(b,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");b.retries??=10,b.factor??=2,b.minTimeout??=1e3,b.maxTimeout??=1/0,b.maxRetryTime??=1/0,b.randomize??=!1,b.onFailedAttempt??=()=>{},b.shouldRetry??=()=>!0,b.shouldConsumeRetry??=()=>!0,eG("factor",b.factor,{min:0,allowInfinity:!1}),eG("minTimeout",b.minTimeout,{min:0,allowInfinity:!1}),eG("maxTimeout",b.maxTimeout,{min:0,allowInfinity:!0}),eG("maxRetryTime",b.maxRetryTime,{min:0,allowInfinity:!0}),b.factor>0||(b.factor=1),b.signal?.throwIfAborted();let d=0,e=0,f=performance.now();for(;!Number.isFinite(b.retries)||e<=b.retries;){d++;try{b.signal?.throwIfAborted();let c=await a(d);return b.signal?.throwIfAborted(),c}catch(a){await eJ({error:a,attemptNumber:d,retriesConsumed:e,startTime:f,options:b})&&e++}}throw Error("Retry attempts exhausted without throwing an error.")}let eL=Symbol.for("request-error");function eM(a){return a instanceof Error&&eL in a}class eN extends Error{[eL]=!0;name="RequestError";cause;constructor(a,b={}){super(a,b),this.cause=b.cause}static is(a){return eM(a)&&"RequestError"===a.name}}class eO extends eN{name="JsonError";cause;constructor(a){super("Failed with a JSON error, see cause.",a),this.cause=a.cause}static is(a){return eM(a)&&"JsonError"===a.name}}class eP extends eN{name="NetworkError";static is(a){return eM(a)&&"NetworkError"===a.name}}class eQ extends eN{name="TimeoutError";constructor(a,b={}){super(`Request timed out after ${a}ms`,b)}static is(a){return eM(a)&&"TimeoutError"===a.name}}class eR extends eN{name="AbortError";signal;constructor(a,b={}){super(`Request aborted: ${a.reason??"unknown"}`,b),this.signal=a}static is(a){return eM(a)&&"AbortError"===a.name}}class eS extends eN{name="HttpError";code=0;response;request;options;constructor(a){super(`${a.response.status} - ${a.response.statusText}`),this.code=a.response?.status??0,this.response=a.response,this.request=a.request,this.options=a.options}static is(a){return eM(a)&&"HttpError"===a.name}}async function eT(a,b={}){let{signal:c,timeout:d=5e3,retry:e,fetch:f=globalThis.fetch.bind(globalThis),json:g,headers:h,onResponse:i=()=>{}}=b;if("string"!=typeof a&&!(a instanceof URL))return{error:new eN("`resource` must be a string or URL object")};let j=!1!==d?AbortSignal.timeout(d):void 0,k=function(a){let b=new AbortController;for(let c of a)if(c&&"aborted"in c&&"reason"in c){if(c.aborted)return b.abort(c.reason),c;c.addEventListener("abort",()=>b.abort(c.reason),{signal:b.signal,once:!0})}return b.signal}([c,j]),l=new Headers(h);void 0!==g&&(l.set("content-type",l.get("content-type")??"application/json"),b.body=JSON.stringify(g));let m=new Request(a,{...b,headers:l,signal:k});async function n(){let a=await f(m),c=await i(a.clone(),m);if(c instanceof Response&&(a=c),!a.ok)throw new eS({response:a,request:m,options:b});return a}try{let a=await (e?eK(()=>n(),{retries:e.retries,factor:e.factor??2,minTimeout:e.minTimeout??1e3,maxTimeout:e.maxTimeout??1/0,randomize:e.randomize??!1,unref:e.unref??!1,maxRetryTime:e.maxRetryTime??1/0,signal:k,onFailedAttempt:async a=>{let b=e.afterStatusCodes??[413,429,503];if(eS.is(a.error)&&b.includes(a.error.code)){let b=function(a){let b=a.headers.get("Retry-After")??a.headers.get("RateLimit-Reset")??a.headers.get("X-RateLimit-Reset")??a.headers.get("X-Rate-Limit-Reset");if(null===b)return 0;let c=Number(b);return Number.isNaN(c)?c=Date.parse(b)-Date.now():c*=1e3,c}(a.error.response);b>0&&await eD(b,{signal:k})}},shouldRetry:async a=>{if(e.shouldRetry)return!!await e.shouldRetry(a);let b=e.methods??["get","put","head","delete","options","trace"],c=e.statusCodes??[408,413,429,500,502,503,504];return!!(b.includes(m.method.toLowerCase())&&eS.is(a.error)&&c.includes(a.error.code))}}):n());return a.ok?{result:a}:{error:new eS({response:a,request:m,options:b})}}catch(a){if(!1!==d&&j?.aborted)return{error:new eQ(d,{cause:a})};if(c?.aborted)return{error:new eR(c,{cause:a})};if(eS.is(a))return{error:a};return{error:new eP(a.message,{cause:a.cause})}}}eT.get=function(a,b={}){return eT(a,{...b,method:"GET"})},eT.post=function(a,b={}){return eT(a,{...b,method:"POST"})},eT.put=function(a,b={}){return eT(a,{...b,method:"PUT"})},eT.delete=function(a,b={}){return eT(a,{...b,method:"DELETE"})},eT.patch=function(a,b={}){return eT(a,{...b,method:"PATCH"})},eT.head=function(a,b={}){return eT(a,{...b,method:"HEAD"})},eT.options=function(a,b={}){return eT(a,{...b,method:"OPTIONS"})},eT.trace=function(a,b={}){return eT(a,{...b,method:"TRACE"})},eT.json=async function(a,b={}){let{error:c,result:d}=await eT(a,{...b,body:null,json:b.body});return c?eS.is(c)&&c.response.headers.get("content-type")?.includes("json")?{error:new eO({cause:await c.response.json()})}:{error:c}:d.ok&&d.headers.get("content-type")?.includes("json")?{result:await d.json()}:{error:new eN("Response is not JSON",{cause:d})}},eT.json.get=function(a,b={}){return eT.json(a,{...b,method:"GET"})},eT.json.post=function(a,b={}){return eT.json(a,{...b,method:"POST"})},eT.json.put=function(a,b={}){return eT.json(a,{...b,method:"PUT"})},eT.json.delete=function(a,b={}){return eT.json(a,{...b,method:"DELETE"})},eT.json.patch=function(a,b={}){return eT.json(a,{...b,method:"PATCH"})},eT.json.head=function(a,b={}){return eT.json(a,{...b,method:"HEAD"})},eT.json.options=function(a,b={}){return eT.json(a,{...b,method:"OPTIONS"})},eT.json.trace=function(a,b={}){return eT.json(a,{...b,method:"TRACE"})};var eU=a.i(283088),eV=a.i(662564),eW=a.i(793703),eX=a.i(954205),eY=a.i(195726);function eZ(a){for(let b of a.matchAll(/(?:vm error|revert reason)=\[(.*?)\]/g)){let a=b[1];if(a?.startsWith("0x")){let b;try{let b=(0,eW.decodeErrorResult)({abi:m,data:a});return`Warm Storage
${e$(b)}`}catch(a){b=a}if(b instanceof eV.AbiErrorSignatureNotFoundError)try{let b=(0,eW.decodeErrorResult)({abi:i,data:a});return`Payments
${e$(b)}`}catch(a){b=a}if(b instanceof eV.AbiErrorSignatureNotFoundError)try{let b=(0,eW.decodeErrorResult)({abi:k,data:a});return`PDP Verifier
${e$(b)}`}catch(a){b=a}return`Unable to decode error
${b}`}if(a?.startsWith("Error("))return`
${a.replace("Error(","").replace(")","")}`}return`Service Provider PDP
${a}`}function e$(a){let b=a.abiItem?(0,eX.formatAbiItem)(a.abiItem,{includeName:!0}):void 0,c=a.args?(0,eY.formatAbiItemWithArgs)({abiItem:a.abiItem,args:a.args,includeName:!1,includeFunctionName:!1}):void 0;return[b?`${b}`:"",c&&"()"!==c?`${[...Array(a.errorName?.length??0).keys()].map(()=>" ").join("")}${c}`:""].join("\n")}let e_=Symbol.for("synapse-error");function e0(a){return a instanceof Error&&e_ in a}class e1 extends Error{[e_]=!0;name="SynapseError";cause;details;shortMessage;constructor(a,b){const c=b?.cause instanceof Error?b.cause.message:b?.details?b.details:void 0;super([a||"An error occurred.",...c?[""]:[],...c?[`Details: ${c}`]:[]].join("\n"),b),this.cause=b?.cause??void 0,this.details=c??void 0,this.shortMessage=a}static is(a){return e0(a)&&"SynapseError"===a.name}}class e2 extends e1{name="LocationHeaderError";constructor(a){super(`Location header format is invalid: ${a??"<none>"}`)}static is(a){return e0(a)&&"LocationHeaderError"===a.name}}class e3 extends e1{name="CreateDataSetError";constructor(a){super("Failed to create data set.",{details:eZ(a)})}static is(a){return e0(a)&&"CreateDataSetError"===a.name}}class e4 extends e1{name="PollDataSetCreationStatusError";constructor(a){super("Failed to check data set creation status.",{details:eZ(a)})}static is(a){return e0(a)&&"PollDataSetCreationStatusError"===a.name}}class e5 extends e1{name="GetDataSetError";constructor(a){super(a?"Failed to get data set.":"Data set not found.",{details:a?eZ(a):void 0})}static is(a){return e0(a)&&"GetDataSetError"===a.name}}class e6 extends e1{name="PostPieceError";constructor(a){super("Failed to create upload session.",{details:eZ(a)})}static is(a){return e0(a)&&"PostPieceError"===a.name}}class e7 extends e1{name="UploadPieceError";constructor(a){super("Failed to upload piece.",{details:eZ(a)})}static is(a){return e0(a)&&"UploadPieceError"===a.name}}class e8 extends e1{name="FindPieceError";constructor(a){super("Failed to find piece.",{details:eZ(a)})}static is(a){return e0(a)&&"FindPieceError"===a.name}}class e9 extends e1{name="AddPiecesError";constructor(a){super("Failed to add pieces.",{details:eZ(a)})}static is(a){return e0(a)&&"AddPiecesError"===a.name}}class fa extends e1{name="PollForAddPiecesStatusError";constructor(a){super("Failed to poll for add pieces status.",{details:eZ(a)})}static is(a){return e0(a)&&"PollForAddPiecesStatusError"===a.name}}class fb extends e1{name="DeletePieceError";constructor(a){super("Failed to delete piece.",{details:eZ(a)})}static is(a){return e0(a)&&"DeletePieceError"===a.name}}class fc extends e1{name="InvalidUploadSizeError";constructor(a){super("Invalid upload size.",{details:`Size ${a} bytes is below minimum allowed size of 127 bytes or exceeds maximum allowed size of 209715200 bytes`})}}let fd=1/0;async function fe(a){let b=await eT.post(new URL("pdp/data-sets",a.endpoint),{body:JSON.stringify({recordKeeper:a.recordKeeper,extraData:a.extraData}),headers:{"Content-Type":"application/json"},timeout:3e5});if(b.error){if(eS.is(b.error))throw new e3(await b.error.response.text());throw b.error}let c=b.result.headers.get("Location"),d=c?.split("/").pop();if(!c||!d||!(0,eU.isHex)(d))throw new e2(c);return{txHash:d,statusUrl:new URL(c,a.endpoint).toString()}}async function ff(a){let b=await eT.json.get(a.statusUrl,{async onResponse(a){if(a.ok){if((await a.clone().json()).dataSetCreated)return a;throw Error("Not created yet")}},retry:{shouldRetry:a=>"Not created yet"===a.error.message,retries:fd,factor:1,minTimeout:4e3},timeout:3e5});if(b.error){if(eS.is(b.error))throw new e4(await b.error.response.text());throw b.error}return b.result}async function fg(a){let b=await eT.post(new URL("pdp/data-sets/create-and-add",a.endpoint),{body:JSON.stringify({recordKeeper:a.recordKeeper,extraData:a.extraData,pieces:a.pieces.map(a=>({pieceCid:a.toString(),subPieces:[{subPieceCid:a.toString()}]}))}),headers:{"Content-Type":"application/json"},timeout:3e5});if(b.error){if(eS.is(b.error))throw new e3(await b.error.response.text());throw b.error}let c=b.result.headers.get("Location"),d=c?.split("/").pop();if(!c||!d||!(0,eU.isHex)(d))throw new e2(c);return{txHash:d,statusUrl:new URL(c,a.endpoint).toString()}}async function fh(a){let b=await eT.json.get(new URL(`pdp/data-sets/${a.dataSetId}`,a.endpoint));if(b.error){if(eS.is(b.error))throw new e5(await b.error.response.text());throw b.error}return b.result}async function fi(a){let b=await eT.post(new URL("pdp/piece/uploads",a.endpoint),{timeout:3e5,signal:a.signal});if(b.error){if(eS.is(b.error))throw new e6(`Failed to create upload session: ${await b.error.response.text()}`);throw b.error}if(201!==b.result.status)throw new e6(`Expected 201 Created, got ${b.result.status}`);let c=b.result.headers.get("Location");if(!c)throw new e2("Upload session created but Location header missing");let d=c.match(/\/pdp\/piece\/uploads\/([a-fA-F0-9-]+)/);if(!d)throw new e2(`Invalid Location header format: ${c}`);let e=d[1],f=()=>a.pieceCid??null,g=null;if(null==a.pieceCid){let a=b5();g=a.stream,f=a.getPieceCID}let h=function(a){return"object"==typeof a&&null!==a&&"getReader"in a&&"function"==typeof a.getReader?a:function(a){var b;if(!("object"==typeof(b=a)&&null!==b&&Symbol.asyncIterator in b&&"function"==typeof b[Symbol.asyncIterator]))throw Error("Input must be an AsyncIterable");if("function"==typeof ReadableStream.from)return ReadableStream.from(a);let c=a[Symbol.asyncIterator]();return new ReadableStream({async pull(a){try{let{value:b,done:d}=await c.next();d?a.close():a.enqueue(b)}catch(b){if(c.return)try{await c.return()}catch{}a.error(b)}},async cancel(){c.return&&await c.return()}})}(a)}(a.data),i=0,j=new TransformStream({transform(b,c){if((i+=b.length)>0x3f800000)throw new fc(i);a.onProgress&&a.onProgress(i),c.enqueue(b)}}),k=g?h.pipeThrough(j).pipeThrough(g):h.pipeThrough(j),l={"Content-Type":"application/octet-stream"};void 0!==a.size&&(l["Content-Length"]=a.size.toString());let m=await eT.put(new URL(`pdp/piece/uploads/${e}`,a.endpoint),{body:k,headers:l,timeout:!1,signal:a.signal,duplex:"half"});if(m.error){if(eS.is(m.error))throw new e7(`Failed to upload piece: ${await m.error.response.text()}`);throw m.error}if(204!==m.result.status)throw new e7(`Expected 204 No Content, got ${m.result.status}`);let n=f();if(null===n)throw Error("Failed to calculate PieceCID during upload");let o=JSON.stringify({pieceCid:n.toString()}),p=await eT.post(new URL(`pdp/piece/uploads/${e}`,a.endpoint),{body:o,headers:{"Content-Type":"application/json"},timeout:3e5,signal:a.signal});if(p.error){if(eS.is(p.error))throw new e6(`Failed to finalize upload: ${await p.error.response.text()}`);throw p.error}if(200!==p.result.status)throw new e6(`Expected 200 OK for finalization, got ${p.result.status}`);return{pieceCid:n,size:i}}async function fj(a){let{pieceCid:b,endpoint:c}=a,d=new URLSearchParams({pieceCid:b.toString()}),e=await eT.json.get(new URL(`pdp/piece?${d.toString()}`,c),{retry:{statusCodes:[404],retries:fd,factor:1},timeout:3e5});if(e.error){if(eS.is(e.error))throw new e8(await e.error.response.text());if(eQ.is(e.error))throw new e8("Timeout waiting for piece to be found");throw e.error}return b4(e.result.pieceCid)}async function fk(a){let{endpoint:b,dataSetId:c,pieces:d,extraData:e}=a,f=await eT.post(new URL(`pdp/data-sets/${c}/pieces`,b),{headers:{"Content-Type":"application/json"},body:JSON.stringify({pieces:d.map(a=>({pieceCid:a.toString(),subPieces:[{subPieceCid:a.toString()}]})),extraData:e}),timeout:3e5});if(f.error){if(eS.is(f.error))throw new e9(await f.error.response.text());throw f.error}let g=f.result.headers.get("Location"),h=g?.split("/").pop();if(!g||!h||!(0,eU.isHex)(h))throw new e2(g);return{txHash:h,statusUrl:new URL(g,b).toString()}}async function fl(a){let b=await eT.json.get(a.statusUrl,{async onResponse(a){if(a.ok){if((await a.clone().json()).piecesAdded)return a;throw Error("Not added yet")}},retry:{shouldRetry:a=>"Not added yet"===a.error.message,retries:fd,factor:1,minTimeout:4e3},timeout:3e5});if(b.error){if(eS.is(b.error))throw new fa(await b.error.response.text());throw b.error}return b.result}async function fm(a){let{endpoint:b,dataSetId:c,pieceId:d,extraData:e}=a,f=await eT.json.delete(new URL(`pdp/data-sets/${c}/pieces/${d}`,b),{body:{extraData:e}});if(f.error){if(eS.is(f.error))throw new fb(await f.error.response.text());throw f.error}return f.result}var fn=a.i(325881);function fo(a,b){let c={};for(let d=0;d<a.length;d++)c[a[d]]=b[d];return c}var fp=a.i(679572);function fq(a){var b;return{serviceURL:(0,fp.hexToString)(a.serviceURL),minPieceSizeInBytes:BigInt(a.minPieceSizeInBytes),maxPieceSizeInBytes:BigInt(a.maxPieceSizeInBytes),ipniPiece:"ipniPiece"in a,ipniIpfs:"ipniIpfs"in a,storagePricePerTibPerDay:BigInt(a.storagePricePerTibPerDay),minProvingPeriodInEpochs:BigInt(a.minProvingPeriodInEpochs),location:(0,fp.hexToString)(a.location),paymentTokenAddress:(b=a.paymentTokenAddress).length>66?"0x0000000000000000000000000000000000000000":b.length>42?`0x${b.slice(-40)}`:b.length<42?(0,fn.pad)(b,{size:20}):b}}function fr(a,b){let c=[],d=[];if(c.push("serviceURL"),d.push((0,d5.stringToHex)(a.serviceURL)),c.push("minPieceSizeInBytes"),d.push((0,d5.bytesToHex)((0,b1.numberToBytes)(a.minPieceSizeInBytes))),c.push("maxPieceSizeInBytes"),d.push((0,d5.bytesToHex)((0,b1.numberToBytes)(a.maxPieceSizeInBytes))),a.ipniPiece&&(c.push("ipniPiece"),d.push("0x01")),a.ipniIpfs&&(c.push("ipniIpfs"),d.push("0x01")),c.push("storagePricePerTibPerDay"),d.push((0,d5.bytesToHex)((0,b1.numberToBytes)(a.storagePricePerTibPerDay))),c.push("minProvingPeriodInEpochs"),d.push((0,d5.bytesToHex)((0,b1.numberToBytes)(a.minProvingPeriodInEpochs))),c.push("location"),d.push((0,d5.stringToHex)(a.location)),c.push("paymentTokenAddress"),d.push(a.paymentTokenAddress),null!=b)for(let[a,e]of Object.entries(b))c.push(a),e?(0,eU.isHex)(e)?d.push(e):d.push((0,d5.bytesToHex)((0,b1.toBytes)(e))):d.push("0x01");return[c,d]}let fs=globalThis.crypto;function ft(){if(fs?.getRandomValues!=null){let a=new BigUint64Array(4);fs.getRandomValues(a);let b=0n;return a.forEach(a=>{b<<=64n,b|=a}),b}let a=0n;for(let b=0;b<32;b++)a<<=8n,a|=BigInt(fu(256));return a}function fu(a){return Math.floor(Math.random()*a)}function fv(a){if(fs?.getRandomValues==null)return fu(a);{let b=new Uint32Array(1);return fs.getRandomValues(b),b[0]%a}}a.i(968894),a.i(486065);var f=f;function fw(a){return"object"==typeof a&&null!=a&&"string"==typeof a.createMessageHash&&"boolean"==typeof a.dataSetCreated&&"string"==typeof a.service&&"string"==typeof a.txStatus&&(null===a.ok||"boolean"==typeof a.ok)&&(void 0===a.dataSetId||"number"==typeof a.dataSetId)}function fx(a){if("object"!=typeof a||null==a||"string"!=typeof a.txHash||"string"!=typeof a.txStatus||"number"!=typeof a.dataSetId||"number"!=typeof a.pieceCount||null!==a.addMessageOk&&"boolean"!=typeof a.addMessageOk)return!1;if(void 0!==a.confirmedPieceIds){if(!Array.isArray(a.confirmedPieceIds))return!1;for(let b of a.confirmedPieceIds)if("number"!=typeof b)return!1}return!0}function fy(a){return"object"==typeof a&&null!=a&&"string"==typeof a.pieceCid&&null!=b3(a.pieceCid)}function fz(a){if(!fw(a))throw Error("Invalid data set creation status response format");return a}function fA(a){if(!fx(a))throw Error("Invalid piece addition status response format");return a}function fB(a){if(!fy(a)){if("object"==typeof a&&null!=a){let b=a.pieceCid??a.piece_cid;if(null!=b&&null==b3(b))throw Error("Invalid find piece response: pieceCid is not a valid PieceCID")}throw Error("Invalid find piece response format")}let b=b3(a.pieceCid??a.piece_cid);if(null==b)throw Error("Invalid find piece response: pieceCid is not a valid PieceCID");return{pieceCid:b}}function fC(a){if("object"!=typeof a||null==a||"number"!=typeof a.pieceId||"string"!=typeof a.pieceCid||"string"!=typeof a.subPieceCid||"number"!=typeof a.subPieceOffset)return null;let b=b3(a.pieceCid),c=b3(a.subPieceCid);return null==b||null==c?null:{pieceId:a.pieceId,pieceCid:b,subPieceCid:c,subPieceOffset:a.subPieceOffset}}function fD(a){if("object"!=typeof a||null==a||"number"!=typeof a.id||!Array.isArray(a.pieces))return null;let b=[];for(let c of a.pieces){let a=fC(c);if(null==a)return null;b.push(a)}return"number"!=typeof a.nextChallengeEpoch?null:{id:a.id,pieces:b,nextChallengeEpoch:a.nextChallengeEpoch}}class fE{_serviceURL;_authHelper;constructor(a,b){if(""===b.trim())throw Error("PDP service URL is required");this._serviceURL=b.replace(/\/$/,""),this._authHelper=a}async createDataSet(a,b,c,d,e){es(d);let f=await this.getAuthHelper().signCreateDataSet(a,b,d),g=this._encodeDataSetCreateData({payer:c,clientDataSetId:a,metadata:d,signature:f.signature});return fe({endpoint:this._serviceURL,recordKeeper:e,extraData:`0x${g}`})}async createAndAddPieces(a,b,c,d,e,g){null==g.dataset&&(g.dataset=[]),es(g.dataset),g.pieces=fE._processAddPiecesInputs(e,g.pieces);let h=await this.getAuthHelper().signCreateDataSet(a,b,g.dataset),i=this._encodeDataSetCreateData({payer:c,clientDataSetId:a,metadata:g.dataset,signature:h.signature}),j=ft(),k=await this.getAuthHelper().signAddPieces(a,j,e,g.pieces),l=this._encodeAddPiecesExtraData({nonce:j,signature:k.signature,metadata:g.pieces}),m=f.AbiCoder.defaultAbiCoder().encode(["bytes","bytes"],[`0x${i}`,`0x${l}`]);return fg({endpoint:this._serviceURL,recordKeeper:d,extraData:m,pieces:e.map(b3).filter(a=>null!=a)})}static _processAddPiecesInputs(a,b){if(0===a.length)throw Error("At least one piece must be provided");if(null!=b){if(b.length!==a.length)throw Error(`Metadata length (${b.length}) must match pieces length (${a.length})`);for(let a=0;a<b.length;a++)if(null!=b[a]&&b[a].length>0)try{et(b[a])}catch(b){throw Error(`Piece ${a} metadata validation failed: ${b.message}`)}}for(let b of a)if(null==b3(b))throw Error(`Invalid PieceCID: ${String(b)}`);return b??a.map(()=>[])}async addPieces(a,b,c,d){let e=fE._processAddPiecesInputs(c,d),f=ft(),g=await this.getAuthHelper().signAddPieces(b,f,c,e),h=this._encodeAddPiecesExtraData({nonce:f,signature:g.signature,metadata:e}),{txHash:i,statusUrl:j}=await fk({endpoint:this._serviceURL,dataSetId:BigInt(a),pieces:c.map(b3).filter(a=>null!=a),extraData:`0x${h}`});return{message:`Pieces added to data set ID ${a} successfully`,txHash:i,statusUrl:j}}async getDataSetCreationStatus(a){let b=await fetch(`${this._serviceURL}/pdp/data-sets/created/${a}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===b.status)throw Error(`Data set creation not found for transaction hash: ${a}`);if(200!==b.status){let a=await b.text();throw Error(`Failed to get data set creation status: ${b.status} ${b.statusText} - ${a}`)}return fz(await b.json())}async getPieceAdditionStatus(a,b){let c=await fetch(`${this._serviceURL}/pdp/data-sets/${a}/pieces/added/${b}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===c.status)throw Error(`Piece addition not found for transaction: ${b}`);if(200!==c.status){let a=await c.text();throw Error(`Failed to get piece addition status: ${c.status} ${c.statusText} - ${a}`)}return fA(await c.json())}async findPiece(a){let b=b3(a);if(null==b)throw Error(`Invalid PieceCID: ${String(a)}`);return{pieceCid:await fj({endpoint:this._serviceURL,pieceCid:b})}}async getPieceStatus(a){let b=b3(a);if(null==b)throw Error(`Invalid PieceCID: ${String(a)}`);let c=await fetch(`${this._serviceURL}/pdp/piece/${b.toString()}/status`,{method:"GET",headers:{Accept:"application/json"}});if(404===c.status){let a=await c.text();throw Error(`Piece not found or does not belong to service: ${a}`)}if(!c.ok){let a=await c.text();throw Error(`Failed to get piece status: ${c.status} ${c.statusText} - ${a}`)}var d=await c.json();if("object"!=typeof d||null==d||"string"!=typeof d.pieceCid||"string"!=typeof d.status||"boolean"!=typeof d.indexed||"boolean"!=typeof d.advertised||"boolean"!=typeof d.retrieved||void 0!==d.retrievedAt&&"string"!=typeof d.retrievedAt)throw Error("Invalid piece status response format");return d}async uploadPiece(a,b){if(!(a instanceof Uint8Array))return fi({endpoint:this._serviceURL,data:a,onProgress:b?.onProgress,pieceCid:b?.pieceCid,signal:b?.signal});{if(a.length>0x3f800000)throw Error(`Upload size ${a.length} exceeds maximum 1065353216 bytes (1 GiB with fr32 expansion)`);let c=b6(a);return fi({endpoint:this._serviceURL,data:c,size:a.length,onProgress:b?.onProgress,pieceCid:b?.pieceCid,signal:b?.signal})}}async downloadPiece(a){let b=b3(a);if(null==b)throw Error(`Invalid PieceCID: ${String(a)}`);let c=ex(this._serviceURL,b),d=await fetch(c);return await b7(d,b)}async getDataSet(a){let b=await fh({endpoint:this._serviceURL,dataSetId:BigInt(a)});return{id:b.id,pieces:b.pieces.map(a=>{let b=b4(a.pieceCid);return{pieceId:a.pieceId,pieceCid:b,subPieceCid:b,subPieceOffset:a.subPieceOffset}}),nextChallengeEpoch:b.nextChallengeEpoch}}async deletePiece(a,b,c){let d=await this.getAuthHelper().signSchedulePieceRemovals(b,[BigInt(c)]),{txHash:e}=await fm({endpoint:this._serviceURL,dataSetId:BigInt(a),pieceId:BigInt(c),extraData:f.AbiCoder.defaultAbiCoder().encode(["bytes"],[d.signature])});return e}_encodeDataSetCreateData(a){let b=a.signature.startsWith("0x")?a.signature:`0x${a.signature}`,c=a.metadata.map(a=>a.key),d=a.metadata.map(a=>a.value);return f.AbiCoder.defaultAbiCoder().encode(["address","uint256","string[]","string[]","bytes"],[a.payer,a.clientDataSetId,c,d,b]).slice(2)}_encodeAddPiecesExtraData(a){let b=a.signature.startsWith("0x")?a.signature:`0x${a.signature}`,c=a.metadata.map(a=>a.map(a=>a.key)),d=a.metadata.map(a=>a.map(a=>a.value));return f.AbiCoder.defaultAbiCoder().encode(["uint256","string[][]","string[][]","bytes"],[a.nonce,c,d,b]).slice(2)}async ping(){let a=`${this._serviceURL}/pdp/ping`,b=await fetch(a,{method:"GET",headers:{}});if(200!==b.status){let a=await b.text().catch(()=>"Unknown error");throw Error(`Provider ping failed: ${b.status} ${b.statusText} - ${a}`)}}getServiceURL(){return this._serviceURL}getAuthHelper(){if(null==this._authHelper)throw Error("AuthHelper is not available for an operation that requires signing");return this._authHelper}}var f=f;class fF{_provider;_contractAddress;_contract;constructor(a,b){this._provider=a,this._contractAddress=b,this._contract=new f.Contract(this._contractAddress,ca.PDP_VERIFIER,this._provider)}async dataSetLive(a){return await this._contract.dataSetLive(a)}async getNextPieceId(a){return Number(await this._contract.getNextPieceId(a))}async getDataSetListener(a){return await this._contract.getDataSetListener(a)}async getDataSetStorageProvider(a){let[b,c]=await this._contract.getDataSetStorageProvider(a);return{storageProvider:b,proposedStorageProvider:c}}async getDataSetLeafCount(a){return Number(await this._contract.getDataSetLeafCount(a))}extractDataSetIdFromReceipt(a){try{for(let b of a.logs)try{let a=this._contract.interface.parseLog({topics:b.topics,data:b.data});if(null!=a&&"DataSetCreated"===a.name)return Number(a.args.setId)}catch{}return null}catch(a){throw Error(`Failed to extract data set ID from receipt: ${a instanceof Error?a.message:String(a)}`)}}async getActivePieces(a,b){let c=b?.offset??0,d=b?.limit??100,e=b?.signal;if(e?.aborted)throw Error("Operation aborted");let f=await this._contract.getActivePieces(a,c,d);return{pieces:f[0].map((a,b)=>{try{return{pieceCid:function(a){let b=(0,b1.hexToBytes)(a),c=bk.decode(b);if(!b2(c))throw Error(`Hex string '${a}' is a valid CID but not a valid PieceCID`);return c}(a.data),pieceId:Number(f[1][b])}}catch(a){throw ek("PDPVerifier","getActivePieces",`Failed to convert piece data to PieceCID: ${a instanceof Error?a.message:String(a)}`,a)}}),hasMore:!!f[2]}}getContractAddress(){return this._contract.target}}a.s([],673686);var f=f;let fG=d8.CreateDataSet,fH=d8.AddPieces,fI=d8.SchedulePieceRemovals,fJ=d8.DeleteDataSet,fK=[fG,fH,fI,fJ],fL={[fG]:"CreateDataSet",[fH]:"AddPieces",[fI]:"SchedulePieceRemovals",[fJ]:"DeleteDataSet"},fM=globalThis.location?.hostname||"unknown";class fN{_provider;_registry;_signer;_owner;constructor(a,b,c,d){this._provider=a,this._registry=new f.Contract(b,ca.SESSION_KEY_REGISTRY,d),this._signer=c,this._owner=d}getSigner(){return this._signer}async fetchExpiries(a=fK){let b=await ew(this._provider),c=new f.Contract(ci.MULTICALL3[b],ca.MULTICALL3,this._provider),d=new f.Interface(ca.SESSION_KEY_REGISTRY),[e,g,h]=await Promise.all([this._owner.getAddress(),this._signer.getAddress(),this._registry.getAddress()]),i=[];for(let b of a)i.push({target:h,allowFailure:!0,callData:d.encodeFunctionData("authorizationExpiry",[e,g,b])});let j=await c.aggregate3.staticCall(i),k={};for(let b=0;b<a.length;b++)k[fK[b]]=d.decodeFunctionResult("authorizationExpiry",j[b].returnData)[0];return k}async login(a,b=fK,c=fM){return await this._registry.login(await this._signer.getAddress(),a,b,c)}async revoke(a=fK){return await this._registry.revoke(await this._signer.getAddress(),a)}}a.s(["ADD_PIECES_TYPEHASH",0,fH,"CREATE_DATA_SET_TYPEHASH",0,fG,"DELETE_DATA_SET_TYPEHASH",0,fJ,"PDP_PERMISSIONS",0,fK,"PDP_PERMISSION_NAMES",0,fL,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,fI,"SessionKey",()=>fN],192449),a.s([],629502);var f=f;class fO{_provider;_registryAddress;_registryContract=null;constructor(a,b){this._provider=a,this._registryAddress=b}static async create(a,b){return new fO(a,b)}_getRegistryContract(){return null==this._registryContract&&(this._registryContract=new f.Contract(this._registryAddress,ca.SERVICE_PROVIDER_REGISTRY,this._provider)),this._registryContract}async registerProvider(a,b){let c=this._getRegistryContract().connect(a),d=await c.REGISTRATION_FEE(),[e,f]=fr(b.pdpOffering,b.capabilities);return await c.registerProvider(b.payee,b.name,b.description,0,e,f,{value:d})}async updateProviderInfo(a,b,c){let d=this._getRegistryContract().connect(a);return await d.updateProviderInfo(b,c)}async removeProvider(a){let b=this._getRegistryContract().connect(a);return await b.removeProvider()}async getProvider(a){try{let b=this._getRegistryContract(),c=await b.getProvider(a);if(c.info.serviceProvider===f.ZeroAddress)return null;let d=await this._getProviderProducts(a);return this._convertToProviderInfo(a,c.info,d)}catch(a){if(a instanceof Error&&a.message.includes("Provider not found"))return null;throw a}}async getProviderByAddress(a){try{let b=this._getRegistryContract(),c=await b.getProviderByAddress(a);if(c.info.serviceProvider===f.ZeroAddress)return null;let d=await this._getProviderProducts(Number(c.providerId));return this._convertToProviderInfo(Number(c.providerId),c.info,d)}catch(a){return console.warn("Error fetching provider by address:",a),null}}async getProviderIdByAddress(a){let b=this._getRegistryContract();return Number(await b.getProviderIdByAddress(a))}async getAllActiveProviders(){let a=this._getRegistryContract(),b=[],c=0,d=!0;for(;d;){let e=await a.getAllActiveProviders(c,50),f=e[0];if(d=e[1],f.length>0){let a=f.map(a=>Number(a));b.push(this.getProviders(a))}c+=50}return(await Promise.all(b)).flat()}async getActiveProvidersByProductType(a){let b=this._getRegistryContract(),c=[],d=0,e=!0;for(;e;){let f=await b.getProvidersByProductType(a,!0,d,50);if(f.providerIds.length>0){let a=f.providerIds.map(a=>Number(a));c.push(this.getProviders(a))}e=f.hasMore,d+=50}return(await Promise.all(c)).flat()}async isProviderActive(a){let b=this._getRegistryContract();return await b.isProviderActive(a)}async isRegisteredProvider(a){let b=this._getRegistryContract();return await b.isRegisteredProvider(a)}async getProviderCount(){let a=this._getRegistryContract();return Number(await a.getProviderCount())}async activeProviderCount(){let a=this._getRegistryContract();return Number(await a.activeProviderCount())}async addPDPProduct(a,b,c={}){let d=this._getRegistryContract().connect(a),[e,f]=fr(b,c);return await d.addProduct(0,e,f)}async updatePDPProduct(a,b,c={}){let d=this._getRegistryContract().connect(a),[e,f]=fr(b,c);return await d.updateProduct(0,e,f)}async removeProduct(a,b){let c=this._getRegistryContract().connect(a);return await c.removeProduct(b)}async getPDPService(a){try{let b=this._getRegistryContract(),c=await b.getProviderWithProduct(a,0);if(!c.product.isActive)return null;let d=fo(c.product.capabilityKeys,c.productCapabilityValues);return{offering:fq(d),capabilities:d,isActive:c.product.isActive}}catch{return null}}async providerHasProduct(a,b){let c=this._getRegistryContract();return await c.providerHasProduct(a,b)}async getProviders(a){if(0===a.length)return[];try{return await this._getProvidersWithMulticall(a)}catch(b){return await this._getProvidersIndividually(a)}}async _getProvidersWithMulticall(a){let b=await ew(this._provider),c=ci.MULTICALL3[b],d=new f.Contract(c,ca.MULTICALL3,this._provider),e=new f.Interface(ca.SERVICE_PROVIDER_REGISTRY),g=this._prepareMulticallCalls(a,e),h=await d.aggregate3.staticCall(g);return this._processMulticallResults(a,h,e)}_prepareMulticallCalls(a,b){let c=[];for(let d of a)c.push({target:this._registryAddress,allowFailure:!0,callData:b.encodeFunctionData("getProviderWithProduct",[d,0])});return c}_processMulticallResults(a,b,c){let d=[];for(let e=0;e<a.length;e++)if(b[e].success)try{let[,g,h,i]=c.decodeFunctionResult("getProviderWithProduct",b[e].returnData)[0],j=fo(h.capabilityKeys,i),k=this._convertToProviderInfo(a[e],g,[{type:"PDP",isActive:h.isActive,capabilities:j,data:fq(j)}]);if(k.serviceProvider===f.ZeroAddress)continue;d.push(k)}catch{}return d}async _getProvidersIndividually(a){let b=[],c=a.map(a=>this.getProvider(a));for(let a of(await Promise.all(c)))null!=a&&b.push(a);return b}async _getProviderProducts(a){let b=[],c=await this.getPDPService(a);return null!=c&&b.push({type:"PDP",isActive:c.isActive,capabilities:c.capabilities,data:c.offering}),b}_convertToProviderInfo(a,b,c){let d={};for(let a of c)"PDP"===a.type&&(d.PDP=a);return{id:a,serviceProvider:b.serviceProvider,payee:b.payee,name:b.name,description:b.description,active:b.isActive,products:d}}}let fP="No approved service providers available";class fQ{_synapse;_provider;_pdpServer;_warmStorageService;_warmStorageAddress;_withCDN;_signer;_uploadBatchSize;_dataSetId;_dataSetMetadata;_pendingPieces=[];_isProcessing=!1;_activeUploads=new Set;_uploadBatchWaitTimeout=15e3;serviceProvider;get withCDN(){return this._withCDN}get provider(){return this._provider}get dataSetMetadata(){return this._dataSetMetadata}get dataSetId(){return this._dataSetId}static validateRawSize(a,b){if(a<ce.MIN_UPLOAD_SIZE)throw ek("StorageContext",b,`Data size ${a} bytes is below minimum allowed size of ${ce.MIN_UPLOAD_SIZE} bytes`);if(a>ce.MAX_UPLOAD_SIZE)throw ek("StorageContext",b,`Data size ${a} bytes exceeds maximum allowed size of ${ce.MAX_UPLOAD_SIZE} bytes (${Math.floor(ce.MAX_UPLOAD_SIZE/1024/1024)} MiB)`)}constructor(a,b,c,d,e,f){this._synapse=a,this._provider=c,this._withCDN=e.withCDN??!1,this._signer=a.getSigner(),this._warmStorageService=b,this._uploadBatchSize=Math.max(1,e.uploadBatchSize??ce.DEFAULT_UPLOAD_BATCH_SIZE),this._dataSetMetadata=f,this._dataSetId=d,this.serviceProvider=c.serviceProvider,this._warmStorageAddress=a.getWarmStorageAddress();const g=new eA(this._warmStorageAddress,this._signer,BigInt(a.getChainId()));if(!c.products.PDP?.data.serviceURL)throw Error(`Provider ${c.id} does not have a PDP product with serviceURL`);this._pdpServer=new fE(g,c.products.PDP.data.serviceURL)}static async createContexts(a,b,c){let d=c?.count??2,e=[],f=await a.getClient().getAddress(),g=b.getServiceProviderRegistryAddress(),h=new fO(a.getProvider(),g);if(c.dataSetIds){let a=[];for(let e of new Set(c.dataSetIds))if(a.push(fQ.resolveByDataSetId(e,b,h,f,{withCDN:c.withCDN,withIpni:c.withIpni,dev:c.dev,metadata:c.metadata})),a.length>=d)break;e.push(...await Promise.all(a))}let i=e.map(a=>a.provider.id);if(e.length<d&&c.providerIds){let a=[];for(let g of[...new Set(c.providerIds)].filter(a=>!i.includes(a)))if(a.push(fQ.resolveByProviderId(f,g,c.metadata??{},b,h,c.forceCreateDataSets)),i.push(g),a.length+e.length>=d)break;e.push(...await Promise.all(a))}if(e.length<d){let a=[...c.excludeProviderIds??[],...i];for(let g=e.length;g<d;g++)try{let d=await fQ.smartSelectProvider(f,c.metadata??{},b,h,a,c.forceCreateDataSets??!1,c.withIpni??!1,c.dev??!1);a.push(d.provider.id),e.push(d)}catch(a){if(a instanceof Error&&a.message.includes(fP))break;throw a}}return await Promise.all(e.map(async d=>await fQ.createWithSelectedProvider(d,a,b,c)))}static async create(a,b,c={}){let d=b.getServiceProviderRegistryAddress(),e=new fO(a.getProvider(),d),f=await fQ.resolveProviderAndDataSet(a,b,e,c);return await fQ.createWithSelectedProvider(f,a,b,c)}static async createWithSelectedProvider(a,b,c,d={}){try{d.callbacks?.onProviderSelected?.(a.provider)}catch(a){console.error("Error in onProviderSelected callback:",a)}return -1!==a.dataSetId&&d.callbacks?.onDataSetResolved?.({isExisting:-1!==a.dataSetId,dataSetId:a.dataSetId,provider:a.provider}),new fQ(b,c,a.provider,-1===a.dataSetId?void 0:a.dataSetId,d,a.dataSetMetadata)}static async resolveProviderAndDataSet(a,b,c,d){let e=await a.getClient().getAddress();if(null!=d.dataSetId&&!0!==d.forceCreateDataSet)return await fQ.resolveByDataSetId(d.dataSetId,b,c,e,d);let f=ev(d.metadata,d.withCDN);return null!=d.providerId?await fQ.resolveByProviderId(e,d.providerId,f,b,c,d.forceCreateDataSet):null!=d.providerAddress?await fQ.resolveByProviderAddress(d.providerAddress,b,c,e,f,d.forceCreateDataSet):await fQ.smartSelectProvider(e,f,b,c,d.excludeProviderIds??[],d.forceCreateDataSet??!1,d.withIpni??!1,d.dev??!1)}static async resolveByDataSetId(a,b,c,d,e){let f=(await b.getClientDataSetsWithDetails(d)).find(b=>b.pdpVerifierDataSetId===a);if(null==f||!f.isLive||!f.isManaged)throw ek("StorageContext","resolveByDataSetId",`Data set ${a} not found, not owned by ${d}, or not managed by the current WarmStorage contract`);(null!=e.providerId||null!=e.providerAddress)&&await fQ.validateDataSetConsistency(f,e,c);let g=await c.getProvider(f.providerId);if(null==g)throw ek("StorageContext","resolveByDataSetId",`Provider ID ${f.providerId} for data set ${a} not found in registry`);if(null!=e.withCDN&&f.withCDN!==e.withCDN)throw ek("StorageContext","resolveByDataSetId",`Data set ${a} has CDN ${f.withCDN?"enabled":"disabled"}, but requested ${e.withCDN?"enabled":"disabled"}`);let h=await b.getDataSetMetadata(a);return{provider:g,dataSetId:a,isExisting:!0,dataSetMetadata:h}}static async validateDataSetConsistency(a,b,c){if(null!=b.providerId&&a.providerId!==b.providerId)throw ek("StorageContext","validateDataSetConsistency",`Data set ${a.pdpVerifierDataSetId} belongs to provider ID ${a.providerId}, but provider ID ${b.providerId} was requested`);if(null!=b.providerAddress){let d=await c.getProvider(a.providerId);if(null==d||d.serviceProvider.toLowerCase()!==b.providerAddress.toLowerCase())throw ek("StorageContext","validateDataSetConsistency",`Data set ${a.pdpVerifierDataSetId} belongs to provider ${d?.serviceProvider??"unknown"}, but provider ${b.providerAddress} was requested`)}}static async resolveByProviderId(a,b,c,d,e,f){let[g,h]=await Promise.all([e.getProvider(b),f?Promise.resolve(null):d.getClientDataSetsWithDetails(a)]);if(null==g)throw ek("StorageContext","resolveByProviderId",`Provider ID ${b} not found in registry`);if(!0===f)return{provider:g,dataSetId:-1,isExisting:!1,dataSetMetadata:c};let i=h.filter(a=>a.providerId===g.id&&!!a.isLive&&!!a.isManaged&&0===a.pdpEndEpoch&&eu(a.metadata,c));if(i.length>0){let a=i.sort((a,b)=>a.currentPieceCount>0&&0===b.currentPieceCount?-1:b.currentPieceCount>0&&0===a.currentPieceCount?1:a.pdpVerifierDataSetId-b.pdpVerifierDataSetId),b=await d.getDataSetMetadata(a[0].pdpVerifierDataSetId);return{provider:g,dataSetId:a[0].pdpVerifierDataSetId,isExisting:!0,dataSetMetadata:b}}return{provider:g,dataSetId:-1,isExisting:!1,dataSetMetadata:c}}static async resolveByProviderAddress(a,b,c,d,e,f){let g=await c.getProviderByAddress(a);if(null==g)throw ek("StorageContext","resolveByProviderAddress",`Provider ${a} not found in registry`);return await fQ.resolveByProviderId(d,g.id,e,b,c,f)}static async smartSelectProvider(a,b,c,d,e,f,g,h){let i=await c.getClientDataSetsWithDetails(a),j=new Set(e),k=i.filter(a=>a.isLive&&a.isManaged&&0===a.pdpEndEpoch&&eu(a.metadata,b)&&!j.has(a.providerId));if(k.length>0&&!f){let a=k.sort((a,b)=>a.currentPieceCount>0&&0===b.currentPieceCount?-1:b.currentPieceCount>0&&0===a.currentPieceCount?1:a.pdpVerifierDataSetId-b.pdpVerifierDataSetId);async function*l(){for(let b of a){if(j.has(b.providerId))continue;j.add(b.providerId);let a=await d.getProvider(b.providerId);if(null==a){console.warn(`Provider ID ${b.providerId} for data set ${b.pdpVerifierDataSetId} is not currently approved`);continue}if(g&&a.products.PDP?.data.ipniIpfs===!1)continue;let c=a.products.PDP?.capabilities?.serviceStatus;(h||"0x646576"!==c)&&(yield a)}}try{let b=await fQ.selectProviderWithPing(l()),d=a.find(a=>a.providerId===b.id);if(null==d)console.warn(`Could not match selected provider ${b.serviceProvider} (ID: ${b.id}) to existing data sets. Falling back to selecting from all providers.`);else{let a=await c.getDataSetMetadata(d.pdpVerifierDataSetId);return{provider:b,dataSetId:d.pdpVerifierDataSetId,isExisting:!0,dataSetMetadata:a}}}catch(a){console.warn("All providers from existing data sets failed health check. Falling back to all providers.")}}let m=await c.getApprovedProviderIds(),n=(await d.getProviders(m)).filter(a=>(!g||a.products.PDP?.data.ipniIpfs===!0)&&(h||a.products.PDP?.capabilities?.serviceStatus!=="0x646576")&&!e.includes(a.id));if(0===n.length)throw ek("StorageContext","smartSelectProvider",fP);return{provider:await fQ.selectRandomProvider(n),dataSetId:-1,isExisting:!1,dataSetMetadata:b}}static async selectRandomProvider(a){if(0===a.length)throw ek("StorageContext","selectRandomProvider","No providers available");async function*b(){let b=[...a];for(;b.length>0;){let a=b.splice(fv(b.length),1)[0];yield a}}return await fQ.selectProviderWithPing(b())}static async selectProviderWithPing(a){let b=0;for await(let c of a){b++;try{if(!c.products.PDP?.data.serviceURL)continue;let a=new fE(null,c.products.PDP.data.serviceURL);return await a.ping(),c}catch(a){console.warn(`Provider ${c.serviceProvider} failed ping test:`,a instanceof Error?a.message:String(a))}}if(0===b)throw ek("StorageContext","selectProviderWithPing","No providers available to select from");throw ek("StorageContext","selectProviderWithPing",`All ${b} providers failed health check. Storage may be temporarily unavailable.`)}static async performPreflightCheck(a,b,c,d){fQ.validateRawSize(c,"preflightUpload");let e=await a.checkAllowanceForStorage(c,d,b);return{estimatedCost:{perEpoch:e.costs.perEpoch,perDay:e.costs.perDay,perMonth:e.costs.perMonth},allowanceCheck:{sufficient:e.sufficient,message:e.message},selectedProvider:null,selectedDataSetId:null}}async preflightUpload(a){return await fQ.performPreflightCheck(this._warmStorageService,this._synapse.payments,a,this._withCDN)}async upload(a,b){let c;performance.mark("synapse:upload-start");let d=b?.pieceCid;a instanceof Uint8Array&&(c=a.length,fQ.validateRawSize(c,"upload"));let e=Symbol("upload");this._activeUploads.add(e);try{let c;try{performance.mark("synapse:pdpServer.uploadPiece-start"),c=await this._pdpServer.uploadPiece(a,{...b,pieceCid:d}),performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end")}catch(a){throw performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end"),ek("StorageContext","uploadPiece","Failed to upload piece to service provider",a)}performance.mark("synapse:findPiece-start"),await this._pdpServer.findPiece(c.pieceCid),performance.mark("synapse:findPiece-end"),performance.measure("synapse:findPiece","synapse:findPiece-start","synapse:findPiece-end"),this._activeUploads.delete(e),b?.onUploadComplete!=null&&b.onUploadComplete(c.pieceCid),b?.metadata!=null&&et(b.metadata);let f=await new Promise((a,d)=>{this._pendingPieces.push({pieceCid:c.pieceCid,resolve:a,reject:d,callbacks:b,metadata:b?.metadata?er(b.metadata):void 0}),setTimeout(()=>{this._processPendingPieces().catch(a=>{console.error("Failed to process pending pieces batch:",a)})},0)});return performance.mark("synapse:upload-end"),performance.measure("synapse:upload","synapse:upload-start","synapse:upload-end"),{pieceCid:c.pieceCid,size:c.size,pieceId:f}}finally{this._activeUploads.delete(e)}}async _processPendingPieces(){if(this._isProcessing||0===this._pendingPieces.length)return;this._isProcessing=!0;let a=new Set(this._activeUploads);if(a.size>0&&this._pendingPieces.length<this._uploadBatchSize){let b=Date.now();for(;a.size>0&&Date.now()-b<this._uploadBatchWaitTimeout;){for(let b of a)this._activeUploads.has(b)||a.delete(b);a.size>0&&await new Promise(a=>setTimeout(a,200))}let c=Date.now()-b;c>200&&console.debug(`Waited ${c}ms for ${a.size} active upload(s) to complete`)}let b=this._pendingPieces.splice(0,this._uploadBatchSize);try{let a=b.map(a=>a.pieceCid),c=b.map(a=>a.metadata??[]),d=[];if(this.dataSetId){let[,e]=await Promise.all([this._warmStorageService.validateDataSet(this.dataSetId),this._warmStorageService.getDataSet(this.dataSetId)]),f=await this._pdpServer.addPieces(this.dataSetId,e.clientDataSetId,a,c);b.forEach(a=>{a.callbacks?.onPieceAdded?.(f.txHash)});let g=await fl(f);d.push(...g.confirmedPieceIds??[]),b.forEach(a=>{a.callbacks?.onPieceConfirmed?.(d)})}else{let e=await this._synapse.getClient().getAddress(),f=this._dataSetMetadata??{},g=!this._withCDN||cf.WITH_CDN in f?f:{...f,[cf.WITH_CDN]:""},h=er(g),i=await this._pdpServer.createAndAddPieces(ft(),this._provider.payee,e,this._synapse.getWarmStorageAddress(),a,{dataset:h,pieces:c});b.forEach(a=>{a.callbacks?.onPieceAdded?.(i.txHash)});let j=await ff(i);this._dataSetId=j.dataSetId;let k=await fl({statusUrl:new URL(`/pdp/data-sets/${j.dataSetId}/pieces/added/${j.createMessageHash}`,this._pdpServer.getServiceURL()).toString()});d.push(...k.confirmedPieceIds??[]),b.forEach(a=>{a.callbacks?.onPieceConfirmed?.(d)})}b.forEach((a,b)=>{let c=d[b];if(null==c)throw ek("StorageContext","addPieces",`Server did not return piece ID for piece at index ${b}`);a.resolve(c)})}catch(c){let a=ek("StorageContext","addPieces","Failed to add piece to data set",c);b.forEach(b=>{b.reject(a)})}finally{this._isProcessing=!1,this._pendingPieces.length>0&&this._processPendingPieces().catch(a=>{console.error("Failed to process pending pieces batch:",a)})}}async download(a,b){let c=this._synapse.storage?.download??this._synapse.download;return await c.call(this._synapse.storage??this._synapse,a,{providerAddress:this._provider.serviceProvider,withCDN:b?.withCDN??this._withCDN})}async providerDownload(a,b){return console.warn("providerDownload() is deprecated. Use download() instead."),await this.download(a,b)}async getProviderInfo(){return await this._synapse.getProviderInfo(this.serviceProvider)}async getDataSetPieces(){if(null==this.dataSetId)return[];let a=[];for await(let{pieceCid:b}of this.getPieces())a.push(b);return a}async *getPieces(a){if(null==this._dataSetId)return;let b=this._warmStorageService.getPDPVerifierAddress(),c=new fF(this._synapse.getProvider(),b),d=a?.batchSize??100,e=a?.signal,f=0,g=!0;for(;g;){if(e?.aborted)throw ek("StorageContext","getPieces","Operation aborted");let a=await c.getActivePieces(this._dataSetId,{offset:f,limit:d,signal:e});for(let b=0;b<a.pieces.length;b++){if(e?.aborted)throw ek("StorageContext","getPieces","Operation aborted");yield{pieceCid:a.pieces[b].pieceCid,pieceId:a.pieces[b].pieceId}}g=a.hasMore,f+=d}}async _getPieceIdByCID(a){if(null==this.dataSetId)throw ek("StorageContext","getPieceIdByCID","Data set not found");let b=b3(a);if(null==b)throw ek("StorageContext","deletePiece","Invalid PieceCID provided");let c=(await this._pdpServer.getDataSet(this.dataSetId)).pieces.find(a=>a.pieceCid.toString()===b.toString());if(null==c)throw ek("StorageContext","deletePiece","Piece not found in data set");return c.pieceId}async deletePiece(a){if(null==this.dataSetId)throw ek("StorageContext","deletePiece","Data set not found");let b="number"==typeof a?a:await this._getPieceIdByCID(a),c=await this._warmStorageService.getDataSet(this.dataSetId);return this._pdpServer.deletePiece(this.dataSetId,c.clientDataSetId,b)}async hasPiece(a){let b=b3(a);if(null==b)return!1;try{return await this._pdpServer.findPiece(b),!0}catch{return!1}}async pieceStatus(a){let b;if(null==this.dataSetId)throw ek("StorageContext","pieceStatus","Data set not found");let c=b3(a);if(null==c)throw ek("StorageContext","pieceStatus","Invalid PieceCID provided");let[d,e,f]=await Promise.all([this.hasPiece(c),this._pdpServer.getDataSet(this.dataSetId).catch(a=>(console.debug("Failed to get data set data:",a),null)),eq(this._synapse.getProvider())]),g=this._synapse.getNetwork(),h=null,i=null,j=null,k=!1,l=0,m=!1;if(d){let[a,d]=await Promise.all([this.getProviderInfo().catch(()=>null),null!=e?Promise.all([this._warmStorageService.getMaxProvingPeriod(),this._warmStorageService.getChallengeWindow()]).then(([a,b])=>({maxProvingPeriod:a,challengeWindow:b})).catch(()=>null):Promise.resolve(null)]);if(null!=a){if(!a.products.PDP?.data.serviceURL)throw Error(`Provider ${a.id} does not have a PDP product with serviceURL`);h=`${a.products.PDP.data.serviceURL.replace(/\/$/,"")}/piece/${c.toString()}`}if(null!=e&&null!=d){let a=e.pieces.find(a=>a.pieceCid.toString()===c.toString());if(null!=a)if(b=a.pieceId,e.nextChallengeEpoch>0){let a=e.nextChallengeEpoch,b=a+d.challengeWindow;j=el(b,g);let c=ep(e.nextChallengeEpoch,d.maxProvingPeriod,g);null!=c&&(i=c),k=Number(f)>=a&&Number(f)<b,m=Number(f)>=b,Number(f)<a&&(l=eo(a,Number(f)).hours)}else console.debug("Data set has nextChallengeEpoch=0, may have just been proven")}}return{exists:d,dataSetLastProven:i,dataSetNextProofDue:j,retrievalUrl:h,pieceId:b,inChallengeWindow:k,hoursUntilChallengeWindow:l,isProofOverdue:m}}async terminate(){if(null==this.dataSetId)throw ek("StorageContext","terminate","Data set not found");return this._synapse.storage.terminateDataSet(this.dataSetId)}}var f=f;class fR{_synapse;_warmStorageService;_pieceRetriever;_withCDN;_dev;_withIpni;_defaultContexts;constructor(a,b,c,d,e,f){this._synapse=a,this._warmStorageService=b,this._pieceRetriever=c,this._withCDN=d,this._dev=e,this._withIpni=f}async upload(a,b){if(b?.context!=null||b?.contexts!=null){let a=[];if(void 0!==b.providerId&&a.push("providerId"),void 0!==b.providerAddress&&a.push("providerAddress"),void 0!==b.dataSetId&&a.push("dataSetId"),void 0!==b.withCDN&&a.push("withCDN"),void 0!==b.forceCreateDataSet&&a.push("forceCreateDataSet"),void 0!==b.uploadBatchSize&&a.push("uploadBatchSize"),a.length>0)throw ek("StorageManager","upload",`Cannot specify both 'context' and other options: ${a.join(", ")}`)}if(b?.contexts!=null&&b.contexts.length>0&&b?.context!=null)throw ek("StorageManager","upload","Cannot specify both 'context' and 'contexts'");let c=b?.contexts??(b?.context?[b.context]:await this.createContexts({withCDN:b?.withCDN,withIpni:b?.withIpni,count:1,dev:b?.dev,uploadBatchSize:b?.uploadBatchSize,forceCreateDataSets:b?.forceCreateDataSet,metadata:b?.metadata,excludeProviderIds:b?.excludeProviderIds,providerIds:b?.providerId?[b.providerId]:void 0,dataSetIds:b?.dataSetId?[b.dataSetId]:void 0,callbacks:b?.callbacks}));if(!(c.length>1))return c[0].upload(a,{...b?.callbacks,metadata:b?.metadata,signal:b?.signal});{if(!(a instanceof Uint8Array))throw ek("StorageManager","upload","Multi-context uploads currently only support Uint8Array. For streaming uploads to multiple providers, convert your stream to Uint8Array first.");let d=function(a){let b=bY();for(let c=0;c<a.length;c+=2048)b.write(a.subarray(c,c+2048));return br(85,b.digest())}(a);return Promise.all(c.map(c=>c.upload(a,{...b?.callbacks,metadata:b?.metadata,pieceCid:d,signal:b?.signal}))).then(a=>a[0])}}async download(a,b){if(b?.context!=null){let c=[];if(void 0!==b.providerAddress&&c.push("providerAddress"),void 0!==b.withCDN&&c.push("withCDN"),c.length>0)throw ek("StorageManager","download",`Cannot specify both 'context' and other options: ${c.join(", ")}`);return await b.context.download(a,b)}let c=b3(a);if(null==c)throw ek("StorageManager","download",`Invalid PieceCID: ${String(a)}`);let d=b?.withCDN??this._withCDN;if(null!=this._defaultContexts&&!d&&b?.providerAddress==null){let a=this._defaultContexts.filter(a=>!1===a.withCDN),d=await Promise.all(a.map(a=>a.hasPiece(c))),e=a.filter((a,b)=>d[b]);e.length>0&&(b={...b,providerAddress:e[fv(e.length)].provider.serviceProvider})}let e=await this._synapse.getClient().getAddress(),f=await this._pieceRetriever.fetchPiece(c,e,{providerAddress:b?.providerAddress,withCDN:d});return await b7(f,c)}async preflightUpload(a,b){let c=b?.withCDN??this._withCDN;if(b?.metadata!=null&&cf.WITH_CDN in b.metadata){let a=b.metadata[cf.WITH_CDN];""!==a&&console.warn(`Warning: withCDN metadata entry has unexpected value "${a}". Expected empty string.`),c=!0}return await fQ.performPreflightCheck(this._warmStorageService,this._synapse.payments,a,c)}async createContexts(a){let b=a?.withCDN??this._withCDN,c=null==a||null==a.providerIds&&null==a.dataSetIds&&!0!==a.forceCreateDataSets&&null==a.uploadBatchSize;if(null!=this._defaultContexts){let c=a?.count??2;if(this._defaultContexts.length===c&&this._defaultContexts.every(b=>a?.excludeProviderIds?.includes(b.provider.id)!==!0)){let c=ev(a?.metadata,b);if(this._defaultContexts.every(a=>eu(a.dataSetMetadata,c))){if(a?.callbacks!=null)for(let b of this._defaultContexts){try{a.callbacks.onProviderSelected?.(b.provider)}catch(a){console.error("Error in onProviderSelected callback:",a)}if(null!=b.dataSetId)try{a.callbacks.onDataSetResolved?.({isExisting:!0,dataSetId:b.dataSetId,provider:b.provider})}catch(a){console.error("Error in onDataSetResolved callback:",a)}}return this._defaultContexts}}}let d=await fQ.createContexts(this._synapse,this._warmStorageService,{...a,withCDN:b,withIpni:a?.withIpni??this._withIpni,dev:a?.dev??this._dev});return c&&(this._defaultContexts=d),d}async createContext(a){let b=a?.withCDN??this._withCDN,c=null==a||null==a.providerId&&null==a.providerAddress&&null==a.dataSetId&&!0!==a.forceCreateDataSet&&null==a.uploadBatchSize;if(c&&null!=this._defaultContexts){let c=ev(a?.metadata,b);for(let b of this._defaultContexts)if(!a?.excludeProviderIds?.includes(b.provider.id)&&eu(b.dataSetMetadata,c)){if(a?.callbacks!=null){try{a.callbacks.onProviderSelected?.(b.provider)}catch(a){console.error("Error in onProviderSelected callback:",a)}if(null!=b.dataSetId)try{a.callbacks.onDataSetResolved?.({isExisting:!0,dataSetId:b.dataSetId,provider:b.provider})}catch(a){console.error("Error in onDataSetResolved callback:",a)}}return b}}let d=await fQ.create(this._synapse,this._warmStorageService,{...a,withCDN:b,withIpni:a?.withIpni??this._withIpni,dev:a?.dev??this._dev});return c&&(this._defaultContexts=[d]),d}async getDefaultContext(){return await this.createContext()}async findDataSets(a){let b=a??await this._synapse.getClient().getAddress();return await this._warmStorageService.getClientDataSetsWithDetails(b)}async terminateDataSet(a){return this._warmStorageService.terminateDataSet(this._synapse.getSigner(),a)}async getStorageInfo(){try{let a=async()=>{try{let a=this._synapse.getWarmStorageAddress(),b=await this._synapse.payments.serviceApproval(a,b8.USDFC);return{service:a,isApproved:b.isApproved,rateAllowance:b.rateAllowance,lockupAllowance:b.lockupAllowance,rateUsed:b.rateUsed,lockupUsed:b.lockupUsed}}catch{return null}},b=this._warmStorageService.getServiceProviderRegistryAddress(),c=new fO(this._synapse.getProvider(),b),[d,e,g]=await Promise.all([this._warmStorageService.getServicePrice(),this._warmStorageService.getApprovedProviderIds(),a()]),h=await c.getProviders(e),i=BigInt(d.epochsPerMonth),j=BigInt(d.pricePerTiBPerMonthNoCDN)/i,k=BigInt(d.pricePerTiBPerMonthNoCDN)/i,l=BigInt(d.pricePerTiBPerMonthNoCDN)/cc.DAYS_PER_MONTH,m=BigInt(d.pricePerTiBPerMonthNoCDN)/cc.DAYS_PER_MONTH,n=h.filter(a=>a.serviceProvider!==f.ZeroAddress),o=this._synapse.getNetwork();return{pricing:{noCDN:{perTiBPerMonth:BigInt(d.pricePerTiBPerMonthNoCDN),perTiBPerDay:l,perTiBPerEpoch:j},withCDN:{perTiBPerMonth:BigInt(d.pricePerTiBPerMonthNoCDN),perTiBPerDay:m,perTiBPerEpoch:k},tokenAddress:d.tokenAddress,tokenSymbol:"USDFC"},providers:n,serviceParameters:{network:o,epochsPerMonth:i,epochsPerDay:cc.EPOCHS_PER_DAY,epochDuration:cc.EPOCH_DURATION,minUploadSize:ce.MIN_UPLOAD_SIZE,maxUploadSize:ce.MAX_UPLOAD_SIZE,warmStorageAddress:this._synapse.getWarmStorageAddress(),paymentsAddress:this._warmStorageService.getPaymentsAddress(),pdpVerifierAddress:this._warmStorageService.getPDPVerifierAddress()},allowances:g}}catch(a){throw Error(`Failed to get storage service information: ${a instanceof Error?a.message:String(a)}`)}}}a.s([],475677);let fS={PDP:0},fT={GET_APPROVED_PROVIDERS_FOR_PIECE_LINK:`
    query GetApprovedProvidersForCommP($cid: Bytes!) {
      pieces(where: { cid: $cid }) {
        id
        dataSet {
          setId
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `,GET_PROVIDER_BY_ADDRESS:`
    query Provider($serviceProvider: ID!) {
      provider (id: $serviceProvider) {
        id
        providerId
        serviceProvider
        payee
        name
        description
        registeredAt
        status
        approvedAt
        products {
          decodedProductData
          productType
          isActive
          capabilityValues
          capabilityKeys
        }
      }
    }
  `,GET_PROVIDERS_FLEXIBLE:`
    query ProvidersFlexible($where: Provider_filter, $first: Int, $skip: Int, $orderBy: Provider_orderBy, $orderDirection: OrderDirection) {
      providers(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        providerId
        serviceProvider
        payee
        registeredAt
        approvedAt
        status
        totalFaultedPeriods
        totalFaultedPieces
        totalDataSets
        totalPieces
        totalDataSize
        createdAt
        updatedAt
        products {
          decodedProductData
          productType
          isActive
          capabilityValues
          capabilityKeys
        }
      }
    }
  `,GET_DATA_SETS_FLEXIBLE:`
    query DataSetsFlexible($where: DataSet_filter, $first: Int, $skip: Int, $orderBy: DataSet_orderBy, $orderDirection: OrderDirection) {
      dataSets(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        setId
        listener
        payer
        withCDN
        isActive
        leafCount
        challengeRange
        lastProvenEpoch
        nextChallengeEpoch
        totalPieces
        totalDataSize
        totalProofs
        totalProvedPieces
        totalFaultedPeriods
        totalFaultedPieces
        metadataKeys
        metadataValues
        createdAt
        updatedAt
        serviceProvider {
          id
          providerId
          serviceProvider
          payee
          name
          description
          registeredAt
          status
          approvedAt
          products {
            decodedProductData
            productType
            isActive
            capabilityValues
            capabilityKeys
          }
        }
        rails {
          id
          type
          railId
          token
          paymentRate
          settledUpto
          endEpoch
        }
      }
    }
  `,GET_PIECES_FLEXIBLE:`
    query PiecesFlexible($where: Piece_filter, $first: Int, $skip: Int, $orderBy: Piece_orderBy, $orderDirection: OrderDirection) {
      pieces(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        setId
        pieceId
        rawSize
        leafCount
        cid
        removed
        totalProofsSubmitted
        totalPeriodsFaulted
        lastProvenEpoch
        lastProvenAt
        lastFaultedEpoch
        lastFaultedAt
        createdAt
        metadataKeys
        metadataValues
        dataSet {
          id
          setId
          isActive
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `,GET_FAULT_RECORDS_FLEXIBLE:`
    query FaultRecordsFlexible($where: FaultRecord_filter, $first: Int, $skip: Int, $orderBy: FaultRecord_orderBy, $orderDirection: OrderDirection) {
      faultRecords(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        dataSetId
        pieceIds
        currentChallengeEpoch
        nextChallengeEpoch
        periodsFaulted
        deadline
        createdAt
        dataSet {
          id
          setId
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `};class fU{endpoint;headers;constructor(a){this.endpoint=this.resolveEndpoint(a),this.headers=this.buildHeaders(a.apiKey)}resolveEndpoint(a){if(null!=a.endpoint&&""!==a.endpoint.trim())return a.endpoint.trim();if(null!=a.goldsky)return this.buildGoldskyEndpoint(a.goldsky);throw ek("SubgraphService","constructor","Invalid configuration: provide either endpoint or complete goldsky config")}buildGoldskyEndpoint(a){let{projectId:b,subgraphName:c,version:d}=a;if(b?.trim()==null||b?.trim()===""||c?.trim()==null||c?.trim()===""||d?.trim()==null||d?.trim()==="")throw ek("SubgraphService","constructor","Incomplete Goldsky config: projectId, subgraphName, and version required");return`https://api.goldsky.com/api/public/${b}/subgraphs/${c}/${d}/gn`}buildHeaders(a){let b={"Content-Type":"application/json"};return null!=a&&""!==a?{...b,Authorization:`Bearer ${a}`}:b}normalizeQueryOptions(a={}){return{where:{},first:10,skip:0,orderBy:"createdAt",orderDirection:"desc",...a}}async executeQuery(a,b,c){try{let d=await fetch(this.endpoint,{method:"POST",headers:this.headers,body:JSON.stringify({query:a,variables:b})});if(!d.ok){let a=await d.text();throw ek("SubgraphService",c,`HTTP ${d.status}: ${a}`)}let e=await d.json();if(null!=e.errors&&e.errors.length>0){let a=e.errors.map(a=>a.message).join("; ");throw ek("SubgraphService",c,`GraphQL errors: ${a}`)}return e.data}catch(a){if(a instanceof Error&&"SynapseError"===a.name)throw a;throw ek("SubgraphService",c,`Query execution failed: ${a.message}`,{cause:a})}}getProductType(a){let b=Object.entries(fS).find(([,b])=>b===a);return null!=b?b[0]:"PDP"}transformProviderData(a){let b={providerId:a?.providerId??0,serviceProvider:a?.serviceProvider??"",payee:a?.payee??"",name:a?.name??"",description:a?.description??"",status:a?.status??"UNKNOWN",products:Array.isArray(a?.products)?a.products:[]};return{id:b.providerId,serviceProvider:b.serviceProvider,payee:b.payee,name:b.name,description:b.description,active:"APPROVED"===b.status,products:this.transformProducts(b.products)}}transformProducts(a){return a.reduce((a,b)=>{let c=this.getProductType(b?.productType),d=this.createServiceProduct(b,c);return null!=d&&(a[c]=d),a},{})}createServiceProduct(a,b){try{return{type:b,isActive:a?.isActive??!1,capabilities:this.transformCapabilities(a?.capabilityValues),data:this.parseProductData(a?.decodedProductData)}}catch(a){return console.warn(`SubgraphService: Failed to create service product for type ${b}:`,a instanceof Error?a.message:"Unknown error"),null}}transformCapabilities(a){return Array.isArray(a)?a.reduce((a,b)=>(b?.key!=null&&b?.value!=null&&(a[b.key]=String(b.value)),a),{}):{}}parseProductData(a){try{if(null==a||""===a.trim())throw Error("Empty or null product data");let b=JSON.parse(a);if(b?.serviceURL==null)throw Error("Missing required serviceURL field");return b}catch(a){return console.warn("SubgraphService: Failed to parse product data, using defaults:",a instanceof Error?a.message:"Unknown error"),{serviceURL:"",minPieceSizeInBytes:0n,maxPieceSizeInBytes:0n,ipniPiece:!1,ipniIpfs:!1,storagePricePerTibPerDay:0n,minProvingPeriodInEpochs:0n,location:"",paymentTokenAddress:"0x0000000000000000000000000000000000000000"}}}parseTimestamp(a){if(null==a)return 0;let b=Number(a);return Number.isNaN(b)?0:b}safeConvertHexToCid(a){try{let b=a.startsWith("0x")?a.slice(2):a,c=x(b),d=bk.decode(c),e=b3(d);if(null==e)throw Error(`Failed to convert CID to PieceCID format: ${a}`);return e}catch(a){return console.warn(`SubgraphService: queryProviders: Failed to convert CID to PieceCID format: ${a instanceof Error?a.message:"Unknown error"}`),null}}isValidProviderData(a){return a?.id!=null&&""!==a.id.trim()&&a?.products!=null&&a.products.length>0}async getApprovedProvidersForPieceCID(a){let b=b3(a);if(null==b)throw ek("SubgraphService","getApprovedProvidersForPieceCID","Invalid PieceCID");let c=w(b.bytes),d=await this.executeQuery(fT.GET_APPROVED_PROVIDERS_FOR_PIECE_LINK,{cid:c},"getApprovedProvidersForPieceCID");return d?.pieces==null||0===d.pieces.length?(console.log(`SubgraphService: No providers found for PieceCID: ${b.toString()}`),[]):Array.from(d.pieces.reduce((a,b)=>{let c=b.dataSet.serviceProvider,d=c?.serviceProvider?.toLowerCase();return null==d||""===d||a.has(d)||(this.isValidProviderData(c)?a.set(d,c):console.warn("SubgraphService: Skipping incomplete provider data for approved provider:",c)),a},new Map).values()).map(a=>this.transformProviderData(a))}async getProviderByAddress(a){let b=await this.executeQuery(fT.GET_PROVIDER_BY_ADDRESS,{serviceProvider:a},"getProviderByAddress");return b?.provider==null?(console.log(`SubgraphService: No provider found for address: ${a}`),null):this.transformProviderData(b.provider)}async queryProviders(a={}){let b=await this.executeQuery(fT.GET_PROVIDERS_FLEXIBLE,this.normalizeQueryOptions(a),"queryProviders");return b?.providers==null||b?.providers?.length===0?(console.log("SubgraphService: No providers found for the given criteria"),[]):b.providers.filter(a=>this.isValidProviderData(a)).map(a=>this.transformProviderData(a))}async queryDataSets(a={}){let b=await this.executeQuery(fT.GET_DATA_SETS_FLEXIBLE,this.normalizeQueryOptions(a),"queryDataSets");return b?.dataSets==null||b?.dataSets?.length===0?(console.log("SubgraphService: No data sets found for the given criteria"),[]):b.dataSets.map(a=>({id:a.id,setId:this.parseTimestamp(a.setId),listener:a.listener??"",payer:a.payer??"",withCDN:a.withCDN??!1,isActive:a.isActive,leafCount:this.parseTimestamp(a.leafCount),challengeRange:this.parseTimestamp(a.challengeRange),lastProvenEpoch:this.parseTimestamp(a.lastProvenEpoch),nextChallengeEpoch:this.parseTimestamp(a.nextChallengeEpoch),totalPieces:this.parseTimestamp(a.totalPieces),totalDataSize:this.parseTimestamp(a.totalDataSize),totalProofs:this.parseTimestamp(a.totalProofs),totalProvedPieces:this.parseTimestamp(a.totalProvedPieces),totalFaultedPeriods:this.parseTimestamp(a.totalFaultedPeriods),totalFaultedPieces:this.parseTimestamp(a.totalFaultedPieces),metadataKeys:a.metadataKeys??[],metadataValues:a.metadataValues??[],createdAt:this.parseTimestamp(a.createdAt),updatedAt:this.parseTimestamp(a.updatedAt),serviceProvider:null!=a.serviceProvider?this.transformProviderData(a.serviceProvider):this.transformProviderData({}),rails:null!=a.rails?a.rails.map(a=>({id:a.id,type:a.type,railId:this.parseTimestamp(a.railId),token:a.token,paymentRate:this.parseTimestamp(a.paymentRate),settledUpto:this.parseTimestamp(a.settledUpto),endEpoch:this.parseTimestamp(a.endEpoch)})):void 0}))}async queryPieces(a={}){let b=await this.executeQuery(fT.GET_PIECES_FLEXIBLE,this.normalizeQueryOptions(a),"queryPieces");return b?.pieces==null||b?.pieces?.length===0?(console.log("SubgraphService: No pieces found for the given criteria"),[]):b.pieces.map(a=>({id:a.id,setId:this.parseTimestamp(a.setId),pieceId:this.parseTimestamp(a.pieceId),rawSize:this.parseTimestamp(a.rawSize),leafCount:this.parseTimestamp(a.leafCount),cid:this.safeConvertHexToCid(a.cid),removed:a.removed,totalProofsSubmitted:this.parseTimestamp(a.totalProofsSubmitted),totalPeriodsFaulted:this.parseTimestamp(a.totalPeriodsFaulted),lastProvenEpoch:this.parseTimestamp(a.lastProvenEpoch),lastProvenAt:this.parseTimestamp(a.lastProvenAt),lastFaultedEpoch:this.parseTimestamp(a.lastFaultedEpoch),lastFaultedAt:this.parseTimestamp(a.lastFaultedAt),createdAt:this.parseTimestamp(a.createdAt),metadataKeys:a.metadataKeys??[],metadataValues:a.metadataValues??[],dataSet:{id:a.dataSet.id,setId:this.parseTimestamp(a.dataSet.setId),isActive:a.dataSet.isActive,serviceProvider:this.transformProviderData(a.dataSet.serviceProvider)}}))}async queryFaultRecords(a={}){let b=await this.executeQuery(fT.GET_FAULT_RECORDS_FLEXIBLE,this.normalizeQueryOptions(a),"queryFaultRecords");return b?.faultRecords==null||b?.faultRecords?.length===0?(console.log("SubgraphService: No fault records found for the given criteria"),[]):b.faultRecords.map(a=>({id:a.id,dataSetId:this.parseTimestamp(a.dataSetId),pieceIds:a.pieceIds.map(a=>this.parseTimestamp(a)),currentChallengeEpoch:this.parseTimestamp(a.currentChallengeEpoch),nextChallengeEpoch:this.parseTimestamp(a.nextChallengeEpoch),periodsFaulted:this.parseTimestamp(a.periodsFaulted),deadline:this.parseTimestamp(a.deadline),createdAt:this.parseTimestamp(a.createdAt),dataSet:{id:a.dataSet.id,setId:this.parseTimestamp(a.dataSet.setId),serviceProvider:this.transformProviderData(a.dataSet.serviceProvider)}}))}}a.s([],760890);var f=f;async function fV(a,b,c,d){let e=[],f=[],g=a.map(async(a,c)=>{let g=new AbortController;f[c]=g,null!=d&&(d.addEventListener("abort",()=>{g.abort(d.reason)},{once:!0}),d.aborted&&g.abort(d.reason));try{if(!a.products.PDP?.data.serviceURL)throw Error(`Provider ${a.id} does not have PDP product with serviceURL`);let d=ey(a.products.PDP.data.serviceURL,b),f=await fetch(d,{signal:g.signal});if(!f.ok)throw e.push({provider:a.serviceProvider,error:`findPiece returned ${f.status}`}),Error("Provider does not have piece");let h=ex(a.products.PDP.data.serviceURL,b),i=await fetch(h,{signal:g.signal});if(i.ok)return{response:i,index:c};throw e.push({provider:a.serviceProvider,error:`download returned ${i.status}`}),Error(`Download failed with status ${i.status}`)}catch(c){let b=c.message??"Unknown error";throw e.some(b=>b.provider===a.serviceProvider)||e.push({provider:a.serviceProvider,error:b}),"This operation was aborted"!==b&&console.warn(`Failed to fetch from provider ${a.serviceProvider}:`,b),c}});try{let{response:a,index:b}=await Promise.any(g);return f.forEach((a,c)=>{c!==b&&a.abort()}),a}catch(a){if(a instanceof AggregateError){let a=e.map(a=>`${a.provider}: ${a.error}`).join("; ");throw ek(c,"fetchPiecesFromProviders",`All providers failed to serve piece ${b.toString()}. Details: ${a}`)}throw a}}class fW{warmStorageService;childRetriever;spRegistry;constructor(a,b,c){this.warmStorageService=a,this.spRegistry=b,this.childRetriever=c}async findProviders(a,b){if(null!=b){let a=await this.spRegistry.getProviderByAddress(b);if(null==a)throw ek("ChainRetriever","findProviders",`Provider ${b} not found in registry`);return[a]}let c=(await this.warmStorageService.getClientDataSetsWithDetails(a)).filter(a=>a.isLive&&a.currentPieceCount>0);if(0===c.length)throw ek("ChainRetriever","findProviders",`No active data sets with data found for client ${a}`);let d=[...new Set(c.map(a=>a.providerId))],e=(await this.spRegistry.getProviders(d)).filter(a=>null!=a);if(0===e.length)throw ek("ChainRetriever","findProviders","No valid providers found (all providers may have been removed from registry or are inactive)");return e}async fetchPiece(a,b,c){let d=async d=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(a,b,c);throw ek("ChainRetriever","fetchPiece",`Failed to retrieve piece ${a.toString()}: ${d}`)},e=[];try{e=await this.findProviders(b,c?.providerAddress)}catch(b){let a=b instanceof Error?b.message:"Provider discovery failed";return await d(a)}if(0===e.length)return await d("No providers found and no additional retriever method was configured");try{return await fV(e,a,"ChainRetriever",c?.signal)}catch{return await d("All provider retrieval attempts failed and no additional retriever method was configured")}}}class fX{baseRetriever;network;constructor(a,b){this.baseRetriever=a,this.network=b}hostname(){return"mainnet"===this.network?"filbeam.io":"calibration.filbeam.io"}async fetchPiece(a,b,c){if(c?.withCDN===!0){let d=`https://${b}.${this.hostname()}/${a.toString()}`;try{let a=await fetch(d,{signal:c?.signal});if(a.ok)return a;402===a.status?console.warn("CDN requires payment. Please initialise Synapse SDK with the option `withCDN: true` and re-upload your files."):console.warn("CDN fetch failed with status:",a.status)}catch(a){console.warn("CDN fetch failed:",a)}console.log("Falling back to direct retrieval")}return await this.baseRetriever.fetchPiece(a,b,c)}}class fY{subgraphService;childRetriever;constructor(a,b){this.subgraphService=a,this.childRetriever=b}async findProviders(a,b){if(null!=b){let a=await this.subgraphService.getProviderByAddress(b);return null!==a?[a]:[]}return await this.subgraphService.getApprovedProvidersForPieceCID(a)}async fetchPiece(a,b,c){let d=async d=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(a,b,c);throw ek("SubgraphRetriever","fetchPiece",`Failed to retrieve piece ${a.toString()}: ${d}`)},e=[];try{e=await this.findProviders(a,c?.providerAddress)}catch{return await d("Provider discovery failed and no additional retriever method was configured")}if(0===e.length)return await d("No providers found and no additional retriever method was configured");try{return await fV(e,a,"SubgraphRetriever",c?.signal)}catch{return await d("All provider retrieval attempts failed and no additional retriever method was configured")}}}var f=f;class fZ{_provider;_warmStorageAddress;_warmStorageContract=null;_warmStorageViewContract=null;_pdpVerifier=null;_addresses;constructor(a,b,c){this._provider=a,this._warmStorageAddress=b,this._addresses=c}static async create(a,b){let c=await ew(a),d=new f.Contract(ci.MULTICALL3[c],ca.MULTICALL3,a),e=new f.Interface(ca.WARM_STORAGE),g=[{target:b,allowFailure:!1,callData:e.encodeFunctionData("pdpVerifierAddress")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("paymentsContractAddress")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("usdfcTokenAddress")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("filBeamBeneficiaryAddress")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("viewContractAddress")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("serviceProviderRegistry")},{target:b,allowFailure:!1,callData:e.encodeFunctionData("sessionKeyRegistry")}],h=await d.aggregate3.staticCall(g);return new fZ(a,b,{pdpVerifier:e.decodeFunctionResult("pdpVerifierAddress",h[0].returnData)[0],payments:e.decodeFunctionResult("paymentsContractAddress",h[1].returnData)[0],usdfcToken:e.decodeFunctionResult("usdfcTokenAddress",h[2].returnData)[0],filBeamBeneficiary:e.decodeFunctionResult("filBeamBeneficiaryAddress",h[3].returnData)[0],viewContract:e.decodeFunctionResult("viewContractAddress",h[4].returnData)[0],serviceProviderRegistry:e.decodeFunctionResult("serviceProviderRegistry",h[5].returnData)[0],sessionKeyRegistry:e.decodeFunctionResult("sessionKeyRegistry",h[6].returnData)[0]})}getPDPVerifierAddress(){return this._addresses.pdpVerifier}getPaymentsAddress(){return this._addresses.payments}getUSDFCTokenAddress(){return this._addresses.usdfcToken}getViewContractAddress(){return this._addresses.viewContract}getServiceProviderRegistryAddress(){return this._addresses.serviceProviderRegistry}getSessionKeyRegistryAddress(){return this._addresses.sessionKeyRegistry}getProvider(){return this._provider}_getWarmStorageContract(){return null==this._warmStorageContract&&(this._warmStorageContract=new f.Contract(this._warmStorageAddress,ca.WARM_STORAGE,this._provider)),this._warmStorageContract}_getWarmStorageViewContract(){if(null==this._warmStorageViewContract){let a=this.getViewContractAddress();this._warmStorageViewContract=new f.Contract(a,ca.WARM_STORAGE_VIEW,this._provider)}return this._warmStorageViewContract}_getPDPVerifier(){if(null==this._pdpVerifier){let a=this.getPDPVerifierAddress();this._pdpVerifier=new fF(this._provider,a)}return this._pdpVerifier}async getDataSet(a){let b=this._getWarmStorageViewContract(),c=await b.getDataSet(a);if(0===Number(c.pdpRailId))throw ek("WarmStorageService","getDataSet",`Data set ${a} does not exist`);return{pdpRailId:Number(c.pdpRailId),cacheMissRailId:Number(c.cacheMissRailId),cdnRailId:Number(c.cdnRailId),payer:c.payer,payee:c.payee,serviceProvider:c.serviceProvider,commissionBps:Number(c.commissionBps),clientDataSetId:c.clientDataSetId,pdpEndEpoch:Number(c.pdpEndEpoch),providerId:Number(c.providerId),dataSetId:a}}async getClientDataSets(a){try{let b=this._getWarmStorageViewContract();return(await b.getClientDataSets(a)).map(a=>({pdpRailId:Number(a.pdpRailId),cacheMissRailId:Number(a.cacheMissRailId),cdnRailId:Number(a.cdnRailId),payer:a.payer,payee:a.payee,serviceProvider:a.serviceProvider,commissionBps:Number(a.commissionBps),clientDataSetId:a.clientDataSetId,pdpEndEpoch:Number(a.pdpEndEpoch),providerId:Number(a.providerId)}))}catch(a){throw Error(`Failed to get client data sets: ${a instanceof Error?a.message:String(a)}`)}}async getClientDataSetsWithDetails(a,b=!1){let c=this._getPDPVerifier(),d=this._getWarmStorageViewContract(),e=await d.clientDataSets(a);if(0===e.length)return[];let f=e.map(async a=>{let d=Number(a);try{let a=await this.getDataSet(d),[e,f,g]=await Promise.all([c.dataSetLive(d),c.getDataSetListener(d).catch(()=>null),this.getDataSetMetadata(d).catch(()=>Object.create(null))]),h=null!=f&&f.toLowerCase()===this._warmStorageAddress.toLowerCase();if(b&&!h)return null;let i=e?await c.getNextPieceId(d):0n;return{...a,pdpVerifierDataSetId:d,nextPieceId:Number(i),currentPieceCount:Number(i),isLive:e,isManaged:h,withCDN:a.cdnRailId>0,metadata:g}}catch(a){throw Error(`Failed to get details for data set ${d}: ${a instanceof Error?a.message:String(a)}`)}});return(await Promise.all(f)).filter(a=>null!==a)}async validateDataSet(a){let b=this._getPDPVerifier(),[c,d]=await Promise.all([b.dataSetLive(Number(a)),b.getDataSetListener(Number(a))]);if(!c)throw Error(`Data set ${a} does not exist or is not live`);if(d.toLowerCase()!==this._warmStorageAddress.toLowerCase())throw Error(`Data set ${a} is not managed by this WarmStorage contract (${this._warmStorageAddress}), managed by ${String(d)}`)}async verifyDataSetCreation(a){try{let b,c="string"==typeof a?a:a.hash;if(b="string"==typeof a?await this._provider.getTransactionReceipt(c):await a.wait(cg.TRANSACTION_CONFIRMATIONS),null==b)return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1};if(1!==b.status)return{transactionMined:!0,transactionSuccess:!1,dataSetLive:!1,blockNumber:b.blockNumber,gasUsed:b.gasUsed,error:"Transaction failed"};let d=this._getPDPVerifier(),e=await d.extractDataSetIdFromReceipt(b);if(null==e)return{transactionMined:!0,transactionSuccess:!0,dataSetLive:!1,blockNumber:b.blockNumber,gasUsed:b.gasUsed,error:"Could not find DataSetCreated event in transaction"};let f=await d.dataSetLive(e);return{transactionMined:!0,transactionSuccess:!0,dataSetId:e,dataSetLive:f,blockNumber:b.blockNumber,gasUsed:b.gasUsed}}catch(a){return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1,error:a instanceof Error?a.message:"Unknown error"}}}async getComprehensiveDataSetStatus(a,b){let c="string"==typeof a?a:a.hash,d=null;if(null!=b)try{performance.mark("synapse:pdpServer.getDataSetCreationStatus-start"),d=await b.getDataSetCreationStatus(c),performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}catch{performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}performance.mark("synapse:verifyDataSetCreation-start");let e=await this.verifyDataSetCreation(a);performance.mark("synapse:verifyDataSetCreation-end"),performance.measure("synapse:verifyDataSetCreation","synapse:verifyDataSetCreation-start","synapse:verifyDataSetCreation-end");let f=e.transactionMined&&e.transactionSuccess&&null!=e.dataSetId&&e.dataSetLive&&null!=d&&!0===d.ok&&d.dataSetCreated,g=d?.dataSetId??e.dataSetId??null,h=e.error??null;return null!=d&&!1===d.ok&&(h=`Server reported transaction failed (status: ${d.txStatus})`),{txHash:c,serverStatus:d,chainStatus:e,summary:{isComplete:f,isLive:e.dataSetLive,dataSetId:g,error:h}}}async waitForDataSetCreationWithStatus(a,b,c=cg.DATA_SET_CREATION_TIMEOUT_MS,d=cg.DATA_SET_CREATION_POLL_INTERVAL_MS,e){let f=Date.now();for(;Date.now()-f<c;){let c=await this.getComprehensiveDataSetStatus(a,b),g=Date.now()-f;if(null!=e)try{await e(c,g)}catch(a){console.error("Error in progress callback:",a)}if(c.summary.isComplete)return c;if(null!=c.summary.error&&c.chainStatus.transactionMined)throw Error(c.summary.error);await new Promise(a=>setTimeout(a,d))}throw Error(`Data set creation timed out after ${c/1e3} seconds`)}async getDataSetMetadata(a){let b=this._getWarmStorageViewContract(),[c,d]=await b.getAllDataSetMetadata(a),e=Object.create(null);for(let a=0;a<c.length;a++)e[c[a]]=d[a];return e}async getDataSetMetadataByKey(a,b){let c=this._getWarmStorageViewContract(),[d,e]=await c.getDataSetMetadata(a,b);return d?e:null}async getPieceMetadata(a,b){let c=this._getWarmStorageViewContract(),[d,e]=await c.getAllPieceMetadata(a,b),f=Object.create(null);for(let a=0;a<d.length;a++)f[d[a]]=e[a];return f}async getPieceMetadataByKey(a,b,c){let d=this._getWarmStorageViewContract(),[e,f]=await d.getPieceMetadata(a,b,c);return e?f:null}async getServicePrice(){let a=this._getWarmStorageContract(),b=await a.getServicePrice();return{pricePerTiBPerMonthNoCDN:b.pricePerTiBPerMonthNoCDN,pricePerTiBCdnEgress:b.pricePerTiBCdnEgress,pricePerTiBCacheMissEgress:b.pricePerTiBCacheMissEgress,tokenAddress:b.tokenAddress,epochsPerMonth:b.epochsPerMonth,minimumPricePerMonth:b.minimumPricePerMonth}}async calculateStorageCost(a){let b=await this.getServicePrice(),c=BigInt(a),d=b.pricePerTiBPerMonthNoCDN*c/(ce.TiB*b.epochsPerMonth),e={perEpoch:d,perDay:d*BigInt(cc.EPOCHS_PER_DAY),perMonth:d*b.epochsPerMonth};return{...e,withCDN:e}}async checkAllowanceForStorage(a,b,c,d){let e,[f,g]=await Promise.all([c.serviceApproval(this._warmStorageAddress,b8.USDFC),this.calculateStorageCost(a)]),h=b?g.withCDN:g,i=h.perEpoch,j=i*(BigInt(d??Number(cc.DEFAULT_LOCKUP_DAYS))*BigInt(cc.EPOCHS_PER_DAY)),k=BigInt(f.rateUsed)+i,l=BigInt(f.lockupUsed)+j,m=f.rateAllowance>=k&&f.lockupAllowance>=l,n=k>f.rateAllowance?k-f.rateAllowance:0n,o=l>f.lockupAllowance?l-f.lockupAllowance:0n;if(!m){let a=n>0n,b=o>0n;a&&b?e="Insufficient rate and lockup allowances":a?e="Insufficient rate allowance":b&&(e="Insufficient lockup allowance")}return{rateAllowanceNeeded:n,lockupAllowanceNeeded:o,currentRateAllowance:f.rateAllowance,currentLockupAllowance:f.lockupAllowance,currentRateUsed:f.rateUsed,currentLockupUsed:f.lockupUsed,sufficient:m,message:e,costs:h,depositAmountNeeded:j}}async prepareStorageUpload(a,b){let[c,d]=await Promise.all([this.calculateStorageCost(a.dataSize),this.checkAllowanceForStorage(a.dataSize,a.withCDN??!1,b)]),e=a.withCDN?c.withCDN:c,f=[],g=await b.accountInfo(b8.USDFC),h=e.perMonth;if(g.availableFunds<h){let a=h-g.availableFunds;f.push({type:"deposit",description:`Deposit ${a} USDFC to payments contract`,execute:async()=>await b.deposit(a,b8.USDFC)})}return d.sufficient||f.push({type:"approveService",description:`Approve service with rate allowance ${d.rateAllowanceNeeded} and lockup allowance ${d.lockupAllowanceNeeded}`,execute:async()=>await b.approveService(this._warmStorageAddress,d.rateAllowanceNeeded,d.lockupAllowanceNeeded,cc.EPOCHS_PER_MONTH,b8.USDFC)}),{estimatedCost:{perEpoch:e.perEpoch,perDay:e.perDay,perMonth:e.perMonth},allowanceCheck:{sufficient:d.sufficient,message:d.sufficient?void 0:`Insufficient allowances: rate needed ${d.rateAllowanceNeeded}, lockup needed ${d.lockupAllowanceNeeded}`},actions:f}}async terminateDataSet(a,b){let c=this._getWarmStorageContract().connect(a);return await c.terminateService(b)}async addApprovedProvider(a,b){let c=this._getWarmStorageContract().connect(a);return await c.addApprovedProvider(b)}async removeApprovedProvider(a,b){let c=this._getWarmStorageContract().connect(a),d=this._getWarmStorageViewContract(),e=(await d.getApprovedProviders(0n,0n)).findIndex(a=>Number(a)===b);if(-1===e)throw Error(`Provider ${b} is not in the approved list`);return await c.removeApprovedProvider(b,e)}async getApprovedProviderIds(){let a=this._getWarmStorageViewContract();return(await a.getApprovedProviders(0n,0n)).map(a=>Number(a))}async isProviderIdApproved(a){let b=this._getWarmStorageViewContract();return await b.isProviderApproved(a)}async getOwner(){let a=this._getWarmStorageContract();return await a.owner()}async isOwner(a){let b=await a.getAddress(),c=await this.getOwner();return b.toLowerCase()===c.toLowerCase()}async getMaxProvingPeriod(){let a=this._getWarmStorageViewContract();return Number(await a.getMaxProvingPeriod())}async getChallengeWindow(){let a=this._getWarmStorageViewContract();return Number(await a.challengeWindow())}async topUpCDNPaymentRails(a,b,c,d){if(c<0n||d<0n)throw Error("Top up amounts must be positive");if(0n===c&&0n===d)throw Error("At least one top up amount must be >0");let e=this._getWarmStorageContract().connect(a);return await e.topUpCDNPaymentRails(b,c,d)}}a.s([],18158);class f${_signer;_network;_withCDN;_payments;_provider;_warmStorageAddress;_warmStorageService;_pieceRetriever;_storageManager;_session=null;static async create(a){let b,c,d,e;if(1!==[a.privateKey,a.provider,a.signer].filter(Boolean).length)throw Error("Must provide exactly one of: privateKey, provider, or signer");if(null!=a.privateKey){let e=a.rpcURL??a.rpcURL;if(null==e)throw Error("rpcURL is required when using privateKey");let g=a.privateKey;g.startsWith("0x")||(g=`0x${g}`),d=/^ws(s)?:\/\//i.test(e)?new f.WebSocketProvider(e):new f.JsonRpcProvider(e),b=await ew(d);let h=new f.Wallet(g,d);c=!0===a.disableNonceManager?h:new f.NonceManager(h)}else if(null!=a.provider)if(d=a.provider,b=await ew(d),"getSigner"in d&&"function"==typeof d.getSigner){let b=await d.getSigner(0);c=!0===a.disableNonceManager?b:new f.NonceManager(b)}else throw Error("Provider does not support signing operations");else if(null!=a.signer){if(c=a.signer,!0===a.disableNonceManager||c instanceof f.NonceManager||(c=new f.NonceManager(c)),null==c.provider)throw Error("Signer must have a provider");d=c.provider,b=await ew(d)}else throw Error("No valid authentication method provided");if("mainnet"!==b&&"calibration"!==b)throw Error(`Invalid network: ${String(b)}. Only 'mainnet' and 'calibration' are supported.`);let g=a.warmStorageAddress??ci.WARM_STORAGE[b];if(!g)throw Error(`No Warm Storage address configured for network: ${b}`);let h=await fZ.create(d,g),i=new ez(d,c,h.getPaymentsAddress(),h.getUSDFCTokenAddress(),!0===a.disableNonceManager),j=new fO(d,h.getServiceProviderRegistryAddress());if(null!=a.pieceRetriever)e=a.pieceRetriever;else{let c=new fW(h,j);(null!=a.subgraphConfig||null!=a.subgraphService)&&(c=new fY(null!=a.subgraphService?a.subgraphService:new fU(a.subgraphConfig))),e=new fX(c,b)}return await eh(a.telemetry||{},{filecoinNetwork:b}),new f$(c,d,b,i,!0===a.withCDN,g,h,e,!1===a.dev,a.withIpni)}constructor(a,b,c,d,e,f,g,h,i,j){this._signer=a,this._provider=b,this._network=c,this._payments=d,this._withCDN=e,this._warmStorageService=g,this._pieceRetriever=h,this._warmStorageAddress=f,this._session=null,this._storageManager=new fR(this,this._warmStorageService,this._pieceRetriever,this._withCDN,i,j)}getNetwork(){return this._network}get telemetry(){return ef}getSigner(){return null==this._session?this._signer:this._session.getSigner()}getClient(){return this._signer}createSessionKey(a){return new fN(this._provider,this._warmStorageService.getSessionKeyRegistryAddress(),a,this._signer)}setSession(a){this._session=a}getProvider(){return this._provider}getChainId(){return"mainnet"===this._network?b9.mainnet:b9.calibration}getWarmStorageAddress(){return this._warmStorageAddress}getPaymentsAddress(){return this._warmStorageService.getPaymentsAddress()}getPDPVerifierAddress(){return this._warmStorageService.getPDPVerifierAddress()}get payments(){return this._payments}get storage(){return this._storageManager}async createStorage(a={}){return await this._storageManager.createContext(a)}async download(a,b){return console.warn("synapse.download() is deprecated. Use synapse.storage.download() instead."),await this._storageManager.download(a,b)}async getProviderInfo(a){try{let b;if("string"==typeof a)try{f.getAddress(a)}catch{throw Error(`Invalid provider address: ${a}`)}let c=this._warmStorageService.getServiceProviderRegistryAddress(),d=new fO(this._provider,c);if(b="string"==typeof a?await d.getProviderByAddress(a):await d.getProvider(a),null==b)throw Error(`Provider ${a} not found in registry`);return b}catch(a){if(a instanceof Error&&a.message.includes("Invalid provider address")||a instanceof Error&&a.message.includes("not found"))throw a;throw Error(`Failed to get provider info: ${a instanceof Error?a.message:String(a)}`)}}async getStorageInfo(){return console.warn("synapse.getStorageInfo() is deprecated. Use synapse.storage.getStorageInfo() instead."),await this._storageManager.getStorageInfo()}}a.s([],643668),a.s([],811048),a.s([],299518),a.i(299518),a.i(771384),a.s(["PaymentsService",()=>ez],30076),a.i(30076),a.i(673686),a.s(["PDPAuthHelper",()=>eA,"PDPServer",()=>fE,"PDPVerifier",()=>fF,"asDataSetData",()=>fD,"asDataSetPieceData",()=>fC,"isDataSetCreationStatusResponse",()=>fw,"isFindPieceResponse",()=>fy,"isPieceAdditionStatusResponse",()=>fx,"validateDataSetCreationStatusResponse",()=>fz,"validateFindPieceResponse",()=>fB,"validatePieceAdditionStatusResponse",()=>fA],403313),a.i(403313),a.i(629502),a.i(192449),a.s(["ADD_PIECES_TYPEHASH",0,fH,"CREATE_DATA_SET_TYPEHASH",0,fG,"DELETE_DATA_SET_TYPEHASH",0,fJ,"PDP_PERMISSIONS",0,fK,"PDP_PERMISSION_NAMES",0,fL,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,fI,"SessionKey",()=>fN],832562),a.i(832562),a.i(475677),a.s(["StorageContext",()=>fQ,"StorageManager",()=>fR,"StorageService",()=>fQ],872457),a.i(872457),a.i(760890),a.s(["SubgraphService",()=>fU],145173),a.i(145173),a.i(643668),a.s(["TelemetryService",()=>ee,"getGlobalTelemetry",()=>eg,"initGlobalTelemetry",()=>eh],353483),a.i(353483),a.i(811048),a.i(312151),a.i(584295),a.i(615135),a.s(["CHAIN_IDS",0,b9,"CONTRACT_ABIS",0,ca,"CONTRACT_ADDRESSES",0,ci,"EIP2612_PERMIT_TYPES",0,cb,"EIP712_ENCODED_TYPES",0,d7,"EIP712_TYPES",0,d6,"EIP712_TYPE_HASHES",0,d8,"GENESIS_TIMESTAMPS",0,cd,"METADATA_KEYS",0,cf,"RPC_URLS",0,ch,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ce,"TIME_CONSTANTS",0,cc,"TIMING_CONSTANTS",0,cg,"TOKENS",0,b8,"calculateLastProofDate",()=>ep,"combineMetadata",()=>ev,"constructFindPieceUrl",()=>ey,"constructPieceUrl",()=>ex,"createError",()=>ek,"dateToEpoch",()=>em,"epochToDate",()=>el,"getCurrentEpoch",()=>eq,"getFilecoinNetworkType",()=>ew,"getGenesisTimestamp",()=>en,"metadataMatches",()=>eu,"timeUntilEpoch",()=>eo],353850),a.i(353850),a.i(18158),a.s(["WarmStorageService",()=>fZ],442614),a.i(442614),a.s(["ADD_PIECES_TYPEHASH",0,fH,"CHAIN_IDS",0,b9,"CONTRACT_ABIS",0,ca,"CONTRACT_ADDRESSES",0,ci,"CREATE_DATA_SET_TYPEHASH",0,fG,"DELETE_DATA_SET_TYPEHASH",0,fJ,"EIP2612_PERMIT_TYPES",0,cb,"EIP712_ENCODED_TYPES",0,d7,"EIP712_TYPES",0,d6,"EIP712_TYPE_HASHES",0,d8,"GENESIS_TIMESTAMPS",0,cd,"METADATA_KEYS",0,cf,"PDPAuthHelper",()=>eA,"PDPServer",()=>fE,"PDPVerifier",()=>fF,"PDP_PERMISSIONS",0,fK,"PDP_PERMISSION_NAMES",0,fL,"PaymentsService",()=>ez,"RPC_URLS",0,ch,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,fI,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ce,"SessionKey",()=>fN,"StorageContext",()=>fQ,"StorageManager",()=>fR,"StorageService",()=>fQ,"SubgraphService",()=>fU,"Synapse",()=>f$,"TIME_CONSTANTS",0,cc,"TIMING_CONSTANTS",0,cg,"TOKENS",0,b8,"TelemetryService",()=>ee,"WarmStorageService",()=>fZ,"asDataSetData",()=>fD,"asDataSetPieceData",()=>fC,"calculateLastProofDate",()=>ep,"combineMetadata",()=>ev,"constructFindPieceUrl",()=>ey,"constructPieceUrl",()=>ex,"createError",()=>ek,"dateToEpoch",()=>em,"epochToDate",()=>el,"getCurrentEpoch",()=>eq,"getFilecoinNetworkType",()=>ew,"getGenesisTimestamp",()=>en,"getGlobalTelemetry",()=>eg,"initGlobalTelemetry",()=>eh,"isDataSetCreationStatusResponse",()=>fw,"isFindPieceResponse",()=>fy,"isPieceAdditionStatusResponse",()=>fx,"metadataMatches",()=>eu,"timeUntilEpoch",()=>eo,"validateDataSetCreationStatusResponse",()=>fz,"validateFindPieceResponse",()=>fB,"validatePieceAdditionStatusResponse",()=>fA],106679)}];

//# sourceMappingURL=857f8_%40filoz_synapse-sdk_dist_src_index_bbda7c4e.js.map