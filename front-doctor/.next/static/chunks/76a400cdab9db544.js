(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,901486,e=>{"use strict";let t,n,r;var i,a=e.i(2766),a=a;e.s([],454742);var s=e.i(653430);let o=[...s.erc20Abi,{type:"function",stateMutability:"view",name:"nonces",inputs:[{name:"owner",type:"address"}],outputs:[{name:"",type:"uint256"}]},{type:"function",stateMutability:"view",name:"version",inputs:[],outputs:[{name:"",type:"string"}]}];e.s(["erc20WithPermit",0,o],49992);let p=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"COMMISSION_MAX_BPS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NETWORK_FEE_DENOMINATOR",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NETWORK_FEE_NUMERATOR",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"owner",internalType:"address",type:"address"}],name:"accounts",outputs:[{name:"funds",internalType:"uint256",type:"uint256"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"}],name:"auctionInfo",outputs:[{name:"startPrice",internalType:"uint88",type:"uint88"},{name:"startTime",internalType:"uint168",type:"uint168"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"recipient",internalType:"address",type:"address"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"burnForFees",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}],name:"createRail",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"}],name:"depositWithAuthorization",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"depositWithAuthorizationAndApproveOperator",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC3009",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"validAfter",internalType:"uint256",type:"uint256"},{name:"validBefore",internalType:"uint256",type:"uint256"},{name:"nonce",internalType:"bytes32",type:"bytes32"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"depositWithAuthorizationAndIncreaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"}],name:"depositWithPermit",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndApproveOperator",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndIncreaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"owner",internalType:"address",type:"address"}],name:"getAccountInfoIfSettled",outputs:[{name:"fundedUntilEpoch",internalType:"uint256",type:"uint256"},{name:"currentFunds",internalType:"uint256",type:"uint256"},{name:"availableFunds",internalType:"uint256",type:"uint256"},{name:"currentLockupRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRail",outputs:[{name:"",internalType:"struct FilecoinPayV1.RailView",type:"tuple",components:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupPeriod",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"},{name:"settledUpTo",internalType:"uint256",type:"uint256"},{name:"endEpoch",internalType:"uint256",type:"uint256"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getRailsForPayeeAndToken",outputs:[{name:"results",internalType:"struct FilecoinPayV1.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]},{name:"nextOffset",internalType:"uint256",type:"uint256"},{name:"total",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getRailsForPayerAndToken",outputs:[{name:"results",internalType:"struct FilecoinPayV1.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]},{name:"nextOffset",internalType:"uint256",type:"uint256"},{name:"total",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRateChangeQueueSize",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"increaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"period",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"}],name:"modifyRailLockup",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"newRate",internalType:"uint256",type:"uint256"},{name:"oneTimePayment",internalType:"uint256",type:"uint256"}],name:"modifyRailPayment",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"client",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"operatorApprovals",outputs:[{name:"isApproved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"approved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"setOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"untilEpoch",internalType:"uint256",type:"uint256"}],name:"settleRail",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"totalNetworkFee",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"settleTerminatedRailWithoutValidation",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"totalNetworkFee",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"terminateRail",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdrawTo",outputs:[],stateMutability:"nonpayable"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"owner",internalType:"address",type:"address",indexed:!0},{name:"lockupCurrent",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256",indexed:!1}],name:"AccountLockupSettled"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1}],name:"DepositRecorded"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"client",internalType:"address",type:"address",indexed:!0},{name:"operator",internalType:"address",type:"address",indexed:!0},{name:"approved",internalType:"bool",type:"bool",indexed:!1},{name:"rateAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1}],name:"OperatorApprovalUpdated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"payer",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0},{name:"token",internalType:"contract IERC20",type:"address",indexed:!1},{name:"operator",internalType:"address",type:"address",indexed:!1},{name:"validator",internalType:"address",type:"address",indexed:!1},{name:"serviceFeeRecipient",internalType:"address",type:"address",indexed:!1},{name:"commissionRateBps",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailCreated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0}],name:"RailFinalized"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"oldLockupFixed",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupFixed",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailLockupModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"netPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1},{name:"networkFee",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailOneTimePaymentProcessed"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"totalSettledAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1},{name:"networkFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"settledUpTo",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailSettled"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"by",internalType:"address",type:"address",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailTerminated"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"contract IERC20",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1}],name:"WithdrawRecorded"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxSettlementEpoch",internalType:"uint256",type:"uint256"},{name:"blockNumber",internalType:"uint256",type:"uint256"}],name:"CannotModifyTerminatedRailBeyondEndEpoch"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowedEpoch",internalType:"uint256",type:"uint256"},{name:"attemptedEpoch",internalType:"uint256",type:"uint256"}],name:"CannotSettleFutureEpochs"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"requiredBlock",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"CannotSettleTerminatedRailBeforeMaxEpoch"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionRateTooHigh"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"oldLockup",internalType:"uint256",type:"uint256"},{name:"currentLockup",internalType:"uint256",type:"uint256"}],name:"CurrentLockupLessThanOldLockup"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"currentLockup",internalType:"uint256",type:"uint256"},{name:"lockupReduction",internalType:"uint256",type:"uint256"}],name:"InsufficientCurrentLockup"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"required",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForOneTimePayment"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForSettlement"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupForSettlement"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"InsufficientNativeTokenForBurn"},{type:"error",inputs:[{name:"available",internalType:"uint256",type:"uint256"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"InsufficientUnlockedFunds"},{type:"error",inputs:[{name:"nextRateChangeUntilEpoch",internalType:"uint256",type:"uint256"},{name:"processedEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidRateChangeQueueState"},{type:"error",inputs:[{name:"actualPeriod",internalType:"uint256",type:"uint256"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"InvalidTerminatedRailModification"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"account",internalType:"address",type:"address"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"fundsCurrent",internalType:"uint256",type:"uint256"}],name:"LockupExceedsFundsInvariant"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"LockupFixedIncreaseNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"expectedLockup",internalType:"uint256",type:"uint256"},{name:"actualLockup",internalType:"uint256",type:"uint256"}],name:"LockupInconsistencyDuringRailFinalization"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"isSettled",internalType:"bool",type:"bool"},{name:"currentRate",internalType:"uint256",type:"uint256"},{name:"attemptedRate",internalType:"uint256",type:"uint256"}],name:"LockupNotSettledRateChangeNotAllowed"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodChangeNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxAllowedPeriod",internalType:"uint256",type:"uint256"},{name:"requestedPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodExceedsOperatorMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"}],name:"LockupRateInconsistent"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"oldRate",internalType:"uint256",type:"uint256"}],name:"LockupRateLessThanOldRate"},{type:"error",inputs:[],name:"MissingServiceFeeRecipient"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"MustSendExactNativeAmount"},{type:"error",inputs:[{name:"sent",internalType:"uint256",type:"uint256"}],name:"NativeTokenNotAccepted"},{type:"error",inputs:[],name:"NativeTokenNotSupported"},{type:"error",inputs:[{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"NativeTransferFailed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"expectedSettledUpTo",internalType:"uint256",type:"uint256"},{name:"actualSettledUpTo",internalType:"uint256",type:"uint256"}],name:"NoProgressInSettlement"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedClient",internalType:"address",type:"address"},{name:"allowedOperator",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"NotAuthorizedToTerminateRail"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"OneTimePaymentExceedsLockup"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailClientAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailOperatorAllowed"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorLockupAllowanceExceeded"},{type:"error",inputs:[{name:"from",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorRateAllowanceExceeded"},{type:"error",inputs:[{name:"x",internalType:"uint256",type:"uint256"},{name:"y",internalType:"uint256",type:"uint256"},{name:"denominator",internalType:"uint256",type:"uint256"}],name:"PRBMath_MulDiv_Overflow"},{type:"error",inputs:[{name:"x",internalType:"UD60x18",type:"uint256"}],name:"PRBMath_UD60x18_Exp2_InputTooBig"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailAlreadyTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailInactiveOrSettled"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RateChangeNotAllowedOnTerminatedRail"},{type:"error",inputs:[{name:"nextUntilEpoch",internalType:"uint256",type:"uint256"}],name:"RateChangeQueueNotEmpty"},{type:"error",inputs:[],name:"ReentrancyGuardReentrantCall"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"}],name:"SafeERC20FailedOperation"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"SignerMustBeMsgSender"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"attempted",internalType:"uint256",type:"uint256"}],name:"ValidatorModifiedAmountExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedStart",internalType:"uint256",type:"uint256"},{name:"attemptedStart",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeforeSegmentStart"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedEnd",internalType:"uint256",type:"uint256"},{name:"attemptedEnd",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeyondSegmentEnd"},{type:"error",inputs:[{name:"token",internalType:"contract IERC20",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"WithdrawAmountExceedsAccumulatedFees"},{type:"error",inputs:[{name:"varName",internalType:"string",type:"string"}],name:"ZeroAddressNotAllowed"}],d=[{type:"constructor",inputs:[{name:"_service",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"challengeWindow",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"}],name:"clientDataSets",outputs:[{name:"dataSetIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"nonce",internalType:"uint256",type:"uint256"}],name:"clientNonces",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"filBeamControllerAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getAllDataSetMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getAllPieceMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getApprovedProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getApprovedProvidersLength",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengesPerProof",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"pure"},{type:"function",inputs:[{name:"client",internalType:"address",type:"address"}],name:"getClientDataSets",outputs:[{name:"infos",internalType:"struct FilecoinWarmStorageService.DataSetInfoView[]",type:"tuple[]",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"dataSetId",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"getCurrentPricingRates",outputs:[{name:"storagePrice",internalType:"uint256",type:"uint256"},{name:"minimumRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getDataSet",outputs:[{name:"info",internalType:"struct FilecoinWarmStorageService.DataSetInfoView",type:"tuple",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"dataSetId",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getDataSetMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"leafCount",internalType:"uint256",type:"uint256"}],name:"getDataSetSizeInBytes",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"pure"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getDataSetStatus",outputs:[{name:"status",internalType:"enum FilecoinWarmStorageService.DataSetStatus",type:"uint8"}],stateMutability:"view"},{type:"function",inputs:[],name:"getMaxProvingPeriod",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[],name:"getPDPConfig",outputs:[{name:"maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"challengesPerProof",internalType:"uint256",type:"uint256"},{name:"initChallengeWindowStart",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getPieceMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderApproved",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"nextPDPChallengeWindowStart",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"nextUpgrade",outputs:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodId",internalType:"uint256",type:"uint256"}],name:"provenPeriods",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provenThisPeriod",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provingActivationEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"provingDeadline",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"railToDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"service",outputs:[{name:"",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"serviceCommissionBps",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodNotInitialized"}],u=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"MAX_ENQUEUED_REMOVALS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_PIECE_SIZE_LOG2",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_CHALLENGE_SCHEDULED",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_PROVEN_EPOCH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"listenerAddr",internalType:"address",type:"address"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"addPieces",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"calculateProofFee",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"proofSize",internalType:"uint256",type:"uint256"}],name:"calculateProofFeeForSize",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"claimDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"listenerAddr",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"createDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"dataSetLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"deleteDataSet",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"feeEffectiveTime",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[],name:"feePerTiB",outputs:[{name:"",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"leafIndexs",internalType:"uint256[]",type:"uint256[]"}],name:"findPieceIds",outputs:[{name:"",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getActivePieceCount",outputs:[{name:"activeCount",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getActivePieces",outputs:[{name:"pieces",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengeFinality",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getChallengeRange",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLastProvenEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetListener",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetStorageProvider",outputs:[{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextChallengeEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextDataSetId",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextPieceId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceCid",outputs:[{name:"",internalType:"struct Cids.Cid",type:"tuple",components:[{name:"data",internalType:"bytes",type:"bytes"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getRandomness",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getScheduledRemovals",outputs:[{name:"",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"_challengeFinality",internalType:"uint256",type:"uint256"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceChallengable",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"newStorageProvider",internalType:"address",type:"address"}],name:"proposeDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"proposedFeePerTiB",outputs:[{name:"",internalType:"uint96",type:"uint96"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"proofs",internalType:"struct IPDPTypes.Proof[]",type:"tuple[]",components:[{name:"leaf",internalType:"bytes32",type:"bytes32"},{name:"proof",internalType:"bytes32[]",type:"bytes32[]"}]}],name:"provePossession",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"schedulePieceDeletions",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newFeePerTiB",internalType:"uint256",type:"uint256"}],name:"updateProofFee",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"storageProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"deletedLeafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"DataSetDeleted"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0}],name:"DataSetEmpty"},{type:"event",anonymous:!1,inputs:[{name:"currentFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"newFee",internalType:"uint256",type:"uint256",indexed:!1},{name:"effectiveTime",internalType:"uint256",type:"uint256",indexed:!1}],name:"FeeUpdateProposed"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challengeEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"leafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"NextProvingPeriod"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1},{name:"pieceCids",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}],indexed:!1}],name:"PiecesAdded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1}],name:"PiecesRemoved"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challenges",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}],indexed:!1}],name:"PossessionProven"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"fee",internalType:"uint256",type:"uint256",indexed:!1}],name:"ProofFeePaid"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldStorageProvider",internalType:"address",type:"address",indexed:!0},{name:"newStorageProvider",internalType:"address",type:"address",indexed:!0}],name:"StorageProviderChanged"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"idx",internalType:"uint256",type:"uint256"},{name:"msg",internalType:"string",type:"string"}],name:"IndexedError"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],l=[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"MAX_CAPABILITIES",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_KEY_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_VALUE_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"REGISTRATION_FEE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"activeProductTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"activeProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"addProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"addressToProviderId",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getAllActiveProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"getAllProductCapabilities",outputs:[{name:"isActive",internalType:"bool",type:"bool"},{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"bytes[]",type:"bytes[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextProviderId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"keys",internalType:"string[]",type:"string[]"}],name:"getProductCapabilities",outputs:[{name:"values",internalType:"bytes[]",type:"bytes[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getProvider",outputs:[{name:"info",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderByAddress",outputs:[{name:"info",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]}],stateMutability:"view"},{type:"function",inputs:[],name:"getProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderIdByAddress",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getProviderPayee",outputs:[{name:"payee",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"getProviderWithProduct",outputs:[{name:"",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct",type:"tuple",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"productCapabilityValues",internalType:"bytes[]",type:"bytes[]"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"}],name:"getProvidersByIds",outputs:[{name:"providerInfos",internalType:"struct ServiceProviderRegistry.ServiceProviderInfoView[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}]},{name:"validIds",internalType:"bool[]",type:"bool[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"onlyActive",internalType:"bool",type:"bool"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getProvidersByProductType",outputs:[{name:"result",internalType:"struct ServiceProviderRegistryStorage.PaginatedProviders",type:"tuple",components:[{name:"providers",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"productCapabilityValues",internalType:"bytes[]",type:"bytes[]"}]},{name:"hasMore",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderActive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"isRegisteredProvider",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"newVersion",internalType:"string",type:"string"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"key",internalType:"string",type:"string"}],name:"productCapabilities",outputs:[{name:"value",internalType:"bytes",type:"bytes"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"productTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerHasProduct",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerProducts",outputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"providers",outputs:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"registerProvider",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"removeProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"removeProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]"}],name:"updateProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"}],name:"updateProviderInfo",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]",indexed:!1}],name:"ProductAdded"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0}],name:"ProductRemoved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"bytes[]",type:"bytes[]",indexed:!1}],name:"ProductUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderInfoUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0}],name:"ProviderRegistered"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderRemoved"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"InsufficientCapabilitiesForProduct"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],y=[{type:"constructor",inputs:[{name:"_pdpVerifierAddress",internalType:"address",type:"address"},{name:"_paymentsContractAddress",internalType:"address",type:"address"},{name:"_usdfc",internalType:"contract IERC20Metadata",type:"address"},{name:"_filBeamBeneficiaryAddress",internalType:"address",type:"address"},{name:"_serviceProviderRegistry",internalType:"contract ServiceProviderRegistry",type:"address"},{name:"_sessionKeyRegistry",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"addApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"plannedUpgrade",internalType:"struct FilecoinWarmStorageService.PlannedUpgrade",type:"tuple",components:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}]}],name:"announcePlannedUpgrade",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"totalBytes",internalType:"uint256",type:"uint256"}],name:"calculateRatePerEpoch",outputs:[{name:"storageRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"configureProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"dataSetCreated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"bytes",type:"bytes"}],name:"dataSetDeleted",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"extsload",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"},{name:"size",internalType:"uint256",type:"uint256"}],name:"extsloadStruct",outputs:[{name:"",internalType:"bytes32[]",type:"bytes32[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"filBeamBeneficiaryAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"getEffectiveRates",outputs:[{name:"serviceFee",internalType:"uint256",type:"uint256"},{name:"spPayment",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getProvingPeriodForEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getServicePrice",outputs:[{name:"pricing",internalType:"struct FilecoinWarmStorageService.ServicePricing",type:"tuple",components:[{name:"pricePerTiBPerMonthNoCDN",internalType:"uint256",type:"uint256"},{name:"pricePerTiBCdnEgress",internalType:"uint256",type:"uint256"},{name:"pricePerTiBCacheMissEgress",internalType:"uint256",type:"uint256"},{name:"tokenAddress",internalType:"contract IERC20",type:"address"},{name:"epochsPerMonth",internalType:"uint256",type:"uint256"},{name:"minimumPricePerMonth",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"_filBeamControllerAddress",internalType:"address",type:"address"},{name:"_name",internalType:"string",type:"string"},{name:"_description",internalType:"string",type:"string"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"leafCount",internalType:"uint256",type:"uint256"},{name:"",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"paymentsContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"pdpVerifierAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"firstAdded",internalType:"uint256",type:"uint256"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesAdded",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesScheduledRemove",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"challengeCount",internalType:"uint256",type:"uint256"}],name:"possessionProven",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"terminator",internalType:"address",type:"address"},{name:"endEpoch",internalType:"uint256",type:"uint256"}],name:"railTerminated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"index",internalType:"uint256",type:"uint256"}],name:"removeApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"serviceProviderRegistry",outputs:[{name:"",internalType:"contract ServiceProviderRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"sessionKeyRegistry",outputs:[{name:"",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"setViewContract",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"cdnAmount",internalType:"uint256",type:"uint256"},{name:"cacheMissAmount",internalType:"uint256",type:"uint256"}],name:"settleFilBeamPaymentRails",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"},{name:"",internalType:"bytes",type:"bytes"}],name:"storageProviderChanged",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateCDNService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"cdnAmountToAdd",internalType:"uint256",type:"uint256"},{name:"cacheMissAmountToAdd",internalType:"uint256",type:"uint256"}],name:"topUpCDNPaymentRails",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newController",internalType:"address",type:"address"}],name:"transferFilBeamController",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newStoragePrice",internalType:"uint256",type:"uint256"},{name:"newMinimumRate",internalType:"uint256",type:"uint256"}],name:"updatePricing",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newCommissionBps",internalType:"uint256",type:"uint256"}],name:"updateServiceCommission",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"usdfcTokenAddress",outputs:[{name:"",internalType:"contract IERC20Metadata",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"proposedAmount",internalType:"uint256",type:"uint256"},{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"}],name:"validatePayment",outputs:[{name:"result",internalType:"struct IValidator.ValidationResult",type:"tuple",components:[{name:"modifiedAmount",internalType:"uint256",type:"uint256"},{name:"settleUpto",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"viewContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"cdnAmountAdded",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalCdnLockup",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissAmountAdded",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalCacheMissLockup",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNPaymentRailsToppedUp"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"payer",internalType:"address",type:"address",indexed:!1},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"payee",internalType:"address",type:"address",indexed:!1},{name:"metadataKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"metadataValues",internalType:"string[]",type:"string[]",indexed:!1}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldServiceProvider",internalType:"address",type:"address",indexed:!0},{name:"newServiceProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetServiceProviderChanged"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"periodsFaulted",internalType:"uint256",type:"uint256",indexed:!1},{name:"deadline",internalType:"uint256",type:"uint256",indexed:!1}],name:"FaultRecord"},{type:"event",anonymous:!1,inputs:[{name:"oldController",internalType:"address",type:"address",indexed:!1},{name:"newController",internalType:"address",type:"address",indexed:!1}],name:"FilBeamControllerChanged"},{type:"event",anonymous:!1,inputs:[{name:"name",internalType:"string",type:"string",indexed:!1},{name:"description",internalType:"string",type:"string",indexed:!1}],name:"FilecoinServiceDeployed"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"PDPPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceCid",internalType:"struct Cids.Cid",type:"tuple",components:[{name:"data",internalType:"bytes",type:"bytes"}],indexed:!1},{name:"keys",internalType:"string[]",type:"string[]",indexed:!1},{name:"values",internalType:"string[]",type:"string[]",indexed:!1}],name:"PieceAdded"},{type:"event",anonymous:!1,inputs:[{name:"storagePrice",internalType:"uint256",type:"uint256",indexed:!1},{name:"minimumRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"PricingUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderApproved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderUnapproved"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"railId",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateUpdated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"ServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"plannedUpgrade",internalType:"struct FilecoinWarmStorageService.PlannedUpgrade",type:"tuple",components:[{name:"nextImplementation",internalType:"address",type:"address"},{name:"afterEpoch",internalType:"uint96",type:"uint96"}],indexed:!1}],name:"UpgradeAnnounced"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"event",anonymous:!1,inputs:[{name:"viewContract",internalType:"address",type:"address",indexed:!0}],name:"ViewContractSet"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[],name:"AtLeastOnePriceMustBeNonZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CDNPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CacheMissPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayer"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"expectedPayee",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayerOrPayee"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"CallerNotPayments"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"windowStart",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ChallengeWindowTooEarly"},{type:"error",inputs:[{name:"clientDataSetId",internalType:"uint256",type:"uint256"}],name:"ClientDataSetAlreadyRegistered"},{type:"error",inputs:[{name:"commissionType",internalType:"enum Errors.CommissionType",type:"uint8"},{name:"max",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"DataSetNotFoundForRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentBeyondEndEpoch"},{type:"error",inputs:[],name:"DivisionByZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"DuplicateMetadataKey"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"ExtraDataRequired"},{type:"error",inputs:[{name:"actualSize",internalType:"uint256",type:"uint256"},{name:"maxAllowedSize",internalType:"uint256",type:"uint256"}],name:"ExtraDataTooLarge"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilBeamServiceNotConfigured"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"minimumRequired",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForMinimumRate"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"minimumLockupRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupAllowance"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"},{name:"requiredLockupPeriod",internalType:"uint256",type:"uint256"}],name:"InsufficientMaxLockupPeriod"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"minimumRateRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientRateAllowance"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minExpected",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeCount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minAllowed",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeEpoch"},{type:"error",inputs:[{name:"maxProvingPeriod",internalType:"uint256",type:"uint256"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeWindowSize"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidDataSetId"},{type:"error",inputs:[{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidEpochRange"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceDescriptionLength"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceNameLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidTopUpAmount"},{type:"error",inputs:[],name:"MaxProvingPeriodZero"},{type:"error",inputs:[{name:"metadataArrayCount",internalType:"uint256",type:"uint256"},{name:"pieceCount",internalType:"uint256",type:"uint256"}],name:"MetadataArrayCountMismatch"},{type:"error",inputs:[{name:"keysLength",internalType:"uint256",type:"uint256"},{name:"valuesLength",internalType:"uint256",type:"uint256"}],name:"MetadataKeyAndValueLengthMismatch"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataKeyExceedsMaxLength"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataValueExceedsMaxLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodDeadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"NextProvingPeriodAlreadyCalled"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"NoPDPPaymentRail"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyFilBeamControllerAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyPDPVerifierAllowed"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"}],name:"PaymentRailsNotFinalized"},{type:"error",inputs:[{name:"priceType",internalType:"enum Errors.PriceType",type:"uint8"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"PriceExceedsMaximum"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProofAlreadySubmitted"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderAlreadyApproved"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotInApprovedList"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"ProviderNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingNotStarted"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodPassed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotAssociated"},{type:"error",inputs:[],name:"ServiceContractMustTerminateRail"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"keysLength",internalType:"uint256",type:"uint256"}],name:"TooManyMetadataKeys"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"ZeroAddress"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"AddressAlreadySet"},{type:"error",inputs:[],name:"AtLeastOnePriceMustBeNonZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CDNPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"CacheMissPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayer"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"expectedPayee",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayerOrPayee"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"CallerNotPayments"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"windowStart",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ChallengeWindowTooEarly"},{type:"error",inputs:[{name:"clientDataSetId",internalType:"uint256",type:"uint256"}],name:"ClientDataSetAlreadyRegistered"},{type:"error",inputs:[{name:"commissionType",internalType:"enum Errors.CommissionType",type:"uint8"},{name:"max",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"DataSetNotFoundForRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentBeyondEndEpoch"},{type:"error",inputs:[],name:"DivisionByZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"DuplicateMetadataKey"},{type:"error",inputs:[],name:"ExtraDataRequired"},{type:"error",inputs:[{name:"actualSize",internalType:"uint256",type:"uint256"},{name:"maxAllowedSize",internalType:"uint256",type:"uint256"}],name:"ExtraDataTooLarge"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilBeamServiceNotConfigured"},{type:"error",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"InsufficientCapabilitiesForProduct"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"minimumRequired",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForMinimumRate"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"minimumLockupRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupAllowance"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"},{name:"requiredLockupPeriod",internalType:"uint256",type:"uint256"}],name:"InsufficientMaxLockupPeriod"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"minimumRateRequired",internalType:"uint256",type:"uint256"}],name:"InsufficientRateAllowance"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minExpected",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeCount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minAllowed",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeEpoch"},{type:"error",inputs:[{name:"maxProvingPeriod",internalType:"uint256",type:"uint256"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeWindowSize"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidDataSetId"},{type:"error",inputs:[{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidEpochRange"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceDescriptionLength"},{type:"error",inputs:[{name:"length",internalType:"uint256",type:"uint256"}],name:"InvalidServiceNameLength"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"InvalidSignature"},{type:"error",inputs:[{name:"expectedLength",internalType:"uint256",type:"uint256"},{name:"actualLength",internalType:"uint256",type:"uint256"}],name:"InvalidSignatureLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidTopUpAmount"},{type:"error",inputs:[],name:"MaxProvingPeriodZero"},{type:"error",inputs:[{name:"metadataArrayCount",internalType:"uint256",type:"uint256"},{name:"pieceCount",internalType:"uint256",type:"uint256"}],name:"MetadataArrayCountMismatch"},{type:"error",inputs:[{name:"keysLength",internalType:"uint256",type:"uint256"},{name:"valuesLength",internalType:"uint256",type:"uint256"}],name:"MetadataKeyAndValueLengthMismatch"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataKeyExceedsMaxLength"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataValueExceedsMaxLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodDeadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"NextProvingPeriodAlreadyCalled"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"NoPDPPaymentRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OldServiceProviderMismatch"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyFilBeamControllerAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyPDPVerifierAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlySelf"},{type:"error",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"}],name:"PaymentRailsNotFinalized"},{type:"error",inputs:[{name:"priceType",internalType:"enum Errors.PriceType",type:"uint8"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"PriceExceedsMaximum"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProofAlreadySubmitted"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderAlreadyApproved"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotInApprovedList"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"ProviderNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingNotStarted"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodNotInitialized"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodPassed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotAssociated"},{type:"error",inputs:[],name:"ServiceContractMustTerminateRail"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"keysLength",internalType:"uint256",type:"uint256"}],name:"TooManyMetadataKeys"},{type:"error",inputs:[{name:"v",internalType:"uint8",type:"uint8"}],name:"UnsupportedSignatureV"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"ZeroAddress"}];e.i(49992);let c=BigInt(4),m=BigInt(127),h=BigInt(128),f=254/256,g=32,v=BigInt(32),T=2*g+1,w=(e=>{if(e instanceof Uint8Array){if(e.length>g)return e.subarray(0,g);else if(e.length==g)return e}let t=new Uint8Array(g);return t.set([...e]),t})(new Uint8Array(g).fill(0));Object.freeze(w.buffer);let b=new Uint8Array(0);function S(e){return e.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")}function P(e){let t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):b}function I(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}function A(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")}function E(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function x(e){return new TextEncoder().encode(e)}function C(e){return new TextDecoder().decode(e)}e.s(["coerce",()=>A,"empty",0,b,"equals",()=>I,"fromHex",()=>P,"fromString",()=>x,"isBinary",()=>E,"toHex",()=>S,"toString",()=>C],743482);var D=e.i(276364);let _="sha2-256",R=new Uint8Array([18,32]);class M{constructor(e){this.code=18,this.name=_,this.bytes=e,this.size=32,this.digest=e.subarray(2)}}let N=e=>{let t=new Uint8Array(R.length+32);return t.set(R,0),t.set((0,D.sha256)(e),R.length),new M(t)};e.s(["digest",0,N],605199),e.s(["code",0,18],544661);let k=["string","number","bigint","symbol"],U=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class ${constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:+(this.major>e.major)}}$.uint=new $(0,"uint",!0),$.negint=new $(1,"negint",!0),$.bytes=new $(2,"bytes",!0),$.string=new $(3,"string",!0),$.array=new $(4,"array",!1),$.map=new $(5,"map",!1),$.tag=new $(6,"tag",!1),$.float=new $(7,"float",!0),$.false=new $(7,"false",!0),$.true=new $(7,"true",!0),$.null=new $(7,"null",!0),$.undefined=new $(7,"undefined",!0),$.break=new $(7,"break",!0);class L{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}let F=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,B=new TextDecoder,O=new TextEncoder;function z(e){return F&&globalThis.Buffer.isBuffer(e)}function V(e){return e instanceof Uint8Array?z(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}let W=F?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):Z(e,t,n):(e,t,n)=>n-t>64?B.decode(e.subarray(t,n)):Z(e,t,n),j=F?e=>e.length>64?globalThis.Buffer.from(e):Y(e):e=>e.length>64?O.encode(e):Y(e),H=F?(e,t,n)=>z(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),G=F?(e,t)=>(e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),V(globalThis.Buffer.concat(e,t))):(e,t)=>{let n=new Uint8Array(t),r=0;for(let t of e)r+t.length>n.length&&(t=t.subarray(0,n.length-r)),n.set(t,r),r+=t.length;return n},K=F?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function q(e,t){if(z(e)&&z(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}function Y(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function Z(e,t,n){let r=[];for(;t<n;){let i=e[t],a=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=n){let n,r,o,p;switch(s){case 1:i<128&&(a=i);break;case 2:(192&(n=e[t+1]))==128&&(p=(31&i)<<6|63&n)>127&&(a=p);break;case 3:n=e[t+1],r=e[t+2],(192&n)==128&&(192&r)==128&&(p=(15&i)<<12|(63&n)<<6|63&r)>2047&&(p<55296||p>57343)&&(a=p);break;case 4:n=e[t+1],r=e[t+2],o=e[t+3],(192&n)==128&&(192&r)==128&&(192&o)==128&&(p=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&o)>65535&&p<1114112&&(a=p)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),t+=s}var i=r;let a=i.length;if(a<=4096)return String.fromCharCode.apply(String,i);let s="",o=0;for(;o<a;)s+=String.fromCharCode.apply(String,i.slice(o,o+=4096));return s}class X{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){let n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){let e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=K(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){let n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=H(n,0,this.cursor)}else t=G(this.chunks,this.cursor);return e&&this.reset(),t}}let Q="CBOR decode error:",J="CBOR encode error:",ee=[];function et(e,t,n){if(e.length-t<n)throw Error(`${Q} not enough data for type`)}ee[23]=1,ee[24]=2,ee[25]=3,ee[26]=5,ee[27]=9;let en=[24,256,65536,0x100000000,BigInt("18446744073709551616")];function er(e,t,n){et(e,t,1);let r=e[t];if(!0===n.strict&&r<en[0])throw Error(`${Q} integer encoded in more bytes than necessary (strict decode)`);return r}function ei(e,t,n){et(e,t,2);let r=e[t]<<8|e[t+1];if(!0===n.strict&&r<en[1])throw Error(`${Q} integer encoded in more bytes than necessary (strict decode)`);return r}function ea(e,t,n){et(e,t,4);let r=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<en[2])throw Error(`${Q} integer encoded in more bytes than necessary (strict decode)`);return r}function es(e,t,n){et(e,t,8);let r=0x1000000*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=0x1000000*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&a<en[3])throw Error(`${Q} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(!0===n.allowBigInt)return a;throw Error(`${Q} integers outside of the safe integer range are not supported`)}function eo(e,t){return ep(e,0,t.value)}function ep(e,t,n){if(n<en[0]){let r=Number(n);e.push([t|r])}else if(n<en[1]){let r=Number(n);e.push([24|t,r])}else if(n<en[2]){let r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<en[3]){let r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{let r=BigInt(n);if(r<en[4]){let n=[27|t,0,0,0,0,0,0,0],i=Number(r&BigInt(0xffffffff)),a=Number(r>>BigInt(32)&BigInt(0xffffffff));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&a,a>>=8,n[3]=255&a,a>>=8,n[2]=255&a,a>>=8,n[1]=255&a,e.push(n)}else throw Error(`${Q} encountered BigInt larger than allowable range`)}}eo.encodedSize=function(e){return ep.encodedSize(e.value)},ep.encodedSize=function(e){return e<en[0]?1:e<en[1]?2:e<en[2]?3:e<en[3]?5:9},eo.compareTokens=function(e,t){return e.value<t.value?-1:+(e.value>t.value)};let ed=BigInt(-1),eu=BigInt(1);function el(e,t){let n=t.value;ep(e,t.type.majorEncoded,"bigint"==typeof n?n*ed-eu:-1*n-1)}function ey(e,t,n,r){et(e,t,n+r);let i=H(e,t+n,t+n+r);return new L($.bytes,i,n+r)}function ec(e,t,n,r){return ey(e,t,1,n)}function em(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===$.string?j(e.value):e.value),e.encodedBytes}function eh(e,t){let n=em(t);ep(e,t.type.majorEncoded,n.length),e.push(n)}function ef(e,t,n,r,i){let a=n+r;et(e,t,a);let s=new L($.string,W(e,t+n,t+a),a);return!0===i.retainStringBytes&&(s.byteValue=H(e,t+n,t+a)),s}function eg(e,t,n,r){return ef(e,t,1,n,r)}function ev(e,t,n,r){return new L($.array,r,n)}function eT(e,t,n,r){return ev(e,t,1,n)}function ew(e,t){ep(e,$.array.majorEncoded,t.value)}function eb(e,t,n,r){return new L($.map,r,n)}function eS(e,t,n,r){return eb(e,t,1,n)}function eP(e,t){ep(e,$.map.majorEncoded,t.value)}function eI(e,t,n,r){return new L($.tag,n,1)}function eA(e,t){ep(e,$.tag.majorEncoded,t.value)}function eE(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw Error(`${Q} NaN values are not supported`);if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw Error(`${Q} Infinity values are not supported`)}return new L($.float,e,t)}function ex(e,t,n){let r=t.value;if(!1===r)e.push([20|$.float.majorEncoded]);else if(!0===r)e.push([21|$.float.majorEncoded]);else if(null===r)e.push([22|$.float.majorEncoded]);else if(void 0===r)e.push([23|$.float.majorEncoded]);else{var i;let t=!1;n&&!0===n.float64||(eR(r),r===eM(e_,1)||Number.isNaN(r)?(e_[0]=249,e.push(e_.slice(0,3)),t=!0):(eN(r),r===ek(e_,1)&&(e_[0]=250,e.push(e_.slice(0,5)),t=!0))),t||(i=r,eD.setFloat64(0,i,!1),eU(e_,1),e_[0]=251,e.push(e_.slice(0,9)))}}el.encodedSize=function(e){let t=e.value,n="bigint"==typeof t?t*ed-eu:-1*t-1;return n<en[0]?1:n<en[1]?2:n<en[2]?3:n<en[3]?5:9},el.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},eh.encodedSize=function(e){let t=em(e);return ep.encodedSize(t.length)+t.length},eh.compareTokens=function(e,t){var n,r;return n=em(e),r=em(t),n.length<r.length?-1:n.length>r.length?1:q(n,r)},ew.compareTokens=eo.compareTokens,ew.encodedSize=function(e){return ep.encodedSize(e.value)},eP.compareTokens=eo.compareTokens,eP.encodedSize=function(e){return ep.encodedSize(e.value)},eA.compareTokens=eo.compareTokens,eA.encodedSize=function(e){return ep.encodedSize(e.value)},ex.encodedSize=function(e,t){let n=e.value;if(!1===n||!0===n||null==n)return 1;if(!t||!0!==t.float64){eR(n);let e=eM(e_,1);if(n===e||Number.isNaN(n))return 3;if(eN(n),n===(e=ek(e_,1)))return 5}return 9};let eC=new ArrayBuffer(9),eD=new DataView(eC,1),e_=new Uint8Array(eC,0);function eR(e){if(e===1/0)eD.setUint16(0,31744,!1);else if(e===-1/0)eD.setUint16(0,64512,!1);else if(Number.isNaN(e))eD.setUint16(0,32256,!1);else{eD.setFloat32(0,e);let t=eD.getUint32(0),n=(0x7f800000&t)>>23,r=8388607&t;if(255===n)eD.setUint16(0,31744,!1);else if(0===n)eD.setUint16(0,(0x80000000&e)>>16|r>>13,!1);else{let e=n-127;e<-24?eD.setUint16(0,0):e<-14?eD.setUint16(0,(0x80000000&t)>>16|1<<24+e,!1):eD.setUint16(0,(0x80000000&t)>>16|e+15<<10|r>>13,!1)}}}function eM(e,t){let n;if(e.length-t<2)throw Error(`${Q} not enough data for float16`);let r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;let i=r>>10&31,a=1023&r;return n=0===i?5960464477539063e-23*a:31!==i?(a+1024)*2**(i-25):0===a?1/0:NaN,32768&r?-n:n}function eN(e){eD.setFloat32(0,e,!1)}function ek(e,t){if(e.length-t<4)throw Error(`${Q} not enough data for float32`);let n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function eU(e,t){if(e.length-t<8)throw Error(`${Q} not enough data for float64`);let n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function e$(e,t,n){throw Error(`${Q} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function eL(e){return()=>{throw Error(`${Q} ${e}`)}}ex.compareTokens=eo.compareTokens;let eF=[];for(let e=0;e<=23;e++)eF[e]=e$;eF[24]=function(e,t,n,r){return new L($.uint,er(e,t+1,r),2)},eF[25]=function(e,t,n,r){return new L($.uint,ei(e,t+1,r),3)},eF[26]=function(e,t,n,r){return new L($.uint,ea(e,t+1,r),5)},eF[27]=function(e,t,n,r){return new L($.uint,es(e,t+1,r),9)},eF[28]=e$,eF[29]=e$,eF[30]=e$,eF[31]=e$;for(let e=32;e<=55;e++)eF[e]=e$;eF[56]=function(e,t,n,r){return new L($.negint,-1-er(e,t+1,r),2)},eF[57]=function(e,t,n,r){return new L($.negint,-1-ei(e,t+1,r),3)},eF[58]=function(e,t,n,r){return new L($.negint,-1-ea(e,t+1,r),5)},eF[59]=function(e,t,n,r){let i=es(e,t+1,r);if("bigint"!=typeof i){let e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new L($.negint,e,9)}if(!0!==r.allowBigInt)throw Error(`${Q} integers outside of the safe integer range are not supported`);return new L($.negint,ed-BigInt(i),9)},eF[60]=e$,eF[61]=e$,eF[62]=e$,eF[63]=e$;for(let e=64;e<=87;e++)eF[e]=ec;eF[88]=function(e,t,n,r){return ey(e,t,2,er(e,t+1,r))},eF[89]=function(e,t,n,r){return ey(e,t,3,ei(e,t+1,r))},eF[90]=function(e,t,n,r){return ey(e,t,5,ea(e,t+1,r))},eF[91]=function(e,t,n,r){let i=es(e,t+1,r);if("bigint"==typeof i)throw Error(`${Q} 64-bit integer bytes lengths not supported`);return ey(e,t,9,i)},eF[92]=e$,eF[93]=e$,eF[94]=e$,eF[95]=eL("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)eF[e]=eg;eF[120]=function(e,t,n,r){return ef(e,t,2,er(e,t+1,r),r)},eF[121]=function(e,t,n,r){return ef(e,t,3,ei(e,t+1,r),r)},eF[122]=function(e,t,n,r){return ef(e,t,5,ea(e,t+1,r),r)},eF[123]=function(e,t,n,r){let i=es(e,t+1,r);if("bigint"==typeof i)throw Error(`${Q} 64-bit integer string lengths not supported`);return ef(e,t,9,i,r)},eF[124]=e$,eF[125]=e$,eF[126]=e$,eF[127]=eL("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)eF[e]=eT;eF[152]=function(e,t,n,r){return ev(e,t,2,er(e,t+1,r))},eF[153]=function(e,t,n,r){return ev(e,t,3,ei(e,t+1,r))},eF[154]=function(e,t,n,r){return ev(e,t,5,ea(e,t+1,r))},eF[155]=function(e,t,n,r){let i=es(e,t+1,r);if("bigint"==typeof i)throw Error(`${Q} 64-bit integer array lengths not supported`);return ev(e,t,9,i)},eF[156]=e$,eF[157]=e$,eF[158]=e$,eF[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw Error(`${Q} indefinite length items not allowed`);return ev(e,t,1,1/0)};for(let e=160;e<=183;e++)eF[e]=eS;eF[184]=function(e,t,n,r){return eb(e,t,2,er(e,t+1,r))},eF[185]=function(e,t,n,r){return eb(e,t,3,ei(e,t+1,r))},eF[186]=function(e,t,n,r){return eb(e,t,5,ea(e,t+1,r))},eF[187]=function(e,t,n,r){let i=es(e,t+1,r);if("bigint"==typeof i)throw Error(`${Q} 64-bit integer map lengths not supported`);return eb(e,t,9,i)},eF[188]=e$,eF[189]=e$,eF[190]=e$,eF[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw Error(`${Q} indefinite length items not allowed`);return eb(e,t,1,1/0)};for(let e=192;e<=215;e++)eF[e]=eI;eF[216]=function(e,t,n,r){return new L($.tag,er(e,t+1,r),2)},eF[217]=function(e,t,n,r){return new L($.tag,ei(e,t+1,r),3)},eF[218]=function(e,t,n,r){return new L($.tag,ea(e,t+1,r),5)},eF[219]=function(e,t,n,r){return new L($.tag,es(e,t+1,r),9)},eF[220]=e$,eF[221]=e$,eF[222]=e$,eF[223]=e$;for(let e=224;e<=243;e++)eF[e]=eL("simple values are not supported");eF[244]=e$,eF[245]=e$,eF[246]=e$,eF[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw Error(`${Q} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new L($.null,null,1):new L($.undefined,void 0,1)},eF[248]=eL("simple values are not supported"),eF[249]=function(e,t,n,r){return eE(eM(e,t+1),3,r)},eF[250]=function(e,t,n,r){return eE(ek(e,t+1),5,r)},eF[251]=function(e,t,n,r){return eE(eU(e,t+1),9,r)},eF[252]=e$,eF[253]=e$,eF[254]=e$,eF[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw Error(`${Q} indefinite length items not allowed`);return new L($.break,void 0,1)};let eB=[];for(let e=0;e<24;e++)eB[e]=new L($.uint,e,1);for(let e=-1;e>=-24;e--)eB[31-e]=new L($.negint,e,1);eB[64]=new L($.bytes,new Uint8Array(0),1),eB[96]=new L($.string,"",1),eB[128]=new L($.array,0,1),eB[160]=new L($.map,0,1),eB[244]=new L($.false,!1,1),eB[245]=new L($.true,!0,1),eB[246]=new L($.null,null,1);let eO=Object.freeze({float64:!0,mapSorter:function(e,t){if(e[0]instanceof L&&t[0]instanceof L){let n=e[0],r=t[0];return n._keyBytes||(n._keyBytes=function(e){return eK(e,ez,eO)}(n.value)),r._keyBytes||(r._keyBytes=function(e){return eK(e,ez,eO)}(r.value)),q(n._keyBytes,r._keyBytes)}throw Error("rfc8949MapSorter: complex key types are not supported yet")},quickEncodeToken:function(e){switch(e.type){case $.false:let t;return t=[244],Uint8Array.from(t);case $.true:let n;return n=[245],Uint8Array.from(n);case $.null:let r;return r=[246],Uint8Array.from(r);case $.bytes:if(!e.value.length){let e;return e=[64],Uint8Array.from(e)}return;case $.string:if(""===e.value){let e;return e=[96],Uint8Array.from(e)}return;case $.array:if(0===e.value){let e;return e=[128],Uint8Array.from(e)}return;case $.map:if(0===e.value){let e;return e=[160],Uint8Array.from(e)}return;case $.uint:if(e.value<24){let t;return t=[Number(e.value)],Uint8Array.from(t)}return;case $.negint:if(e.value>=-24){let t;return t=[31-Number(e.value)],Uint8Array.from(t)}}}}),ez=((t=[])[$.uint.major]=eo,t[$.negint.major]=el,t[$.bytes.major]=eh,t[$.string.major]=eh,t[$.array.major]=ew,t[$.map.major]=eP,t[$.tag.major]=eA,t[$.float.major]=ex,t),eV=new X;class eW{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent)return!1}static createCheck(e,t){if(e&&e.includes(t))throw Error(`${J} object contains circular references`);return new eW(t,e)}}let ej={null:new L($.null,null),undefined:new L($.undefined,void 0),true:new L($.true,!0),false:new L($.false,!1),emptyArray:new L($.array,0),emptyMap:new L($.map,0)},eH={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?e>=0?new L($.uint,e):new L($.negint,e):new L($.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new L($.uint,e):new L($.negint,e),Uint8Array:(e,t,n,r)=>new L($.bytes,e),string:(e,t,n,r)=>new L($.string,e),boolean:(e,t,n,r)=>e?ej.true:ej.false,null:(e,t,n,r)=>ej.null,undefined:(e,t,n,r)=>ej.undefined,ArrayBuffer:(e,t,n,r)=>new L($.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new L($.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[ej.emptyArray,new L($.break)]:ej.emptyArray;r=eW.createCheck(r,e);let i=[],a=0;for(let t of e)i[a++]=eG(t,n,r);return n.addBreakTokens?[new L($.array,e.length),i,new L($.break)]:[new L($.array,e.length),i]},Object(e,t,n,r){var i,a;let s="Object"!==t,o=s?e.keys():Object.keys(e),p=s?e.size:o.length;if(!p)return!0===n.addBreakTokens?[ej.emptyMap,new L($.break)]:ej.emptyMap;r=eW.createCheck(r,e);let d=[],u=0;for(let t of o)d[u++]=[eG(t,n,r),eG(s?e.get(t):e[t],n,r)];return(i=d,(a=n).mapSorter&&i.sort(a.mapSorter),n.addBreakTokens)?[new L($.map,p),d,new L($.break)]:[new L($.map,p),d]}};for(let e of(eH.Map=eH.Object,eH.Buffer=eH.Uint8Array,"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" ")))eH[`${e}Array`]=eH.DataView;function eG(e,t={},n){let r=function(e){var t;if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";let n=typeof e;if(k.includes(n))return n;if("function"===n)return"Function";if(Array.isArray(e))return"Array";if((t=e)&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t))return"Buffer";let r=function(e){let t=Object.prototype.toString.call(e).slice(8,-1);if(U.includes(t))return t}(e);return r||"Object"}(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||eH[r];if("function"==typeof i){let a=i(e,r,t,n);if(null!=a)return a}let a=eH[r];if(!a)throw Error(`${J} unsupported type: ${r}`);return a(e,r,t,n)}function eK(e,t,n){let r=eG(e,n);if(!Array.isArray(r)&&n.quickEncodeToken){let e=n.quickEncodeToken(r);if(e)return e;let i=t[r.type.major];if(i.encodedSize){let e=new X(i.encodedSize(r,n));if(i(e,r,n),1!==e.chunks.length)throw Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return V(e.chunks[0])}}return eV.reset(),!function e(t,n,r,i){if(Array.isArray(n))for(let a of n)e(t,a,r,i);else r[n.type.major](t,n,i)}(eV,r,t,n),eV.toBytes(!0)}Symbol.for("DONE"),Symbol.for("BREAK");let eq=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var a=e.charAt(i),s=a.charCodeAt(0);if(255!==n[s])throw TypeError(a+" is ambiguous");n[s]=i}var o=e.length,p=e.charAt(0),d=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var r=0,i=0;e[t]===p;)r++,t++;for(var a=(e.length-t)*d+1>>>0,s=new Uint8Array(a);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var l=0,y=a-1;(0!==u||l<i)&&-1!==y;y--,l++)u+=o*s[y]>>>0,s[y]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var c=a-i;c!==a&&0===s[c];)c++;for(var m=new Uint8Array(r+(a-c)),h=r;c!==a;)m[h++]=s[c++];return m}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,a=t.length;i!==a&&0===t[i];)i++,n++;for(var s=(a-i)*u+1>>>0,d=new Uint8Array(s);i!==a;){for(var l=t[i],y=0,c=s-1;(0!==l||y<r)&&-1!==c;c--,y++)l+=256*d[c]>>>0,d[c]=l%o>>>0,l=l/o>>>0;if(0!==l)throw Error("Non-zero carry");r=y,i++}for(var m=s-r;m!==s&&0===d[m];)m++;for(var h=p.repeat(n);m<s;++m)h+=e.charAt(d[m]);return h},decodeUnsafe:l,decode:function(e){var n=l(e);if(n)return n;throw Error(`Non-${t} character`)}}};class eY{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class eZ{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;const r=t.codePointAt(0);if(void 0===r)throw Error("Invalid prefix character");this.prefixCodePoint=r,this.baseDecode=n}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return eQ(this,e)}}class eX{decoders;constructor(e){this.decoders=e}or(e){return eQ(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function eQ(e,t){return new eX({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class eJ{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new eY(e,t,n),this.decoder=new eZ(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function e2({name:e,prefix:t,encode:n,decode:r}){return new eJ(e,t,n,r)}function e0({name:e,prefix:t,alphabet:n}){let{encode:r,decode:i}=eq(n,e);return e2({prefix:t,name:e,encode:r,decode:e=>A(i(e))})}function e5({name:e,prefix:t,bitsPerChar:n,alphabet:r}){let i=function(e){let t={};for(let n=0;n<e.length;++n)t[e[n]]=n;return t}(r);return e2({prefix:t,name:e,encode:e=>(function(e,t,n){let r="="===t[t.length-1],i=(1<<n)-1,a="",s=0,o=0;for(let r=0;r<e.length;++r)for(o=o<<8|e[r],s+=8;s>n;)s-=n,a+=t[i&o>>s];if(0!==s&&(a+=t[i&o<<n-s]),r)for(;(a.length*n&7)!=0;)a+="=";return a})(e,r,n),decode:t=>(function(e,t,n,r){let i=e.length;for(;"="===e[i-1];)--i;let a=new Uint8Array(i*n/8|0),s=0,o=0,p=0;for(let d=0;d<i;++d){let i=t[e[d]];if(void 0===i)throw SyntaxError(`Non-${r} character`);o=o<<n|i,(s+=n)>=8&&(s-=8,a[p++]=255&o>>s)}if(s>=n||(255&o<<8-s)!=0)throw SyntaxError("Unexpected end of data");return a})(t,i,n,e)})}let e6=e5({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});e5({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),e5({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),e5({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),e5({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),e5({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),e5({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),e5({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),e5({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});let e1=e0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"});e0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});let e3=e0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});e0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});function e8(e,t,n){t=t||[];for(var r=n=n||0;e>=0x80000000;)t[n++]=255&e|128,e/=128;for(;-128&e;)t[n++]=255&e|128,e>>>=7;return t[n]=0|e,e8.bytes=n-r+1,t}function e4(e,t){var n,r=0,t=t||0,i=0,a=t,s=e.length;do{if(a>=s)throw e4.bytes=0,RangeError("Could not decode varint");n=e[a++],r+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128)return e4.bytes=a-t,r}let e7=function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10};function e9(e,t=0){return[e4(e,t),e4.bytes]}function te(e,t,n=0){return e8(e,t,n),t}function tt(e){return e7(e)}function tn(e,t){let n=t.byteLength,r=e7(e),i=r+e7(n),a=new Uint8Array(i+n);return te(e,a,0),te(n,a,r),a.set(t,i),new ta(e,n,t,a)}function tr(e){let t=A(e),[n,r]=e9(t),[i,a]=e9(t.subarray(r)),s=t.subarray(r+a);if(s.byteLength!==i)throw Error("Incorrect length");return new ta(n,i,s,t)}function ti(e,t){return e===t||e.code===t.code&&e.size===t.size&&t.bytes instanceof Uint8Array&&I(e.bytes,t.bytes)}e.s(["decode",()=>e9,"encodeTo",()=>te,"encodingLength",()=>tt],554444);class ta{code;size;digest;bytes;constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}function ts(e,t){return e.code===t}function to(e,t){let{bytes:n,version:r}=e;return 0===r?function(e,t,n){let{prefix:r}=n;if(r!==e3.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);let i=t.get(r);if(null!=i)return i;{let i=n.encode(e).slice(1);return t.set(r,i),i}}(n,td(e),t??e3.encoder):function(e,t,n){let{prefix:r}=n,i=t.get(r);if(null!=i)return i;{let i=n.encode(e);return t.set(r,i),i}}(n,td(e),t??e6.encoder)}e.s(["Digest",()=>ta,"create",()=>tn,"decode",()=>tr,"equals",()=>ti,"hasCode",()=>ts],454617);let tp=new WeakMap;function td(e){let t=tp.get(e);if(null==t){let t=new Map;return tp.set(e,t),t}return t}class tu{code;version;multihash;bytes;"/";constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:t}=this;if(e!==tl)throw Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ty)throw Error("Cannot convert non sha2-256 multihash CID to CIDv0");return tu.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=tn(e,t);return tu.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return tu.equals(this,e)}static equals(e,t){return null!=t&&e.code===t.code&&e.version===t.version&&ti(e.multihash,t.multihash)}toString(e){return to(this,e)}toJSON(){return{"/":to(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;if(e instanceof tu)return e;if(null!=e["/"]&&e["/"]===e.bytes||e.asCID===e){let{version:t,code:n,multihash:r,bytes:i}=e;return new tu(t,n,r,i??tc(t,n,r.bytes))}if(!0!==e[tm])return null;{let{version:t,multihash:n,code:r}=e,i=tr(n);return tu.create(t,r,i)}}static create(e,t,n){if("number"!=typeof t)throw Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw Error("Invalid digest");switch(e){case 0:if(t===tl)return new tu(e,t,n,n.bytes);throw Error(`Version 0 CID must use dag-pb (code: ${tl}) block encoding`);case 1:{let r=tc(e,t,n.bytes);return new tu(e,t,n,r)}default:throw Error("Invalid version")}}static createV0(e){return tu.create(0,tl,e)}static createV1(e,t){return tu.create(1,e,t)}static decode(e){let[t,n]=tu.decodeFirst(e);if(0!==n.length)throw Error("Incorrect length");return t}static decodeFirst(e){let t=tu.inspectBytes(e),n=t.size-t.multihashSize,r=A(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw Error("Incorrect length");let i=r.subarray(t.multihashSize-t.digestSize),a=new ta(t.multihashCode,t.digestSize,i,r);return[0===t.version?tu.createV0(a):tu.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[n,r]=e9(e.subarray(t));return t+=r,n},r=n(),i=tl;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw RangeError(`Invalid CID version ${r}`);let a=t,s=n(),o=n(),p=t+o;return{version:r,codec:i,multihashCode:s,digestSize:o,multihashSize:p-a,size:p}}static parse(e,t){let[n,r]=function(e,t){switch(e[0]){case"Q":{let n=t??e3;return[e3.prefix,n.decode(`${e3.prefix}${e}`)]}case e3.prefix:{let n=t??e3;return[e3.prefix,n.decode(e)]}case e6.prefix:{let n=t??e6;return[e6.prefix,n.decode(e)]}case e1.prefix:{let n=t??e1;return[e1.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),i=tu.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return td(i).set(n,e),i}}let tl=112,ty=18;function tc(e,t,n){let r=e7(e),i=r+e7(t),a=new Uint8Array(i+n.byteLength);return te(e,a,0),te(t,a,r),a.set(n,i),a}let tm=Symbol.for("@ipld/js-cid/CID"),th={float64:!0,typeEncoders:{Map:function(e){for(let t of e.keys())if("string"!=typeof t||0===t.length)throw Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null},Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;let t=tu.asCID(e);if(!t)return null;let n=new Uint8Array(t.bytes.byteLength+1);return n.set(t.bytes,1),[new L($.tag,42),new L($.bytes,n)]},undefined:function(){throw Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};({...th,typeEncoders:{...th.typeEncoders}});let tf={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};function tg(e,t){return tu.create(1,e,t)}tf.tags[42]=function(e){if(0!==e[0])throw Error("Invalid CID for CBOR tag 42; expected leading 0x00");return tu.decode(e.subarray(1))},tf.tags.slice(),e.i(544661),e.i(605199),e.s(["code",0,18,"digest",0,N,"name",0,_,"size",0,32],824513),e.i(824513),e.s(["code",0,18,"digest",0,N,"name",0,_,"size",0,32],808800);var tv=e.i(808800),tv=tv;let tT=(e,t,n)=>{let r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),function(e,t={}){var n;let{digest:r}=(t.hasher||tv).digest(e);return n=r,n[g-1]&=63,n}(r,n)},tw=new class{constructor(){this.bytes=new Uint8Array(64*g),this.bytes.set(w,0),this.node=w,this.length=g}slice(e,t){for(;this.length<t;)this.node=tT(this.node,this.node),this.bytes.set(this.node,this.length),this.length+=g;return this.bytes.subarray(e,t)}},tb=e=>{if(e<0||e>=64)throw Error("Only levels between 0 and 63 inclusive are available");return tw.slice(g*e,g*(e+1))},tS=e=>{let t=e.length/g,n=Array(t);for(let r=0;r<t;r++){let t=r*g,i=e.subarray(t,t+g);n[r]=i}return n};function tP(e){let t=Math.max(e,T),n=Math.floor(Math.log2(t)),r=Math.ceil(f*2**(n+1));return t<=r?r:Math.ceil(f*2**(n+2))}let tI=e=>tP(e)/f,tA=(e,t=new Uint8Array(tI(e.length)))=>{let n=tP(e.byteLength)/127;for(let r=0;r<n;r++){let n=127*r,i=128*r;t.set(e.subarray(n,n+32),i),t[i+31]&=63;for(let r=32;r<64;r++)t[i+r]=e[n+r]<<2|e[n+r-1]>>6;t[i+63]&=63;for(let r=64;r<96;r++)t[i+r]=e[n+r]<<4|e[n+r-1]>>4;t[i+95]&=63;for(let r=96;r<127;r++)t[i+r]=e[n+r]<<6|e[n+r-1]>>2;t[i+127]=e[n+126]>>2}return t},tE=e=>e<=1n?0:(e=>{let t=0n;for(;e>>=1n;)t++;return Number(t)})(BigInt(e)-1n)+1,tx=e=>tD(e)*m,tC=e=>tD(e)*c,tD=e=>2n**BigInt(tE((e+m-1n)/m));e.s(["fromPiece",0,({height:e,padding:t})=>2n**BigInt(e-2)*m-t,"toExpanded",0,e=>tD(e)*h,"toHeight",0,e=>tE(tC(e)),"toPadded",0,tx,"toPadding",0,e=>tx(e)-e,"toWidth",0,tC],840769);let t_=e=>tR(2n**BigInt(e)),tR=e=>e*v;var tM=e.i(840769),tM=tM;function tN({name:e,code:t,encode:n,minDigestLength:r,maxDigestLength:i}){return new tk(e,t,n,r,i)}e.i(743482),e.i(454617);class tk{name;code;encode;minDigestLength;maxDigestLength;constructor(e,t,n,r,i){this.name=e,this.code=t,this.encode=n,this.minDigestLength=r??20,this.maxDigestLength=i}digest(e,t){if(t?.truncate!=null){if(t.truncate<this.minDigestLength)throw Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(null!=this.maxDigestLength&&t.truncate>this.maxDigestLength)throw Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){let n=this.encode(e);return n instanceof Uint8Array?tU(n,this.code,t?.truncate):n.then(e=>tU(e,this.code,t?.truncate))}throw Error("Unknown type, must be binary type")}}function tU(e,t,n){if(null!=n&&n!==e.byteLength){if(n>e.byteLength)throw Error(`Invalid truncate option, must be less than or equal to ${e.byteLength}`);e=e.subarray(0,n)}return tn(t,e)}e.s(["Hasher",()=>tk,"from",()=>tN],724159),e.i(724159);var t$=e.i(554444),tL=t$,tv=tv;let tF="fr32-sha2-256-trunc254-padded-binary-tree",tB=tv.size,tO=10+tv.size,tz=tL.encodingLength(4113),tV=tz+tL.encodingLength(tO)+tO,tW=t_(255)*BigInt(254)/BigInt(256),tj=e=>new tq(e),tH=({digest:e})=>{let[,t]=tL.decode(e);return e[t]},tG=({digest:e})=>{let[t]=tL.decode(e);return BigInt(t)},tK=({digest:e})=>{let[,t]=tL.decode(e);return e.subarray(t+1,t+1+tv.size)};class tq{constructor(e){this.bytes=e;const[t]=tL.decode(e);if(4113!==t)throw RangeError("Expected multihash with code 4113");let n=tz;const[r,i]=tL.decode(e,n);n+=i;const a=e.subarray(n);if(a.length!==r)throw RangeError(`Invalid multihash size expected ${n+r} bytes, got ${e.length} bytes`);this.digest=a}get name(){return tF}get code(){return 4113}get size(){return this.digest.length}get padding(){return tG(this)}get height(){return tH(this)}get root(){return tK(this)}}e.s(["HEIGHT_SIZE",0,1,"MAX_DIGEST_SIZE",0,tO,"MAX_HEIGHT",0,255,"MAX_PAYLOAD_SIZE",0,tW,"MAX_SIZE",0,tV,"ROOT_SIZE",0,tB,"TAG_SIZE",0,tz,"code",0,4113,"fromBytes",0,tj,"fromPiece",0,({padding:e,height:t,root:n})=>{let r=tL.encodingLength(Number(e)),i=r+1+tB,a=tL.encodingLength(i),s=0,o=new Uint8Array(tz+a+i);return tL.encodeTo(4113,o,s),s+=tz,tL.encodeTo(i,o,s),s+=a,tL.encodeTo(Number(e),o,s),o[s+=r]=t,s+=1,o.set(n,s),new tq(o)},"height",0,tH,"name",0,tF,"padding",0,tG,"root",0,tK,"toBytes",0,({digest:e})=>{let t=tL.encodingLength(e.length)+tz;if(e.byteOffset>=t){let n=new Uint8Array(e.buffer,e.byteOffset-t,e.byteOffset+e.length),[r,i]=tL.decode(n);if(4113===r&&tL.decode(n,i)[0]===e.length)return n}let n=new Uint8Array(e.length+t);return tL.encodeTo(4113,n),tL.encodeTo(e.length,n,tz),n.set(e,t),n}],235095),e.i(235095);var tL=t$;let tY=t_(255)*BigInt(254)/BigInt(256),tZ=()=>new tX;class tX{constructor(){this.bytesWritten=0n,this.buffer=new Uint8Array(127),this.offset=0,this.layers=[[]]}count(){return this.bytesWritten}digest(){let e=new Uint8Array(tV),t=this.digestInto(e,0,!0);return tj(e.subarray(0,t))}digestInto(e,t=0,n=!0){let{buffer:r,layers:i,offset:a,bytesWritten:s}=this,[o,...p]=i;(a>0||0n===s)&&(o=[...o,...tS(tA(r.fill(0,a)))]);let d=tJ([o,...p]),u=d.length-1,[l]=d[u],y=Number(tM.toPadding(this.bytesWritten)),c=tL.encodingLength(y),m=t;if(n){tL.encodeTo(4113,e,m),m+=tz;let t=c+1+tB,n=tL.encodingLength(t);tL.encodeTo(t,e,m),m+=n}return tL.encodeTo(y,e,m),e[m+=c]=u,m+=1,e.set(l,m),(m+=l.length)-t}write(e){let{buffer:t,offset:n,layers:r}=this,i=r[0],{length:a}=e;if(0===a)return this;if(this.bytesWritten+BigInt(a)>tY)throw RangeError(`Writing ${a} bytes exceeds max payload size of ${tY}`);if(n+a<t.length)return t.set(e,n),this.offset+=a,this.bytesWritten+=BigInt(a),this;{let r=t.length-n;t.set(e.subarray(0,r),n),i.push(...tS(tA(t)));let s=r;for(;s+127<a;){let t=e.subarray(s,s+127);i.push(...tS(tA(t))),s+=127}return this.buffer.set(e.subarray(s),0),this.offset=a-s,this.bytesWritten+=BigInt(a),tQ(this.layers),this}}reset(){return this.offset=0,this.bytesWritten=0n,this.layers.length=1,this.layers[0].length=0,this}dispose(){this.reset()}get code(){return 4113}get name(){return"fr32-sha2-256-trunc254-padded-binary-tree"}}let tQ=e=>t2(e,!1),tJ=e=>t2([...e],!0),t2=(e,t)=>{let n=0;for(;n<e.length;){let r=e[n+1],i=e[n];t&&i.length%2>0&&r&&i.push(tb(n)),n+=1,r=r?t?[...r]:r:[];let a=0;for(;a+1<i.length;){let e=tT(i[a],i[a+1]);delete i[a],delete i[a+1],r.push(e),a+=2}r.length&&(e[n]=r),i.splice(0,a)}return e};var tM=tM,t0=e.i(541116);function t5(e){return 85===e.code&&4113===e.multihash.code}function t6(e){if(null==e)return null;if("string"==typeof e){try{let t=tu.parse(e);if(t5(t))return t}catch{}return null}return"object"==typeof e&&null!==e&&null!==tu.asCID(e)&&t5(e)?e:null}function t1(e){try{var t;let n=tu.parse(e).toV1();if(t=n,"object"!=typeof t||null==tu.asCID(t)||85!==t.code||4113!==t.multihash.code)throw Error("Invalid PieceCID: input must be a valid PieceCIDv2");return n}catch{throw Error(`Invalid CID string: ${e}`)}}function t3(){let e=tZ(),t=!1,n=null;return{stream:new TransformStream({transform(t,n){e.write(t),n.enqueue(t)},flush(){n=tg(85,e.digest()),t=!0}}),getPieceCID:()=>t?n:null}}async function*t8(e,t=2048){for(let n=0;n<e.length;n+=t)yield e.subarray(n,n+t)}async function t4(e,t){let n=t6(t);if(null==n)throw Error(`Invalid PieceCID: ${String(t)}`);if(!e.ok)throw Error(`Download failed: ${e.status} ${e.statusText}`);if(null==e.body)throw Error("Response body is null");let{stream:r,getPieceCID:i}=t3(),a=[],s=new TransformStream({transform(e,t){a.push(e),t.enqueue(e)}}),o=e.body.pipeThrough(r).pipeThrough(s).getReader();try{for(;;){let{done:e}=await o.read();if(e)break}}finally{o.releaseLock()}if(0===a.length)throw Error("Response body is empty");let p=i();if(null==p)throw Error("Failed to calculate PieceCID from stream");if(p.toString()!==n.toString())throw Error(`PieceCID verification failed. Expected: ${String(n)}, Got: ${String(p)}`);let d=new Uint8Array(a.reduce((e,t)=>e+t.length,0)),u=0;for(let e of a)d.set(e,u),u+=e.length;return d}let t7={USDFC:"USDFC",FIL:"FIL"},t9={mainnet:314,calibration:314159},ne={ERC20:s.erc20Abi,ERC20_PERMIT:o,PAYMENTS:p,PDP_VERIFIER:u,WARM_STORAGE:y,WARM_STORAGE_VIEW:d,MULTICALL3:s.multicall3Abi,SERVICE_PROVIDER_REGISTRY:l,SESSION_KEY_REGISTRY:[{type:"function",inputs:[{name:"user",internalType:"address",type:"address"},{name:"signer",internalType:"address",type:"address"},{name:"permission",internalType:"bytes32",type:"bytes32"}],name:"authorizationExpiry",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"login",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"signer",internalType:"address payable",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"loginAndFund",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"},{name:"origin",internalType:"string",type:"string"}],name:"revoke",outputs:[],stateMutability:"nonpayable"},{type:"event",anonymous:!1,inputs:[{name:"identity",internalType:"address",type:"address",indexed:!0},{name:"signer",internalType:"address",type:"address",indexed:!1},{name:"expiry",internalType:"uint256",type:"uint256",indexed:!1},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]",indexed:!1},{name:"origin",internalType:"string",type:"string",indexed:!1}],name:"AuthorizationsUpdated"}]},nt={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},nn={EPOCH_DURATION:30,EPOCHS_PER_DAY:2880n,EPOCHS_PER_MONTH:86400n,DAYS_PER_MONTH:30n,DEFAULT_LOCKUP_DAYS:30n},nr={mainnet:0x5f443860,calibration:0x636161ac},ni={KiB:1024n,MiB:1n<<20n,GiB:1n<<30n,TiB:1n<<40n,PiB:1n<<50n,MAX_UPLOAD_SIZE:0x3f800000,MIN_UPLOAD_SIZE:127,DEFAULT_UPLOAD_BATCH_SIZE:32},na={WITH_CDN:"withCDN",WITH_IPFS_INDEXING:"withIPFSIndexing",IPFS_ROOT_CID:"ipfsRootCID"},ns={TRANSACTION_PROPAGATION_TIMEOUT_MS:18e4,TRANSACTION_PROPAGATION_POLL_INTERVAL_MS:2e3,DATA_SET_CREATION_TIMEOUT_MS:42e4,DATA_SET_CREATION_POLL_INTERVAL_MS:2e3,PIECE_PARKING_TIMEOUT_MS:42e4,PIECE_PARKING_POLL_INTERVAL_MS:5e3,TRANSACTION_CONFIRMATIONS:1,PERMIT_DEADLINE_DURATION:3600,PIECE_ADDITION_TIMEOUT_MS:42e4,PIECE_ADDITION_POLL_INTERVAL_MS:1e3},no={mainnet:{http:"https://api.node.glif.io/rpc/v1",websocket:"wss://wss.node.glif.io/apigw/lotus/rpc/v1"},calibration:{http:"https://api.calibration.node.glif.io/rpc/v1",websocket:"wss://wss.calibration.node.glif.io/apigw/lotus/rpc/v1"}},np={WARM_STORAGE:{mainnet:"0x8408502033C418E1bbC97cE9ac48E5528F371A9f",calibration:"0x02925630df557F957f70E112bA06e50965417CA0"},MULTICALL3:{mainnet:"0xcA11bde05977b3631167028862bE2a173976CA11",calibration:"0xcA11bde05977b3631167028862bE2a173976CA11"},USDFC:{mainnet:"0x80B98d3aa09ffff255c3ba4A241111Ff1262F045",calibration:"0xb3042734b608a1B16e9e86B374A3f3e389B4cDf0"}};e.s(["CHAIN_IDS",0,t9,"CONTRACT_ABIS",0,ne,"CONTRACT_ADDRESSES",0,np,"EIP2612_PERMIT_TYPES",0,nt,"GENESIS_TIMESTAMPS",0,nr,"METADATA_KEYS",0,na,"RPC_URLS",0,no,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ni,"TIME_CONSTANTS",0,nn,"TIMING_CONSTANTS",0,ns,"TOKENS",0,t7],34237),e.i(445598),e.i(401538),"function"==typeof Uint8Array.from([]).toHex&&Uint8Array.fromHex;class nd extends Error{constructor(e,t={}){const n=(()=>{if(t.cause instanceof nd){if(t.cause.details)return t.cause.details;if(t.cause.shortMessage)return t.cause.shortMessage}return t.cause&&"details"in t.cause&&"string"==typeof t.cause.details?t.cause.details:t.cause?.message?t.cause.message:t.details})(),r=t.cause instanceof nd&&t.cause.docsPath||t.docsPath,i=t.docsOrigin??"https://oxlib.sh",a=`${i}${r??""}`;super([e||"An error occurred.",...t.metaMessages?["",...t.metaMessages]:[],...n||r||t.version?["",n?`Details: ${n}`:void 0,r?`See: ${a}`:void 0,t.version?`Version: ${t.version}`:void 0]:[]].filter(e=>"string"==typeof e).join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.cause=t.cause,this.details=n,this.docs=a,this.docsPath=r,this.shortMessage=e,this.version=t.version??"ox@0.1.1"}walk(e){return function e(t,n){return n?.(t)?t:t&&"object"==typeof t&&"cause"in t&&t.cause?e(t.cause,n):n?null:t}(this,e)}}function nu(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function nl(e,t){if(nP(e)>t)throw new nA({givenSize:nP(e),maxSize:t})}function ny(e,t={}){let{dir:n,size:r=32}=t;if(0===r)return e;let i=e.replace("0x","");if(i.length>2*r)throw new nx({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i["right"===n?"padEnd":"padStart"](2*r,"0")}`}function nc(e,t,n){return JSON.stringify(e,(e,n)=>"function"==typeof t?t(e,n):"bigint"==typeof n?n.toString()+"#__bigint":n,n)}let nm=new TextEncoder,nh=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function nf(...e){return`0x${e.reduce((e,t)=>e+t.replace("0x",""),"")}`}function ng(e,t={}){let n=`0x${Number(e)}`;return"number"==typeof t.size?(nl(n,t.size),nb(n,t.size)):n}function nv(e,t={}){let n="";for(let t=0;t<e.length;t++)n+=nh[e[t]];let r=`0x${n}`;return"number"==typeof t.size?(nl(r,t.size),nS(r,t.size)):r}function nT(e,t={}){let n,{signed:r,size:i}=t,a=BigInt(e);i?n=r?(1n<<8n*BigInt(i)-1n)-1n:2n**(8n*BigInt(i))-1n:"number"==typeof e&&(n=BigInt(Number.MAX_SAFE_INTEGER));let s="bigint"==typeof n&&r?-n-1n:0;if(n&&a>n||a<s){let t="bigint"==typeof e?"n":"";throw new nI({max:n?`${n}${t}`:void 0,min:`${s}${t}`,signed:r,size:i,value:`${e}${t}`})}let o=(r&&a<0?BigInt.asUintN(8*i,BigInt(a)):a).toString(16),p=`0x${o}`;return i?nb(p,i):p}function nw(e,t={}){return nv(nm.encode(e),t)}function nb(e,t){return ny(e,{dir:"left",size:t})}function nS(e,t){return ny(e,{dir:"right",size:t})}function nP(e){return Math.ceil((e.length-2)/2)}class nI extends nd{constructor({max:e,min:t,signed:n,size:r,value:i}){super(`Number \`${i}\` is not in safe${r?` ${8*r}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${t}\` to \`${e}\`)`:`(above \`${t}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class nA extends nd{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class nE extends nd{constructor({offset:e,position:t,size:n}){super(`Slice ${"start"===t?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class nx extends nd{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let nC=new TextEncoder;function nD(e,t={}){let{size:n}=t,r=nC.encode(e);if("number"==typeof n){var i;if(r.length>n)throw new n_({givenSize:r.length,maxSize:n});return i=r,function(e,t={}){let{dir:n,size:r=32}=t;if(0===r)return e;if(e.length>r)throw new nR({size:e.length,targetSize:r,type:"Bytes"});let i=new Uint8Array(r);for(let t=0;t<r;t++){let a="right"===n;i[a?t:r-t-1]=e[a?t:e.length-t-1]}return i}(i,{dir:"right",size:n})}return r}class n_ extends nd{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class nR extends nd{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}class nM extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}let nN={checksum:new nM(8192)}.checksum;function nk(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function nU(e,...t){if(!(e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function n$(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function nL(e,t){nU(e);let n=t.outputLen;if(e.length<n)throw Error("digestInto() expects output buffer of length at least "+n)}function nF(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let nB=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?e=>e:function(e){for(let n=0;n<e.length;n++){var t;e[n]=(t=e[n])<<24&0xff000000|t<<8&0xff0000|t>>>8&65280|t>>>24&255}return e};function nO(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e)),nU(e),e}class nz{}let nV=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),nW=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),nj=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),nH=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),nG=Uint32Array.from([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0]),nK=new Uint32Array(80);(e,t)=>Math.floor(0x100000000*Math.abs(Math.sin(t+1)));let nq=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),nY=Uint8Array.from(Array(16).fill(0).map((e,t)=>t)),nZ=nY.map(e=>(9*e+5)%16),nX=(()=>{let e=[[nY],[nZ]];for(let t=0;t<4;t++)for(let n of e)n.push(n[t].map(e=>nq[e]));return e})(),nQ=nX[0],nJ=nX[1],n2=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(e=>Uint8Array.from(e)),n0=nQ.map((e,t)=>e.map(e=>n2[t][e])),n5=nJ.map((e,t)=>e.map(e=>n2[t][e])),n6=Uint32Array.from([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),n1=Uint32Array.from([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]),n3=BigInt(0x100000000-1),n8=BigInt(32);function n4(e,t=!1){let n=e.length,r=new Uint32Array(n),i=new Uint32Array(n);for(let a=0;a<n;a++){let{h:n,l:s}=function(e,t=!1){return t?{h:Number(e&n3),l:Number(e>>n8&n3)}:{h:0|Number(e>>n8&n3),l:0|Number(e&n3)}}(e[a],t);[r[a],i[a]]=[n,s]}return[r,i]}let n7=BigInt(0),n9=BigInt(1),re=BigInt(2),rt=BigInt(7),rn=BigInt(256),rr=BigInt(113),ri=[],ra=[],rs=[];for(let e=0,t=n9,n=1,r=0;e<24;e++){[n,r]=[r,(2*n+3*r)%5],ri.push(2*(5*r+n)),ra.push((e+1)*(e+2)/2%64);let i=n7;for(let e=0;e<7;e++)(t=(t<<n9^(t>>rt)*rr)%rn)&re&&(i^=n9<<(n9<<BigInt(e))-n9);rs.push(i)}let ro=n4(rs,!0),rp=ro[0],rd=ro[1],ru=(e,t,n)=>n>32?t<<n-32|e>>>64-n:e<<n|t>>>32-n,rl=(e,t,n)=>n>32?e<<n-32|t>>>64-n:t<<n|e>>>32-n;class ry extends nz{constructor(e,t,n,r=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=r,this.rounds=i,nk(n),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}(this.state)}clone(){return this._cloneInto()}keccak(){nB(this.state32),function(e,t=24){let n=new Uint32Array(10);for(let r=24-t;r<24;r++){for(let t=0;t<10;t++)n[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let r=(t+8)%10,i=(t+2)%10,a=n[i],s=n[i+1],o=ru(a,s,1)^n[r],p=rl(a,s,1)^n[r+1];for(let n=0;n<50;n+=10)e[t+n]^=o,e[t+n+1]^=p}let t=e[2],i=e[3];for(let n=0;n<24;n++){let r=ra[n],a=ru(t,i,r),s=rl(t,i,r),o=ri[n];t=e[o],i=e[o+1],e[o]=a,e[o+1]=s}for(let t=0;t<50;t+=10){for(let r=0;r<10;r++)n[r]=e[t+r];for(let r=0;r<10;r++)e[t+r]^=~n[(r+2)%10]&n[(r+4)%10]}e[0]^=rp[r],e[1]^=rd[r]}nF(n)}(this.state32,this.rounds),nB(this.state32),this.posOut=0,this.pos=0}update(e){n$(this),nU(e=nO(e));let{blockLen:t,state:n}=this,r=e.length;for(let i=0;i<r;){let a=Math.min(t-this.pos,r-i);for(let t=0;t<a;t++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:n,blockLen:r}=this;e[n]^=t,(128&t)!=0&&n===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){n$(this,!1),nU(e),this.finish();let t=this.state,{blockLen:n}=this;for(let r=0,i=e.length;r<i;){this.posOut>=n&&this.keccak();let a=Math.min(n-this.posOut,i-r);e.set(t.subarray(this.posOut,this.posOut+a),r),this.posOut+=a,r+=a}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return nk(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(nL(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,nF(this.state)}_cloneInto(e){let{blockLen:t,suffix:n,outputLen:r,rounds:i,enableXOF:a}=this;return e||(e=new ry(t,n,r,a,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=r,e.enableXOF=a,e.destroyed=this.destroyed,e}}let rc=(i=()=>new ry(136,1,32),(n=e=>i().update(nO(e)).digest()).outputLen=(r=i()).outputLen,n.blockLen=r.blockLen,n.create=()=>i(),n),rm=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),rh=new Uint32Array(64),rf=n4(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),rg=rf[0],rv=rf[1],rT=new Uint32Array(80),rw=new Uint32Array(80);function rb(e,t={}){var n;let{as:r="string"==typeof e?"Hex":"Bytes"}=t,i=rc(e instanceof Uint8Array?e:"string"==typeof e?function(e,t={}){let{size:n}=t,r=e;n&&(nl(e,n),r=nS(e,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);let a=i.length/2,s=new Uint8Array(a);for(let e=0,t=0;e<a;e++){let n=nu(i.charCodeAt(t++)),r=nu(i.charCodeAt(t++));if(void 0===n||void 0===r)throw new nd(`Invalid byte sequence ("${i[t-2]}${i[t-1]}" in "${i}").`);s[e]=n<<4|r}return s}(e):(n=e)instanceof Uint8Array?n:new Uint8Array(n));return"Bytes"===r?i:nv(i)}let rS=/^0x[a-fA-F0-9]{40}$/;function rP(e,t={}){let{strict:n=!0}=t;if(!rS.test(e))throw new rI({address:e,cause:new rA});if(n){if(e.toLowerCase()===e)return;if(function(e){if(nN.has(e))return nN.get(e);rP(e,{strict:!1});let t=e.substring(2).toLowerCase(),n=rb(nD(t),{as:"Bytes"}),r=t.split("");for(let e=0;e<40;e+=2)n[e>>1]>>4>=8&&r[e]&&(r[e]=r[e].toUpperCase()),(15&n[e>>1])>=8&&r[e+1]&&(r[e+1]=r[e+1].toUpperCase());let i=`0x${r.join("")}`;return nN.set(e,i),i}(e)!==e)throw new rI({address:e,cause:new rE})}}class rI extends nd{constructor({address:e,cause:t}){super(`Address "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class rA extends nd{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class rE extends nd{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}let rx=/^(.*)\[([0-9]*)\]$/,rC=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,rD=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function r_(e){let t=0;for(let n=0;n<e.length;n++){let{dynamic:r,encoded:i}=e[n];r?t+=32:t+=nP(i)}let n=[],r=[],i=0;for(let a=0;a<e.length;a++){let{dynamic:s,encoded:o}=e[a];s?(n.push(nT(t+i,{size:32})),r.push(o),i+=nP(o)):n.push(o)}return nf(...n,...r)}function rR(e,t,n){let{checksumAddress:r=!1}=n??{};if(e.length!==t.length)throw new rU({expectedLength:e.length,givenLength:t.length});let i=r_(function({checksumAddress:e,parameters:t,values:n}){let r=[];for(let i=0;i<t.length;i++)r.push(function e({checksumAddress:t=!1,parameter:n,value:r}){let i,a=(i=n.type.match(/^(.*)\[(\d+)?\]$/))?[i[2]?Number(i[2]):null,i[1]]:void 0;if(a){let[i,s]=a;return function(t,n){let{checksumAddress:r,length:i,parameter:a}=n,s=null===i;if(!Array.isArray(t))throw new r$(t);if(!s&&t.length!==i)throw new rN({expectedLength:i,givenLength:t.length,type:`${a.type}[${i}]`});let o=!1,p=[];for(let n=0;n<t.length;n++){let i=e({checksumAddress:r,parameter:a,value:t[n]});i.dynamic&&(o=!0),p.push(i)}if(s||o){let e=r_(p);if(s){let t=nT(p.length,{size:32});return{dynamic:!0,encoded:p.length>0?nf(t,e):t}}if(o)return{dynamic:!0,encoded:e}}return{dynamic:!1,encoded:nf(...p.map(({encoded:e})=>e))}}(r,{checksumAddress:t,length:i,parameter:{...n,type:s}})}if("tuple"===n.type)return function(t,n){let{checksumAddress:r,parameter:i}=n,a=!1,s=[];for(let n=0;n<i.components.length;n++){let o=i.components[n],p=Array.isArray(t)?n:o.name,d=e({checksumAddress:r,parameter:o,value:t[p]});s.push(d),d.dynamic&&(a=!0)}return{dynamic:a,encoded:a?r_(s):nf(...s.map(({encoded:e})=>e))}}(r,{checksumAddress:t,parameter:n});if("address"===n.type)return function(e,t){let{checksum:n=!1}=t;return rP(e,{strict:n}),{dynamic:!1,encoded:nb(e.toLowerCase())}}(r,{checksum:t});if("bool"===n.type){var s=r;if("boolean"!=typeof s)throw new nd(`Invalid boolean value: "${s}" (type: ${typeof s}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:nb(ng(s))}}if(n.type.startsWith("uint")||n.type.startsWith("int")){let e=n.type.startsWith("int"),[,,t="256"]=rD.exec(n.type)??[];return function(e,{signed:t,size:n}){if("number"==typeof n){let r=2n**(BigInt(n)-(t?1n:0n))-1n,i=t?-r-1n:0n;if(e>r||e<i)throw new nI({max:r.toString(),min:i.toString(),signed:t,size:n/8,value:e.toString()})}return{dynamic:!1,encoded:nT(e,{size:32,signed:t})}}(r,{signed:e,size:Number(t)})}if(n.type.startsWith("bytes"))return function(e,{type:t}){let[,n]=t.split("bytes"),r=nP(e);if(!n){let t=e;return r%32!=0&&(t=nS(t,32*Math.ceil((e.length-2)/2/32))),{dynamic:!0,encoded:nf(nb(nT(r,{size:32})),t)}}if(r!==Number.parseInt(n,10))throw new rk({expectedSize:Number.parseInt(n,10),value:e});return{dynamic:!1,encoded:nS(e)}}(r,{type:n.type});if("string"===n.type){var o=r;let e=nw(o),t=Math.ceil(nP(e)/32),n=[];for(let r=0;r<t;r++)n.push(nS(function(e,t,n,r={}){let{strict:i}=r;if("number"==typeof t&&t>0&&t>nP(e)-1)throw new nE({offset:t,position:"start",size:nP(e)});let a=`0x${e.replace("0x","").slice((t??0)*2,(n??e.length)*2)}`;return i&&function(e,t,n){if("number"==typeof t&&"number"==typeof n&&nP(e)!==n-t)throw new nE({offset:n,position:"end",size:nP(e)})}(a,t,n),a}(e,32*r,(r+1)*32)));return{dynamic:!0,encoded:nf(nS(nT(nP(e),{size:32})),...n)}}throw new rL(n.type)}({checksumAddress:e,parameter:t[i],value:n[i]}));return r}({checksumAddress:r,parameters:e,values:t}));return 0===i.length?"0x":i}function rM(e,t){if(e.length!==t.length)throw new rU({expectedLength:e.length,givenLength:t.length});let n=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[r];n.push(rM.encode(i,a))}return nf(...n)}new Uint8Array,new DataView(new ArrayBuffer(0)),(rM||(rM={})).encode=function e(t,n,r=!1){if("address"===t)return rP(n),nb(n.toLowerCase(),32*!!r);if("string"===t)return nw(n);if("bytes"===t)return n;if("bool"===t)return nb(ng(n),r?32:1);let i=t.match(rD);if(i){let[e,t,a="256"]=i,s=Number.parseInt(a,10)/8;return nT(n,{size:r?32:s,signed:"int"===t})}let a=t.match(rC);if(a){let[e,t]=a;if(Number.parseInt(t,10)!==(n.length-2)/2)throw new rk({expectedSize:Number.parseInt(t,10),value:n});return nS(n,32*!!r)}let s=t.match(rx);if(s&&Array.isArray(n)){let[t,r]=s,i=[];for(let t=0;t<n.length;t++)i.push(e(r,n[t],!0));return 0===i.length?"0x":nf(...i)}throw new rL(t)};class rN extends nd{constructor({expectedLength:e,givenLength:t,type:n}){super(`Array length mismatch for type \`${n}\`. Expected: \`${e}\`. Given: \`${t}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}class rk extends nd{constructor({expectedSize:e,value:t}){super(`Size of bytes "${t}" (bytes${nP(t)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class rU extends nd{constructor({expectedLength:e,givenLength:t}){super(`ABI encoding parameters/values length mismatch.
Expected length (parameters): ${e}
Given length (values): ${t}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class r$ extends nd{constructor(e){super(`Value \`${e}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class rL extends nd{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}function rF(e){let{domain:t,message:n,primaryType:r,types:i}=e,a=(e,t)=>{for(let n of e){let{name:e,type:r}=n,s=t[e],o=r.match(rD);if(o&&("number"==typeof s||"bigint"==typeof s)){let[,e,t]=o;nT(s,{signed:"int"===e,size:Number.parseInt(t??"",10)/8})}if("address"===r&&"string"==typeof s&&!function(e,t={}){let{strict:n=!0}=t??{};try{return rP(e,{strict:n}),!0}catch{return!1}}(s))throw new rI({address:s,cause:new rA});let p=r.match(rC);if(p){let[,e]=p;if(e&&nP(s)!==Number.parseInt(e,10))throw new rq({expectedSize:Number.parseInt(e,10),givenSize:nP(s)})}let d=i[r];d&&(function(e){if("address"===e||"bool"===e||"string"===e||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new rX({type:e})}(r),a(d,s))}};if(i.EIP712Domain&&t){if("object"!=typeof t)throw new rY({domain:t});a(i.EIP712Domain,t)}if("EIP712Domain"!==r)if(i[r])a(i[r],n);else throw new rZ({primaryType:r,types:i})}function rB(e){return rj({domain:e})}function rO(e){let{domain:t={},message:n,primaryType:r}=e,i={EIP712Domain:rV(t),...e.types};rF({domain:t,message:n,primaryType:r,types:i});let a=["0x19","0x01"];return t&&a.push(rj({domain:t,types:i})),"EIP712Domain"!==r&&a.push(rH({data:n,primaryType:r,types:i})),nf(...a)}function rz(e){let{primaryType:t,types:n}=e,r="",i=r0({primaryType:t,types:n});for(let e of(i.delete(t),[t,...Array.from(i).sort()]))r+=`${e}(${(n[e]??[]).map(({name:e,type:t})=>`${t} ${e}`).join(",")})`;return r}function rV(e){return["string"==typeof e?.name&&{name:"name",type:"string"},e?.version&&{name:"version",type:"string"},("number"==typeof e?.chainId||"bigint"==typeof e?.chainId)&&{name:"chainId",type:"uint256"},e?.verifyingContract&&{name:"verifyingContract",type:"address"},e?.salt&&{name:"salt",type:"bytes32"}].filter(Boolean)}function rW(e){return rb(rO(e))}function rj(e){let{domain:t,types:n}=e;return rH({data:t,primaryType:"EIP712Domain",types:{...n,EIP712Domain:n?.EIP712Domain||rV(t)}})}function rH(e){let{data:t,primaryType:n,types:r}=e;return rb(rQ({data:t,primaryType:n,types:r}))}function rG(e){let{domain:t,message:n,primaryType:r,types:i}=e,a=(e,t)=>{let n={...t};for(let t of e){let{name:e,type:r}=t;"address"===r&&(n[e]=n[e].toLowerCase())}return n};return nc({domain:t?a(i.EIP712Domain??rV(t),t):{},message:(()=>{if("EIP712Domain"!==r)return i[r]?a(i[r],n):{}})(),primaryType:r,types:i},(e,t)=>"bigint"==typeof t?t.toString():t)}function rK(e){try{return rF(e),!0}catch{return!1}}class rq extends nd{constructor({expectedSize:e,givenSize:t}){super(`Expected bytes${e}, got bytes${t}.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.BytesSizeMismatchError"})}}class rY extends nd{constructor({domain:e}){super(`Invalid domain "${nc(e)}".`,{metaMessages:["Must be a valid EIP-712 domain."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidDomainError"})}}class rZ extends nd{constructor({primaryType:e,types:t}){super(`Invalid primary type \`${e}\` must be one of \`${JSON.stringify(Object.keys(t))}\`.`,{metaMessages:["Check that the primary type is a key in `types`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidPrimaryTypeError"})}}class rX extends nd{constructor({type:e}){super(`Struct type "${e}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidStructTypeError"})}}function rQ(e){let{data:t,primaryType:n,types:r}=e,i=[{type:"bytes32"}],a=[rJ({primaryType:n,types:r})];for(let e of r[n]??[]){let[n,s]=r2({types:r,name:e.name,type:e.type,value:t[e.name]});i.push(n),a.push(s)}return rR(i,a)}function rJ(e){let{primaryType:t,types:n}=e;return rb(nw(rz({primaryType:t,types:n})))}function r2(e){let{types:t,name:n,type:r,value:i}=e;if(void 0!==t[r])return[{type:"bytes32"},rb(rQ({data:i,primaryType:r,types:t}))];if("bytes"===r){let e=i.length%2?"0":"";return[{type:"bytes32"},rb(i=`0x${e+i.slice(2)}`,{as:"Hex"})]}if("string"===r)return[{type:"bytes32"},rb(nD(i),{as:"Hex"})];if(r.lastIndexOf("]")===r.length-1){let e=r.slice(0,r.lastIndexOf("[")),a=i.map(r=>r2({name:n,type:e,types:t,value:r}));return[{type:"bytes32"},rb(rR(a.map(([e])=>e),a.map(([,e])=>e)))]}return[{type:r},i]}function r0(e,t=new Set){let{primaryType:n,types:r}=e,i=n.match(/^\w*/u),a=i?.[0];if(t.has(a)||void 0===r[a])return t;for(let e of(t.add(a),r[a]))r0({primaryType:e.type,types:r},t);return t}e.s(["BytesSizeMismatchError",()=>rq,"InvalidDomainError",()=>rY,"InvalidPrimaryTypeError",()=>rZ,"InvalidStructTypeError",()=>rX,"assert",()=>rF,"domainSeparator",()=>rB,"encode",()=>rO,"encodeData",()=>rQ,"encodeField",()=>r2,"encodeType",()=>rz,"extractEip712DomainTypes",()=>rV,"findTypeDependencies",()=>r0,"getSignPayload",()=>rW,"hashDomain",()=>rj,"hashStruct",()=>rH,"hashType",()=>rJ,"serialize",()=>rG,"validate",()=>rK],719077);var r5=e.i(719077),r5=r5,r6=e.i(736777),r1=e.i(884735);let r3={MetadataEntry:[{name:"key",type:"string"},{name:"value",type:"string"}],CreateDataSet:[{name:"clientDataSetId",type:"uint256"},{name:"payee",type:"address"},{name:"metadata",type:"MetadataEntry[]"}],Cid:[{name:"data",type:"bytes"}],PieceMetadata:[{name:"pieceIndex",type:"uint256"},{name:"metadata",type:"MetadataEntry[]"}],AddPieces:[{name:"clientDataSetId",type:"uint256"},{name:"nonce",type:"uint256"},{name:"pieceData",type:"Cid[]"},{name:"pieceMetadata",type:"PieceMetadata[]"}],SchedulePieceRemovals:[{name:"clientDataSetId",type:"uint256"},{name:"pieceIds",type:"uint256[]"}],DeleteDataSet:[{name:"clientDataSetId",type:"uint256"}]},r8={},r4={};for(let e in r3){let t=r5.encodeType({types:r3,primaryType:e});r8[e]=t,r4[e]=(0,r6.keccak256)((0,r1.stringToHex)(t))}e.s(["calculateLastProofDate",()=>ig,"dateToEpoch",()=>ic,"epochToDate",()=>iy,"getCurrentEpoch",()=>iv,"getGenesisTimestamp",()=>im,"timeUntilEpoch",()=>ih],805462);var r7=e.i(479801);let r9=e.i(278721).default.version,ie=void 0!==globalThis.window&&void 0!==globalThis.document;async function it(){try{return await e.A(873733)}catch{return null}}let ir=[[/\?.+/,""],[/\/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/gi,"/<UUID>"],[/\/baf[a-z0-9]{50,}/g,"/<CID>"],[/\/0x[a-f0-9]{16,}/gi,"/<txHash>"],[/\/[0-9]+\b/g,"/<ID>"]];function ii(e){let t=e;for(let[e,n]of ir)t=t.replace(e,n);return t}class ia{eventBuffer=[];maxBufferSize=15;sentry=null;async initSentry(e,t){let n,r=await it();if(!r)return;this.sentry=r;let i=[r.dedupeIntegration()];ie?(n="browser",i.push(r.globalHandlersIntegration({onerror:!0,onunhandledrejection:!0}))):(n="node",i.push(r.onUncaughtExceptionIntegration(),r.onUnhandledRejectionIntegration()));let a={...e.sentrySetTags,filecoinNetwork:t.filecoinNetwork,synapseSdkVersion:`@filoz/synapse-sdk@v${r9}`};this.sentry.init({dsn:"https://7a07cc9e3b5bf5a8fada2f25dc76cd49@o4510235322023936.ingest.us.sentry.io/4510308233445376",sendDefaultPii:!1,tracesSampleRate:1,integrations:i,defaultIntegrations:!1,...e.sentryInitOptions,beforeSend:this.createBeforeSend(e),beforeSendSpan:this.createBeforeSendSpan(e,a),release:`@filoz/synapse-sdk@v${r9}`}),this.sentry.setContext("runtime",{type:n,userAgent:ie&&"navigator"in globalThis?globalThis.navigator.userAgent:void 0}),this.sentry.setTags(a)}createBeforeSend(e){return async(t,n)=>(this.addToEventBuffer(t),e.sentryInitOptions?.beforeSend!=null)?await e.sentryInitOptions.beforeSend(t,n):t}createBeforeSendSpan(e,t){let n=/^(GET|POST|PUT|PATCH|DELETE|HEAD|OPTIONS|TRACE|CONNECT)\s/i;return r=>{let i=r;if(e.sentryInitOptions?.beforeSendSpan!=null){let t=e.sentryInitOptions.beforeSendSpan(r);null!=t&&(i=t)}return i.description&&n.test(i.description)&&(i.description=ii(i.description),("http.client"===i.op||"http.client"===i.data["sentry.op"])&&(i.data={...t,...i.data,"url.sanitizedPath":ii(i.data?.["url.path"]?.toString()??"")})),i}}debugDump(e=50){return{events:this.eventBuffer.slice(-e)}}addToEventBuffer(e){this.eventBuffer.push(e),this.eventBuffer.length>this.maxBufferSize&&this.eventBuffer.shift()}}let is=null;function io(){return is}async function ip(e,t){var n,r;n=e,r=t,n?.sentryInitOptions?.enabled===!1||function(){if("undefined"!=typeof globalThis){if(!0===globalThis.SYNAPSE_TELEMETRY_DISABLED)return!0;if("process"in globalThis){let e=globalThis.process;if(e?.env){let t=e.env.SYNAPSE_TELEMETRY_DISABLED;if("string"==typeof t&&"true"===t.trim().toLowerCase())return!0}}}return!1}()||n?.sentryInitOptions?.enabled===void 0&&(globalThis.process?.env?.NODE_ENV==="test"||null!=globalThis.PW_TEST)||n?.sentryInitOptions?.enabled!==!0&&"calibration"!==r.filecoinNetwork||(is=new ia,await is.initSentry(e,t),iu||(iu=!0,globalThis.fetch=async function(e,t){let n=is?.sentry;if(!n)return id(e,t);let r=e instanceof Request?new URL(e.url):new URL(e.toString()),i=e instanceof Request?e.method:t?.method||"GET";return await n.startSpan({op:"http.client",name:`${i} ${r}`},async n=>{n.setAttributes({"url.path":r.pathname,"url.full":r.toString(),"server.address":r.hostname,"http.request.method":i,"server.port":r.port||void 0,"location.origin":ie?globalThis.location?.origin:void 0});let a=await id(e,t);return n.setAttributes({"http.response.status_code":a.status,"http.response_content_length":a.headers.get("content-length")?Number(a.headers.get("content-length")):void 0}),a})}),function(e={}){let t=globalThis,n=e.timeoutMs??2e3,r=!1;if(ie){let e=()=>{is?.sentry?.flush(n).catch(()=>{})};t.window.addEventListener("pagehide",e,{capture:!0}),t.document.addEventListener("visibilitychange",()=>{"hidden"===t.document.visibilityState&&e()},{capture:!0}),t.window.addEventListener("beforeunload",e,{capture:!0}),t.window.addEventListener("unload",e,{capture:!0})}else{let e=()=>{r||(r=!0,is?.sentry?.close(n).finally(()=>{r=!1,function(e=!0){null!=is&&(e&&is?.sentry?.flush().catch(()=>{}),iu&&(globalThis.fetch=id,iu=!1),is=null)}(!1)}).catch(()=>{}))};r7.default.on("exit",e),r7.default.on("beforeExit",e),r7.default.on("SIGINT",e),r7.default.on("SIGTERM",e),r7.default.on("SIGQUIT",e)}}())}let id=globalThis.fetch,iu=!1;function il(e,t,n,r){let i,a=`${e} ${t} failed: ${n}`;return null!=r&&r instanceof Error&&(a=`${a} - ${r.message}`),i=null!=r?Error(a,{cause:r}):Error(a),is?.sentry?.captureException(i,{tags:{operation:`${e}.${t}`},extra:{synapseErrorPrefix:e,synapseErrorOperation:t,synapseErrorDetails:n,originalError:r}}),i}function iy(e,t){return new Date(1e3*(nr[t]+e*nn.EPOCH_DURATION))}function ic(e,t){let n=nr[t],r=nn.EPOCH_DURATION;return Math.floor((Math.floor(e.getTime()/1e3)-n)/r)}function im(e){return nr[e]}function ih(e,t){let n=e-t,r=n*nn.EPOCH_DURATION;return{epochs:n,seconds:r,minutes:r/60,hours:r/3600,days:r/86400}}function ig(e,t,n){if(0===e)return null;let r=e-t;return r<=0?null:iy(r,n)}async function iv(e){let t=await e.getBlockNumber();if(null==t)throw il("epoch","getCurrentEpoch","Failed to get latest block number");return BigInt(t)}function iT(e){return Object.entries(e).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({key:e,value:t}))}function iw(e){let t=Array.isArray(e)?e:iT(e);if(t.length>10)throw Error(`Too many metadata keys for data set: ${t.length} (max: 10)`);for(let{key:e,value:n}of t){if(e.length>32)throw Error(`Metadata key "${e}" exceeds max length: ${e.length} bytes (max: 32)`);if(n.length>128)throw Error(`Metadata value for key "${e}" exceeds max length: ${n.length} bytes (max: 128)`)}}function ib(e){let t=Array.isArray(e)?e:iT(e);if(t.length>5)throw Error(`Too many metadata keys for piece: ${t.length} (max: 5)`);for(let{key:e,value:n}of t){if(e.length>32)throw Error(`Metadata key "${e}" exceeds max length: ${e.length} bytes (max: 32)`);if(n.length>128)throw Error(`Metadata value for key "${e}" exceeds max length: ${n.length} bytes (max: 128)`)}}function iS(e,t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;if(0===r.length)return!0;for(let n of r)if(e[n]!==t[n])return!1;return!0}function iP(e={},t){return null==t||na.WITH_CDN in e?e:t?{...e,[na.WITH_CDN]:""}:e}async function iI(e){try{let t=await e.getNetwork(),n=Number(t.chainId);if(n===t9.mainnet)return"mainnet";if(n===t9.calibration)return"calibration";throw il("NetworkUtils","getFilecoinNetworkType",`Unsupported network: chain ID ${n}. Only Filecoin mainnet (${t9.mainnet}) and calibration (${t9.calibration}) are supported.`)}catch(e){if(e instanceof Error&&e.message.includes("Unsupported network"))throw e;throw il("NetworkUtils","getFilecoinNetworkType",`Failed to detect network: ${e instanceof Error?e.message:String(e)}`)}}function iA(e,t){let n=e.replace(/\/$/,"");return`${n}/piece/${t.toString()}`}function iE(e,t){let n=e.replace(/\/$/,""),r=new URLSearchParams({pieceCid:t.toString()});return`${n}/pdp/piece?${r.toString()}`}class ix{_provider;_signer;_paymentsAddress;_usdfcAddress;_disableNonceManager;_usdfcContract=null;_paymentsContract=null;constructor(e,t,n,r,i){this._provider=e,this._signer=t,this._paymentsAddress=n,this._usdfcAddress=r,this._disableNonceManager=i}_getUsdfcContract(){return null==this._usdfcContract&&(this._usdfcContract=new a.Contract(this._usdfcAddress,ne.ERC20,this._signer)),this._usdfcContract}_getPaymentsContract(){return null==this._paymentsContract&&(this._paymentsContract=new a.Contract(this._paymentsAddress,ne.PAYMENTS,this._signer)),this._paymentsContract}async _getPermitSignature(e,t,n){let r,i,s,o,p,d=await this._signer.getAddress(),u=await iI(this._provider),l=t9[u],y=np.MULTICALL3[u],c=new a.Contract(y,ne.MULTICALL3,this._provider),m=new a.Interface(ne.ERC20),h=new a.Interface(ne.ERC20_PERMIT),f=[{target:this._usdfcAddress,allowFailure:!1,callData:m.encodeFunctionData("balanceOf",[d])},{target:this._usdfcAddress,allowFailure:!1,callData:m.encodeFunctionData("name")},{target:this._usdfcAddress,allowFailure:!0,callData:h.encodeFunctionData("version")},{target:this._usdfcAddress,allowFailure:!1,callData:h.encodeFunctionData("nonces",[d])}];try{r=await c.aggregate3.staticCall(f)}catch(e){throw il("PaymentsService",n,"Failed to fetch token information for permit. Ensure token contract is reachable.",e)}try{i=m.decodeFunctionResult("balanceOf",r[0].returnData)[0]}catch(e){throw il("PaymentsService",n,"Failed to decode token balance.",e)}if(i<e)throw il("PaymentsService",n,`Insufficient USDFC: have ${i.toString()}, need ${e.toString()}`);try{s=m.decodeFunctionResult("name",r[1].returnData)[0]}catch(e){throw il("PaymentsService",n,"Failed to read token name for permit domain. Ensure token contract is reachable.",e)}let g="1";if(r[2].success)try{let e=h.decodeFunctionResult("version",r[2].returnData)[0];"string"==typeof e&&e.length>0&&(g=e)}catch{}try{o=h.decodeFunctionResult("nonces",r[3].returnData)[0]}catch(e){throw il("PaymentsService",n,"Token does not appear to support EIP-2612 permit (nonces() unavailable).",e)}let v={name:s,version:g,chainId:l,verifyingContract:this._usdfcAddress},T={owner:d,spender:this._paymentsAddress,value:e,nonce:o,deadline:t};try{p=await this._signer.signTypedData(v,nt,T)}catch(e){throw il("PaymentsService",n,"Failed to sign EIP-2612 permit. Ensure your wallet supports typed data signing.",e)}return a.Signature.from(p)}async balance(e=t7.USDFC){if(e!==t7.USDFC)throw il("PaymentsService","payments contract balance check",`Token "${e}" is not supported. Currently only USDFC token is supported for payments contract balance queries.`);return(await this.accountInfo(e)).availableFunds}async accountInfo(e=t7.USDFC){let t;if(e!==t7.USDFC)throw il("PaymentsService","account info",`Token "${e}" is not supported. Currently only USDFC token is supported.`);let n=await this._signer.getAddress(),r=this._getPaymentsContract();try{t=await r.accounts(this._usdfcAddress,n)}catch(e){throw il("PaymentsService","account info","Failed to read account information from payments contract. This could indicate the contract is not properly deployed, the ABI is incorrect, or there are network connectivity issues.",e)}let[i,a,s,o]=t,p=await iv(this._provider)-BigInt(o),d=BigInt(a)+BigInt(s)*p,u=BigInt(i)-d;return{funds:BigInt(i),lockupCurrent:BigInt(a),lockupRate:BigInt(s),lockupLastSettledAt:BigInt(o),availableFunds:u>0n?u:0n}}async walletBalance(e){if(null==e||e===t7.FIL)try{let e=await this._signer.getAddress();return await this._provider.getBalance(e)}catch(e){throw il("PaymentsService","wallet FIL balance check","Unable to retrieve FIL balance from wallet. This could be due to network connectivity issues, RPC endpoint problems, or wallet connection issues.",e)}if(e===t7.USDFC)try{let e=await this._signer.getAddress(),t=this._getUsdfcContract();return await t.balanceOf(e)}catch(e){throw il("PaymentsService","wallet USDFC balance check","Unexpected error while checking USDFC token balance in wallet.",e)}throw il("PaymentsService","wallet balance",`Token "${e}" is not supported. Currently only FIL and USDFC tokens are supported.`)}decimals(e=t7.USDFC){return 18}async allowance(e,t=t7.USDFC){if(t!==t7.USDFC)throw il("PaymentsService","allowance",`Token "${t}" is not supported. Currently only USDFC token is supported.`);let n=await this._signer.getAddress(),r=this._getUsdfcContract();try{return await r.allowance(n,e)}catch(e){throw il("PaymentsService","allowance check","Failed to check token allowance. This could indicate network connectivity issues or an invalid spender address.",e)}}async approve(e,t,n=t7.USDFC){if(n!==t7.USDFC)throw il("PaymentsService","approve",`Token "${n}" is not supported. Currently only USDFC token is supported.`);let r="bigint"==typeof t?t:BigInt(t);if(r<0n)throw il("PaymentsService","approve","Approval amount cannot be negative");let i=await this._signer.getAddress(),a=this._getUsdfcContract(),s={};this._disableNonceManager&&(s.nonce=await this._provider.getTransactionCount(i,"pending"));try{return await a.approve(e,r,s)}catch(t){throw il("PaymentsService","approve",`Failed to approve ${e} to spend ${r.toString()} ${n}`,t)}}async approveService(e,t,n,r,i=t7.USDFC){if(i!==t7.USDFC)throw il("PaymentsService","approveService",`Token "${i}" is not supported. Currently only USDFC token is supported.`);let a="bigint"==typeof t?t:BigInt(t),s="bigint"==typeof n?n:BigInt(n),o="bigint"==typeof r?r:BigInt(r);if(a<0n||s<0n||o<0n)throw il("PaymentsService","approveService","Allowance values cannot be negative");let p=await this._signer.getAddress(),d=this._getPaymentsContract(),u={};this._disableNonceManager&&(u.nonce=await this._provider.getTransactionCount(p,"pending"));try{return await d.setOperatorApproval(this._usdfcAddress,e,!0,a,s,o,u)}catch(t){throw il("PaymentsService","approveService",`Failed to approve service ${e} as operator for ${i}`,t)}}async revokeService(e,t=t7.USDFC){if(t!==t7.USDFC)throw il("PaymentsService","revokeService",`Token "${t}" is not supported. Currently only USDFC token is supported.`);let n=await this._signer.getAddress(),r=this._getPaymentsContract(),i={};this._disableNonceManager&&(i.nonce=await this._provider.getTransactionCount(n,"pending"));try{return await r.setOperatorApproval(this._usdfcAddress,e,!1,0n,0n,0n,i)}catch(n){throw il("PaymentsService","revokeService",`Failed to revoke service ${e} as operator for ${t}`,n)}}async serviceApproval(e,t=t7.USDFC){if(t!==t7.USDFC)throw il("PaymentsService","serviceApproval",`Token "${t}" is not supported. Currently only USDFC token is supported.`);let n=await this._signer.getAddress(),r=this._getPaymentsContract();try{let t=await r.operatorApprovals(this._usdfcAddress,n,e);return{isApproved:t[0],rateAllowance:t[1],lockupAllowance:t[2],rateUsed:t[3],lockupUsed:t[4],maxLockupPeriod:t[5]}}catch(t){throw il("PaymentsService","serviceApproval",`Failed to check service approval status for ${e}`,t)}}async deposit(e,t=t7.USDFC,n){if(t!==t7.USDFC)throw il("PaymentsService","deposit",`Unsupported token: ${t}`);let r="bigint"==typeof e?e:BigInt(e);if(r<=0n)throw il("PaymentsService","deposit","Invalid amount");let i=await this._signer.getAddress(),a=n?.to??i,s=this._getUsdfcContract(),o=this._getPaymentsContract(),p=await s.balanceOf(i);if(p<r)throw il("PaymentsService","deposit",`Insufficient USDFC: have ${BigInt(p).toString()}, need ${r.toString()}`);let d=await this.allowance(this._paymentsAddress,t);if(n?.onAllowanceCheck?.(d,r),d<r){let e=await this.approve(this._paymentsAddress,r,t);n?.onApprovalTransaction?.(e);let i=await e.wait(ns.TRANSACTION_CONFIRMATIONS);null!=i&&n?.onApprovalConfirmed?.(i)}n?.onDepositStarting?.();let u={};return this._disableNonceManager&&(u.nonce=await this._provider.getTransactionCount(i,"pending")),await o.deposit(this._usdfcAddress,a,r,u)}async depositWithPermit(e,t=t7.USDFC,n){if(t!==t7.USDFC)throw il("PaymentsService","depositWithPermit",`Unsupported token: ${t}`);let r="bigint"==typeof e?e:BigInt(e);if(r<=0n)throw il("PaymentsService","depositWithPermit","Invalid amount");let i=await this._signer.getAddress(),a=this._getPaymentsContract(),s=null==n?BigInt(Math.floor(Date.now()/1e3)+ns.PERMIT_DEADLINE_DURATION):BigInt(n),o=await this._getPermitSignature(r,s,"depositWithPermit"),p={};this._disableNonceManager&&(p.nonce=await this._provider.getTransactionCount(i,"pending"));try{return await a.depositWithPermit(this._usdfcAddress,i,r,s,o.v,o.r,o.s,p)}catch(e){throw il("PaymentsService","depositWithPermit","Failed to execute depositWithPermit on Payments contract.",e)}}async depositWithPermitAndApproveOperator(e,t,n,r,i,a=t7.USDFC,s){if(a!==t7.USDFC)throw il("PaymentsService","depositWithPermitAndApproveOperator",`Unsupported token: ${a}`);let o="bigint"==typeof e?e:BigInt(e);if(o<=0n)throw il("PaymentsService","depositWithPermitAndApproveOperator","Invalid amount");let p="bigint"==typeof n?n:BigInt(n),d="bigint"==typeof r?r:BigInt(r),u="bigint"==typeof i?i:BigInt(i);if(p<0n||d<0n||u<0n)throw il("PaymentsService","depositWithPermitAndApproveOperator","Allowance values cannot be negative");let l=await this._signer.getAddress(),y=this._getPaymentsContract(),c=null==s?BigInt(Math.floor(Date.now()/1e3)+ns.PERMIT_DEADLINE_DURATION):BigInt(s),m=await this._getPermitSignature(o,c,"depositWithPermitAndApproveOperator"),h={};this._disableNonceManager&&(h.nonce=await this._provider.getTransactionCount(l,"pending"));try{return await y.depositWithPermitAndApproveOperator(this._usdfcAddress,l,o,c,m.v,m.r,m.s,t,p,d,u,h)}catch(e){throw il("PaymentsService","depositWithPermitAndApproveOperator","Failed to execute depositWithPermitAndApproveOperator on Payments contract.",e)}}async withdraw(e,t=t7.USDFC){if(t!==t7.USDFC)throw il("PaymentsService","withdraw",`Unsupported token: ${t}`);let n="bigint"==typeof e?e:BigInt(e);if(n<=0n)throw il("PaymentsService","withdraw","Invalid amount");let r=await this._signer.getAddress(),i=this._getPaymentsContract(),a=await this.accountInfo(t);if(a.availableFunds<n)throw il("PaymentsService","withdraw",`Insufficient available balance: have ${a.availableFunds.toString()}, need ${n.toString()}`);let s={};return this._disableNonceManager&&(s.nonce=await this._provider.getTransactionCount(r,"pending")),await i.withdraw(this._usdfcAddress,n,s)}async settle(e,t){let n="bigint"==typeof e?e:BigInt(e),[r,i]=await Promise.all([this._signer.getAddress(),null==t?iv(this._provider):Promise.resolve(null)]),a=null==t?i:BigInt(t),s=this._getPaymentsContract(),o={value:1300000000000000n};this._disableNonceManager&&(o.nonce=await this._provider.getTransactionCount(r,"pending"));try{return await s.settleRail(n,a,o)}catch(e){throw il("PaymentsService","settle",`Failed to settle rail ${n.toString()} up to epoch ${a.toString()}`,e)}}async getSettlementAmounts(e,t){let n="bigint"==typeof e?e:BigInt(e),r=null==t?await iv(this._provider):null,i=null==t?r:BigInt(t),a=this._getPaymentsContract();try{let e=await a.settleRail.staticCall(n,i);return{totalSettledAmount:e[0],totalNetPayeeAmount:e[1],totalOperatorCommission:e[2],totalNetworkFee:e[3],finalSettledEpoch:e[4],note:e[5]}}catch(e){throw il("PaymentsService","getSettlementAmounts",`Failed to get settlement amounts for rail ${n.toString()} up to epoch ${i.toString()}`,e)}}async settleTerminatedRail(e){let t="bigint"==typeof e?e:BigInt(e),n=await this._signer.getAddress(),r=this._getPaymentsContract(),i={};this._disableNonceManager&&(i.nonce=await this._provider.getTransactionCount(n,"pending"));try{return await r.settleTerminatedRailWithoutValidation(t,i)}catch(e){throw il("PaymentsService","settleTerminatedRail",`Failed to settle terminated rail ${t.toString()}`,e)}}async getRail(e){let t="bigint"==typeof e?e:BigInt(e),n=this._getPaymentsContract();try{let e=await n.getRail(t);return{token:e.token,from:e.from,to:e.to,operator:e.operator,validator:e.validator,paymentRate:e.paymentRate,lockupPeriod:e.lockupPeriod,lockupFixed:e.lockupFixed,settledUpTo:e.settledUpTo,endEpoch:e.endEpoch,commissionRateBps:e.commissionRateBps,serviceFeeRecipient:e.serviceFeeRecipient}}catch(e){if(e.message?.includes("RailInactiveOrSettled"))throw il("PaymentsService","getRail",`Rail ${t.toString()} does not exist or is inactive`);throw il("PaymentsService","getRail",`Failed to get rail ${t.toString()}`,e)}}async settleAuto(e,t){let n="bigint"==typeof e?e:BigInt(e);return(await this.getRail(n)).endEpoch>0n?await this.settleTerminatedRail(n):await this.settle(n,t)}async getRailsAsPayer(e=t7.USDFC){if(e!==t7.USDFC)throw il("PaymentsService","getRailsAsPayer",`Token "${e}" is not supported. Currently only USDFC token is supported.`);let t=await this._signer.getAddress(),n=this._getPaymentsContract();try{let[e]=await n.getRailsForPayerAndToken(t,this._usdfcAddress,0n,0n);return e.map(e=>({railId:Number(e.railId),isTerminated:e.isTerminated,endEpoch:Number(e.endEpoch)}))}catch(e){throw il("PaymentsService","getRailsAsPayer","Failed to get rails where wallet is payer",e)}}async getRailsAsPayee(e=t7.USDFC){if(e!==t7.USDFC)throw il("PaymentsService","getRailsAsPayee",`Token "${e}" is not supported. Currently only USDFC token is supported.`);let t=await this._signer.getAddress(),n=this._getPaymentsContract();try{let[e]=await n.getRailsForPayeeAndToken(t,this._usdfcAddress,0n,0n);return e.map(e=>({railId:Number(e.railId),isTerminated:e.isTerminated,endEpoch:Number(e.endEpoch)}))}catch(e){throw il("PaymentsService","getRailsAsPayee","Failed to get rails where wallet is payee",e)}}}e.s([],527920);var a=a;class iC{signer;domain;WITH_CDN_METADATA={key:na.WITH_CDN,value:""};constructor(e,t,n){this.signer=t,this.domain={name:"FilecoinWarmStorageService",version:"1",chainId:Number(n),verifyingContract:e}}getUnderlyingSigner(){return"signer"in this.signer&&"NonceManager"===this.signer.constructor.name?this.signer.signer:this.signer}async isMetaMaskSigner(){try{let e=this.getUnderlyingSigner();if("Wallet"===e.constructor.name)return!1;let t=e.provider;if(null==t)return!1;if("_eip1193Provider"in t)return!0;if(t instanceof a.JsonRpcProvider||t instanceof a.WebSocketProvider)return!1;if("request"in t&&"function"==typeof t.request)return!0}catch{}return!1}async signWithMetaMask(e,t){let n,r=this.signer.provider;if(null==r)throw Error("No provider available");let i=await this.signer.getAddress(),a="";for(let t of Object.keys(e))if("Cid"!==t&&"PieceData"!==t){a=t;break}let s={types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],...e},primaryType:a,domain:this.domain,message:t};return"_eip1193Provider"in r?n=r._eip1193Provider:("request"in r,n=r),null!=n&&"request"in n?await n.request({method:"eth_signTypedData_v4",params:[i,JSON.stringify(s)]}):await r.send("eth_signTypedData_v4",[i,JSON.stringify(s)])}async signCreateDataSet(e,t,n=[]){let r,i={CreateDataSet:r3.CreateDataSet,MetadataEntry:r3.MetadataEntry};if(await this.isMetaMaskSigner()){let a={clientDataSetId:e.toString(),metadata:n,payee:t};r=await this.signWithMetaMask(i,a)}else{let a=this.getUnderlyingSigner();r=await a.signTypedData(this.domain,i,{clientDataSetId:e,metadata:n,payee:t})}let s=a.Signature.from(r),o=a.TypedDataEncoder.hash(this.domain,i,{clientDataSetId:e,metadata:n,payee:t});return{signature:r,v:s.v,r:s.r,s:s.s,signedData:o}}async signAddPieces(e,t,n,r=[]){let i;if(0===r.length)r=Array(n.length).fill([]);else if(r.length!==n.length)throw Error("metadata length must match pieceDataArray length");let s=[],o=[];for(let e=0;e<n.length;e++){let t=n[e],i="string"==typeof t?t6(t):t;if(null==i)throw Error(`Invalid PieceCID: ${String(i)}`);o.push({data:i.bytes}),s.push({pieceIndex:e,metadata:r[e]})}let p={AddPieces:r3.AddPieces,Cid:r3.Cid,PieceMetadata:r3.PieceMetadata,MetadataEntry:r3.MetadataEntry};if(await this.isMetaMaskSigner()){let n={clientDataSetId:e.toString(),nonce:t.toString(),pieceData:o.map(e=>({data:a.hexlify(e.data)})),pieceMetadata:s};i=await this.signWithMetaMask(p,n)}else{let n=this.getUnderlyingSigner();i=await n.signTypedData(this.domain,p,{clientDataSetId:e,nonce:t,pieceData:o,pieceMetadata:s})}let d=a.Signature.from(i),u=a.TypedDataEncoder.hash(this.domain,p,{clientDataSetId:e,nonce:t,pieceData:o,pieceMetadata:s});return{signature:i,v:d.v,r:d.r,s:d.s,signedData:u}}async signSchedulePieceRemovals(e,t){let n;if(await this.isMetaMaskSigner()){let r={clientDataSetId:e.toString(),pieceIds:t.map(e=>e.toString())};n=await this.signWithMetaMask({SchedulePieceRemovals:r3.SchedulePieceRemovals},r)}else{let r=this.getUnderlyingSigner();n=await r.signTypedData(this.domain,{SchedulePieceRemovals:r3.SchedulePieceRemovals},{clientDataSetId:e,pieceIds:t})}let r=a.Signature.from(n),i=a.TypedDataEncoder.hash(this.domain,{SchedulePieceRemovals:r3.SchedulePieceRemovals},{clientDataSetId:e,pieceIds:t});return{signature:n,v:r.v,r:r.r,s:r.s,signedData:i}}async signDeleteDataSet(e){let t;if(await this.isMetaMaskSigner()){let n={clientDataSetId:e.toString()};t=await this.signWithMetaMask({DeleteDataSet:r3.DeleteDataSet},n)}else{let n=this.getUnderlyingSigner();t=await n.signTypedData(this.domain,{DeleteDataSet:r3.DeleteDataSet},{clientDataSetId:e})}let n=a.Signature.from(t),r=a.TypedDataEncoder.hash(this.domain,{DeleteDataSet:r3.DeleteDataSet},{clientDataSetId:e});return{signature:t,v:n.v,r:n.r,s:n.s,signedData:r}}async getSignerAddress(){return await this.signer.getAddress()}}let iD=Symbol.for("sindresorhus/unlimited-timeout#brand"),i_=new WeakMap,iR=function({clearTimeout:e,setTimeout:t}={}){return(n,{value:r,signal:i}={})=>{let a,s,o;if(i?.aborted)return Promise.reject(i.reason);let p=e??clearTimeout,d=()=>{p(a),o(i.reason)},u=new Promise((e,p)=>{s=()=>{i&&i.removeEventListener("abort",d),e(r)},o=p,a=(t??setTimeout)(s,n)});return i&&i.addEventListener("abort",d,{once:!0}),i_.set(u,()=>{p(a),a=null,s()}),u}}({setTimeout:function(e,t,...n){if("function"!=typeof e)throw TypeError("Expected callback to be a function");t??=0;let r=!1,i={[iD]:!0,id:void 0,cleared:!1,ref:()=>(r=!1,i.id?.ref?.(),i),unref:()=>(r=!0,i.id?.unref?.(),i)};if((t=Number(t))===1/0||t>Number.MAX_SAFE_INTEGER)return i;(!Number.isFinite(t)||t<0)&&(t=0);let a=performance.now()+t,s=t=>{!i.cleared&&(t<=0x7fffffff?i.id=globalThis.setTimeout(()=>{i.cleared||e(...n)},t):i.id=globalThis.setTimeout(()=>{s(Math.max(0,a-performance.now()))},0x7fffffff),r&&i.id?.unref?.())};return s(t),i},clearTimeout:function(e){e&&"object"==typeof e&&e[iD]&&(e.cleared=!0,void 0!==e.id&&(globalThis.clearTimeout(e.id),e.id=void 0))}}),iM=Object.prototype.toString,iN=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function ik(e,t,{min:n=0,allowInfinity:r=!1}={}){if(void 0!==t){if("number"!=typeof t||Number.isNaN(t))throw TypeError(`Expected \`${e}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(t))throw TypeError(`Expected \`${e}\` to be a finite number.`);if(t<n)throw TypeError(`Expected \`${e}\` to be \u2265 ${n}.`)}}class iU extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}function i$(e,t){return Number.isFinite(t)?t-(performance.now()-e):t}async function iL({error:e,attemptNumber:t,retriesConsumed:n,startTime:r,options:i}){let a,s=e instanceof Error?e:TypeError(`Non-error was thrown: "${e}". You should only throw errors.`);if(s instanceof iU)throw s.originalError;let o=Number.isFinite(i.retries)?Math.max(0,i.retries-n):i.retries,p=i.maxRetryTime??1/0,d=Object.freeze({error:s,attemptNumber:t,retriesLeft:o,retriesConsumed:n});if(await i.onFailedAttempt(d),0>=i$(r,p))throw s;let u=await i.shouldConsumeRetry(d),l=i$(r,p);if(l<=0||o<=0)throw s;if(s instanceof TypeError&&!function(e){if(!(e&&"[object Error]"===iM.call(e)&&"TypeError"===e.name&&"string"==typeof e.message))return!1;let{message:t,stack:n}=e;return"Load failed"===t?void 0===n||"__sentry_captured__"in e:!!t.startsWith("error sending request for url")||iN.has(t)}(s)){if(u)throw s;return i.signal?.throwIfAborted(),!1}if(!await i.shouldRetry(d))throw s;if(!u)return i.signal?.throwIfAborted(),!1;let y=Math.min((a=Math.max(1,n+1),Math.min(Math.round((i.randomize?Math.random()+1:1)*i.minTimeout*i.factor**(a-1)),i.maxTimeout)),l);return y>0&&await new Promise((e,t)=>{let n=()=>{clearTimeout(r),i.signal?.removeEventListener("abort",n),t(i.signal.reason)},r=setTimeout(()=>{i.signal?.removeEventListener("abort",n),e()},y);i.unref&&r.unref?.(),i.signal?.addEventListener("abort",n,{once:!0})}),i.signal?.throwIfAborted(),!0}async function iF(e,t={}){var n=(t={...t}).retries;if("number"==typeof n){if(n<0)throw TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(n))throw TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(void 0!==n)throw TypeError("Expected `retries` to be a number or Infinity.");if(Object.hasOwn(t,"forever"))throw Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");t.retries??=10,t.factor??=2,t.minTimeout??=1e3,t.maxTimeout??=1/0,t.maxRetryTime??=1/0,t.randomize??=!1,t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.shouldConsumeRetry??=()=>!0,ik("factor",t.factor,{min:0,allowInfinity:!1}),ik("minTimeout",t.minTimeout,{min:0,allowInfinity:!1}),ik("maxTimeout",t.maxTimeout,{min:0,allowInfinity:!0}),ik("maxRetryTime",t.maxRetryTime,{min:0,allowInfinity:!0}),t.factor>0||(t.factor=1),t.signal?.throwIfAborted();let r=0,i=0,a=performance.now();for(;!Number.isFinite(t.retries)||i<=t.retries;){r++;try{t.signal?.throwIfAborted();let n=await e(r);return t.signal?.throwIfAborted(),n}catch(e){await iL({error:e,attemptNumber:r,retriesConsumed:i,startTime:a,options:t})&&i++}}throw Error("Retry attempts exhausted without throwing an error.")}let iB=Symbol.for("request-error");function iO(e){return e instanceof Error&&iB in e}class iz extends Error{[iB]=!0;name="RequestError";cause;constructor(e,t={}){super(e,t),this.cause=t.cause}static is(e){return iO(e)&&"RequestError"===e.name}}class iV extends iz{name="JsonError";cause;constructor(e){super("Failed with a JSON error, see cause.",e),this.cause=e.cause}static is(e){return iO(e)&&"JsonError"===e.name}}class iW extends iz{name="NetworkError";static is(e){return iO(e)&&"NetworkError"===e.name}}class ij extends iz{name="TimeoutError";constructor(e,t={}){super(`Request timed out after ${e}ms`,t)}static is(e){return iO(e)&&"TimeoutError"===e.name}}class iH extends iz{name="AbortError";signal;constructor(e,t={}){super(`Request aborted: ${e.reason??"unknown"}`,t),this.signal=e}static is(e){return iO(e)&&"AbortError"===e.name}}class iG extends iz{name="HttpError";code=0;response;request;options;constructor(e){super(`${e.response.status} - ${e.response.statusText}`),this.code=e.response?.status??0,this.response=e.response,this.request=e.request,this.options=e.options}static is(e){return iO(e)&&"HttpError"===e.name}}async function iK(e,t={}){let{signal:n,timeout:r=5e3,retry:i,fetch:a=globalThis.fetch.bind(globalThis),json:s,headers:o,onResponse:p=()=>{}}=t;if("string"!=typeof e&&!(e instanceof URL))return{error:new iz("`resource` must be a string or URL object")};let d=!1!==r?AbortSignal.timeout(r):void 0,u=function(e){let t=new AbortController;for(let n of e)if(n&&"aborted"in n&&"reason"in n){if(n.aborted)return t.abort(n.reason),n;n.addEventListener("abort",()=>t.abort(n.reason),{signal:t.signal,once:!0})}return t.signal}([n,d]),l=new Headers(o);void 0!==s&&(l.set("content-type",l.get("content-type")??"application/json"),t.body=JSON.stringify(s));let y=new Request(e,{...t,headers:l,signal:u});async function c(){let e=await a(y),n=await p(e.clone(),y);if(n instanceof Response&&(e=n),!e.ok)throw new iG({response:e,request:y,options:t});return e}try{let e=await (i?iF(()=>c(),{retries:i.retries,factor:i.factor??2,minTimeout:i.minTimeout??1e3,maxTimeout:i.maxTimeout??1/0,randomize:i.randomize??!1,unref:i.unref??!1,maxRetryTime:i.maxRetryTime??1/0,signal:u,onFailedAttempt:async e=>{let t=i.afterStatusCodes??[413,429,503];if(iG.is(e.error)&&t.includes(e.error.code)){let t=function(e){let t=e.headers.get("Retry-After")??e.headers.get("RateLimit-Reset")??e.headers.get("X-RateLimit-Reset")??e.headers.get("X-Rate-Limit-Reset");if(null===t)return 0;let n=Number(t);return Number.isNaN(n)?n=Date.parse(t)-Date.now():n*=1e3,n}(e.error.response);t>0&&await iR(t,{signal:u})}},shouldRetry:async e=>{if(i.shouldRetry)return!!await i.shouldRetry(e);let t=i.methods??["get","put","head","delete","options","trace"],n=i.statusCodes??[408,413,429,500,502,503,504];return!!(t.includes(y.method.toLowerCase())&&iG.is(e.error)&&n.includes(e.error.code))}}):c());return e.ok?{result:e}:{error:new iG({response:e,request:y,options:t})}}catch(e){if(!1!==r&&d?.aborted)return{error:new ij(r,{cause:e})};if(n?.aborted)return{error:new iH(n,{cause:e})};if(iG.is(e))return{error:e};return{error:new iW(e.message,{cause:e.cause})}}}iK.get=function(e,t={}){return iK(e,{...t,method:"GET"})},iK.post=function(e,t={}){return iK(e,{...t,method:"POST"})},iK.put=function(e,t={}){return iK(e,{...t,method:"PUT"})},iK.delete=function(e,t={}){return iK(e,{...t,method:"DELETE"})},iK.patch=function(e,t={}){return iK(e,{...t,method:"PATCH"})},iK.head=function(e,t={}){return iK(e,{...t,method:"HEAD"})},iK.options=function(e,t={}){return iK(e,{...t,method:"OPTIONS"})},iK.trace=function(e,t={}){return iK(e,{...t,method:"TRACE"})},iK.json=async function(e,t={}){let{error:n,result:r}=await iK(e,{...t,body:null,json:t.body});return n?iG.is(n)&&n.response.headers.get("content-type")?.includes("json")?{error:new iV({cause:await n.response.json()})}:{error:n}:r.ok&&r.headers.get("content-type")?.includes("json")?{result:await r.json()}:{error:new iz("Response is not JSON",{cause:r})}},iK.json.get=function(e,t={}){return iK.json(e,{...t,method:"GET"})},iK.json.post=function(e,t={}){return iK.json(e,{...t,method:"POST"})},iK.json.put=function(e,t={}){return iK.json(e,{...t,method:"PUT"})},iK.json.delete=function(e,t={}){return iK.json(e,{...t,method:"DELETE"})},iK.json.patch=function(e,t={}){return iK.json(e,{...t,method:"PATCH"})},iK.json.head=function(e,t={}){return iK.json(e,{...t,method:"HEAD"})},iK.json.options=function(e,t={}){return iK.json(e,{...t,method:"OPTIONS"})},iK.json.trace=function(e,t={}){return iK.json(e,{...t,method:"TRACE"})};var iq=e.i(959512),iY=e.i(377138),iZ=e.i(581937),iX=e.i(288406),iQ=e.i(252376);function iJ(e){for(let t of e.matchAll(/(?:vm error|revert reason)=\[(.*?)\]/g)){let e=t[1];if(e?.startsWith("0x")){let t;try{let t=(0,iZ.decodeErrorResult)({abi:y,data:e});return`Warm Storage
${i2(t)}`}catch(e){t=e}if(t instanceof iY.AbiErrorSignatureNotFoundError)try{let t=(0,iZ.decodeErrorResult)({abi:p,data:e});return`Payments
${i2(t)}`}catch(e){t=e}if(t instanceof iY.AbiErrorSignatureNotFoundError)try{let t=(0,iZ.decodeErrorResult)({abi:u,data:e});return`PDP Verifier
${i2(t)}`}catch(e){t=e}return`Unable to decode error
${t}`}if(e?.startsWith("Error("))return`
${e.replace("Error(","").replace(")","")}`}return`Service Provider PDP
${e}`}function i2(e){let t=e.abiItem?(0,iX.formatAbiItem)(e.abiItem,{includeName:!0}):void 0,n=e.args?(0,iQ.formatAbiItemWithArgs)({abiItem:e.abiItem,args:e.args,includeName:!1,includeFunctionName:!1}):void 0;return[t?`${t}`:"",n&&"()"!==n?`${[...Array(e.errorName?.length??0).keys()].map(()=>" ").join("")}${n}`:""].join("\n")}let i0=Symbol.for("synapse-error");function i5(e){return e instanceof Error&&i0 in e}class i6 extends Error{[i0]=!0;name="SynapseError";cause;details;shortMessage;constructor(e,t){const n=t?.cause instanceof Error?t.cause.message:t?.details?t.details:void 0;super([e||"An error occurred.",...n?[""]:[],...n?[`Details: ${n}`]:[]].join("\n"),t),this.cause=t?.cause??void 0,this.details=n??void 0,this.shortMessage=e}static is(e){return i5(e)&&"SynapseError"===e.name}}class i1 extends i6{name="LocationHeaderError";constructor(e){super(`Location header format is invalid: ${e??"<none>"}`)}static is(e){return i5(e)&&"LocationHeaderError"===e.name}}class i3 extends i6{name="CreateDataSetError";constructor(e){super("Failed to create data set.",{details:iJ(e)})}static is(e){return i5(e)&&"CreateDataSetError"===e.name}}class i8 extends i6{name="PollDataSetCreationStatusError";constructor(e){super("Failed to check data set creation status.",{details:iJ(e)})}static is(e){return i5(e)&&"PollDataSetCreationStatusError"===e.name}}class i4 extends i6{name="GetDataSetError";constructor(e){super(e?"Failed to get data set.":"Data set not found.",{details:e?iJ(e):void 0})}static is(e){return i5(e)&&"GetDataSetError"===e.name}}class i7 extends i6{name="PostPieceError";constructor(e){super("Failed to create upload session.",{details:iJ(e)})}static is(e){return i5(e)&&"PostPieceError"===e.name}}class i9 extends i6{name="UploadPieceError";constructor(e){super("Failed to upload piece.",{details:iJ(e)})}static is(e){return i5(e)&&"UploadPieceError"===e.name}}class ae extends i6{name="FindPieceError";constructor(e){super("Failed to find piece.",{details:iJ(e)})}static is(e){return i5(e)&&"FindPieceError"===e.name}}class at extends i6{name="AddPiecesError";constructor(e){super("Failed to add pieces.",{details:iJ(e)})}static is(e){return i5(e)&&"AddPiecesError"===e.name}}class an extends i6{name="PollForAddPiecesStatusError";constructor(e){super("Failed to poll for add pieces status.",{details:iJ(e)})}static is(e){return i5(e)&&"PollForAddPiecesStatusError"===e.name}}class ar extends i6{name="DeletePieceError";constructor(e){super("Failed to delete piece.",{details:iJ(e)})}static is(e){return i5(e)&&"DeletePieceError"===e.name}}class ai extends i6{name="InvalidUploadSizeError";constructor(e){super("Invalid upload size.",{details:`Size ${e} bytes is below minimum allowed size of 127 bytes or exceeds maximum allowed size of 209715200 bytes`})}}let aa=1/0;async function as(e){let t=await iK.post(new URL("pdp/data-sets",e.endpoint),{body:JSON.stringify({recordKeeper:e.recordKeeper,extraData:e.extraData}),headers:{"Content-Type":"application/json"},timeout:3e5});if(t.error){if(iG.is(t.error))throw new i3(await t.error.response.text());throw t.error}let n=t.result.headers.get("Location"),r=n?.split("/").pop();if(!n||!r||!(0,iq.isHex)(r))throw new i1(n);return{txHash:r,statusUrl:new URL(n,e.endpoint).toString()}}async function ao(e){let t=await iK.json.get(e.statusUrl,{async onResponse(e){if(e.ok){if((await e.clone().json()).dataSetCreated)return e;throw Error("Not created yet")}},retry:{shouldRetry:e=>"Not created yet"===e.error.message,retries:aa,factor:1,minTimeout:4e3},timeout:3e5});if(t.error){if(iG.is(t.error))throw new i8(await t.error.response.text());throw t.error}return t.result}async function ap(e){let t=await iK.post(new URL("pdp/data-sets/create-and-add",e.endpoint),{body:JSON.stringify({recordKeeper:e.recordKeeper,extraData:e.extraData,pieces:e.pieces.map(e=>({pieceCid:e.toString(),subPieces:[{subPieceCid:e.toString()}]}))}),headers:{"Content-Type":"application/json"},timeout:3e5});if(t.error){if(iG.is(t.error))throw new i3(await t.error.response.text());throw t.error}let n=t.result.headers.get("Location"),r=n?.split("/").pop();if(!n||!r||!(0,iq.isHex)(r))throw new i1(n);return{txHash:r,statusUrl:new URL(n,e.endpoint).toString()}}async function ad(e){let t=await iK.json.get(new URL(`pdp/data-sets/${e.dataSetId}`,e.endpoint));if(t.error){if(iG.is(t.error))throw new i4(await t.error.response.text());throw t.error}return t.result}async function au(e){let t=await iK.post(new URL("pdp/piece/uploads",e.endpoint),{timeout:3e5,signal:e.signal});if(t.error){if(iG.is(t.error))throw new i7(`Failed to create upload session: ${await t.error.response.text()}`);throw t.error}if(201!==t.result.status)throw new i7(`Expected 201 Created, got ${t.result.status}`);let n=t.result.headers.get("Location");if(!n)throw new i1("Upload session created but Location header missing");let r=n.match(/\/pdp\/piece\/uploads\/([a-fA-F0-9-]+)/);if(!r)throw new i1(`Invalid Location header format: ${n}`);let i=r[1],a=()=>e.pieceCid??null,s=null;if(null==e.pieceCid){let e=t3();s=e.stream,a=e.getPieceCID}let o=function(e){return"object"==typeof e&&null!==e&&"getReader"in e&&"function"==typeof e.getReader?e:function(e){var t;if(!("object"==typeof(t=e)&&null!==t&&Symbol.asyncIterator in t&&"function"==typeof t[Symbol.asyncIterator]))throw Error("Input must be an AsyncIterable");if("function"==typeof ReadableStream.from)return ReadableStream.from(e);let n=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){try{let{value:t,done:r}=await n.next();r?e.close():e.enqueue(t)}catch(t){if(n.return)try{await n.return()}catch{}e.error(t)}},async cancel(){n.return&&await n.return()}})}(e)}(e.data),p=0,d=new TransformStream({transform(t,n){if((p+=t.length)>0x3f800000)throw new ai(p);e.onProgress&&e.onProgress(p),n.enqueue(t)}}),u=s?o.pipeThrough(d).pipeThrough(s):o.pipeThrough(d),l={"Content-Type":"application/octet-stream"};void 0!==e.size&&(l["Content-Length"]=e.size.toString());let y=await iK.put(new URL(`pdp/piece/uploads/${i}`,e.endpoint),{body:u,headers:l,timeout:!1,signal:e.signal,duplex:"half"});if(y.error){if(iG.is(y.error))throw new i9(`Failed to upload piece: ${await y.error.response.text()}`);throw y.error}if(204!==y.result.status)throw new i9(`Expected 204 No Content, got ${y.result.status}`);let c=a();if(null===c)throw Error("Failed to calculate PieceCID during upload");let m=JSON.stringify({pieceCid:c.toString()}),h=await iK.post(new URL(`pdp/piece/uploads/${i}`,e.endpoint),{body:m,headers:{"Content-Type":"application/json"},timeout:3e5,signal:e.signal});if(h.error){if(iG.is(h.error))throw new i7(`Failed to finalize upload: ${await h.error.response.text()}`);throw h.error}if(200!==h.result.status)throw new i7(`Expected 200 OK for finalization, got ${h.result.status}`);return{pieceCid:c,size:p}}async function al(e){let{pieceCid:t,endpoint:n}=e,r=new URLSearchParams({pieceCid:t.toString()}),i=await iK.json.get(new URL(`pdp/piece?${r.toString()}`,n),{retry:{statusCodes:[404],retries:aa,factor:1},timeout:3e5});if(i.error){if(iG.is(i.error))throw new ae(await i.error.response.text());if(ij.is(i.error))throw new ae("Timeout waiting for piece to be found");throw i.error}return t1(i.result.pieceCid)}async function ay(e){let{endpoint:t,dataSetId:n,pieces:r,extraData:i}=e,a=await iK.post(new URL(`pdp/data-sets/${n}/pieces`,t),{headers:{"Content-Type":"application/json"},body:JSON.stringify({pieces:r.map(e=>({pieceCid:e.toString(),subPieces:[{subPieceCid:e.toString()}]})),extraData:i}),timeout:3e5});if(a.error){if(iG.is(a.error))throw new at(await a.error.response.text());throw a.error}let s=a.result.headers.get("Location"),o=s?.split("/").pop();if(!s||!o||!(0,iq.isHex)(o))throw new i1(s);return{txHash:o,statusUrl:new URL(s,t).toString()}}async function ac(e){let t=await iK.json.get(e.statusUrl,{async onResponse(e){if(e.ok){if((await e.clone().json()).piecesAdded)return e;throw Error("Not added yet")}},retry:{shouldRetry:e=>"Not added yet"===e.error.message,retries:aa,factor:1,minTimeout:4e3},timeout:3e5});if(t.error){if(iG.is(t.error))throw new an(await t.error.response.text());throw t.error}return t.result}async function am(e){let{endpoint:t,dataSetId:n,pieceId:r,extraData:i}=e,a=await iK.json.delete(new URL(`pdp/data-sets/${n}/pieces/${r}`,t),{body:{extraData:i}});if(a.error){if(iG.is(a.error))throw new ar(await a.error.response.text());throw a.error}return a.result}var ah=e.i(463078);function af(e,t){let n={};for(let r=0;r<e.length;r++)n[e[r]]=t[r];return n}var ag=e.i(490524);function av(e){var t;return{serviceURL:(0,ag.hexToString)(e.serviceURL),minPieceSizeInBytes:BigInt(e.minPieceSizeInBytes),maxPieceSizeInBytes:BigInt(e.maxPieceSizeInBytes),ipniPiece:"ipniPiece"in e,ipniIpfs:"ipniIpfs"in e,storagePricePerTibPerDay:BigInt(e.storagePricePerTibPerDay),minProvingPeriodInEpochs:BigInt(e.minProvingPeriodInEpochs),location:(0,ag.hexToString)(e.location),paymentTokenAddress:(t=e.paymentTokenAddress).length>66?"0x0000000000000000000000000000000000000000":t.length>42?`0x${t.slice(-40)}`:t.length<42?(0,ah.pad)(t,{size:20}):t}}function aT(e,t){let n=[],r=[];if(n.push("serviceURL"),r.push((0,r1.stringToHex)(e.serviceURL)),n.push("minPieceSizeInBytes"),r.push((0,r1.bytesToHex)((0,t0.numberToBytes)(e.minPieceSizeInBytes))),n.push("maxPieceSizeInBytes"),r.push((0,r1.bytesToHex)((0,t0.numberToBytes)(e.maxPieceSizeInBytes))),e.ipniPiece&&(n.push("ipniPiece"),r.push("0x01")),e.ipniIpfs&&(n.push("ipniIpfs"),r.push("0x01")),n.push("storagePricePerTibPerDay"),r.push((0,r1.bytesToHex)((0,t0.numberToBytes)(e.storagePricePerTibPerDay))),n.push("minProvingPeriodInEpochs"),r.push((0,r1.bytesToHex)((0,t0.numberToBytes)(e.minProvingPeriodInEpochs))),n.push("location"),r.push((0,r1.stringToHex)(e.location)),n.push("paymentTokenAddress"),r.push(e.paymentTokenAddress),null!=t)for(let[e,i]of Object.entries(t))n.push(e),i?(0,iq.isHex)(i)?r.push(i):r.push((0,r1.bytesToHex)((0,t0.toBytes)(i))):r.push("0x01");return[n,r]}let aw=globalThis.crypto;function ab(){if(aw?.getRandomValues!=null){let e=new BigUint64Array(4);aw.getRandomValues(e);let t=0n;return e.forEach(e=>{t<<=64n,t|=e}),t}let e=0n;for(let t=0;t<32;t++)e<<=8n,e|=BigInt(aS(256));return e}function aS(e){return Math.floor(Math.random()*e)}function aP(e){if(aw?.getRandomValues==null)return aS(e);{let t=new Uint32Array(1);return aw.getRandomValues(t),t[0]%e}}e.i(243752),e.i(102253);var a=a;function aI(e){return"object"==typeof e&&null!=e&&"string"==typeof e.createMessageHash&&"boolean"==typeof e.dataSetCreated&&"string"==typeof e.service&&"string"==typeof e.txStatus&&(null===e.ok||"boolean"==typeof e.ok)&&(void 0===e.dataSetId||"number"==typeof e.dataSetId)}function aA(e){if("object"!=typeof e||null==e||"string"!=typeof e.txHash||"string"!=typeof e.txStatus||"number"!=typeof e.dataSetId||"number"!=typeof e.pieceCount||null!==e.addMessageOk&&"boolean"!=typeof e.addMessageOk)return!1;if(void 0!==e.confirmedPieceIds){if(!Array.isArray(e.confirmedPieceIds))return!1;for(let t of e.confirmedPieceIds)if("number"!=typeof t)return!1}return!0}function aE(e){return"object"==typeof e&&null!=e&&"string"==typeof e.pieceCid&&null!=t6(e.pieceCid)}function ax(e){if(!aI(e))throw Error("Invalid data set creation status response format");return e}function aC(e){if(!aA(e))throw Error("Invalid piece addition status response format");return e}function aD(e){if(!aE(e)){if("object"==typeof e&&null!=e){let t=e.pieceCid??e.piece_cid;if(null!=t&&null==t6(t))throw Error("Invalid find piece response: pieceCid is not a valid PieceCID")}throw Error("Invalid find piece response format")}let t=t6(e.pieceCid??e.piece_cid);if(null==t)throw Error("Invalid find piece response: pieceCid is not a valid PieceCID");return{pieceCid:t}}function a_(e){if("object"!=typeof e||null==e||"number"!=typeof e.pieceId||"string"!=typeof e.pieceCid||"string"!=typeof e.subPieceCid||"number"!=typeof e.subPieceOffset)return null;let t=t6(e.pieceCid),n=t6(e.subPieceCid);return null==t||null==n?null:{pieceId:e.pieceId,pieceCid:t,subPieceCid:n,subPieceOffset:e.subPieceOffset}}function aR(e){if("object"!=typeof e||null==e||"number"!=typeof e.id||!Array.isArray(e.pieces))return null;let t=[];for(let n of e.pieces){let e=a_(n);if(null==e)return null;t.push(e)}return"number"!=typeof e.nextChallengeEpoch?null:{id:e.id,pieces:t,nextChallengeEpoch:e.nextChallengeEpoch}}class aM{_serviceURL;_authHelper;constructor(e,t){if(""===t.trim())throw Error("PDP service URL is required");this._serviceURL=t.replace(/\/$/,""),this._authHelper=e}async createDataSet(e,t,n,r,i){iw(r);let a=await this.getAuthHelper().signCreateDataSet(e,t,r),s=this._encodeDataSetCreateData({payer:n,clientDataSetId:e,metadata:r,signature:a.signature});return as({endpoint:this._serviceURL,recordKeeper:i,extraData:`0x${s}`})}async createAndAddPieces(e,t,n,r,i,s){null==s.dataset&&(s.dataset=[]),iw(s.dataset),s.pieces=aM._processAddPiecesInputs(i,s.pieces);let o=await this.getAuthHelper().signCreateDataSet(e,t,s.dataset),p=this._encodeDataSetCreateData({payer:n,clientDataSetId:e,metadata:s.dataset,signature:o.signature}),d=ab(),u=await this.getAuthHelper().signAddPieces(e,d,i,s.pieces),l=this._encodeAddPiecesExtraData({nonce:d,signature:u.signature,metadata:s.pieces}),y=a.AbiCoder.defaultAbiCoder().encode(["bytes","bytes"],[`0x${p}`,`0x${l}`]);return ap({endpoint:this._serviceURL,recordKeeper:r,extraData:y,pieces:i.map(t6).filter(e=>null!=e)})}static _processAddPiecesInputs(e,t){if(0===e.length)throw Error("At least one piece must be provided");if(null!=t){if(t.length!==e.length)throw Error(`Metadata length (${t.length}) must match pieces length (${e.length})`);for(let e=0;e<t.length;e++)if(null!=t[e]&&t[e].length>0)try{ib(t[e])}catch(t){throw Error(`Piece ${e} metadata validation failed: ${t.message}`)}}for(let t of e)if(null==t6(t))throw Error(`Invalid PieceCID: ${String(t)}`);return t??e.map(()=>[])}async addPieces(e,t,n,r){let i=aM._processAddPiecesInputs(n,r),a=ab(),s=await this.getAuthHelper().signAddPieces(t,a,n,i),o=this._encodeAddPiecesExtraData({nonce:a,signature:s.signature,metadata:i}),{txHash:p,statusUrl:d}=await ay({endpoint:this._serviceURL,dataSetId:BigInt(e),pieces:n.map(t6).filter(e=>null!=e),extraData:`0x${o}`});return{message:`Pieces added to data set ID ${e} successfully`,txHash:p,statusUrl:d}}async getDataSetCreationStatus(e){let t=await fetch(`${this._serviceURL}/pdp/data-sets/created/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===t.status)throw Error(`Data set creation not found for transaction hash: ${e}`);if(200!==t.status){let e=await t.text();throw Error(`Failed to get data set creation status: ${t.status} ${t.statusText} - ${e}`)}return ax(await t.json())}async getPieceAdditionStatus(e,t){let n=await fetch(`${this._serviceURL}/pdp/data-sets/${e}/pieces/added/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===n.status)throw Error(`Piece addition not found for transaction: ${t}`);if(200!==n.status){let e=await n.text();throw Error(`Failed to get piece addition status: ${n.status} ${n.statusText} - ${e}`)}return aC(await n.json())}async findPiece(e){let t=t6(e);if(null==t)throw Error(`Invalid PieceCID: ${String(e)}`);return{pieceCid:await al({endpoint:this._serviceURL,pieceCid:t})}}async getPieceStatus(e){let t=t6(e);if(null==t)throw Error(`Invalid PieceCID: ${String(e)}`);let n=await fetch(`${this._serviceURL}/pdp/piece/${t.toString()}/status`,{method:"GET",headers:{Accept:"application/json"}});if(404===n.status){let e=await n.text();throw Error(`Piece not found or does not belong to service: ${e}`)}if(!n.ok){let e=await n.text();throw Error(`Failed to get piece status: ${n.status} ${n.statusText} - ${e}`)}var r=await n.json();if("object"!=typeof r||null==r||"string"!=typeof r.pieceCid||"string"!=typeof r.status||"boolean"!=typeof r.indexed||"boolean"!=typeof r.advertised||"boolean"!=typeof r.retrieved||void 0!==r.retrievedAt&&"string"!=typeof r.retrievedAt)throw Error("Invalid piece status response format");return r}async uploadPiece(e,t){if(!(e instanceof Uint8Array))return au({endpoint:this._serviceURL,data:e,onProgress:t?.onProgress,pieceCid:t?.pieceCid,signal:t?.signal});{if(e.length>0x3f800000)throw Error(`Upload size ${e.length} exceeds maximum 1065353216 bytes (1 GiB with fr32 expansion)`);let n=t8(e);return au({endpoint:this._serviceURL,data:n,size:e.length,onProgress:t?.onProgress,pieceCid:t?.pieceCid,signal:t?.signal})}}async downloadPiece(e){let t=t6(e);if(null==t)throw Error(`Invalid PieceCID: ${String(e)}`);let n=iA(this._serviceURL,t),r=await fetch(n);return await t4(r,t)}async getDataSet(e){let t=await ad({endpoint:this._serviceURL,dataSetId:BigInt(e)});return{id:t.id,pieces:t.pieces.map(e=>{let t=t1(e.pieceCid);return{pieceId:e.pieceId,pieceCid:t,subPieceCid:t,subPieceOffset:e.subPieceOffset}}),nextChallengeEpoch:t.nextChallengeEpoch}}async deletePiece(e,t,n){let r=await this.getAuthHelper().signSchedulePieceRemovals(t,[BigInt(n)]),{txHash:i}=await am({endpoint:this._serviceURL,dataSetId:BigInt(e),pieceId:BigInt(n),extraData:a.AbiCoder.defaultAbiCoder().encode(["bytes"],[r.signature])});return i}_encodeDataSetCreateData(e){let t=e.signature.startsWith("0x")?e.signature:`0x${e.signature}`,n=e.metadata.map(e=>e.key),r=e.metadata.map(e=>e.value);return a.AbiCoder.defaultAbiCoder().encode(["address","uint256","string[]","string[]","bytes"],[e.payer,e.clientDataSetId,n,r,t]).slice(2)}_encodeAddPiecesExtraData(e){let t=e.signature.startsWith("0x")?e.signature:`0x${e.signature}`,n=e.metadata.map(e=>e.map(e=>e.key)),r=e.metadata.map(e=>e.map(e=>e.value));return a.AbiCoder.defaultAbiCoder().encode(["uint256","string[][]","string[][]","bytes"],[e.nonce,n,r,t]).slice(2)}async ping(){let e=`${this._serviceURL}/pdp/ping`,t=await fetch(e,{method:"GET",headers:{}});if(200!==t.status){let e=await t.text().catch(()=>"Unknown error");throw Error(`Provider ping failed: ${t.status} ${t.statusText} - ${e}`)}}getServiceURL(){return this._serviceURL}getAuthHelper(){if(null==this._authHelper)throw Error("AuthHelper is not available for an operation that requires signing");return this._authHelper}}var a=a;class aN{_provider;_contractAddress;_contract;constructor(e,t){this._provider=e,this._contractAddress=t,this._contract=new a.Contract(this._contractAddress,ne.PDP_VERIFIER,this._provider)}async dataSetLive(e){return await this._contract.dataSetLive(e)}async getNextPieceId(e){return Number(await this._contract.getNextPieceId(e))}async getDataSetListener(e){return await this._contract.getDataSetListener(e)}async getDataSetStorageProvider(e){let[t,n]=await this._contract.getDataSetStorageProvider(e);return{storageProvider:t,proposedStorageProvider:n}}async getDataSetLeafCount(e){return Number(await this._contract.getDataSetLeafCount(e))}extractDataSetIdFromReceipt(e){try{for(let t of e.logs)try{let e=this._contract.interface.parseLog({topics:t.topics,data:t.data});if(null!=e&&"DataSetCreated"===e.name)return Number(e.args.setId)}catch{}return null}catch(e){throw Error(`Failed to extract data set ID from receipt: ${e instanceof Error?e.message:String(e)}`)}}async getActivePieces(e,t){let n=t?.offset??0,r=t?.limit??100,i=t?.signal;if(i?.aborted)throw Error("Operation aborted");let a=await this._contract.getActivePieces(e,n,r);return{pieces:a[0].map((e,t)=>{try{return{pieceCid:function(e){let t=(0,t0.hexToBytes)(e),n=tu.decode(t);if(!t5(n))throw Error(`Hex string '${e}' is a valid CID but not a valid PieceCID`);return n}(e.data),pieceId:Number(a[1][t])}}catch(e){throw il("PDPVerifier","getActivePieces",`Failed to convert piece data to PieceCID: ${e instanceof Error?e.message:String(e)}`,e)}}),hasMore:!!a[2]}}getContractAddress(){return this._contract.target}}e.s([],861318);var a=a;let ak=r4.CreateDataSet,aU=r4.AddPieces,a$=r4.SchedulePieceRemovals,aL=r4.DeleteDataSet,aF=[ak,aU,a$,aL],aB={[ak]:"CreateDataSet",[aU]:"AddPieces",[a$]:"SchedulePieceRemovals",[aL]:"DeleteDataSet"},aO=globalThis.location?.hostname||"unknown";class az{_provider;_registry;_signer;_owner;constructor(e,t,n,r){this._provider=e,this._registry=new a.Contract(t,ne.SESSION_KEY_REGISTRY,r),this._signer=n,this._owner=r}getSigner(){return this._signer}async fetchExpiries(e=aF){let t=await iI(this._provider),n=new a.Contract(np.MULTICALL3[t],ne.MULTICALL3,this._provider),r=new a.Interface(ne.SESSION_KEY_REGISTRY),[i,s,o]=await Promise.all([this._owner.getAddress(),this._signer.getAddress(),this._registry.getAddress()]),p=[];for(let t of e)p.push({target:o,allowFailure:!0,callData:r.encodeFunctionData("authorizationExpiry",[i,s,t])});let d=await n.aggregate3.staticCall(p),u={};for(let t=0;t<e.length;t++)u[aF[t]]=r.decodeFunctionResult("authorizationExpiry",d[t].returnData)[0];return u}async login(e,t=aF,n=aO){return await this._registry.login(await this._signer.getAddress(),e,t,n)}async revoke(e=aF){return await this._registry.revoke(await this._signer.getAddress(),e)}}e.s(["ADD_PIECES_TYPEHASH",0,aU,"CREATE_DATA_SET_TYPEHASH",0,ak,"DELETE_DATA_SET_TYPEHASH",0,aL,"PDP_PERMISSIONS",0,aF,"PDP_PERMISSION_NAMES",0,aB,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,a$,"SessionKey",()=>az],277280),e.s([],355455);var a=a;class aV{_provider;_registryAddress;_registryContract=null;constructor(e,t){this._provider=e,this._registryAddress=t}static async create(e,t){return new aV(e,t)}_getRegistryContract(){return null==this._registryContract&&(this._registryContract=new a.Contract(this._registryAddress,ne.SERVICE_PROVIDER_REGISTRY,this._provider)),this._registryContract}async registerProvider(e,t){let n=this._getRegistryContract().connect(e),r=await n.REGISTRATION_FEE(),[i,a]=aT(t.pdpOffering,t.capabilities);return await n.registerProvider(t.payee,t.name,t.description,0,i,a,{value:r})}async updateProviderInfo(e,t,n){let r=this._getRegistryContract().connect(e);return await r.updateProviderInfo(t,n)}async removeProvider(e){let t=this._getRegistryContract().connect(e);return await t.removeProvider()}async getProvider(e){try{let t=this._getRegistryContract(),n=await t.getProvider(e);if(n.info.serviceProvider===a.ZeroAddress)return null;let r=await this._getProviderProducts(e);return this._convertToProviderInfo(e,n.info,r)}catch(e){if(e instanceof Error&&e.message.includes("Provider not found"))return null;throw e}}async getProviderByAddress(e){try{let t=this._getRegistryContract(),n=await t.getProviderByAddress(e);if(n.info.serviceProvider===a.ZeroAddress)return null;let r=await this._getProviderProducts(Number(n.providerId));return this._convertToProviderInfo(Number(n.providerId),n.info,r)}catch(e){return console.warn("Error fetching provider by address:",e),null}}async getProviderIdByAddress(e){let t=this._getRegistryContract();return Number(await t.getProviderIdByAddress(e))}async getAllActiveProviders(){let e=this._getRegistryContract(),t=[],n=0,r=!0;for(;r;){let i=await e.getAllActiveProviders(n,50),a=i[0];if(r=i[1],a.length>0){let e=a.map(e=>Number(e));t.push(this.getProviders(e))}n+=50}return(await Promise.all(t)).flat()}async getActiveProvidersByProductType(e){let t=this._getRegistryContract(),n=[],r=0,i=!0;for(;i;){let a=await t.getProvidersByProductType(e,!0,r,50);if(a.providerIds.length>0){let e=a.providerIds.map(e=>Number(e));n.push(this.getProviders(e))}i=a.hasMore,r+=50}return(await Promise.all(n)).flat()}async isProviderActive(e){let t=this._getRegistryContract();return await t.isProviderActive(e)}async isRegisteredProvider(e){let t=this._getRegistryContract();return await t.isRegisteredProvider(e)}async getProviderCount(){let e=this._getRegistryContract();return Number(await e.getProviderCount())}async activeProviderCount(){let e=this._getRegistryContract();return Number(await e.activeProviderCount())}async addPDPProduct(e,t,n={}){let r=this._getRegistryContract().connect(e),[i,a]=aT(t,n);return await r.addProduct(0,i,a)}async updatePDPProduct(e,t,n={}){let r=this._getRegistryContract().connect(e),[i,a]=aT(t,n);return await r.updateProduct(0,i,a)}async removeProduct(e,t){let n=this._getRegistryContract().connect(e);return await n.removeProduct(t)}async getPDPService(e){try{let t=this._getRegistryContract(),n=await t.getProviderWithProduct(e,0);if(!n.product.isActive)return null;let r=af(n.product.capabilityKeys,n.productCapabilityValues);return{offering:av(r),capabilities:r,isActive:n.product.isActive}}catch{return null}}async providerHasProduct(e,t){let n=this._getRegistryContract();return await n.providerHasProduct(e,t)}async getProviders(e){if(0===e.length)return[];try{return await this._getProvidersWithMulticall(e)}catch(t){return await this._getProvidersIndividually(e)}}async _getProvidersWithMulticall(e){let t=await iI(this._provider),n=np.MULTICALL3[t],r=new a.Contract(n,ne.MULTICALL3,this._provider),i=new a.Interface(ne.SERVICE_PROVIDER_REGISTRY),s=this._prepareMulticallCalls(e,i),o=await r.aggregate3.staticCall(s);return this._processMulticallResults(e,o,i)}_prepareMulticallCalls(e,t){let n=[];for(let r of e)n.push({target:this._registryAddress,allowFailure:!0,callData:t.encodeFunctionData("getProviderWithProduct",[r,0])});return n}_processMulticallResults(e,t,n){let r=[];for(let i=0;i<e.length;i++)if(t[i].success)try{let[,s,o,p]=n.decodeFunctionResult("getProviderWithProduct",t[i].returnData)[0],d=af(o.capabilityKeys,p),u=this._convertToProviderInfo(e[i],s,[{type:"PDP",isActive:o.isActive,capabilities:d,data:av(d)}]);if(u.serviceProvider===a.ZeroAddress)continue;r.push(u)}catch{}return r}async _getProvidersIndividually(e){let t=[],n=e.map(e=>this.getProvider(e));for(let e of(await Promise.all(n)))null!=e&&t.push(e);return t}async _getProviderProducts(e){let t=[],n=await this.getPDPService(e);return null!=n&&t.push({type:"PDP",isActive:n.isActive,capabilities:n.capabilities,data:n.offering}),t}_convertToProviderInfo(e,t,n){let r={};for(let e of n)"PDP"===e.type&&(r.PDP=e);return{id:e,serviceProvider:t.serviceProvider,payee:t.payee,name:t.name,description:t.description,active:t.isActive,products:r}}}let aW="No approved service providers available";class aj{_synapse;_provider;_pdpServer;_warmStorageService;_warmStorageAddress;_withCDN;_signer;_uploadBatchSize;_dataSetId;_dataSetMetadata;_pendingPieces=[];_isProcessing=!1;_activeUploads=new Set;_uploadBatchWaitTimeout=15e3;serviceProvider;get withCDN(){return this._withCDN}get provider(){return this._provider}get dataSetMetadata(){return this._dataSetMetadata}get dataSetId(){return this._dataSetId}static validateRawSize(e,t){if(e<ni.MIN_UPLOAD_SIZE)throw il("StorageContext",t,`Data size ${e} bytes is below minimum allowed size of ${ni.MIN_UPLOAD_SIZE} bytes`);if(e>ni.MAX_UPLOAD_SIZE)throw il("StorageContext",t,`Data size ${e} bytes exceeds maximum allowed size of ${ni.MAX_UPLOAD_SIZE} bytes (${Math.floor(ni.MAX_UPLOAD_SIZE/1024/1024)} MiB)`)}constructor(e,t,n,r,i,a){this._synapse=e,this._provider=n,this._withCDN=i.withCDN??!1,this._signer=e.getSigner(),this._warmStorageService=t,this._uploadBatchSize=Math.max(1,i.uploadBatchSize??ni.DEFAULT_UPLOAD_BATCH_SIZE),this._dataSetMetadata=a,this._dataSetId=r,this.serviceProvider=n.serviceProvider,this._warmStorageAddress=e.getWarmStorageAddress();const s=new iC(this._warmStorageAddress,this._signer,BigInt(e.getChainId()));if(!n.products.PDP?.data.serviceURL)throw Error(`Provider ${n.id} does not have a PDP product with serviceURL`);this._pdpServer=new aM(s,n.products.PDP.data.serviceURL)}static async createContexts(e,t,n){let r=n?.count??2,i=[],a=await e.getClient().getAddress(),s=t.getServiceProviderRegistryAddress(),o=new aV(e.getProvider(),s);if(n.dataSetIds){let e=[];for(let i of new Set(n.dataSetIds))if(e.push(aj.resolveByDataSetId(i,t,o,a,{withCDN:n.withCDN,withIpni:n.withIpni,dev:n.dev,metadata:n.metadata})),e.length>=r)break;i.push(...await Promise.all(e))}let p=i.map(e=>e.provider.id);if(i.length<r&&n.providerIds){let e=[];for(let s of[...new Set(n.providerIds)].filter(e=>!p.includes(e)))if(e.push(aj.resolveByProviderId(a,s,n.metadata??{},t,o,n.forceCreateDataSets)),p.push(s),e.length+i.length>=r)break;i.push(...await Promise.all(e))}if(i.length<r){let e=[...n.excludeProviderIds??[],...p];for(let s=i.length;s<r;s++)try{let r=await aj.smartSelectProvider(a,n.metadata??{},t,o,e,n.forceCreateDataSets??!1,n.withIpni??!1,n.dev??!1);e.push(r.provider.id),i.push(r)}catch(e){if(e instanceof Error&&e.message.includes(aW))break;throw e}}return await Promise.all(i.map(async r=>await aj.createWithSelectedProvider(r,e,t,n)))}static async create(e,t,n={}){let r=t.getServiceProviderRegistryAddress(),i=new aV(e.getProvider(),r),a=await aj.resolveProviderAndDataSet(e,t,i,n);return await aj.createWithSelectedProvider(a,e,t,n)}static async createWithSelectedProvider(e,t,n,r={}){try{r.callbacks?.onProviderSelected?.(e.provider)}catch(e){console.error("Error in onProviderSelected callback:",e)}return -1!==e.dataSetId&&r.callbacks?.onDataSetResolved?.({isExisting:-1!==e.dataSetId,dataSetId:e.dataSetId,provider:e.provider}),new aj(t,n,e.provider,-1===e.dataSetId?void 0:e.dataSetId,r,e.dataSetMetadata)}static async resolveProviderAndDataSet(e,t,n,r){let i=await e.getClient().getAddress();if(null!=r.dataSetId&&!0!==r.forceCreateDataSet)return await aj.resolveByDataSetId(r.dataSetId,t,n,i,r);let a=iP(r.metadata,r.withCDN);return null!=r.providerId?await aj.resolveByProviderId(i,r.providerId,a,t,n,r.forceCreateDataSet):null!=r.providerAddress?await aj.resolveByProviderAddress(r.providerAddress,t,n,i,a,r.forceCreateDataSet):await aj.smartSelectProvider(i,a,t,n,r.excludeProviderIds??[],r.forceCreateDataSet??!1,r.withIpni??!1,r.dev??!1)}static async resolveByDataSetId(e,t,n,r,i){let a=(await t.getClientDataSetsWithDetails(r)).find(t=>t.pdpVerifierDataSetId===e);if(null==a||!a.isLive||!a.isManaged)throw il("StorageContext","resolveByDataSetId",`Data set ${e} not found, not owned by ${r}, or not managed by the current WarmStorage contract`);(null!=i.providerId||null!=i.providerAddress)&&await aj.validateDataSetConsistency(a,i,n);let s=await n.getProvider(a.providerId);if(null==s)throw il("StorageContext","resolveByDataSetId",`Provider ID ${a.providerId} for data set ${e} not found in registry`);if(null!=i.withCDN&&a.withCDN!==i.withCDN)throw il("StorageContext","resolveByDataSetId",`Data set ${e} has CDN ${a.withCDN?"enabled":"disabled"}, but requested ${i.withCDN?"enabled":"disabled"}`);let o=await t.getDataSetMetadata(e);return{provider:s,dataSetId:e,isExisting:!0,dataSetMetadata:o}}static async validateDataSetConsistency(e,t,n){if(null!=t.providerId&&e.providerId!==t.providerId)throw il("StorageContext","validateDataSetConsistency",`Data set ${e.pdpVerifierDataSetId} belongs to provider ID ${e.providerId}, but provider ID ${t.providerId} was requested`);if(null!=t.providerAddress){let r=await n.getProvider(e.providerId);if(null==r||r.serviceProvider.toLowerCase()!==t.providerAddress.toLowerCase())throw il("StorageContext","validateDataSetConsistency",`Data set ${e.pdpVerifierDataSetId} belongs to provider ${r?.serviceProvider??"unknown"}, but provider ${t.providerAddress} was requested`)}}static async resolveByProviderId(e,t,n,r,i,a){let[s,o]=await Promise.all([i.getProvider(t),a?Promise.resolve(null):r.getClientDataSetsWithDetails(e)]);if(null==s)throw il("StorageContext","resolveByProviderId",`Provider ID ${t} not found in registry`);if(!0===a)return{provider:s,dataSetId:-1,isExisting:!1,dataSetMetadata:n};let p=o.filter(e=>e.providerId===s.id&&!!e.isLive&&!!e.isManaged&&0===e.pdpEndEpoch&&iS(e.metadata,n));if(p.length>0){let e=p.sort((e,t)=>e.currentPieceCount>0&&0===t.currentPieceCount?-1:t.currentPieceCount>0&&0===e.currentPieceCount?1:e.pdpVerifierDataSetId-t.pdpVerifierDataSetId),t=await r.getDataSetMetadata(e[0].pdpVerifierDataSetId);return{provider:s,dataSetId:e[0].pdpVerifierDataSetId,isExisting:!0,dataSetMetadata:t}}return{provider:s,dataSetId:-1,isExisting:!1,dataSetMetadata:n}}static async resolveByProviderAddress(e,t,n,r,i,a){let s=await n.getProviderByAddress(e);if(null==s)throw il("StorageContext","resolveByProviderAddress",`Provider ${e} not found in registry`);return await aj.resolveByProviderId(r,s.id,i,t,n,a)}static async smartSelectProvider(e,t,n,r,i,a,s,o){let p=await n.getClientDataSetsWithDetails(e),d=new Set(i),u=p.filter(e=>e.isLive&&e.isManaged&&0===e.pdpEndEpoch&&iS(e.metadata,t)&&!d.has(e.providerId));if(u.length>0&&!a){let e=u.sort((e,t)=>e.currentPieceCount>0&&0===t.currentPieceCount?-1:t.currentPieceCount>0&&0===e.currentPieceCount?1:e.pdpVerifierDataSetId-t.pdpVerifierDataSetId);async function*l(){for(let t of e){if(d.has(t.providerId))continue;d.add(t.providerId);let e=await r.getProvider(t.providerId);if(null==e){console.warn(`Provider ID ${t.providerId} for data set ${t.pdpVerifierDataSetId} is not currently approved`);continue}if(s&&e.products.PDP?.data.ipniIpfs===!1)continue;let n=e.products.PDP?.capabilities?.serviceStatus;(o||"0x646576"!==n)&&(yield e)}}try{let t=await aj.selectProviderWithPing(l()),r=e.find(e=>e.providerId===t.id);if(null==r)console.warn(`Could not match selected provider ${t.serviceProvider} (ID: ${t.id}) to existing data sets. Falling back to selecting from all providers.`);else{let e=await n.getDataSetMetadata(r.pdpVerifierDataSetId);return{provider:t,dataSetId:r.pdpVerifierDataSetId,isExisting:!0,dataSetMetadata:e}}}catch(e){console.warn("All providers from existing data sets failed health check. Falling back to all providers.")}}let y=await n.getApprovedProviderIds(),c=(await r.getProviders(y)).filter(e=>(!s||e.products.PDP?.data.ipniIpfs===!0)&&(o||e.products.PDP?.capabilities?.serviceStatus!=="0x646576")&&!i.includes(e.id));if(0===c.length)throw il("StorageContext","smartSelectProvider",aW);return{provider:await aj.selectRandomProvider(c),dataSetId:-1,isExisting:!1,dataSetMetadata:t}}static async selectRandomProvider(e){if(0===e.length)throw il("StorageContext","selectRandomProvider","No providers available");async function*t(){let t=[...e];for(;t.length>0;){let e=t.splice(aP(t.length),1)[0];yield e}}return await aj.selectProviderWithPing(t())}static async selectProviderWithPing(e){let t=0;for await(let n of e){t++;try{if(!n.products.PDP?.data.serviceURL)continue;let e=new aM(null,n.products.PDP.data.serviceURL);return await e.ping(),n}catch(e){console.warn(`Provider ${n.serviceProvider} failed ping test:`,e instanceof Error?e.message:String(e))}}if(0===t)throw il("StorageContext","selectProviderWithPing","No providers available to select from");throw il("StorageContext","selectProviderWithPing",`All ${t} providers failed health check. Storage may be temporarily unavailable.`)}static async performPreflightCheck(e,t,n,r){aj.validateRawSize(n,"preflightUpload");let i=await e.checkAllowanceForStorage(n,r,t);return{estimatedCost:{perEpoch:i.costs.perEpoch,perDay:i.costs.perDay,perMonth:i.costs.perMonth},allowanceCheck:{sufficient:i.sufficient,message:i.message},selectedProvider:null,selectedDataSetId:null}}async preflightUpload(e){return await aj.performPreflightCheck(this._warmStorageService,this._synapse.payments,e,this._withCDN)}async upload(e,t){let n;performance.mark("synapse:upload-start");let r=t?.pieceCid;e instanceof Uint8Array&&(n=e.length,aj.validateRawSize(n,"upload"));let i=Symbol("upload");this._activeUploads.add(i);try{let n;try{performance.mark("synapse:pdpServer.uploadPiece-start"),n=await this._pdpServer.uploadPiece(e,{...t,pieceCid:r}),performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end")}catch(e){throw performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end"),il("StorageContext","uploadPiece","Failed to upload piece to service provider",e)}performance.mark("synapse:findPiece-start"),await this._pdpServer.findPiece(n.pieceCid),performance.mark("synapse:findPiece-end"),performance.measure("synapse:findPiece","synapse:findPiece-start","synapse:findPiece-end"),this._activeUploads.delete(i),t?.onUploadComplete!=null&&t.onUploadComplete(n.pieceCid),t?.metadata!=null&&ib(t.metadata);let a=await new Promise((e,r)=>{this._pendingPieces.push({pieceCid:n.pieceCid,resolve:e,reject:r,callbacks:t,metadata:t?.metadata?iT(t.metadata):void 0}),setTimeout(()=>{this._processPendingPieces().catch(e=>{console.error("Failed to process pending pieces batch:",e)})},0)});return performance.mark("synapse:upload-end"),performance.measure("synapse:upload","synapse:upload-start","synapse:upload-end"),{pieceCid:n.pieceCid,size:n.size,pieceId:a}}finally{this._activeUploads.delete(i)}}async _processPendingPieces(){if(this._isProcessing||0===this._pendingPieces.length)return;this._isProcessing=!0;let e=new Set(this._activeUploads);if(e.size>0&&this._pendingPieces.length<this._uploadBatchSize){let t=Date.now();for(;e.size>0&&Date.now()-t<this._uploadBatchWaitTimeout;){for(let t of e)this._activeUploads.has(t)||e.delete(t);e.size>0&&await new Promise(e=>setTimeout(e,200))}let n=Date.now()-t;n>200&&console.debug(`Waited ${n}ms for ${e.size} active upload(s) to complete`)}let t=this._pendingPieces.splice(0,this._uploadBatchSize);try{let e=t.map(e=>e.pieceCid),n=t.map(e=>e.metadata??[]),r=[];if(this.dataSetId){let[,i]=await Promise.all([this._warmStorageService.validateDataSet(this.dataSetId),this._warmStorageService.getDataSet(this.dataSetId)]),a=await this._pdpServer.addPieces(this.dataSetId,i.clientDataSetId,e,n);t.forEach(e=>{e.callbacks?.onPieceAdded?.(a.txHash)});let s=await ac(a);r.push(...s.confirmedPieceIds??[]),t.forEach(e=>{e.callbacks?.onPieceConfirmed?.(r)})}else{let i=await this._synapse.getClient().getAddress(),a=this._dataSetMetadata??{},s=!this._withCDN||na.WITH_CDN in a?a:{...a,[na.WITH_CDN]:""},o=iT(s),p=await this._pdpServer.createAndAddPieces(ab(),this._provider.payee,i,this._synapse.getWarmStorageAddress(),e,{dataset:o,pieces:n});t.forEach(e=>{e.callbacks?.onPieceAdded?.(p.txHash)});let d=await ao(p);this._dataSetId=d.dataSetId;let u=await ac({statusUrl:new URL(`/pdp/data-sets/${d.dataSetId}/pieces/added/${d.createMessageHash}`,this._pdpServer.getServiceURL()).toString()});r.push(...u.confirmedPieceIds??[]),t.forEach(e=>{e.callbacks?.onPieceConfirmed?.(r)})}t.forEach((e,t)=>{let n=r[t];if(null==n)throw il("StorageContext","addPieces",`Server did not return piece ID for piece at index ${t}`);e.resolve(n)})}catch(n){let e=il("StorageContext","addPieces","Failed to add piece to data set",n);t.forEach(t=>{t.reject(e)})}finally{this._isProcessing=!1,this._pendingPieces.length>0&&this._processPendingPieces().catch(e=>{console.error("Failed to process pending pieces batch:",e)})}}async download(e,t){let n=this._synapse.storage?.download??this._synapse.download;return await n.call(this._synapse.storage??this._synapse,e,{providerAddress:this._provider.serviceProvider,withCDN:t?.withCDN??this._withCDN})}async providerDownload(e,t){return console.warn("providerDownload() is deprecated. Use download() instead."),await this.download(e,t)}async getProviderInfo(){return await this._synapse.getProviderInfo(this.serviceProvider)}async getDataSetPieces(){if(null==this.dataSetId)return[];let e=[];for await(let{pieceCid:t}of this.getPieces())e.push(t);return e}async *getPieces(e){if(null==this._dataSetId)return;let t=this._warmStorageService.getPDPVerifierAddress(),n=new aN(this._synapse.getProvider(),t),r=e?.batchSize??100,i=e?.signal,a=0,s=!0;for(;s;){if(i?.aborted)throw il("StorageContext","getPieces","Operation aborted");let e=await n.getActivePieces(this._dataSetId,{offset:a,limit:r,signal:i});for(let t=0;t<e.pieces.length;t++){if(i?.aborted)throw il("StorageContext","getPieces","Operation aborted");yield{pieceCid:e.pieces[t].pieceCid,pieceId:e.pieces[t].pieceId}}s=e.hasMore,a+=r}}async _getPieceIdByCID(e){if(null==this.dataSetId)throw il("StorageContext","getPieceIdByCID","Data set not found");let t=t6(e);if(null==t)throw il("StorageContext","deletePiece","Invalid PieceCID provided");let n=(await this._pdpServer.getDataSet(this.dataSetId)).pieces.find(e=>e.pieceCid.toString()===t.toString());if(null==n)throw il("StorageContext","deletePiece","Piece not found in data set");return n.pieceId}async deletePiece(e){if(null==this.dataSetId)throw il("StorageContext","deletePiece","Data set not found");let t="number"==typeof e?e:await this._getPieceIdByCID(e),n=await this._warmStorageService.getDataSet(this.dataSetId);return this._pdpServer.deletePiece(this.dataSetId,n.clientDataSetId,t)}async hasPiece(e){let t=t6(e);if(null==t)return!1;try{return await this._pdpServer.findPiece(t),!0}catch{return!1}}async pieceStatus(e){let t;if(null==this.dataSetId)throw il("StorageContext","pieceStatus","Data set not found");let n=t6(e);if(null==n)throw il("StorageContext","pieceStatus","Invalid PieceCID provided");let[r,i,a]=await Promise.all([this.hasPiece(n),this._pdpServer.getDataSet(this.dataSetId).catch(e=>(console.debug("Failed to get data set data:",e),null)),iv(this._synapse.getProvider())]),s=this._synapse.getNetwork(),o=null,p=null,d=null,u=!1,l=0,y=!1;if(r){let[e,r]=await Promise.all([this.getProviderInfo().catch(()=>null),null!=i?Promise.all([this._warmStorageService.getMaxProvingPeriod(),this._warmStorageService.getChallengeWindow()]).then(([e,t])=>({maxProvingPeriod:e,challengeWindow:t})).catch(()=>null):Promise.resolve(null)]);if(null!=e){if(!e.products.PDP?.data.serviceURL)throw Error(`Provider ${e.id} does not have a PDP product with serviceURL`);o=`${e.products.PDP.data.serviceURL.replace(/\/$/,"")}/piece/${n.toString()}`}if(null!=i&&null!=r){let e=i.pieces.find(e=>e.pieceCid.toString()===n.toString());if(null!=e)if(t=e.pieceId,i.nextChallengeEpoch>0){let e=i.nextChallengeEpoch,t=e+r.challengeWindow;d=iy(t,s);let n=ig(i.nextChallengeEpoch,r.maxProvingPeriod,s);null!=n&&(p=n),u=Number(a)>=e&&Number(a)<t,y=Number(a)>=t,Number(a)<e&&(l=ih(e,Number(a)).hours)}else console.debug("Data set has nextChallengeEpoch=0, may have just been proven")}}return{exists:r,dataSetLastProven:p,dataSetNextProofDue:d,retrievalUrl:o,pieceId:t,inChallengeWindow:u,hoursUntilChallengeWindow:l,isProofOverdue:y}}async terminate(){if(null==this.dataSetId)throw il("StorageContext","terminate","Data set not found");return this._synapse.storage.terminateDataSet(this.dataSetId)}}var a=a;class aH{_synapse;_warmStorageService;_pieceRetriever;_withCDN;_dev;_withIpni;_defaultContexts;constructor(e,t,n,r,i,a){this._synapse=e,this._warmStorageService=t,this._pieceRetriever=n,this._withCDN=r,this._dev=i,this._withIpni=a}async upload(e,t){if(t?.context!=null||t?.contexts!=null){let e=[];if(void 0!==t.providerId&&e.push("providerId"),void 0!==t.providerAddress&&e.push("providerAddress"),void 0!==t.dataSetId&&e.push("dataSetId"),void 0!==t.withCDN&&e.push("withCDN"),void 0!==t.forceCreateDataSet&&e.push("forceCreateDataSet"),void 0!==t.uploadBatchSize&&e.push("uploadBatchSize"),e.length>0)throw il("StorageManager","upload",`Cannot specify both 'context' and other options: ${e.join(", ")}`)}if(t?.contexts!=null&&t.contexts.length>0&&t?.context!=null)throw il("StorageManager","upload","Cannot specify both 'context' and 'contexts'");let n=t?.contexts??(t?.context?[t.context]:await this.createContexts({withCDN:t?.withCDN,withIpni:t?.withIpni,count:1,dev:t?.dev,uploadBatchSize:t?.uploadBatchSize,forceCreateDataSets:t?.forceCreateDataSet,metadata:t?.metadata,excludeProviderIds:t?.excludeProviderIds,providerIds:t?.providerId?[t.providerId]:void 0,dataSetIds:t?.dataSetId?[t.dataSetId]:void 0,callbacks:t?.callbacks}));if(!(n.length>1))return n[0].upload(e,{...t?.callbacks,metadata:t?.metadata,signal:t?.signal});{if(!(e instanceof Uint8Array))throw il("StorageManager","upload","Multi-context uploads currently only support Uint8Array. For streaming uploads to multiple providers, convert your stream to Uint8Array first.");let r=function(e){let t=tZ();for(let n=0;n<e.length;n+=2048)t.write(e.subarray(n,n+2048));return tg(85,t.digest())}(e);return Promise.all(n.map(n=>n.upload(e,{...t?.callbacks,metadata:t?.metadata,pieceCid:r,signal:t?.signal}))).then(e=>e[0])}}async download(e,t){if(t?.context!=null){let n=[];if(void 0!==t.providerAddress&&n.push("providerAddress"),void 0!==t.withCDN&&n.push("withCDN"),n.length>0)throw il("StorageManager","download",`Cannot specify both 'context' and other options: ${n.join(", ")}`);return await t.context.download(e,t)}let n=t6(e);if(null==n)throw il("StorageManager","download",`Invalid PieceCID: ${String(e)}`);let r=t?.withCDN??this._withCDN;if(null!=this._defaultContexts&&!r&&t?.providerAddress==null){let e=this._defaultContexts.filter(e=>!1===e.withCDN),r=await Promise.all(e.map(e=>e.hasPiece(n))),i=e.filter((e,t)=>r[t]);i.length>0&&(t={...t,providerAddress:i[aP(i.length)].provider.serviceProvider})}let i=await this._synapse.getClient().getAddress(),a=await this._pieceRetriever.fetchPiece(n,i,{providerAddress:t?.providerAddress,withCDN:r});return await t4(a,n)}async preflightUpload(e,t){let n=t?.withCDN??this._withCDN;if(t?.metadata!=null&&na.WITH_CDN in t.metadata){let e=t.metadata[na.WITH_CDN];""!==e&&console.warn(`Warning: withCDN metadata entry has unexpected value "${e}". Expected empty string.`),n=!0}return await aj.performPreflightCheck(this._warmStorageService,this._synapse.payments,e,n)}async createContexts(e){let t=e?.withCDN??this._withCDN,n=null==e||null==e.providerIds&&null==e.dataSetIds&&!0!==e.forceCreateDataSets&&null==e.uploadBatchSize;if(null!=this._defaultContexts){let n=e?.count??2;if(this._defaultContexts.length===n&&this._defaultContexts.every(t=>e?.excludeProviderIds?.includes(t.provider.id)!==!0)){let n=iP(e?.metadata,t);if(this._defaultContexts.every(e=>iS(e.dataSetMetadata,n))){if(e?.callbacks!=null)for(let t of this._defaultContexts){try{e.callbacks.onProviderSelected?.(t.provider)}catch(e){console.error("Error in onProviderSelected callback:",e)}if(null!=t.dataSetId)try{e.callbacks.onDataSetResolved?.({isExisting:!0,dataSetId:t.dataSetId,provider:t.provider})}catch(e){console.error("Error in onDataSetResolved callback:",e)}}return this._defaultContexts}}}let r=await aj.createContexts(this._synapse,this._warmStorageService,{...e,withCDN:t,withIpni:e?.withIpni??this._withIpni,dev:e?.dev??this._dev});return n&&(this._defaultContexts=r),r}async createContext(e){let t=e?.withCDN??this._withCDN,n=null==e||null==e.providerId&&null==e.providerAddress&&null==e.dataSetId&&!0!==e.forceCreateDataSet&&null==e.uploadBatchSize;if(n&&null!=this._defaultContexts){let n=iP(e?.metadata,t);for(let t of this._defaultContexts)if(!e?.excludeProviderIds?.includes(t.provider.id)&&iS(t.dataSetMetadata,n)){if(e?.callbacks!=null){try{e.callbacks.onProviderSelected?.(t.provider)}catch(e){console.error("Error in onProviderSelected callback:",e)}if(null!=t.dataSetId)try{e.callbacks.onDataSetResolved?.({isExisting:!0,dataSetId:t.dataSetId,provider:t.provider})}catch(e){console.error("Error in onDataSetResolved callback:",e)}}return t}}let r=await aj.create(this._synapse,this._warmStorageService,{...e,withCDN:t,withIpni:e?.withIpni??this._withIpni,dev:e?.dev??this._dev});return n&&(this._defaultContexts=[r]),r}async getDefaultContext(){return await this.createContext()}async findDataSets(e){let t=e??await this._synapse.getClient().getAddress();return await this._warmStorageService.getClientDataSetsWithDetails(t)}async terminateDataSet(e){return this._warmStorageService.terminateDataSet(this._synapse.getSigner(),e)}async getStorageInfo(){try{let e=async()=>{try{let e=this._synapse.getWarmStorageAddress(),t=await this._synapse.payments.serviceApproval(e,t7.USDFC);return{service:e,isApproved:t.isApproved,rateAllowance:t.rateAllowance,lockupAllowance:t.lockupAllowance,rateUsed:t.rateUsed,lockupUsed:t.lockupUsed}}catch{return null}},t=this._warmStorageService.getServiceProviderRegistryAddress(),n=new aV(this._synapse.getProvider(),t),[r,i,s]=await Promise.all([this._warmStorageService.getServicePrice(),this._warmStorageService.getApprovedProviderIds(),e()]),o=await n.getProviders(i),p=BigInt(r.epochsPerMonth),d=BigInt(r.pricePerTiBPerMonthNoCDN)/p,u=BigInt(r.pricePerTiBPerMonthNoCDN)/p,l=BigInt(r.pricePerTiBPerMonthNoCDN)/nn.DAYS_PER_MONTH,y=BigInt(r.pricePerTiBPerMonthNoCDN)/nn.DAYS_PER_MONTH,c=o.filter(e=>e.serviceProvider!==a.ZeroAddress),m=this._synapse.getNetwork();return{pricing:{noCDN:{perTiBPerMonth:BigInt(r.pricePerTiBPerMonthNoCDN),perTiBPerDay:l,perTiBPerEpoch:d},withCDN:{perTiBPerMonth:BigInt(r.pricePerTiBPerMonthNoCDN),perTiBPerDay:y,perTiBPerEpoch:u},tokenAddress:r.tokenAddress,tokenSymbol:"USDFC"},providers:c,serviceParameters:{network:m,epochsPerMonth:p,epochsPerDay:nn.EPOCHS_PER_DAY,epochDuration:nn.EPOCH_DURATION,minUploadSize:ni.MIN_UPLOAD_SIZE,maxUploadSize:ni.MAX_UPLOAD_SIZE,warmStorageAddress:this._synapse.getWarmStorageAddress(),paymentsAddress:this._warmStorageService.getPaymentsAddress(),pdpVerifierAddress:this._warmStorageService.getPDPVerifierAddress()},allowances:s}}catch(e){throw Error(`Failed to get storage service information: ${e instanceof Error?e.message:String(e)}`)}}}e.s([],21482);let aG={PDP:0},aK={GET_APPROVED_PROVIDERS_FOR_PIECE_LINK:`
    query GetApprovedProvidersForCommP($cid: Bytes!) {
      pieces(where: { cid: $cid }) {
        id
        dataSet {
          setId
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `,GET_PROVIDER_BY_ADDRESS:`
    query Provider($serviceProvider: ID!) {
      provider (id: $serviceProvider) {
        id
        providerId
        serviceProvider
        payee
        name
        description
        registeredAt
        status
        approvedAt
        products {
          decodedProductData
          productType
          isActive
          capabilityValues
          capabilityKeys
        }
      }
    }
  `,GET_PROVIDERS_FLEXIBLE:`
    query ProvidersFlexible($where: Provider_filter, $first: Int, $skip: Int, $orderBy: Provider_orderBy, $orderDirection: OrderDirection) {
      providers(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        providerId
        serviceProvider
        payee
        registeredAt
        approvedAt
        status
        totalFaultedPeriods
        totalFaultedPieces
        totalDataSets
        totalPieces
        totalDataSize
        createdAt
        updatedAt
        products {
          decodedProductData
          productType
          isActive
          capabilityValues
          capabilityKeys
        }
      }
    }
  `,GET_DATA_SETS_FLEXIBLE:`
    query DataSetsFlexible($where: DataSet_filter, $first: Int, $skip: Int, $orderBy: DataSet_orderBy, $orderDirection: OrderDirection) {
      dataSets(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        setId
        listener
        payer
        withCDN
        isActive
        leafCount
        challengeRange
        lastProvenEpoch
        nextChallengeEpoch
        totalPieces
        totalDataSize
        totalProofs
        totalProvedPieces
        totalFaultedPeriods
        totalFaultedPieces
        metadataKeys
        metadataValues
        createdAt
        updatedAt
        serviceProvider {
          id
          providerId
          serviceProvider
          payee
          name
          description
          registeredAt
          status
          approvedAt
          products {
            decodedProductData
            productType
            isActive
            capabilityValues
            capabilityKeys
          }
        }
        rails {
          id
          type
          railId
          token
          paymentRate
          settledUpto
          endEpoch
        }
      }
    }
  `,GET_PIECES_FLEXIBLE:`
    query PiecesFlexible($where: Piece_filter, $first: Int, $skip: Int, $orderBy: Piece_orderBy, $orderDirection: OrderDirection) {
      pieces(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        setId
        pieceId
        rawSize
        leafCount
        cid
        removed
        totalProofsSubmitted
        totalPeriodsFaulted
        lastProvenEpoch
        lastProvenAt
        lastFaultedEpoch
        lastFaultedAt
        createdAt
        metadataKeys
        metadataValues
        dataSet {
          id
          setId
          isActive
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `,GET_FAULT_RECORDS_FLEXIBLE:`
    query FaultRecordsFlexible($where: FaultRecord_filter, $first: Int, $skip: Int, $orderBy: FaultRecord_orderBy, $orderDirection: OrderDirection) {
      faultRecords(
        where: $where
        first: $first
        skip: $skip
        orderBy: $orderBy
        orderDirection: $orderDirection
      ) {
        id
        dataSetId
        pieceIds
        currentChallengeEpoch
        nextChallengeEpoch
        periodsFaulted
        deadline
        createdAt
        dataSet {
          id
          setId
          serviceProvider {
            id
            providerId
            serviceProvider
            payee
            name
            description
            registeredAt
            status
            approvedAt
            products {
              decodedProductData
              productType
              isActive
              capabilityValues
              capabilityKeys
            }
          }
        }
      }
    }
  `};class aq{endpoint;headers;constructor(e){this.endpoint=this.resolveEndpoint(e),this.headers=this.buildHeaders(e.apiKey)}resolveEndpoint(e){if(null!=e.endpoint&&""!==e.endpoint.trim())return e.endpoint.trim();if(null!=e.goldsky)return this.buildGoldskyEndpoint(e.goldsky);throw il("SubgraphService","constructor","Invalid configuration: provide either endpoint or complete goldsky config")}buildGoldskyEndpoint(e){let{projectId:t,subgraphName:n,version:r}=e;if(t?.trim()==null||t?.trim()===""||n?.trim()==null||n?.trim()===""||r?.trim()==null||r?.trim()==="")throw il("SubgraphService","constructor","Incomplete Goldsky config: projectId, subgraphName, and version required");return`https://api.goldsky.com/api/public/${t}/subgraphs/${n}/${r}/gn`}buildHeaders(e){let t={"Content-Type":"application/json"};return null!=e&&""!==e?{...t,Authorization:`Bearer ${e}`}:t}normalizeQueryOptions(e={}){return{where:{},first:10,skip:0,orderBy:"createdAt",orderDirection:"desc",...e}}async executeQuery(e,t,n){try{let r=await fetch(this.endpoint,{method:"POST",headers:this.headers,body:JSON.stringify({query:e,variables:t})});if(!r.ok){let e=await r.text();throw il("SubgraphService",n,`HTTP ${r.status}: ${e}`)}let i=await r.json();if(null!=i.errors&&i.errors.length>0){let e=i.errors.map(e=>e.message).join("; ");throw il("SubgraphService",n,`GraphQL errors: ${e}`)}return i.data}catch(e){if(e instanceof Error&&"SynapseError"===e.name)throw e;throw il("SubgraphService",n,`Query execution failed: ${e.message}`,{cause:e})}}getProductType(e){let t=Object.entries(aG).find(([,t])=>t===e);return null!=t?t[0]:"PDP"}transformProviderData(e){let t={providerId:e?.providerId??0,serviceProvider:e?.serviceProvider??"",payee:e?.payee??"",name:e?.name??"",description:e?.description??"",status:e?.status??"UNKNOWN",products:Array.isArray(e?.products)?e.products:[]};return{id:t.providerId,serviceProvider:t.serviceProvider,payee:t.payee,name:t.name,description:t.description,active:"APPROVED"===t.status,products:this.transformProducts(t.products)}}transformProducts(e){return e.reduce((e,t)=>{let n=this.getProductType(t?.productType),r=this.createServiceProduct(t,n);return null!=r&&(e[n]=r),e},{})}createServiceProduct(e,t){try{return{type:t,isActive:e?.isActive??!1,capabilities:this.transformCapabilities(e?.capabilityValues),data:this.parseProductData(e?.decodedProductData)}}catch(e){return console.warn(`SubgraphService: Failed to create service product for type ${t}:`,e instanceof Error?e.message:"Unknown error"),null}}transformCapabilities(e){return Array.isArray(e)?e.reduce((e,t)=>(t?.key!=null&&t?.value!=null&&(e[t.key]=String(t.value)),e),{}):{}}parseProductData(e){try{if(null==e||""===e.trim())throw Error("Empty or null product data");let t=JSON.parse(e);if(t?.serviceURL==null)throw Error("Missing required serviceURL field");return t}catch(e){return console.warn("SubgraphService: Failed to parse product data, using defaults:",e instanceof Error?e.message:"Unknown error"),{serviceURL:"",minPieceSizeInBytes:0n,maxPieceSizeInBytes:0n,ipniPiece:!1,ipniIpfs:!1,storagePricePerTibPerDay:0n,minProvingPeriodInEpochs:0n,location:"",paymentTokenAddress:"0x0000000000000000000000000000000000000000"}}}parseTimestamp(e){if(null==e)return 0;let t=Number(e);return Number.isNaN(t)?0:t}safeConvertHexToCid(e){try{let t=e.startsWith("0x")?e.slice(2):e,n=P(t),r=tu.decode(n),i=t6(r);if(null==i)throw Error(`Failed to convert CID to PieceCID format: ${e}`);return i}catch(e){return console.warn(`SubgraphService: queryProviders: Failed to convert CID to PieceCID format: ${e instanceof Error?e.message:"Unknown error"}`),null}}isValidProviderData(e){return e?.id!=null&&""!==e.id.trim()&&e?.products!=null&&e.products.length>0}async getApprovedProvidersForPieceCID(e){let t=t6(e);if(null==t)throw il("SubgraphService","getApprovedProvidersForPieceCID","Invalid PieceCID");let n=S(t.bytes),r=await this.executeQuery(aK.GET_APPROVED_PROVIDERS_FOR_PIECE_LINK,{cid:n},"getApprovedProvidersForPieceCID");return r?.pieces==null||0===r.pieces.length?(console.log(`SubgraphService: No providers found for PieceCID: ${t.toString()}`),[]):Array.from(r.pieces.reduce((e,t)=>{let n=t.dataSet.serviceProvider,r=n?.serviceProvider?.toLowerCase();return null==r||""===r||e.has(r)||(this.isValidProviderData(n)?e.set(r,n):console.warn("SubgraphService: Skipping incomplete provider data for approved provider:",n)),e},new Map).values()).map(e=>this.transformProviderData(e))}async getProviderByAddress(e){let t=await this.executeQuery(aK.GET_PROVIDER_BY_ADDRESS,{serviceProvider:e},"getProviderByAddress");return t?.provider==null?(console.log(`SubgraphService: No provider found for address: ${e}`),null):this.transformProviderData(t.provider)}async queryProviders(e={}){let t=await this.executeQuery(aK.GET_PROVIDERS_FLEXIBLE,this.normalizeQueryOptions(e),"queryProviders");return t?.providers==null||t?.providers?.length===0?(console.log("SubgraphService: No providers found for the given criteria"),[]):t.providers.filter(e=>this.isValidProviderData(e)).map(e=>this.transformProviderData(e))}async queryDataSets(e={}){let t=await this.executeQuery(aK.GET_DATA_SETS_FLEXIBLE,this.normalizeQueryOptions(e),"queryDataSets");return t?.dataSets==null||t?.dataSets?.length===0?(console.log("SubgraphService: No data sets found for the given criteria"),[]):t.dataSets.map(e=>({id:e.id,setId:this.parseTimestamp(e.setId),listener:e.listener??"",payer:e.payer??"",withCDN:e.withCDN??!1,isActive:e.isActive,leafCount:this.parseTimestamp(e.leafCount),challengeRange:this.parseTimestamp(e.challengeRange),lastProvenEpoch:this.parseTimestamp(e.lastProvenEpoch),nextChallengeEpoch:this.parseTimestamp(e.nextChallengeEpoch),totalPieces:this.parseTimestamp(e.totalPieces),totalDataSize:this.parseTimestamp(e.totalDataSize),totalProofs:this.parseTimestamp(e.totalProofs),totalProvedPieces:this.parseTimestamp(e.totalProvedPieces),totalFaultedPeriods:this.parseTimestamp(e.totalFaultedPeriods),totalFaultedPieces:this.parseTimestamp(e.totalFaultedPieces),metadataKeys:e.metadataKeys??[],metadataValues:e.metadataValues??[],createdAt:this.parseTimestamp(e.createdAt),updatedAt:this.parseTimestamp(e.updatedAt),serviceProvider:null!=e.serviceProvider?this.transformProviderData(e.serviceProvider):this.transformProviderData({}),rails:null!=e.rails?e.rails.map(e=>({id:e.id,type:e.type,railId:this.parseTimestamp(e.railId),token:e.token,paymentRate:this.parseTimestamp(e.paymentRate),settledUpto:this.parseTimestamp(e.settledUpto),endEpoch:this.parseTimestamp(e.endEpoch)})):void 0}))}async queryPieces(e={}){let t=await this.executeQuery(aK.GET_PIECES_FLEXIBLE,this.normalizeQueryOptions(e),"queryPieces");return t?.pieces==null||t?.pieces?.length===0?(console.log("SubgraphService: No pieces found for the given criteria"),[]):t.pieces.map(e=>({id:e.id,setId:this.parseTimestamp(e.setId),pieceId:this.parseTimestamp(e.pieceId),rawSize:this.parseTimestamp(e.rawSize),leafCount:this.parseTimestamp(e.leafCount),cid:this.safeConvertHexToCid(e.cid),removed:e.removed,totalProofsSubmitted:this.parseTimestamp(e.totalProofsSubmitted),totalPeriodsFaulted:this.parseTimestamp(e.totalPeriodsFaulted),lastProvenEpoch:this.parseTimestamp(e.lastProvenEpoch),lastProvenAt:this.parseTimestamp(e.lastProvenAt),lastFaultedEpoch:this.parseTimestamp(e.lastFaultedEpoch),lastFaultedAt:this.parseTimestamp(e.lastFaultedAt),createdAt:this.parseTimestamp(e.createdAt),metadataKeys:e.metadataKeys??[],metadataValues:e.metadataValues??[],dataSet:{id:e.dataSet.id,setId:this.parseTimestamp(e.dataSet.setId),isActive:e.dataSet.isActive,serviceProvider:this.transformProviderData(e.dataSet.serviceProvider)}}))}async queryFaultRecords(e={}){let t=await this.executeQuery(aK.GET_FAULT_RECORDS_FLEXIBLE,this.normalizeQueryOptions(e),"queryFaultRecords");return t?.faultRecords==null||t?.faultRecords?.length===0?(console.log("SubgraphService: No fault records found for the given criteria"),[]):t.faultRecords.map(e=>({id:e.id,dataSetId:this.parseTimestamp(e.dataSetId),pieceIds:e.pieceIds.map(e=>this.parseTimestamp(e)),currentChallengeEpoch:this.parseTimestamp(e.currentChallengeEpoch),nextChallengeEpoch:this.parseTimestamp(e.nextChallengeEpoch),periodsFaulted:this.parseTimestamp(e.periodsFaulted),deadline:this.parseTimestamp(e.deadline),createdAt:this.parseTimestamp(e.createdAt),dataSet:{id:e.dataSet.id,setId:this.parseTimestamp(e.dataSet.setId),serviceProvider:this.transformProviderData(e.dataSet.serviceProvider)}}))}}e.s([],479217);var a=a;async function aY(e,t,n,r){let i=[],a=[],s=e.map(async(e,n)=>{let s=new AbortController;a[n]=s,null!=r&&(r.addEventListener("abort",()=>{s.abort(r.reason)},{once:!0}),r.aborted&&s.abort(r.reason));try{if(!e.products.PDP?.data.serviceURL)throw Error(`Provider ${e.id} does not have PDP product with serviceURL`);let r=iE(e.products.PDP.data.serviceURL,t),a=await fetch(r,{signal:s.signal});if(!a.ok)throw i.push({provider:e.serviceProvider,error:`findPiece returned ${a.status}`}),Error("Provider does not have piece");let o=iA(e.products.PDP.data.serviceURL,t),p=await fetch(o,{signal:s.signal});if(p.ok)return{response:p,index:n};throw i.push({provider:e.serviceProvider,error:`download returned ${p.status}`}),Error(`Download failed with status ${p.status}`)}catch(n){let t=n.message??"Unknown error";throw i.some(t=>t.provider===e.serviceProvider)||i.push({provider:e.serviceProvider,error:t}),"This operation was aborted"!==t&&console.warn(`Failed to fetch from provider ${e.serviceProvider}:`,t),n}});try{let{response:e,index:t}=await Promise.any(s);return a.forEach((e,n)=>{n!==t&&e.abort()}),e}catch(e){if(e instanceof AggregateError){let e=i.map(e=>`${e.provider}: ${e.error}`).join("; ");throw il(n,"fetchPiecesFromProviders",`All providers failed to serve piece ${t.toString()}. Details: ${e}`)}throw e}}class aZ{warmStorageService;childRetriever;spRegistry;constructor(e,t,n){this.warmStorageService=e,this.spRegistry=t,this.childRetriever=n}async findProviders(e,t){if(null!=t){let e=await this.spRegistry.getProviderByAddress(t);if(null==e)throw il("ChainRetriever","findProviders",`Provider ${t} not found in registry`);return[e]}let n=(await this.warmStorageService.getClientDataSetsWithDetails(e)).filter(e=>e.isLive&&e.currentPieceCount>0);if(0===n.length)throw il("ChainRetriever","findProviders",`No active data sets with data found for client ${e}`);let r=[...new Set(n.map(e=>e.providerId))],i=(await this.spRegistry.getProviders(r)).filter(e=>null!=e);if(0===i.length)throw il("ChainRetriever","findProviders","No valid providers found (all providers may have been removed from registry or are inactive)");return i}async fetchPiece(e,t,n){let r=async r=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(e,t,n);throw il("ChainRetriever","fetchPiece",`Failed to retrieve piece ${e.toString()}: ${r}`)},i=[];try{i=await this.findProviders(t,n?.providerAddress)}catch(t){let e=t instanceof Error?t.message:"Provider discovery failed";return await r(e)}if(0===i.length)return await r("No providers found and no additional retriever method was configured");try{return await aY(i,e,"ChainRetriever",n?.signal)}catch{return await r("All provider retrieval attempts failed and no additional retriever method was configured")}}}class aX{baseRetriever;network;constructor(e,t){this.baseRetriever=e,this.network=t}hostname(){return"mainnet"===this.network?"filbeam.io":"calibration.filbeam.io"}async fetchPiece(e,t,n){if(n?.withCDN===!0){let r=`https://${t}.${this.hostname()}/${e.toString()}`;try{let e=await fetch(r,{signal:n?.signal});if(e.ok)return e;402===e.status?console.warn("CDN requires payment. Please initialise Synapse SDK with the option `withCDN: true` and re-upload your files."):console.warn("CDN fetch failed with status:",e.status)}catch(e){console.warn("CDN fetch failed:",e)}console.log("Falling back to direct retrieval")}return await this.baseRetriever.fetchPiece(e,t,n)}}class aQ{subgraphService;childRetriever;constructor(e,t){this.subgraphService=e,this.childRetriever=t}async findProviders(e,t){if(null!=t){let e=await this.subgraphService.getProviderByAddress(t);return null!==e?[e]:[]}return await this.subgraphService.getApprovedProvidersForPieceCID(e)}async fetchPiece(e,t,n){let r=async r=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(e,t,n);throw il("SubgraphRetriever","fetchPiece",`Failed to retrieve piece ${e.toString()}: ${r}`)},i=[];try{i=await this.findProviders(e,n?.providerAddress)}catch{return await r("Provider discovery failed and no additional retriever method was configured")}if(0===i.length)return await r("No providers found and no additional retriever method was configured");try{return await aY(i,e,"SubgraphRetriever",n?.signal)}catch{return await r("All provider retrieval attempts failed and no additional retriever method was configured")}}}var a=a;class aJ{_provider;_warmStorageAddress;_warmStorageContract=null;_warmStorageViewContract=null;_pdpVerifier=null;_addresses;constructor(e,t,n){this._provider=e,this._warmStorageAddress=t,this._addresses=n}static async create(e,t){let n=await iI(e),r=new a.Contract(np.MULTICALL3[n],ne.MULTICALL3,e),i=new a.Interface(ne.WARM_STORAGE),s=[{target:t,allowFailure:!1,callData:i.encodeFunctionData("pdpVerifierAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("paymentsContractAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("usdfcTokenAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("filBeamBeneficiaryAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("viewContractAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("serviceProviderRegistry")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("sessionKeyRegistry")}],o=await r.aggregate3.staticCall(s);return new aJ(e,t,{pdpVerifier:i.decodeFunctionResult("pdpVerifierAddress",o[0].returnData)[0],payments:i.decodeFunctionResult("paymentsContractAddress",o[1].returnData)[0],usdfcToken:i.decodeFunctionResult("usdfcTokenAddress",o[2].returnData)[0],filBeamBeneficiary:i.decodeFunctionResult("filBeamBeneficiaryAddress",o[3].returnData)[0],viewContract:i.decodeFunctionResult("viewContractAddress",o[4].returnData)[0],serviceProviderRegistry:i.decodeFunctionResult("serviceProviderRegistry",o[5].returnData)[0],sessionKeyRegistry:i.decodeFunctionResult("sessionKeyRegistry",o[6].returnData)[0]})}getPDPVerifierAddress(){return this._addresses.pdpVerifier}getPaymentsAddress(){return this._addresses.payments}getUSDFCTokenAddress(){return this._addresses.usdfcToken}getViewContractAddress(){return this._addresses.viewContract}getServiceProviderRegistryAddress(){return this._addresses.serviceProviderRegistry}getSessionKeyRegistryAddress(){return this._addresses.sessionKeyRegistry}getProvider(){return this._provider}_getWarmStorageContract(){return null==this._warmStorageContract&&(this._warmStorageContract=new a.Contract(this._warmStorageAddress,ne.WARM_STORAGE,this._provider)),this._warmStorageContract}_getWarmStorageViewContract(){if(null==this._warmStorageViewContract){let e=this.getViewContractAddress();this._warmStorageViewContract=new a.Contract(e,ne.WARM_STORAGE_VIEW,this._provider)}return this._warmStorageViewContract}_getPDPVerifier(){if(null==this._pdpVerifier){let e=this.getPDPVerifierAddress();this._pdpVerifier=new aN(this._provider,e)}return this._pdpVerifier}async getDataSet(e){let t=this._getWarmStorageViewContract(),n=await t.getDataSet(e);if(0===Number(n.pdpRailId))throw il("WarmStorageService","getDataSet",`Data set ${e} does not exist`);return{pdpRailId:Number(n.pdpRailId),cacheMissRailId:Number(n.cacheMissRailId),cdnRailId:Number(n.cdnRailId),payer:n.payer,payee:n.payee,serviceProvider:n.serviceProvider,commissionBps:Number(n.commissionBps),clientDataSetId:n.clientDataSetId,pdpEndEpoch:Number(n.pdpEndEpoch),providerId:Number(n.providerId),dataSetId:e}}async getClientDataSets(e){try{let t=this._getWarmStorageViewContract();return(await t.getClientDataSets(e)).map(e=>({pdpRailId:Number(e.pdpRailId),cacheMissRailId:Number(e.cacheMissRailId),cdnRailId:Number(e.cdnRailId),payer:e.payer,payee:e.payee,serviceProvider:e.serviceProvider,commissionBps:Number(e.commissionBps),clientDataSetId:e.clientDataSetId,pdpEndEpoch:Number(e.pdpEndEpoch),providerId:Number(e.providerId)}))}catch(e){throw Error(`Failed to get client data sets: ${e instanceof Error?e.message:String(e)}`)}}async getClientDataSetsWithDetails(e,t=!1){let n=this._getPDPVerifier(),r=this._getWarmStorageViewContract(),i=await r.clientDataSets(e);if(0===i.length)return[];let a=i.map(async e=>{let r=Number(e);try{let e=await this.getDataSet(r),[i,a,s]=await Promise.all([n.dataSetLive(r),n.getDataSetListener(r).catch(()=>null),this.getDataSetMetadata(r).catch(()=>Object.create(null))]),o=null!=a&&a.toLowerCase()===this._warmStorageAddress.toLowerCase();if(t&&!o)return null;let p=i?await n.getNextPieceId(r):0n;return{...e,pdpVerifierDataSetId:r,nextPieceId:Number(p),currentPieceCount:Number(p),isLive:i,isManaged:o,withCDN:e.cdnRailId>0,metadata:s}}catch(e){throw Error(`Failed to get details for data set ${r}: ${e instanceof Error?e.message:String(e)}`)}});return(await Promise.all(a)).filter(e=>null!==e)}async validateDataSet(e){let t=this._getPDPVerifier(),[n,r]=await Promise.all([t.dataSetLive(Number(e)),t.getDataSetListener(Number(e))]);if(!n)throw Error(`Data set ${e} does not exist or is not live`);if(r.toLowerCase()!==this._warmStorageAddress.toLowerCase())throw Error(`Data set ${e} is not managed by this WarmStorage contract (${this._warmStorageAddress}), managed by ${String(r)}`)}async verifyDataSetCreation(e){try{let t,n="string"==typeof e?e:e.hash;if(t="string"==typeof e?await this._provider.getTransactionReceipt(n):await e.wait(ns.TRANSACTION_CONFIRMATIONS),null==t)return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1};if(1!==t.status)return{transactionMined:!0,transactionSuccess:!1,dataSetLive:!1,blockNumber:t.blockNumber,gasUsed:t.gasUsed,error:"Transaction failed"};let r=this._getPDPVerifier(),i=await r.extractDataSetIdFromReceipt(t);if(null==i)return{transactionMined:!0,transactionSuccess:!0,dataSetLive:!1,blockNumber:t.blockNumber,gasUsed:t.gasUsed,error:"Could not find DataSetCreated event in transaction"};let a=await r.dataSetLive(i);return{transactionMined:!0,transactionSuccess:!0,dataSetId:i,dataSetLive:a,blockNumber:t.blockNumber,gasUsed:t.gasUsed}}catch(e){return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getComprehensiveDataSetStatus(e,t){let n="string"==typeof e?e:e.hash,r=null;if(null!=t)try{performance.mark("synapse:pdpServer.getDataSetCreationStatus-start"),r=await t.getDataSetCreationStatus(n),performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}catch{performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}performance.mark("synapse:verifyDataSetCreation-start");let i=await this.verifyDataSetCreation(e);performance.mark("synapse:verifyDataSetCreation-end"),performance.measure("synapse:verifyDataSetCreation","synapse:verifyDataSetCreation-start","synapse:verifyDataSetCreation-end");let a=i.transactionMined&&i.transactionSuccess&&null!=i.dataSetId&&i.dataSetLive&&null!=r&&!0===r.ok&&r.dataSetCreated,s=r?.dataSetId??i.dataSetId??null,o=i.error??null;return null!=r&&!1===r.ok&&(o=`Server reported transaction failed (status: ${r.txStatus})`),{txHash:n,serverStatus:r,chainStatus:i,summary:{isComplete:a,isLive:i.dataSetLive,dataSetId:s,error:o}}}async waitForDataSetCreationWithStatus(e,t,n=ns.DATA_SET_CREATION_TIMEOUT_MS,r=ns.DATA_SET_CREATION_POLL_INTERVAL_MS,i){let a=Date.now();for(;Date.now()-a<n;){let n=await this.getComprehensiveDataSetStatus(e,t),s=Date.now()-a;if(null!=i)try{await i(n,s)}catch(e){console.error("Error in progress callback:",e)}if(n.summary.isComplete)return n;if(null!=n.summary.error&&n.chainStatus.transactionMined)throw Error(n.summary.error);await new Promise(e=>setTimeout(e,r))}throw Error(`Data set creation timed out after ${n/1e3} seconds`)}async getDataSetMetadata(e){let t=this._getWarmStorageViewContract(),[n,r]=await t.getAllDataSetMetadata(e),i=Object.create(null);for(let e=0;e<n.length;e++)i[n[e]]=r[e];return i}async getDataSetMetadataByKey(e,t){let n=this._getWarmStorageViewContract(),[r,i]=await n.getDataSetMetadata(e,t);return r?i:null}async getPieceMetadata(e,t){let n=this._getWarmStorageViewContract(),[r,i]=await n.getAllPieceMetadata(e,t),a=Object.create(null);for(let e=0;e<r.length;e++)a[r[e]]=i[e];return a}async getPieceMetadataByKey(e,t,n){let r=this._getWarmStorageViewContract(),[i,a]=await r.getPieceMetadata(e,t,n);return i?a:null}async getServicePrice(){let e=this._getWarmStorageContract(),t=await e.getServicePrice();return{pricePerTiBPerMonthNoCDN:t.pricePerTiBPerMonthNoCDN,pricePerTiBCdnEgress:t.pricePerTiBCdnEgress,pricePerTiBCacheMissEgress:t.pricePerTiBCacheMissEgress,tokenAddress:t.tokenAddress,epochsPerMonth:t.epochsPerMonth,minimumPricePerMonth:t.minimumPricePerMonth}}async calculateStorageCost(e){let t=await this.getServicePrice(),n=BigInt(e),r=t.pricePerTiBPerMonthNoCDN*n/(ni.TiB*t.epochsPerMonth),i={perEpoch:r,perDay:r*BigInt(nn.EPOCHS_PER_DAY),perMonth:r*t.epochsPerMonth};return{...i,withCDN:i}}async checkAllowanceForStorage(e,t,n,r){let i,[a,s]=await Promise.all([n.serviceApproval(this._warmStorageAddress,t7.USDFC),this.calculateStorageCost(e)]),o=t?s.withCDN:s,p=o.perEpoch,d=p*(BigInt(r??Number(nn.DEFAULT_LOCKUP_DAYS))*BigInt(nn.EPOCHS_PER_DAY)),u=BigInt(a.rateUsed)+p,l=BigInt(a.lockupUsed)+d,y=a.rateAllowance>=u&&a.lockupAllowance>=l,c=u>a.rateAllowance?u-a.rateAllowance:0n,m=l>a.lockupAllowance?l-a.lockupAllowance:0n;if(!y){let e=c>0n,t=m>0n;e&&t?i="Insufficient rate and lockup allowances":e?i="Insufficient rate allowance":t&&(i="Insufficient lockup allowance")}return{rateAllowanceNeeded:c,lockupAllowanceNeeded:m,currentRateAllowance:a.rateAllowance,currentLockupAllowance:a.lockupAllowance,currentRateUsed:a.rateUsed,currentLockupUsed:a.lockupUsed,sufficient:y,message:i,costs:o,depositAmountNeeded:d}}async prepareStorageUpload(e,t){let[n,r]=await Promise.all([this.calculateStorageCost(e.dataSize),this.checkAllowanceForStorage(e.dataSize,e.withCDN??!1,t)]),i=e.withCDN?n.withCDN:n,a=[],s=await t.accountInfo(t7.USDFC),o=i.perMonth;if(s.availableFunds<o){let e=o-s.availableFunds;a.push({type:"deposit",description:`Deposit ${e} USDFC to payments contract`,execute:async()=>await t.deposit(e,t7.USDFC)})}return r.sufficient||a.push({type:"approveService",description:`Approve service with rate allowance ${r.rateAllowanceNeeded} and lockup allowance ${r.lockupAllowanceNeeded}`,execute:async()=>await t.approveService(this._warmStorageAddress,r.rateAllowanceNeeded,r.lockupAllowanceNeeded,nn.EPOCHS_PER_MONTH,t7.USDFC)}),{estimatedCost:{perEpoch:i.perEpoch,perDay:i.perDay,perMonth:i.perMonth},allowanceCheck:{sufficient:r.sufficient,message:r.sufficient?void 0:`Insufficient allowances: rate needed ${r.rateAllowanceNeeded}, lockup needed ${r.lockupAllowanceNeeded}`},actions:a}}async terminateDataSet(e,t){let n=this._getWarmStorageContract().connect(e);return await n.terminateService(t)}async addApprovedProvider(e,t){let n=this._getWarmStorageContract().connect(e);return await n.addApprovedProvider(t)}async removeApprovedProvider(e,t){let n=this._getWarmStorageContract().connect(e),r=this._getWarmStorageViewContract(),i=(await r.getApprovedProviders(0n,0n)).findIndex(e=>Number(e)===t);if(-1===i)throw Error(`Provider ${t} is not in the approved list`);return await n.removeApprovedProvider(t,i)}async getApprovedProviderIds(){let e=this._getWarmStorageViewContract();return(await e.getApprovedProviders(0n,0n)).map(e=>Number(e))}async isProviderIdApproved(e){let t=this._getWarmStorageViewContract();return await t.isProviderApproved(e)}async getOwner(){let e=this._getWarmStorageContract();return await e.owner()}async isOwner(e){let t=await e.getAddress(),n=await this.getOwner();return t.toLowerCase()===n.toLowerCase()}async getMaxProvingPeriod(){let e=this._getWarmStorageViewContract();return Number(await e.getMaxProvingPeriod())}async getChallengeWindow(){let e=this._getWarmStorageViewContract();return Number(await e.challengeWindow())}async topUpCDNPaymentRails(e,t,n,r){if(n<0n||r<0n)throw Error("Top up amounts must be positive");if(0n===n&&0n===r)throw Error("At least one top up amount must be >0");let i=this._getWarmStorageContract().connect(e);return await i.topUpCDNPaymentRails(t,n,r)}}e.s([],838840);class a2{_signer;_network;_withCDN;_payments;_provider;_warmStorageAddress;_warmStorageService;_pieceRetriever;_storageManager;_session=null;static async create(e){let t,n,r,i;if(1!==[e.privateKey,e.provider,e.signer].filter(Boolean).length)throw Error("Must provide exactly one of: privateKey, provider, or signer");if(null!=e.privateKey){let i=e.rpcURL??e.rpcURL;if(null==i)throw Error("rpcURL is required when using privateKey");let s=e.privateKey;s.startsWith("0x")||(s=`0x${s}`),r=/^ws(s)?:\/\//i.test(i)?new a.WebSocketProvider(i):new a.JsonRpcProvider(i),t=await iI(r);let o=new a.Wallet(s,r);n=!0===e.disableNonceManager?o:new a.NonceManager(o)}else if(null!=e.provider)if(r=e.provider,t=await iI(r),"getSigner"in r&&"function"==typeof r.getSigner){let t=await r.getSigner(0);n=!0===e.disableNonceManager?t:new a.NonceManager(t)}else throw Error("Provider does not support signing operations");else if(null!=e.signer){if(n=e.signer,!0===e.disableNonceManager||n instanceof a.NonceManager||(n=new a.NonceManager(n)),null==n.provider)throw Error("Signer must have a provider");r=n.provider,t=await iI(r)}else throw Error("No valid authentication method provided");if("mainnet"!==t&&"calibration"!==t)throw Error(`Invalid network: ${String(t)}. Only 'mainnet' and 'calibration' are supported.`);let s=e.warmStorageAddress??np.WARM_STORAGE[t];if(!s)throw Error(`No Warm Storage address configured for network: ${t}`);let o=await aJ.create(r,s),p=new ix(r,n,o.getPaymentsAddress(),o.getUSDFCTokenAddress(),!0===e.disableNonceManager),d=new aV(r,o.getServiceProviderRegistryAddress());if(null!=e.pieceRetriever)i=e.pieceRetriever;else{let n=new aZ(o,d);(null!=e.subgraphConfig||null!=e.subgraphService)&&(n=new aQ(null!=e.subgraphService?e.subgraphService:new aq(e.subgraphConfig))),i=new aX(n,t)}return await ip(e.telemetry||{},{filecoinNetwork:t}),new a2(n,r,t,p,!0===e.withCDN,s,o,i,!1===e.dev,e.withIpni)}constructor(e,t,n,r,i,a,s,o,p,d){this._signer=e,this._provider=t,this._network=n,this._payments=r,this._withCDN=i,this._warmStorageService=s,this._pieceRetriever=o,this._warmStorageAddress=a,this._session=null,this._storageManager=new aH(this,this._warmStorageService,this._pieceRetriever,this._withCDN,p,d)}getNetwork(){return this._network}get telemetry(){return is}getSigner(){return null==this._session?this._signer:this._session.getSigner()}getClient(){return this._signer}createSessionKey(e){return new az(this._provider,this._warmStorageService.getSessionKeyRegistryAddress(),e,this._signer)}setSession(e){this._session=e}getProvider(){return this._provider}getChainId(){return"mainnet"===this._network?t9.mainnet:t9.calibration}getWarmStorageAddress(){return this._warmStorageAddress}getPaymentsAddress(){return this._warmStorageService.getPaymentsAddress()}getPDPVerifierAddress(){return this._warmStorageService.getPDPVerifierAddress()}get payments(){return this._payments}get storage(){return this._storageManager}async createStorage(e={}){return await this._storageManager.createContext(e)}async download(e,t){return console.warn("synapse.download() is deprecated. Use synapse.storage.download() instead."),await this._storageManager.download(e,t)}async getProviderInfo(e){try{let t;if("string"==typeof e)try{a.getAddress(e)}catch{throw Error(`Invalid provider address: ${e}`)}let n=this._warmStorageService.getServiceProviderRegistryAddress(),r=new aV(this._provider,n);if(t="string"==typeof e?await r.getProviderByAddress(e):await r.getProvider(e),null==t)throw Error(`Provider ${e} not found in registry`);return t}catch(e){if(e instanceof Error&&e.message.includes("Invalid provider address")||e instanceof Error&&e.message.includes("not found"))throw e;throw Error(`Failed to get provider info: ${e instanceof Error?e.message:String(e)}`)}}async getStorageInfo(){return console.warn("synapse.getStorageInfo() is deprecated. Use synapse.storage.getStorageInfo() instead."),await this._storageManager.getStorageInfo()}}e.s([],72141),e.s([],108786),e.s([],123051),e.i(123051),e.i(527920),e.s(["PaymentsService",()=>ix],521828),e.i(521828),e.i(861318),e.s(["PDPAuthHelper",()=>iC,"PDPServer",()=>aM,"PDPVerifier",()=>aN,"asDataSetData",()=>aR,"asDataSetPieceData",()=>a_,"isDataSetCreationStatusResponse",()=>aI,"isFindPieceResponse",()=>aE,"isPieceAdditionStatusResponse",()=>aA,"validateDataSetCreationStatusResponse",()=>ax,"validateFindPieceResponse",()=>aD,"validatePieceAdditionStatusResponse",()=>aC],320343),e.i(320343),e.i(355455),e.i(277280),e.s(["ADD_PIECES_TYPEHASH",0,aU,"CREATE_DATA_SET_TYPEHASH",0,ak,"DELETE_DATA_SET_TYPEHASH",0,aL,"PDP_PERMISSIONS",0,aF,"PDP_PERMISSION_NAMES",0,aB,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,a$,"SessionKey",()=>az],919436),e.i(919436),e.i(21482),e.s(["StorageContext",()=>aj,"StorageManager",()=>aH,"StorageService",()=>aj],684462),e.i(684462),e.i(479217),e.s(["SubgraphService",()=>aq],961488),e.i(961488),e.i(72141),e.s(["TelemetryService",()=>ia,"getGlobalTelemetry",()=>io,"initGlobalTelemetry",()=>ip],874425),e.i(874425),e.i(108786),e.i(454742),e.i(34237),e.i(805462),e.s(["CHAIN_IDS",0,t9,"CONTRACT_ABIS",0,ne,"CONTRACT_ADDRESSES",0,np,"EIP2612_PERMIT_TYPES",0,nt,"EIP712_ENCODED_TYPES",0,r8,"EIP712_TYPES",0,r3,"EIP712_TYPE_HASHES",0,r4,"GENESIS_TIMESTAMPS",0,nr,"METADATA_KEYS",0,na,"RPC_URLS",0,no,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ni,"TIME_CONSTANTS",0,nn,"TIMING_CONSTANTS",0,ns,"TOKENS",0,t7,"calculateLastProofDate",()=>ig,"combineMetadata",()=>iP,"constructFindPieceUrl",()=>iE,"constructPieceUrl",()=>iA,"createError",()=>il,"dateToEpoch",()=>ic,"epochToDate",()=>iy,"getCurrentEpoch",()=>iv,"getFilecoinNetworkType",()=>iI,"getGenesisTimestamp",()=>im,"metadataMatches",()=>iS,"timeUntilEpoch",()=>ih],650717),e.i(650717),e.i(838840),e.s(["WarmStorageService",()=>aJ],415157),e.i(415157),e.s(["ADD_PIECES_TYPEHASH",0,aU,"CHAIN_IDS",0,t9,"CONTRACT_ABIS",0,ne,"CONTRACT_ADDRESSES",0,np,"CREATE_DATA_SET_TYPEHASH",0,ak,"DELETE_DATA_SET_TYPEHASH",0,aL,"EIP2612_PERMIT_TYPES",0,nt,"EIP712_ENCODED_TYPES",0,r8,"EIP712_TYPES",0,r3,"EIP712_TYPE_HASHES",0,r4,"GENESIS_TIMESTAMPS",0,nr,"METADATA_KEYS",0,na,"PDPAuthHelper",()=>iC,"PDPServer",()=>aM,"PDPVerifier",()=>aN,"PDP_PERMISSIONS",0,aF,"PDP_PERMISSION_NAMES",0,aB,"PaymentsService",()=>ix,"RPC_URLS",0,no,"SCHEDULE_PIECE_REMOVALS_TYPEHASH",0,a$,"SETTLEMENT_FEE",0,1300000000000000n,"SIZE_CONSTANTS",0,ni,"SessionKey",()=>az,"StorageContext",()=>aj,"StorageManager",()=>aH,"StorageService",()=>aj,"SubgraphService",()=>aq,"Synapse",()=>a2,"TIME_CONSTANTS",0,nn,"TIMING_CONSTANTS",0,ns,"TOKENS",0,t7,"TelemetryService",()=>ia,"WarmStorageService",()=>aJ,"asDataSetData",()=>aR,"asDataSetPieceData",()=>a_,"calculateLastProofDate",()=>ig,"combineMetadata",()=>iP,"constructFindPieceUrl",()=>iE,"constructPieceUrl",()=>iA,"createError",()=>il,"dateToEpoch",()=>ic,"epochToDate",()=>iy,"getCurrentEpoch",()=>iv,"getFilecoinNetworkType",()=>iI,"getGenesisTimestamp",()=>im,"getGlobalTelemetry",()=>io,"initGlobalTelemetry",()=>ip,"isDataSetCreationStatusResponse",()=>aI,"isFindPieceResponse",()=>aE,"isPieceAdditionStatusResponse",()=>aA,"metadataMatches",()=>iS,"timeUntilEpoch",()=>ih,"validateDataSetCreationStatusResponse",()=>ax,"validateFindPieceResponse",()=>aD,"validatePieceAdditionStatusResponse",()=>aC],901486)}]);